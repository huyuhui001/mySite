<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://huyuhui001.github.io/mySite/python/DataAnalysis/ch05/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.3"><title>数据规整：连接、联合与重塑 - UPSkilling</title><link rel=stylesheet href=../../../assets/stylesheets/main.6b80c2a2.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#009485><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=teal data-md-color-accent=green> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=UPSkilling class="md-header__button md-logo" aria-label=UPSkilling data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> UPSkilling </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 数据规整：连接、联合与重塑 </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> UPSkilling </a> </li> <li class=md-tabs__item> <a href=../../../linux/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../k8s/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> Python </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=UPSkilling class="md-nav__button md-logo" aria-label=UPSkilling data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> UPSkilling </label> <div class=md-nav__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> UPSkilling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=UPSkilling data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> UPSkilling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Welcome </a> </li> <li class=md-nav__item> <a href=../../../about/ class=md-nav__link> About </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Linux SRE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux SRE" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Linux SRE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/SRE/01-fundamentals/ class=md-nav__link> Linux Fundamentals </a> </li> <li class=md-nav__item> <a href=../../../linux/SRE/02-filesystem/ class=md-nav__link> File System </a> </li> <li class=md-nav__item> <a href=../../../linux/SRE/03-identity-security/ class=md-nav__link> Identity & Security </a> </li> <li class=md-nav__item> <a href=../../../linux/SRE/04-TextTools/ class=md-nav__link> Text Tools </a> </li> <li class=md-nav__item> <a href=../../../linux/SRE/05-RegExpress/ class=md-nav__link> Regular Expression </a> </li> <li class=md-nav__item> <a href=../../../linux/SRE/06-FileLookup/ class=md-nav__link> File Lookup </a> </li> <li class=md-nav__item> <a href=../../../linux/SRE/07-FilePacking/ class=md-nav__link> FIle Packing & Unpacking </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> SUSE Linux Administration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Linux Administration" data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> SUSE Linux Administration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/Administration/01/ class=md-nav__link> Linux File System Overview </a> </li> <li class=md-nav__item> <a href=../../../linux/Administration/02/ class=md-nav__link> Useful Commands </a> </li> <li class=md-nav__item> <a href=../../../linux/Administration/03/ class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4> SUSE Enterprise Storage Foundation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Enterprise Storage Foundation" data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> SUSE Enterprise Storage Foundation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/SES/linux_ses_memo/ class=md-nav__link> SUSE Enterprise Storage Foundation </a> </li> <li class=md-nav__item> <a href=../../../linux/SES/linux_ses_demo/ class=md-nav__link> SUSE Enterprise Storage Basic Operation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> CKA Learning Memo <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CKA Learning Memo" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> CKA Learning Memo </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_1 type=checkbox id=__nav_3_2_1> <label class=md-nav__link for=__nav_3_2_1> Installation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Installation data-md-level=3> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/installation/single-local/ class=md-nav__link> Single Node Installation </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/installation/multiple-local/ class=md-nav__link> Multiple Nodes Installation </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/installation/aliyun-ubuntu/ class=md-nav__link> Installation on Aliyun ECS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_2 type=checkbox id=__nav_3_2_2> <label class=md-nav__link for=__nav_3_2_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=3> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/docker/ class=md-nav__link> Fundamentals </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_3 type=checkbox id=__nav_3_2_3> <label class=md-nav__link for=__nav_3_2_3> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=3> <label class=md-nav__title for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/memo/ class=md-nav__link> Memo </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/basics/ class=md-nav__link> kubectl basics </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_4 type=checkbox id=__nav_3_2_4> <label class=md-nav__link for=__nav_3_2_4> Core Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Core Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_4> <span class="md-nav__icon md-icon"></span> Core Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_5 type=checkbox id=__nav_3_2_5> <label class=md-nav__link for=__nav_3_2_5> Application Modeling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Application Modeling" data-md-level=3> <label class=md-nav__title for=__nav_3_2_5> <span class="md-nav__icon md-icon"></span> Application Modeling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/secrets/ class=md-nav__link> Secrets </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/rbac/ class=md-nav__link> Role Based Access Control (RBAC) </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/ingress/ class=md-nav__link> Ingress </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_6 type=checkbox id=__nav_3_2_6> <label class=md-nav__link for=__nav_3_2_6> Advanced Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advanced Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_6> <span class="md-nav__icon md-icon"></span> Advanced Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_7 type=checkbox id=__nav_3_2_7> <label class=md-nav__link for=__nav_3_2_7> Operating Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Operating Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_7> <span class="md-nav__icon md-icon"></span> Operating Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/healthcheck/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/helming/ class=md-nav__link> Helming </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_8 type=checkbox id=__nav_3_2_8> <label class=md-nav__link for=__nav_3_2_8> Topics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Topics data-md-level=3> <label class=md-nav__title for=__nav_3_2_8> <span class="md-nav__icon md-icon"></span> Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/casestudy-operation-resources/ class=md-nav__link> Operations on Resources </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/casestudy-health-check/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/casestudy-calico/ class=md-nav__link> Calico Installation </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/kyma/ class=md-nav__link> Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> CKA学习笔记 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CKA学习笔记 data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> CKA学习笔记 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_1 type=checkbox id=__nav_3_3_1> <label class=md-nav__link for=__nav_3_3_1> 安装 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=安装 data-md-level=3> <label class=md-nav__title for=__nav_3_3_1> <span class="md-nav__icon md-icon"></span> 安装 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/installation/single-local/ class=md-nav__link> 单节点虚拟机安装Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/installation/multiple-local/ class=md-nav__link> 多节点虚拟机安装Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/installation/aliyun-ubuntu/ class=md-nav__link> 阿里云ECS安装Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_2 type=checkbox id=__nav_3_3_2> <label class=md-nav__link for=__nav_3_3_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=3> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/docker/ class=md-nav__link> Docker基础 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_3 type=checkbox id=__nav_3_3_3> <label class=md-nav__link for=__nav_3_3_3> 基础知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础知识 data-md-level=3> <label class=md-nav__title for=__nav_3_3_3> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/memo/ class=md-nav__link> Kubernetes随笔 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/overview/ class=md-nav__link> Kubernetes集群概览 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/basics/ class=md-nav__link> kubectl基础 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_4 type=checkbox id=__nav_3_3_4> <label class=md-nav__link for=__nav_3_3_4> 核心概念 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=核心概念 data-md-level=3> <label class=md-nav__title for=__nav_3_3_4> <span class="md-nav__icon md-icon"></span> 核心概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_5 type=checkbox id=__nav_3_3_5> <label class=md-nav__link for=__nav_3_3_5> 应用体系 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=应用体系 data-md-level=3> <label class=md-nav__title for=__nav_3_3_5> <span class="md-nav__icon md-icon"></span> 应用体系 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/secrets/ class=md-nav__link> secrets </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/rbac/ class=md-nav__link> RBAC鉴权 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/ingress/ class=md-nav__link> Ingress-nginx </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_6 type=checkbox id=__nav_3_3_6> <label class=md-nav__link for=__nav_3_3_6> 进阶概念 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=进阶概念 data-md-level=3> <label class=md-nav__title for=__nav_3_3_6> <span class="md-nav__icon md-icon"></span> 进阶概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/hpa/ class=md-nav__link> Horizontal Pod Autoscaling (HPA) </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_7 type=checkbox id=__nav_3_3_7> <label class=md-nav__link for=__nav_3_3_7> 日常维护 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=日常维护 data-md-level=3> <label class=md-nav__title for=__nav_3_3_7> <span class="md-nav__icon md-icon"></span> 日常维护 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/healthcheck/ class=md-nav__link> 健康检查 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/helming/ class=md-nav__link> Helm Chart </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_8 type=checkbox id=__nav_3_3_8> <label class=md-nav__link for=__nav_3_3_8> 主题讨论 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=主题讨论 data-md-level=3> <label class=md-nav__title for=__nav_3_3_8> <span class="md-nav__icon md-icon"></span> 主题讨论 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/casestudy-operation-resources/ class=md-nav__link> Kubernetes资源常见操作 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/casestudy-health-check/ class=md-nav__link> 健康检查 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/casestudy-calico/ class=md-nav__link> 安装Calico </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/demo/cap_on_kyma/ class=md-nav__link> Build CAP Application on Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Python基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python基础 data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Python基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Foundation/ch00/ class=md-nav__link> 安装 </a> </li> <li class=md-nav__item> <a href=../../Foundation/ch01/ class=md-nav__link> 语言基础 </a> </li> <li class=md-nav__item> <a href=../../Foundation/ch02/ class=md-nav__link> 打包和拆包 </a> </li> <li class=md-nav__item> <a href=../../Foundation/ch03/ class=md-nav__link> 函数及文件 </a> </li> <li class=md-nav__item> <a href=../../Foundation/ch04/ class=md-nav__link> 面向对象概念 </a> </li> <li class=md-nav__item> <a href=../../Foundation/ch05/ class=md-nav__link> 面向对象特性 </a> </li> <li class=md-nav__item> <a href=../../Foundation/Algorithms/ class=md-nav__link> 数据结构和算法 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3 checked> <label class=md-nav__link for=__nav_4_3> Python数据分析基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python数据分析基础 data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Python数据分析基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ch01/ class=md-nav__link> NumPy基础 </a> </li> <li class=md-nav__item> <a href=../ch10/ class=md-nav__link> NumPy进阶 </a> </li> <li class=md-nav__item> <a href=../ch02/ class=md-nav__link> Pandas入门 </a> </li> <li class=md-nav__item> <a href=../ch03/ class=md-nav__link> 数据载入、存储及文件格式 </a> </li> <li class=md-nav__item> <a href=../ch04/ class=md-nav__link> 数据清洗与准备 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 数据规整：连接、联合与重塑 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 数据规整：连接、联合与重塑 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 分层索引 </a> <nav class=md-nav aria-label=分层索引> <ul class=md-nav__list> <li class=md-nav__item> <a href=#series class=md-nav__link> Series索引分层 </a> </li> <li class=md-nav__item> <a href=#dataframe class=md-nav__link> DataFrame索引分层 </a> <nav class=md-nav aria-label=DataFrame索引分层> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1 class=md-nav__link> 方法1：直接创建 </a> </li> <li class=md-nav__item> <a href=#2from_arrays class=md-nav__link> 方法2：from_arrays </a> </li> <li class=md-nav__item> <a href=#3from_tuples class=md-nav__link> 方法3：from_tuples </a> </li> <li class=md-nav__item> <a href=#4from_product class=md-nav__link> 方法4：from_product </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 重排序和层级排序 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 按层级进行汇总统计 </a> </li> <li class=md-nav__item> <a href=#dataframe_1 class=md-nav__link> 使用DataFrame的列进行索引 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 联合与合并数据集 </a> <nav class=md-nav aria-label=联合与合并数据集> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dataframe_2 class=md-nav__link> 数据库风格的DataFrame连接 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 根据索引合并 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 沿轴向连接 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 联合重叠数据 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 重塑和透视 </a> <nav class=md-nav aria-label=重塑和透视> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 使用多层索引进行重塑 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 将“长”透视为“宽” </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 将“宽”透视为“长” </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ch06/ class=md-nav__link> 绘图与可视化 </a> </li> <li class=md-nav__item> <a href=../ch07/ class=md-nav__link> 数据聚合与分组操作 </a> </li> <li class=md-nav__item> <a href=../ch08/ class=md-nav__link> 时间序列 </a> </li> <li class=md-nav__item> <a href=../ch09/ class=md-nav__link> 高阶pandas </a> </li> <li class=md-nav__item> <a href=../ch11/ class=md-nav__link> Python建模库介绍 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Demo/CourseSystem/ class=md-nav__link> 选课系统 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 分层索引 </a> <nav class=md-nav aria-label=分层索引> <ul class=md-nav__list> <li class=md-nav__item> <a href=#series class=md-nav__link> Series索引分层 </a> </li> <li class=md-nav__item> <a href=#dataframe class=md-nav__link> DataFrame索引分层 </a> <nav class=md-nav aria-label=DataFrame索引分层> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1 class=md-nav__link> 方法1：直接创建 </a> </li> <li class=md-nav__item> <a href=#2from_arrays class=md-nav__link> 方法2：from_arrays </a> </li> <li class=md-nav__item> <a href=#3from_tuples class=md-nav__link> 方法3：from_tuples </a> </li> <li class=md-nav__item> <a href=#4from_product class=md-nav__link> 方法4：from_product </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 重排序和层级排序 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 按层级进行汇总统计 </a> </li> <li class=md-nav__item> <a href=#dataframe_1 class=md-nav__link> 使用DataFrame的列进行索引 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 联合与合并数据集 </a> <nav class=md-nav aria-label=联合与合并数据集> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dataframe_2 class=md-nav__link> 数据库风格的DataFrame连接 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 根据索引合并 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 沿轴向连接 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 联合重叠数据 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 重塑和透视 </a> <nav class=md-nav aria-label=重塑和透视> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 使用多层索引进行重塑 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 将“长”透视为“宽” </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 将“宽”透视为“长” </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/huyuhui001/mySite/edit/main/docs/python/DataAnalysis/ch05.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=_1>数据规整：连接、联合与重塑<a class=headerlink href=#_1 title="Permanent link"> ¶</a></h1> <h2 id=_2>分层索引<a class=headerlink href=#_2 title="Permanent link"> ¶</a></h2> <div class=highlight><pre><span></span><code>import pandas as pd
import numpy as np
import re
</code></pre></div> <p>分层索引是pandas的重要特性，允许你在一个轴向上拥有多个（两个或两个以上）索引层级。 分层索<code>import re</code>引提供了一种在更低维度的形式中处理更高维度数据的方式。</p> <h3 id=series>Series索引分层<a class=headerlink href=#series title="Permanent link"> ¶</a></h3> <div class=highlight><pre><span></span><code>data = pd.Series(
    np.random.randn(9),
    index=[[&#39;a&#39;, &#39;a&#39;, &#39;a&#39;, &#39;b&#39;, &#39;b&#39;, &#39;c&#39;, &#39;c&#39;, &#39;d&#39;, &#39;d&#39;],
           [1, 2, 3, 1, 3, 1, 2, 2, 3]]
)
</code></pre></div> <p>输出是一个以<code>MultiIndex</code>作为索引的Series的美化视图。 索引中的"间隙"表示"直接使用上面的标签"。 <div class=highlight><pre><span></span><code>print(data)
# a  1    0.163468
#    2   -1.525926
#    3   -0.210247
# b  1   -0.956063
#    3   -1.839111
# c  1   -0.398905
#    2    0.595279
# d  2    0.034305
#    3   -0.896078
# dtype: float64

print(data.index)
# MultiIndex([(&#39;a&#39;, 1),
#             (&#39;a&#39;, 2),
#             (&#39;a&#39;, 3),
#             (&#39;b&#39;, 1),
#             (&#39;b&#39;, 3),
#             (&#39;c&#39;, 1),
#             (&#39;c&#39;, 2),
#             (&#39;d&#39;, 2),
#             (&#39;d&#39;, 3)],
#            )
</code></pre></div></p> <p>通过分层索引对象，也可以称为部分索引，可以简洁地选择出数据的子集。 <div class=highlight><pre><span></span><code>m = data[&#39;b&#39;]
print(m)
# 1   -0.956063
# 3   -1.839111
# dtype: float64

m = data[&#39;b&#39;: &#39;c&#39;]
print(m)
# b  1   -0.956063
#    3   -1.839111
# c  1   -0.398905
#    2    0.595279
# dtype: float64
m = data.loc[[&#39;b&#39;, &#39;c&#39;]]
print(m)
# b  1   -0.956063
#    3   -1.839111
# c  1   -0.398905
#    2    0.595279
# dtype: float64

m = data.loc[:, 2]
print(m)
# a   -1.525926
# c    0.595279
# d    0.034305
# dtype: float64
</code></pre></div></p> <p>分层索引在重塑数据和数组透视表等分组操作中扮演了重要角色。 例如，你可以使用<code>unstack</code>方法将数据在DataFrame中重新排列。 <div class=highlight><pre><span></span><code>m = data.unstack()
print(m)
#           1         2         3
# a  0.163468 -1.525926 -0.210247
# b -0.956063       NaN -1.839111
# c -0.398905  0.595279       NaN
# d       NaN  0.034305 -0.896078
n = m.stack()
print(n)  # 或者 print(data.unstack().stack())
# a  1    0.163468
#    2   -1.525926
#    3   -0.210247
# b  1   -0.956063
#    3   -1.839111
# c  1   -0.398905
#    2    0.595279
# d  2    0.034305
#    3   -0.896078
# dtype: float64
</code></pre></div></p> <h3 id=dataframe>DataFrame索引分层<a class=headerlink href=#dataframe title="Permanent link"> ¶</a></h3> <p>在DataFrame中，每个轴都可以拥有分层索引。<a href=https://www.jianshu.com/p/2c1c8fbee55a>参考</a></p> <h4 id=1>方法1：直接创建<a class=headerlink href=#1 title="Permanent link"> ¶</a></h4> <p>直接通过给<code>index</code>（columns）参数传递多维数组，进而构建多维索引。 数组中每个维度对应位置的元素，组成每个索引值。 <div class=highlight><pre><span></span><code>frame = pd.DataFrame(
    np.arange(12).reshape((4, 3)),
    index=[[&#39;a&#39;, &#39;a&#39;, &#39;b&#39;, &#39;b&#39;],
           [1, 2, 1, 2]],
    columns=[[&#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Colorado&#39;],
             [&#39;Green&#39;, &#39;Red&#39;, &#39;Green&#39;]]
)

print(frame)
#      Ohio     Colorado
#     Green Red    Green
# a 1     0   1        2
#   2     3   4        5
# b 1     6   7        8
#   2     9  10       11
</code></pre></div></p> <p>上面输出中的2个层级是没有名字。 分层的层级可以有名称（可以是字符串或Python对象）。 如果层级有名称，这些名称会在控制台输出中显示。 <div class=highlight><pre><span></span><code>print(frame.index.names)
# [None, None]
print(frame.columns.names)
# [None, None]
</code></pre></div></p> <p>给层级赋予名称。注意区分行标签中的索引名称<code>state</code>和<code>color</code>。 <div class=highlight><pre><span></span><code>frame.index.names = [&#39;key1&#39;, &#39;key2&#39;]
frame.columns.names = [&#39;state&#39;, &#39;color&#39;]
print(frame)
# state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
#      2        3   4        5
# b    1        6   7        8
#      2        9  10       11
print(frame[&#39;Ohio&#39;])
# color      Green  Red
# key1 key2
# a    1         0    1
#      2         3    4
# b    1         6    7
#      2         9   10

print(frame.index)
# MultiIndex([(&#39;a&#39;, 1),
#             (&#39;a&#39;, 2),
#             (&#39;b&#39;, 1),
#             (&#39;b&#39;, 2)],
#            names=[&#39;key1&#39;, &#39;key2&#39;])
</code></pre></div></p> <p>通过<code>MultiIndex</code>类的相关方法，预先创建一个<code>MultiIndex</code>对象，然后作为Series与DataFrame中的<code>index</code>（或columns）参数值。同时，可以通过<code>names</code>参数指定多层索引的名称。</p> <h4 id=2from_arrays>方法2：from_arrays<a class=headerlink href=#2from_arrays title="Permanent link"> ¶</a></h4> <p><code>from_arrays</code>：接收一个多维数组参数，高维指定高层索引，低维指定底层索引。 <div class=highlight><pre><span></span><code>mindex = pd.MultiIndex.from_arrays(
    [[&#39;a&#39;, &#39;a&#39;, &#39;b&#39;, &#39;b&#39;],
     [1, 2, 1, 2]],
    names=[&#39;key1&#39;, &#39;key2&#39;]
)
frame = pd.DataFrame(
    np.arange(12).reshape((4, 3)),
    index=mindex,
    columns=[[&#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Colorado&#39;],
             [&#39;Green&#39;, &#39;Red&#39;, &#39;Green&#39;]]
)
frame.columns.names = [&#39;state&#39;, &#39;color&#39;]
print(frame)
# state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
#      2        3   4        5
# b    1        6   7        8
#      2        9  10       11
</code></pre></div></p> <h4 id=3from_tuples>方法3：from_tuples<a class=headerlink href=#3from_tuples title="Permanent link"> ¶</a></h4> <p><code>from_tuples</code>：接收一个元组的列表，每个元组指定每个索引（高维索引，低维索引）。 <div class=highlight><pre><span></span><code>mindex = pd.MultiIndex.from_tuples(
    [(&#39;a&#39;, 1),
     (&#39;a&#39;, 2),
     (&#39;b&#39;, 1),
     (&#39;b&#39;, 2)]
)
frame = pd.DataFrame(
    np.arange(12).reshape((4, 3)),
    index=mindex,
    columns=[[&#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Colorado&#39;],
             [&#39;Green&#39;, &#39;Red&#39;, &#39;Green&#39;]]
)
frame.index.names = [&#39;key1&#39;, &#39;key2&#39;]
frame.columns.names = [&#39;state&#39;, &#39;color&#39;]
print(frame)
# state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
#      2        3   4        5
# b    1        6   7        8
#      2        9  10       11
</code></pre></div></p> <h4 id=4from_product>方法4：from_product<a class=headerlink href=#4from_product title="Permanent link"> ¶</a></h4> <p><code>from_product</code>：接收一个可迭代对象的列表，根据多个可迭代对象元素的笛卡尔积进行创建索引。 使用笛卡尔积的方式来创建多层索引。参数为嵌套的可迭代对象。结果为使用每个一维数组中的元素与其他一维数组中的元素来生成。 笛卡尔积的方式的局限：两两组合必须都存在，否则，就不能使用这种方式。</p> <div class=highlight><pre><span></span><code>mindex = pd.MultiIndex.from_product(
    [[&#39;a&#39;, &#39;b&#39;],
     [&#39;1&#39;, &#39;2&#39;]],
    names=[&#39;key1&#39;, &#39;key2&#39;]
)
frame = pd.DataFrame(
    np.arange(12).reshape((4, 3)),
    index=mindex,
    columns=[[&#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Colorado&#39;],
             [&#39;Green&#39;, &#39;Red&#39;, &#39;Green&#39;]]
)
frame.columns.names = [&#39;state&#39;, &#39;color&#39;]
print(frame)
# state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
#      2        3   4        5
# b    1        6   7        8
#      2        9  10       11
</code></pre></div> <h3 id=_3>重排序和层级排序<a class=headerlink href=#_3 title="Permanent link"> ¶</a></h3> <p>如果需要重新排列轴上的层级顺序，或者按照特定层级的值对数据进行排序， 可以通过swaplevel接收两个层级序号或层级名称，返回一个进行了层级变更的新对象（但是数据是不变的）。 <div class=highlight><pre><span></span><code>print(frame)
# state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
#      2        3   4        5
# b    1        6   7        8
#      2        9  10       11
m = frame.swaplevel(&#39;key1&#39;, &#39;key2&#39;)
print(m)
# state      Ohio     Colorado
# color     Green Red    Green
# key2 key1
# 1    a        0   1        2
# 2    a        3   4        5
# 1    b        6   7        8
# 2    b        9  10       11
</code></pre></div></p> <p><code>sort_index</code>只能在单一层级上对数据进行排序。 在进行层级变换时，使用<code>sort_index</code>以使得结果按照层级进行字典排序。 <div class=highlight><pre><span></span><code>m = frame.sort_index(level=1)  # 对key2排序，底层索引
print(m)
# state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
# b    1        6   7        8
# a    2        3   4        5
# b    2        9  10       11
m = frame.sort_index(level=0)  # 对key1排序，高层索引
print(m)
# state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
#      2        3   4        5
# b    1        6   7        8
#      2        9  10       11

m = frame.swaplevel(0, 1).sort_index(level=1)  # swaplevel(0, 1)等同于swaplevel(key1, key2)，交换后key1变成了底层索引
print(m)
# state      Ohio     Colorado
# color     Green Red    Green
# key2 key1
# 1    a        0   1        2
# 2    a        3   4        5
# 1    b        6   7        8
# 2    b        9  10       11
</code></pre></div></p> <h3 id=_4>按层级进行汇总统计<a class=headerlink href=#_4 title="Permanent link"> ¶</a></h3> <p>DataFrame和Series中很多描述性和汇总性统计有一个<code>level</code>选项，通过<code>level</code>选项你可以指定你想要在某个特定的轴上进行聚合。 <div class=highlight><pre><span></span><code>print(frame)
# state      Ohio     Colorado
# color     Green Red    Green
# key1 key2
# a    1        0   1        2
#      2        3   4        5
# b    1        6   7        8
#      2        9  10       11
m = frame.groupby(level=&#39;key2&#39;).sum()
print(m)
# state  Ohio     Colorado
# color Green Red    Green
# key2
# 1         6   8       10
# 2        12  14       16
m = frame.groupby(level=&#39;color&#39;, axis=1).sum()
print(m)
# color      Green  Red
# key1 key2
# a    1         2    1
#      2         8    4
# b    1        14    7
#      2        20   10
</code></pre></div></p> <h3 id=dataframe_1>使用DataFrame的列进行索引<a class=headerlink href=#dataframe_1 title="Permanent link"> ¶</a></h3> <p>通常我们不会使用DataFrame中一个或多个列作为行索引；反而你可能想要将行索引移动到DataFrame的列中。 <div class=highlight><pre><span></span><code>frame = pd.DataFrame(
    {&#39;a&#39;: range(7),
     &#39;b&#39;: range(7, 0, -1),
     &#39;c&#39;: [&#39;one&#39;, &#39;one&#39;, &#39;one&#39;, &#39;two&#39;, &#39;two&#39;, &#39;two&#39;, &#39;two&#39;],
     &#39;d&#39;: [0, 1, 2, 0, 1, 2, 3]
     }
)
print(frame)
#    a  b    c  d
# 0  0  7  one  0
# 1  1  6  one  1
# 2  2  5  one  2
# 3  3  4  two  0
# 4  4  3  two  1
# 5  5  2  two  2
# 6  6  1  two  3
</code></pre></div></p> <p>DataFrame的<code>set_index</code>函数会生成一个新的DataFrame，新的DataFrame使用一个或多个列作为索引。 默认情况下这些索引列会从DataFrame中移除，也可以将它们留在DataFrame中。 <div class=highlight><pre><span></span><code>frame2 = frame.set_index([&#39;c&#39;, &#39;d&#39;], drop=False)
print(frame2)
#        a  b    c  d
# c   d
# one 0  0  7  one  0
#     1  1  6  one  1
#     2  2  5  one  2
# two 0  3  4  two  0
#     1  4  3  two  1
#     2  5  2  two  2
#     3  6  1  two  3

frame2 = frame.set_index([&#39;c&#39;, &#39;d&#39;])
print(frame2)
#        a  b
# c   d
# one 0  0  7
#     1  1  6
#     2  2  5
# two 0  3  4
#     1  4  3
#     2  5  2
#     3  6  1
</code></pre></div></p> <p><code>reset_index</code>是<code>set_index</code>的反操作，分层索引的索引层级会被移动到列中。 注意：如果在<code>set_index</code>时使用了<code>drop=False</code>，在使用<code>reset_index</code>会报错。 <div class=highlight><pre><span></span><code>m = frame2.reset_index()
print(m)
#      c  d  a  b
# 0  one  0  0  7
# 1  one  1  1  6
# 2  one  2  2  5
# 3  two  0  3  4
# 4  two  1  4  3
# 5  two  2  5  2
# 6  two  3  6  1
</code></pre></div></p> <h2 id=_5>联合与合并数据集<a class=headerlink href=#_5 title="Permanent link"> ¶</a></h2> <p>包含在pandas对象的数据可以通过多种方式联合在一起：</p> <ul> <li><code>pandas.merge</code>根据一个或多个键将行进行连接。对于SQL或其他关系型数据库的用户来说，这种方式比较熟悉，它实现的是数据库的连接操作。</li> <li><code>pandas.concat</code>使对象在轴向上进行黏合或“堆叠”。</li> <li><code>combine_first</code>实例方法允许将重叠的数据拼接在一起，以使用一个对象中的值填充另一个对象中的缺失值。</li> </ul> <h3 id=dataframe_2>数据库风格的DataFrame连接<a class=headerlink href=#dataframe_2 title="Permanent link"> ¶</a></h3> <p>合并或连接操作通过一个或多个键连接行来联合数据集。 这些操作是关系型数据库的核心内容（例如基于SQL的数据库）。 pandas中的<code>merge</code>函数主要用于将各种<code>join</code>操作算法运用在数据上。 在进行列-列连接时，传递的DataFrame索引对象会被丢弃。 合并操作也要考虑如何处理重叠的列名(<code>suffixes</code>后缀选项)。</p> <p>下面是一个多对一连接的例子。 <code>df1</code>的数据有多个行的标签为<code>a</code>和<code>b</code>，而<code>df2</code>在<code>key</code>列中每个值仅有一行。 <div class=highlight><pre><span></span><code>df1 = pd.DataFrame(
    {
        &#39;key&#39;: [&#39;b&#39;, &#39;b&#39;, &#39;a&#39;, &#39;c&#39;, &#39;a&#39;, &#39;a&#39;, &#39;b&#39;],
        &#39;data1&#39;: range(7)
     }
)
df2 = pd.DataFrame(
    {
        &#39;key&#39;: [&#39;a&#39;, &#39;b&#39;, &#39;d&#39;],
        &#39;data1&#39;: range(3)
     }
)
print(df1)
#   key  data1
# 0   b      0
# 1   b      1
# 2   a      2
# 3   c      3
# 4   a      4
# 5   a      5
# 6   b      6
print(df2)
#   key  data1
# 0   a      0
# 1   b      1
# 2   d      2
</code></pre></div></p> <p>调用<code>merge</code>处理，推荐显式地指定连接键。 <div class=highlight><pre><span></span><code>result = pd.merge(df1, df2)
print(result)
#   key  data1
# 0   b      1
result = pd.merge(df1, df2, on=[&#39;key&#39;, &#39;data1&#39;])
print(result)
#   key  data1
# 0   b      1
result = pd.merge(df1, df2, on=&#39;key&#39;)
print(result)
#   key  data1_x  data1_y
# 0   b        0        1
# 1   b        1        1
# 2   b        6        1
# 3   a        2        0
# 4   a        4        0
# 5   a        5        0
</code></pre></div></p> <p>如果每个对象的列名是不同的，可以分别为它们指定列名。 <div class=highlight><pre><span></span><code>df3 = pd.DataFrame(
    {
        &#39;lkey&#39;: [&#39;b&#39;, &#39;b&#39;, &#39;a&#39;, &#39;c&#39;, &#39;a&#39;, &#39;a&#39;, &#39;b&#39;],
        &#39;data1&#39;: range(7)
     }
)

df4 = pd.DataFrame(
    {
        &#39;rkey&#39;: [&#39;a&#39;, &#39;b&#39;, &#39;d&#39;],
        &#39;data2&#39;: range(3)
     }
)
print(df3)
#   lkey  data1
# 0    b      0
# 1    b      1
# 2    a      2
# 3    c      3
# 4    a      4
# 5    a      5
# 6    b      6
print(df4)
#   rkey  data2
# 0    a      0
# 1    b      1
# 2    d      2
</code></pre></div></p> <p>默认情况下，<code>merge</code>做的是内连接（'inner' join），结果中的键是两张表的交集。 <div class=highlight><pre><span></span><code>result = pd.merge(df3, df4, left_on=&#39;lkey&#39;, right_on=&#39;rkey&#39;)  # df4的[a,0]对应df3的所有[a,?]记录（通过重复来填充不足）
print(result)
#   lkey  data1 rkey  data2
# 0    b      0    b      1
# 1    b      1    b      1
# 2    b      6    b      1
# 3    a      2    a      0
# 4    a      4    a      0
# 5    a      5    a      0
</code></pre></div></p> <p>外连接（outer join）是键的并集，联合了左连接和右连接的效果。 多对多连接是行的笛卡尔积。 <div class=highlight><pre><span></span><code>df1 = pd.DataFrame(
    {
        &#39;key&#39;: [&#39;b&#39;, &#39;b&#39;, &#39;a&#39;, &#39;c&#39;, &#39;a&#39;, &#39;b&#39;],
        &#39;data1&#39;: range(6)
     }
)
df2 = pd.DataFrame(
    {
        &#39;key&#39;: [&#39;a&#39;, &#39;b&#39;, &#39;a&#39;, &#39;b&#39;, &#39;d&#39;],
        &#39;data2&#39;: range(5)
     }
)
print(df1.sort_values(by=&#39;key&#39;))
#   key  data1
# 2   a      2
# 4   a      4
# 0   b      0
# 1   b      1
# 5   b      5
# 3   c      3
print(df2.sort_values(by=&#39;key&#39;))
#   key  data2
# 0   a      0
# 2   a      2
# 1   b      1
# 3   b      3
# 4   d      4

result = pd.merge(df1, df2, on=&#39;key&#39;, how=&#39;left&#39;)
print(result.sort_values(by=&#39;key&#39;))
#    key  data1  data2
# 4    a      2    0.0
# 5    a      2    2.0
# 7    a      4    0.0
# 8    a      4    2.0
# 0    b      0    1.0
# 1    b      0    3.0
# 2    b      1    1.0
# 3    b      1    3.0
# 9    b      5    1.0
# 10   b      5    3.0
# 6    c      3    NaN

result = pd.merge(df1, df2, on=&#39;key&#39;, how=&#39;outer&#39;)  # 多对多连接
print(result.sort_values(by=&#39;key&#39;))
#    key  data1  data2
# 6    a    2.0    0.0
# 7    a    2.0    2.0
# 8    a    4.0    0.0
# 9    a    4.0    2.0
# 0    b    0.0    1.0
# 1    b    0.0    3.0
# 2    b    1.0    1.0
# 3    b    1.0    3.0
# 4    b    5.0    1.0
# 5    b    5.0    3.0
# 10   c    3.0    NaN
# 11   d    NaN    4.0
</code></pre></div></p> <p>多键合并。 <div class=highlight><pre><span></span><code>df1 = pd.DataFrame(
    {
        &#39;key1&#39;: [&#39;foo&#39;, &#39;foo&#39;, &#39;bar&#39;],
        &#39;key2&#39;: [&#39;one&#39;, &#39;two&#39;, &#39;one&#39;],
        &#39;lval&#39;: [1, 2, 3]
     }
)
df2 = pd.DataFrame(
    {
        &#39;key1&#39;: [&#39;foo&#39;, &#39;foo&#39;, &#39;bar&#39;, &#39;bar&#39;],
        &#39;key2&#39;: [&#39;one&#39;, &#39;one&#39;, &#39;one&#39;, &#39;two&#39;],
        &#39;rval&#39;: [4, 5, 6, 7]
     }
)
print(df1.sort_values(by=[&#39;key1&#39;, &#39;key2&#39;]))
#   key1 key2  lval
# 2  bar  one     3
# 0  foo  one     1
# 1  foo  two     2
print(df2.sort_values(by=[&#39;key1&#39;, &#39;key2&#39;]))
#   key1 key2  rval
# 2  bar  one     6
# 3  bar  two     7
# 0  foo  one     4
# 1  foo  one     5

result = pd.merge(df1, df2, on=[&#39;key1&#39;, &#39;key2&#39;], how=&#39;outer&#39;)
print(result.sort_values(by=[&#39;key1&#39;, &#39;key2&#39;]))
#   key1 key2  lval  rval
# 3  bar  one   3.0   6.0
# 4  bar  two   NaN   7.0
# 0  foo  one   1.0   4.0  # 重复填充
# 1  foo  one   1.0   5.0  # 重复填充
# 2  foo  two   2.0   NaN
</code></pre></div></p> <p>处理重叠列名。 <div class=highlight><pre><span></span><code>result = pd.merge(df1, df2, on=&#39;key1&#39;)
print(result.sort_values(by=&#39;key1&#39;))
#   key1 key2_x  lval key2_y  rval
# 4  bar    one     3    one     6
# 5  bar    one     3    two     7
# 0  foo    one     1    one     4
# 1  foo    one     1    one     5
# 2  foo    two     2    one     4
# 3  foo    two     2    one     5
result = pd.merge(df1, df2, on=&#39;key1&#39;, suffixes=(&#39;_left&#39;, &#39;_right&#39;))
print(result.sort_values(by=&#39;key1&#39;))
#   key1 key2_left  lval key2_right  rval
# 4  bar       one     3        one     6
# 5  bar       one     3        two     7
# 0  foo       one     1        one     4
# 1  foo       one     1        one     5
# 2  foo       two     2        one     4
# 3  foo       two     2        one     5
</code></pre></div></p> <h3 id=_6>根据索引合并<a class=headerlink href=#_6 title="Permanent link"> ¶</a></h3> <p>在某些情况下，DataFrame中用于合并的键是它的索引。可以传递<code>left_index=True</code>或<code>right_index=True</code>（或者都传）来表示索引需要用来作为合并的键。 <div class=highlight><pre><span></span><code>df1 = pd.DataFrame(
    {
        &#39;key1&#39;: [&#39;foo&#39;, &#39;foo&#39;, &#39;bar&#39;],
        &#39;key2&#39;: [&#39;one&#39;, &#39;two&#39;, &#39;one&#39;],
        &#39;lval&#39;: [1, 2, 3]
     }
)
df2 = pd.DataFrame(
    {
        &#39;key1&#39;: [&#39;foo&#39;, &#39;foo&#39;, &#39;bar&#39;, &#39;bar&#39;],
        &#39;key2&#39;: [&#39;one&#39;, &#39;one&#39;, &#39;one&#39;, &#39;two&#39;],
        &#39;rval&#39;: [4, 5, 6, 7]
     },
    index=[&#39;foo&#39;, &#39;foo&#39;, &#39;bar&#39;, &#39;bar&#39;]
)
print(df1)
#   key1 key2  lval
# 0  foo  one     1
# 1  foo  two     2
# 2  bar  one     3
print(df2)
#     key1 key2  rval
# foo  foo  one     4
# foo  foo  one     5
# bar  bar  one     6
# bar  bar  two     7
result = pd.merge(df1, df2, left_on=&#39;key1&#39;, right_index=True, suffixes=(&#39;_left&#39;, &#39;_right&#39;))
print(result.sort_index())
#   key1 key1_left key2_left  lval key1_right key2_right  rval
# 0  foo       foo       one     1        foo        one     4
# 0  foo       foo       one     1        foo        one     5
# 1  foo       foo       two     2        foo        one     4
# 1  foo       foo       two     2        foo        one     5
# 2  bar       bar       one     3        bar        one     6
# 2  bar       bar       one     3        bar        two     7
result = pd.merge(df1, df2, left_on=&#39;key1&#39;, right_index=True, how=&#39;outer&#39;, suffixes=(&#39;_left&#39;, &#39;_right&#39;))  # 和上述结果一样
print(result.sort_index())
#   key1 key1_left key2_left  lval key1_right key2_right  rval
# 0  foo       foo       one     1        foo        one     4
# 0  foo       foo       one     1        foo        one     5
# 1  foo       foo       two     2        foo        one     4
# 1  foo       foo       two     2        foo        one     5
# 2  bar       bar       one     3        bar        one     6
# 2  bar       bar       one     3        bar        two     7
</code></pre></div></p> <p>在更复杂多层索引数据的多键合并，在索引上连接是一个隐式的多键合并。 必须以列表的方式指明合并所需多个列（注意使用<code>how='outer'</code>处理重复的索引值）。 <div class=highlight><pre><span></span><code>df1 = pd.DataFrame(
    {
        &#39;key1&#39;: [&#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Nevada&#39;, &#39;Nevada&#39;],
        &#39;key2&#39;: [2000, 2001, 2002, 2001, 2002],
        &#39;data&#39;: np.arange(5.)
    }
)
df2 = pd.DataFrame(
    np.arange(12).reshape((6, 2)),
    index=[
        [&#39;Nevada&#39;, &#39;Nevada&#39;, &#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Ohio&#39;],
        [2001, 2000, 2000, 2000, 2001, 2002]
    ],
    columns=[&#39;event1&#39;, &#39;event2&#39;]
)
print(df1)
#      key1  key2  data
# 0    Ohio  2000   0.0
# 1    Ohio  2001   1.0
# 2    Ohio  2002   2.0
# 3  Nevada  2001   3.0
# 4  Nevada  2002   4.0
print(df2)
#              event1  event2
# Nevada 2001       0       1
#        2000       2       3
# Ohio   2000       4       5
#        2000       6       7
#        2001       8       9
#        2002      10      11
result = pd.merge(df1, df2, left_on=[&#39;key1&#39;, &#39;key2&#39;], right_index=True)
print(result)
#      key1  key2  data  event1  event2
# 0    Ohio  2000   0.0       4       5
# 0    Ohio  2000   0.0       6       7
# 1    Ohio  2001   1.0       8       9
# 2    Ohio  2002   2.0      10      11
# 3  Nevada  2001   3.0       0       1
result = pd.merge(df1, df2, left_on=[&#39;key1&#39;, &#39;key2&#39;], right_index=True, how=&#39;outer&#39;)
print(result)
#      key1  key2  data  event1  event2
# 0    Ohio  2000   0.0     4.0     5.0
# 0    Ohio  2000   0.0     6.0     7.0
# 1    Ohio  2001   1.0     8.0     9.0
# 2    Ohio  2002   2.0    10.0    11.0
# 3  Nevada  2001   3.0     0.0     1.0
# 4  Nevada  2002   4.0     NaN     NaN
# 4  Nevada  2000   NaN     2.0     3.0
</code></pre></div></p> <p>使用两边的索引进行合并也是可以的，前提是用两边用来合并的索引有交集（公共部分）。 在使用<code>merge</code>时，参数<code>on=['key1', 'key2']</code>不能和 <code>left_index=True</code>, <code>right_index=True</code>同时存在。 对于重复索引，如果值不同，则多行显示，和数据库SQL的<code>full join</code>类似概念。 如果出现相同列名，则会自动添加后缀字符以示区别。 <div class=highlight><pre><span></span><code>df1 = pd.DataFrame(
    [[1, 2], [3, 4], [5, 6]],
    index=[&#39;a&#39;, &#39;c&#39;, &#39;e&#39;],
    columns=[&#39;Ohio&#39;, &#39;Nevada&#39;]
)
print(df1)
#    Ohio  Nevada
# a     1       2
# c     3       4
# e     5       6
df2 = pd.DataFrame(
    [[7, 8], [9, 10], [11, 12], [13, 14]],
    index=[&#39;b&#39;, &#39;c&#39;, &#39;c&#39;, &#39;e&#39;],
    columns=[&#39;Missouri&#39;, &#39;Alabama&#39;]
)
print(df2)
#    Missouri  Alabama
# b         7        8
# c         9       10
# c        11       12
# e        13       14
df3 = pd.DataFrame(
    [[7, 8], [9, 10], [11, 12], [13, 14]],
    index=[&#39;a&#39;, &#39;c&#39;, &#39;e&#39;, &#39;f&#39;],
    columns=[&#39;Nevada&#39;, &#39;Alabama&#39;]
)
print(df3)
#    Nevada  Alabama
# a       7        8
# c       9       10
# e      11       12
# f      13       14
result = pd.merge(df1, df2, left_index=True, right_index=True, how=&#39;outer&#39;)
print(result)
#    Ohio  Nevada  Missouri  Alabama
# a   1.0     2.0       NaN      NaN
# b   NaN     NaN       7.0      8.0
# c   3.0     4.0       9.0     10.0
# c   3.0     4.0      11.0     12.0
# e   5.0     6.0      13.0     14.0
result = pd.merge(df1, df3, left_index=True, right_index=True, how=&#39;outer&#39;)
print(result)
#    Ohio  Nevada_x  Nevada_y  Alabama
# a   1.0       2.0         7        8
# c   3.0       4.0         9       10
# e   5.0       6.0        11       12
# f   NaN       NaN        13       14
</code></pre></div></p> <p>另一种写法： <div class=highlight><pre><span></span><code>result = df1.join(df2, how=&#39;outer&#39;)
print(result)
#    Ohio  Nevada  Missouri  Alabama
# a   1.0     2.0       NaN      NaN
# b   NaN     NaN       7.0      8.0
# c   3.0     4.0       9.0     10.0
# c   3.0     4.0      11.0     12.0
# e   5.0     6.0      13.0     14.0
</code></pre></div></p> <p>也可以向<code>join</code>方法传入一个DataFrame列表，类似于对三个数据集进行<code>join</code>操作。 <div class=highlight><pre><span></span><code>result = df1.join([df2, df3])
print(result)
#    Ohio  Nevada_x  Missouri  Alabama_x  Nevada_y  Alabama_y
# a     1         2       NaN        NaN         7          8
# c     3         4       9.0       10.0         9         10
# c     3         4      11.0       12.0         9         10
# e     5         6      13.0       14.0        11         12
</code></pre></div></p> <h3 id=_7>沿轴向连接<a class=headerlink href=#_7 title="Permanent link"> ¶</a></h3> <p>另一种数据组合操作可称为拼接、绑定或堆叠。NumPy的<code>concatenate</code>函数可以在NumPy数组上实现该功能。</p> <p>基于Series的pandas的<code>concat</code>函数的工作机制分析。</p> <p>下面三个索引不重叠的Series。 <div class=highlight><pre><span></span><code>s1 = pd.Series([0, 1], index=[&#39;a&#39;, &#39;b&#39;])
s2 = pd.Series([2, 3, 4], index=[&#39;c&#39;, &#39;d&#39;, &#39;e&#39;])
s3 = pd.Series([5, 6], index=[&#39;f&#39;, &#39;g&#39;])
</code></pre></div></p> <p>用列表中的这些对象调用<code>concat</code>方法会将值和索引粘在一起： 默认情况下，<code>concat</code>方法是沿着<code>axis=0</code>的轴向生效的，生成另一个Series。 如果传递<code>axis=1</code>，返回的结果则是一个DataFrame（<code>axis=1</code>时是列）。 <div class=highlight><pre><span></span><code>result = pd.concat([s1, s2, s3])
print(result)
# a    0
# b    1
# c    2
# d    3
# e    4
# f    5
# g    6
# dtype: int64
result = pd.concat([s1, s2, s3], keys=[&#39;one&#39;, &#39;two&#39;, &#39;three&#39;])  # 通过keys参数，在连接轴向上创建一个多层索引，以便在结果中区分各部分
print(result)
# one    a    0
#        b    1
# two    c    2
#        d    3
#        e    4
# three  f    5
#        g    6
# dtype: int64
print(result.unstack())  # 把原索引作为列标签展开
#          a    b    c    d    e    f    g
# one    0.0  1.0  NaN  NaN  NaN  NaN  NaN
# two    NaN  NaN  2.0  3.0  4.0  NaN  NaN
# three  NaN  NaN  NaN  NaN  NaN  5.0  6.0
result = pd.concat([s1, s2, s3], axis=1)  # 在这个案例中axis=1轴向上并没有重叠
print(result)
#      0    1    2
# a  0.0  NaN  NaN
# b  1.0  NaN  NaN
# c  NaN  2.0  NaN
# d  NaN  3.0  NaN
# e  NaN  4.0  NaN
# f  NaN  NaN  5.0
# g  NaN  NaN  6.0
result = pd.concat([s1, s2, s3], axis=1, keys=[&#39;one&#39;, &#39;two&#39;, &#39;three&#39;])  # 在这个案例中axis=1轴向上并没有重叠
print(result)
#    one  two  three
# a  0.0  NaN    NaN
# b  1.0  NaN    NaN
# c  NaN  2.0    NaN
# d  NaN  3.0    NaN
# e  NaN  4.0    NaN
# f  NaN  NaN    5.0
# g  NaN  NaN    6.0
print(result.unstack())  # 对比axis=0的多层索引，当axis=1时对输出各index的并集做了分组。
# one    a    0.0
#        b    1.0
#        c    NaN
#        d    NaN
#        e    NaN
#        f    NaN
#        g    NaN
# two    a    NaN
#        b    NaN
#        c    2.0
#        d    3.0
#        e    4.0
#        f    NaN
#        g    NaN
# three  a    NaN
#        b    NaN
#        c    NaN
#        d    NaN
#        e    NaN
#        f    5.0
#        g    6.0
# dtype: float64

s4 = pd.concat([s1, s3])
print(s4)
# a    0
# b    1
# f    5
# g    6
# dtype: int64
result = pd.concat([s1, s4])
print(result)
# a    0
# b    1
# a    0
# b    1
# f    5
# g    6
# dtype: int64
result = pd.concat([s1, s4], axis=1)  # 现在在中axis=1轴向上有重叠
print(result)
#      0  1
# a  0.0  0
# b  1.0  1
# f  NaN  5
# g  NaN  6
result = pd.concat([s1, s4], axis=1, keys=[&#39;one&#39;, &#39;two&#39;, &#39;three&#39;])
print(result)
#    one  two
# a  0.0    0
# b  1.0    1
# f  NaN    5
# g  NaN    6
result = pd.concat([s1, s4], axis=0, keys=[&#39;one&#39;, &#39;two&#39;, &#39;three&#39;])  # 通过keys参数，在连接轴向上创建一个多层索引
print(result)
# one  a    0
#      b    1
# two  a    0
#      b    1
#      f    5
#      g    6
# dtype: int64
result = pd.concat([s1, s4], axis=1, join=&#39;inner&#39;)  # 内连接方式合并索引（索引交集）
print(result)
#    0  1
# a  0  0
# b  1  1
result = pd.concat([s1, s4], axis=1).reindex([&#39;a&#39;, &#39;c&#39;, &#39;b&#39;, &#39;e&#39;])  # 使用join_axes(已被替换成reindex)来指定用于连接其他轴向的轴
print(result)
#      0    1
# a  0.0  0.0
# c  NaN  NaN
# b  1.0  1.0
# e  NaN  NaN
</code></pre></div></p> <p>基于DataFrame的pandas的<code>concat</code>函数的工作机制分析。 <div class=highlight><pre><span></span><code>df1 = pd.DataFrame(
    np.arange(12).reshape((6, 2)),
    index=[
        [&#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Nevada&#39;, &#39;Nevada&#39;, &#39;Nevada&#39;],
        [2000, 2001, 2002, 2000, 2001, 2002]
    ],
    columns=[&#39;event1&#39;, &#39;event2&#39;]
)
df2 = pd.DataFrame(
    np.arange(12).reshape((6, 2)),
    index=[
        [&#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Ohio&#39;, &#39;Nevada&#39;, &#39;Nevada&#39;, &#39;Nevada&#39;],
        [2000, 2001, 2002, 2000, 2001, 2002]
    ],
    columns=[&#39;event3&#39;, &#39;event4&#39;]
)
print(df1)
#              event1  event2
# Ohio   2000       0       1
#        2001       2       3
#        2002       4       5
# Nevada 2000       6       7
#        2001       8       9
#        2002      10      11
print(df2)
#              event3  event4
# Ohio   2000       0       1
#        2001       2       3
#        2002       4       5
# Nevada 2000       6       7
#        2001       8       9
#        2002      10      11
result = np.concatenate([df1, df2], axis=0)  # 沿0轴拼接
print(result)
# [[ 0  1]
#  [ 2  3]
#  [ 4  5]
#  [ 6  7]
#  [ 8  9]
#  [10 11]
#  [ 0  1]
#  [ 2  3]
#  [ 4  5]
#  [ 6  7]
#  [ 8  9]
#  [10 11]]
result = np.concatenate([df1, df2], axis=1)  # 沿1轴拼接
print(result)
# [[ 0  1  0  1]
#  [ 2  3  2  3]
#  [ 4  5  4  5]
#  [ 6  7  6  7]
#  [ 8  9  8  9]
#  [10 11 10 11]]
result = np.concatenate([df1, df2], axis=None)  # 将数组展平
print(result)
# [ 0  1  2  3  4  5  6  7  8  9 10 11  0  1  2  3  4  5  6  7  8  9 10 11]
</code></pre></div></p> <h3 id=_8>联合重叠数据<a class=headerlink href=#_8 title="Permanent link"> ¶</a></h3> <p>另一个数据联合场景，既不是合并操作，也不是连接操作。 假如有两个数据集，这两个数据集的索引全部或部分重叠，通过NumPy的<code>where</code>函数可以进行面向数组的if-else等价操作。 <div class=highlight><pre><span></span><code>s1 = pd.Series(
    [np.nan, 2.5, 0.0, 3.5, 4.5, np.nan],
    index=[&#39;f&#39;, &#39;e&#39;, &#39;d&#39;, &#39;c&#39;, &#39;b&#39;, &#39;a&#39;]
)
s2 = pd.Series(
    [0.0, np.nan, 2.0, np.nan, np.nan, 5.0],
    index=[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;]
)

print(s1)
# f    NaN
# e    2.5
# d    0.0
# c    3.5
# b    4.5
# a    NaN
# dtype: float64
print(s2)
# a    0.0
# b    NaN
# c    2.0
# d    NaN
# e    NaN
# f    5.0
# dtype: float64
</code></pre></div></p> <p>方法1，通过Numpy的<code>where</code>函数。 <div class=highlight><pre><span></span><code>result = np.where(pd.isnull(s1), s2, s1)  # An array with elements from &#39;x&#39;(s2) where &#39;condition&#39;(isnull(s1)) is True, and elements from &#39;y&#39;(s1) elsewhere.
print(result)
# [0.  2.5 0.  3.5 4.5 5. ]
# s1         # s2         # result
# f    NaN   # a    0.0   0.       条件中s1该元素为null，所以where函数取对应x(s2)的元素（注意，与索引顺序无关）
# e    2.5   # b    NaN   2.5      条件中s1该元素不为null，所以where函数取对应y(s1)的元素
# d    0.0   # c    2.0   0.
# c    3.5   # d    NaN   3.5
# b    4.5   # e    NaN   4.5
# a    NaN   # f    5.0   5.0      条件中s1该元素为null，所以where函数取对应x(s2)的元素

result = np.where(pd.isnull(s2), s1, s2)
print(result)
# [0.  2.5 2.  3.5 4.5 5. ]
</code></pre></div></p> <p>方法2，通过Series的<code>combine_first</code>方法。 <div class=highlight><pre><span></span><code>result = s2.combine_first(s1)  # 注意，combine_first是按照s2的索引顺序检索的，相同索引的s1的值会填充对应s2的null
print(result)
# a    0.0
# b    4.5
# c    2.0
# d    0.0
# e    2.5
# f    5.0
# dtype: float64
</code></pre></div></p> <p>方法3：Pandas的<code>combine_first</code>方法。 <div class=highlight><pre><span></span><code>df1 = pd.DataFrame(
    {
        &#39;a&#39;: [1.0, np.nan, 5.0, np.nan],
        &#39;b&#39;: [np.nan, 2.0, np.nan, 6.0],
        &#39;c&#39;: [2.0, 6.0, 10.0, 15.0]
    }
)
df2 = pd.DataFrame(
    {
        &#39;a&#39;: [5.0, 4.0, np.nan, 3.0, 7.0],
        &#39;b&#39;: [np.nan, 3.0, 4.0, 6.0, 8.0]
    }
)
print(df1)
#      a    b     c
# 0  1.0  NaN   2.0
# 1  NaN  2.0   6.0
# 2  5.0  NaN  10.0
# 3  NaN  6.0  15.0
print(df2)
#      a    b
# 0  5.0  NaN
# 1  4.0  3.0
# 2  NaN  4.0
# 3  3.0  6.0
# 4  7.0  8.0
result = df2.combine_first(df1)  # 用df1的值去填充df2对应索引位置的null值
print(result)
#      a    b     c
# 0  5.0  NaN   2.0
# 1  4.0  3.0   6.0
# 2  5.0  4.0  10.0
# 3  3.0  6.0  15.0
# 4  7.0  8.0   NaN
</code></pre></div></p> <h2 id=_9>重塑和透视<a class=headerlink href=#_9 title="Permanent link"> ¶</a></h2> <p>重新排列表格型数据有多种基础操作。这些操作被称为重塑或透视。 <div class=highlight><pre><span></span><code>import numpy as np
import pandas as pd
</code></pre></div></p> <h3 id=_10>使用多层索引进行重塑<a class=headerlink href=#_10 title="Permanent link"> ¶</a></h3> <p>多层索引在DataFrame中提供了一种一致性方式用于重排列数据。以下是两个基础操作：</p> <ul> <li>statck（堆叠）该操作会“旋转”或将列中的数据透视到行。</li> <li>unstack（拆堆）该操作会将行中的数据透视到列。</li> </ul> <div class=highlight><pre><span></span><code>df = pd.DataFrame(
    np.arange(6).reshape((2, 3)),
    index=pd.Index([&#39;Ohio&#39;, &#39;Colorado&#39;], name=&#39;state&#39;),
    columns=pd.Index([&#39;one&#39;, &#39;two&#39;, &#39;three&#39;], name=&#39;number&#39;)
)
print(df)
# number    one  two  three
# state
# Ohio        0    1      2
# Colorado    3    4      5
</code></pre></div> <p>在这份数据上使用stack方法会将列透视到行，产生一个新的Series： <div class=highlight><pre><span></span><code>result = df.stack()
print(result)
# state     number
# Ohio      one       0
#           two       1
#           three     2
# Colorado  one       3
#           two       4
#           three     5
# dtype: int64
</code></pre></div></p> <p>从一个多层索引序列中，你可以使用<code>unstack</code>方法将数据重排列后放入一个DataFrame中： <div class=highlight><pre><span></span><code>print(result.unstack())
# number    one  two  three
# state
# Ohio        0    1      2
# Colorado    3    4      5
print(result.unstack(0))  # 可以传入一个层级序号或名称来拆分一个不同的层级
# state   Ohio  Colorado
# number
# one        0         3
# two        1         4
# three      2         5
print(result.unstack(1))
# number    one  two  three
# state
# Ohio        0    1      2
# Colorado    3    4      5
print(result.unstack(&#39;state&#39;))  # 输出结果和传入层级0一样
# state   Ohio  Colorado
# number
# one        0         3
# two        1         4
# three      2         5
print(result.unstack(&#39;number&#39;))  # 输出结果和传入层级1一样
# number    one  two  three
# state
# Ohio        0    1      2
# Colorado    3    4      5
</code></pre></div></p> <p>如果层级中的所有值并未包含于每个子分组中时，拆分可能会引入缺失值： <div class=highlight><pre><span></span><code>s1 = pd.Series([0, 1, 2, 3], index=[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;])
s2 = pd.Series([4, 5, 6], index=[&#39;c&#39;, &#39;d&#39;, &#39;e&#39;])
s3 = pd.concat([s1, s2], keys=[&#39;one&#39;, &#39;two&#39;])
print(s3)
# one  a    0
#      b    1
#      c    2
#      d    3
# two  c    4
#      d    5
#      e    6
# dtype: int64
print(s3.unstack(0))
#    one  two
# a  0.0  NaN
# b  1.0  NaN
# c  2.0  4.0
# d  3.0  5.0
# e  NaN  6.0
print(s3.unstack(1))
print(s3.unstack())
#        a    b    c    d    e
# one  0.0  1.0  2.0  3.0  NaN
# two  NaN  NaN  4.0  5.0  6.0
</code></pre></div></p> <p>默认情况下，堆叠会过滤出缺失值，因此堆叠拆堆的操作是可逆的。 <div class=highlight><pre><span></span><code>print(s3.unstack().stack())
# one  a    0.0
#      b    1.0
#      c    2.0
#      d    3.0
# two  c    4.0
#      d    5.0
#      e    6.0
# dtype: float64
print(s3.unstack().stack(dropna=False))
# one  a    0.0
#      b    1.0
#      c    2.0
#      d    3.0
#      e    NaN
# two  a    NaN
#      b    NaN
#      c    4.0
#      d    5.0
#      e    6.0
# dtype: float64
</code></pre></div></p> <p>在DataFrame中拆堆时，被拆堆的层级会变为结果中最低的层级。 在调用<code>stack</code>方法时，我们可以指明需要堆叠的轴向名称。 <div class=highlight><pre><span></span><code>df = pd.DataFrame(
    {&#39;left&#39;: result, &#39;right&#39;: result + 5},
    columns=pd.Index([&#39;left&#39;, &#39;right&#39;], name=&#39;side&#39;)
)
print(df)
# side             left  right
# state    number
# Ohio     one        0      5
#          two        1      6
#          three      2      7
# Colorado one        3      8
#          two        4      9
#          three      5     10
print(df.unstack())
# side     left           right
# number    one two three   one two three
# state
# Ohio        0   1     2     5   6     7
# Colorado    3   4     5     8   9    10
print(df.unstack(&#39;state&#39;))  # 被拆堆的层级(state)会变为结果中最低的层级
# side   left          right
# state  Ohio Colorado  Ohio Colorado
# number
# one       0        3     5        8
# two       1        4     6        9
# three     2        5     7       10
</code></pre></div></p> <p>在调用<code>stack</code>方法时，可以指明需要堆叠的轴向名称： <div class=highlight><pre><span></span><code>print(df.unstack(&#39;state&#39;).stack(&#39;side&#39;))
# state         Colorado  Ohio
# number side
# one    left          3     0
#        right         8     5
# two    left          4     1
#        right         9     6
# three  left          5     2
#        right        10     7
</code></pre></div></p> <h3 id=_11>将“长”透视为“宽”<a class=headerlink href=#_11 title="Permanent link"> ¶</a></h3> <p>在数据库和CSV中存储多时间序列的方式就是所谓的长格式或堆叠格式。 <div class=highlight><pre><span></span><code>data = pd.read_csv(&#39;../examples/macrodata.csv&#39;)

print(data.head(3))
#      year  quarter   realgdp  realcons  ...  unemp      pop  infl  realint
# 0  1959.0      1.0  2710.349    1707.4  ...    5.8  177.146  0.00     0.00
# 1  1959.0      2.0  2778.801    1733.7  ...    5.1  177.830  2.34     0.74
# 2  1959.0      3.0  2775.488    1751.8  ...    5.3  178.657  2.74     1.09
# ......
# [3 rows x 14 columns]

# PeriodIndex将year和quarter等列进行联合并生成了一种时间间隔类型
periods = pd.PeriodIndex(
    year=data.year,
    quarter=data.quarter,
    name=&#39;date&#39;
)
columns = pd.Index(
    [&#39;realgdp&#39;, &#39;infl&#39;, &#39;unemp&#39;],
    name=&#39;item&#39;
)
data = data.reindex(columns=columns)
print(data)
# item    realgdp  infl  unemp
# 0      2710.349  0.00    5.8
# 1      2778.801  2.34    5.1
# 2      2775.488  2.74    5.3
# ......
# [203 rows x 3 columns]

data.index = periods.to_timestamp(&#39;D&#39;, &#39;end&#39;)
print(data.index)
# DatetimeIndex([&#39;1959-03-31 23:59:59.999999999&#39;,
#                &#39;1959-06-30 23:59:59.999999999&#39;,
#                ...
#                &#39;2009-06-30 23:59:59.999999999&#39;,
#                &#39;2009-09-30 23:59:59.999999999&#39;],
#               dtype=&#39;datetime64[ns]&#39;, name=&#39;date&#39;, length=203, freq=None)
</code></pre></div></p> <p>下面是ldata的数据样本。 这种数据即所谓的多时间序列的长格式，或称为具有两个或更多个键的其他观测数据（这里，我们的键是date和item）。 表中的每一行表示一个时间点上的单个观测值。 <div class=highlight><pre><span></span><code>ldata = data.stack().reset_index().rename(columns={0: &#39;value&#39;})
print(ldata)
#                              date     item      value
# 0   1959-03-31 23:59:59.999999999  realgdp   2710.349
# 1   1959-03-31 23:59:59.999999999     infl      0.000
# 2   1959-03-31 23:59:59.999999999    unemp      5.800
# 3   1959-06-30 23:59:59.999999999  realgdp   2778.801
# 4   1959-06-30 23:59:59.999999999     infl      2.340
# ..                            ...      ...        ...
# 604 2009-06-30 23:59:59.999999999     infl      3.370
# 605 2009-06-30 23:59:59.999999999    unemp      9.200
# 606 2009-09-30 23:59:59.999999999  realgdp  12990.341
# 607 2009-09-30 23:59:59.999999999     infl      3.560
# 608 2009-09-30 23:59:59.999999999    unemp      9.600
# [609 rows x 3 columns]
</code></pre></div></p> <p>在上面的例子中：</p> <p>数据通常以这种方式存储在关系型数据库中，比如MySQL，因为固定模式（列名称和数据类型）允许<code>item</code>列中不同值的数量随着数据被添加到表中而改变。</p> <p><code>date</code>和<code>item</code>通常是主键（使用关系型数据库的说法），提供了关系完整性和更简单的连接。 在某些情况下，处理这种格式的数据更为困难。可能更倾向于获取一个按<code>date</code>列时间戳索引的且每个不同的<code>item</code>独立一列的DataFrame。</p> <p>DataFrame的pivot方法就是进行这种转换的：</p> <p>下面例子中，传递的前两个值是分别用作行和列索引的列，然后是可选的数值列以填充DataFrame。 注意，<code>pivot</code>方法等价于使用<code>set_index</code>创建分层索引，然后调用unstack。 <div class=highlight><pre><span></span><code>pivoted = ldata.pivot(&#39;date&#39;, &#39;item&#39;, &#39;value&#39;)
print(pivoted)
# item                           infl    realgdp  unemp
# date
# 1959-03-31 23:59:59.999999999  0.00   2710.349    5.8
# 1959-06-30 23:59:59.999999999  2.34   2778.801    5.1
# ...                             ...        ...    ...
# 2009-06-30 23:59:59.999999999  3.37  12901.504    9.2
# 2009-09-30 23:59:59.999999999  3.56  12990.341    9.6
# [203 rows x 3 columns]

ldata[&#39;value2&#39;] = np.random.randn(len(ldata))
print(ldata[:5])
#                            date     item     value    value2
# 0 1959-03-31 23:59:59.999999999  realgdp  2710.349 -1.268405
# 1 1959-03-31 23:59:59.999999999     infl     0.000  0.377691
# 2 1959-03-31 23:59:59.999999999    unemp     5.800 -0.342492
# 3 1959-06-30 23:59:59.999999999  realgdp  2778.801  0.132797
# 4 1959-06-30 23:59:59.999999999     infl     2.340  0.180290
</code></pre></div></p> <p>此时<code>ldata</code>已经添加了一列。如果遗漏最后一个参数，会得到一个含有多层列的DataFrame，如下： <div class=highlight><pre><span></span><code>pivoted = ldata.pivot(&#39;date&#39;, &#39;item&#39;)
print(pivoted)
#                               value             ...    value2
# item                           infl    realgdp  ...   realgdp     unemp
# date                                            ...
# 1959-03-31 23:59:59.999999999  0.00   2710.349  ...  0.157467 -0.222464
# 1959-06-30 23:59:59.999999999  2.34   2778.801  ...  0.861501  0.368855
# ...                             ...        ...  ...       ...       ...
# 2009-06-30 23:59:59.999999999  3.37  12901.504  ...  0.279988  0.934972
# 2009-09-30 23:59:59.999999999  3.56  12990.341  ...  0.547914  1.842967
# [203 rows x 6 columns]
</code></pre></div></p> <p>注意，<code>pivot</code>方法等价于使用<code>set_index</code>创建分层索引，然后调用<code>unstack</code>。 <div class=highlight><pre><span></span><code>unstacked = ldata.set_index([&#39;date&#39;, &#39;item&#39;]).unstack(&#39;item&#39;)
print(unstacked[:5])
#                               value            ...    value2
# item                           infl   realgdp  ...   realgdp     unemp
# date                                           ...
# 1959-03-31 23:59:59.999999999  0.00  2710.349  ...  0.213120 -0.248004
# 1959-06-30 23:59:59.999999999  2.34  2778.801  ...  0.697763  0.112388
# 1959-09-30 23:59:59.999999999  2.74  2775.488  ...  1.291884 -1.046142
# 1959-12-31 23:59:59.999999999  0.27  2785.204  ...  0.363339 -0.307364
# 1960-03-31 23:59:59.999999999  2.31  2847.699  ...  0.377330  2.272980
# [5 rows x 6 columns]
</code></pre></div></p> <h3 id=_12>将“宽”透视为“长”<a class=headerlink href=#_12 title="Permanent link"> ¶</a></h3> <p>在DataFrame中，pivot方法的反操作是<code>pandas.melt</code>。 与将一列变换为新的DataFrame中的多列不同，它将多列合并成一列，产生一个新的DataFrame，其长度比输入更长。 <div class=highlight><pre><span></span><code>df = pd.DataFrame(
    {
        &#39;key&#39;: [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;],
        &#39;A&#39;: [1, 2, 3],
        &#39;B&#39;: [4, 5, 6],
        &#39;C&#39;: [7, 8, 9]
    }
)

print(df)
#    key  A  B  C
# 0  foo  1  4  7
# 1  bar  2  5  8
# 2  baz  3  6  9
</code></pre></div></p> <p><code>key</code>列可以作为分组指标，其他列均为数据值。 当使用<code>pandas.melt</code>时，我们必须指明哪些列是分组指标（如果有的话）。</p> <p>此处，让我们使用<code>key</code>作为唯一的分组指标： <div class=highlight><pre><span></span><code>melted = pd.melt(df, [&#39;key&#39;])
print(melted)
#    key variable  value
# 0  foo        A      1
# 1  bar        A      2
# 2  baz        A      3
# 3  foo        B      4
# 4  bar        B      5
# 5  baz        B      6
# 6  foo        C      7
# 7  bar        C      8
# 8  baz        C      9
</code></pre></div></p> <p>使用<code>pivot</code>方法，我们可以将数据重塑回原先的布局。 <div class=highlight><pre><span></span><code>reshaped = melted.pivot(&#39;key&#39;, &#39;variable&#39;, &#39;value&#39;)
print(reshaped)
# variable  A  B  C
# key
# bar       2  5  8
# baz       3  6  9
# foo       1  4  7
</code></pre></div></p> <p>由于<code>pivot</code>的结果根据作为行标签的列生成了索引，可使用<code>reset_index</code>来将数据回移一列： <div class=highlight><pre><span></span><code>print(reshaped.reset_index())
# variable  key  A  B  C
# 0         bar  2  5  8
# 1         baz  3  6  9
# 2         foo  1  4  7
</code></pre></div></p> <p><code>pandas.melt</code>的使用也可以无须任何分组指标。 <div class=highlight><pre><span></span><code>result = pd.melt(df, value_vars=[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;])
print(result)
#   variable  value
# 0        A      1
# 1        A      2
# 2        A      3
# 3        B      4
# 4        B      5
# 5        B      6
# 6        C      7
# 7        C      8
# 8        C      9

result = pd.melt(df, value_vars=[&#39;key&#39;, &#39;B&#39;, &#39;C&#39;])
print(result)
#   variable value
# 0      key   foo
# 1      key   bar
# 2      key   baz
# 3        B     4
# 4        B     5
# 5        B     6
# 6        C     7
# 7        C     8
# 8        C     9
</code></pre></div></p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ch04/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 数据清洗与准备" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> 数据清洗与准备 </div> </div> </a> <a href=../ch06/ class="md-footer__link md-footer__link--next" aria-label="Next: 绘图与可视化" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> 绘图与可视化 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.top"], "search": "../../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.2ab50757.min.js></script> </body> </html>