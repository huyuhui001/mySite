<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://huyuhui001.github.io/mySite/linux/SRE/05-RegExpress/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-7.3.6"><title>第五章 正则表达式 - UPSkilling</title><link rel=stylesheet href=../../../assets/stylesheets/main.a57b2b03.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.3f5d1f46.min.css><meta name=theme-color content=#009485><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../extra.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=teal data-md-color-accent=green> <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=UPSkilling class="md-header__button md-logo" aria-label=UPSkilling data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> UPSkilling </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 第五章 正则表达式 </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> UPSkilling </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> Linux </a> </li> <li class=md-tabs__item> <a href=../../../k8s/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../python/ class=md-tabs__link> Python </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=UPSkilling class="md-nav__button md-logo" aria-label=UPSkilling data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> UPSkilling </label> <div class=md-nav__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> UPSkilling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=UPSkilling data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> UPSkilling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../../about/ class=md-nav__link> About </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2 checked> <label class=md-nav__link for=__nav_2_2> Linux SRE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux SRE" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Linux SRE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-fundamentals/ class=md-nav__link> 第一章 Linux基础 </a> </li> <li class=md-nav__item> <a href=../02-filesystem/ class=md-nav__link> 第二章 文件系统 </a> </li> <li class=md-nav__item> <a href=../03-identity-security/ class=md-nav__link> 第三章 身份与安全 </a> </li> <li class=md-nav__item> <a href=../04-TextTools/ class=md-nav__link> 第四章 文本编辑 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 第五章 正则表达式 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 第五章 正则表达式 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#51 class=md-nav__link> 5.1.基本正则表达式符号 </a> </li> <li class=md-nav__item> <a href=#52 class=md-nav__link> 5.2.扩展正则表达式符号 </a> </li> <li class=md-nav__item> <a href=#53 class=md-nav__link> 5.3.字符匹配 </a> </li> <li class=md-nav__item> <a href=#54 class=md-nav__link> 5.4.位置标记 </a> </li> <li class=md-nav__item> <a href=#55 class=md-nav__link> 5.5.标识符 </a> </li> <li class=md-nav__item> <a href=#56 class=md-nav__link> 5.6.数量修饰符 </a> </li> <li class=md-nav__item> <a href=#57 class=md-nav__link> 5.7.分组 </a> </li> <li class=md-nav__item> <a href=#58grep class=md-nav__link> 5.8.三剑客grep命令 </a> </li> <li class=md-nav__item> <a href=#59sed class=md-nav__link> 5.9.三剑客sed命令 </a> </li> <li class=md-nav__item> <a href=#510awk class=md-nav__link> 5.10.三剑客awk命令 </a> <nav class=md-nav aria-label=5.10.三剑客awk命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#5101 class=md-nav__link> 5.10.1.命令格式 </a> </li> <li class=md-nav__item> <a href=#5102 class=md-nav__link> 5.10.2.工作过程 </a> </li> <li class=md-nav__item> <a href=#5103 class=md-nav__link> 5.10.3.分隔符、域和记录 </a> </li> <li class=md-nav__item> <a href=#5104action class=md-nav__link> 5.10.4.常用action分类 </a> </li> <li class=md-nav__item> <a href=#5105pattern class=md-nav__link> 5.10.5.模式Pattern </a> </li> <li class=md-nav__item> <a href=#5106 class=md-nav__link> 5.10.6.截取片段 </a> </li> <li class=md-nav__item> <a href=#5107 class=md-nav__link> 5.10.7.操作符 </a> <nav class=md-nav aria-label=5.10.7.操作符> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51071 class=md-nav__link> 5.10.7.1.算数操作符 </a> </li> <li class=md-nav__item> <a href=#51072 class=md-nav__link> 5.10.7.2.字符串操作符 </a> </li> <li class=md-nav__item> <a href=#51073 class=md-nav__link> 5.10.7.3.赋值操作符 </a> </li> <li class=md-nav__item> <a href=#51074 class=md-nav__link> 5.10.7.4.比较操作符 </a> </li> <li class=md-nav__item> <a href=#51075 class=md-nav__link> 5.10.7.5.逻辑操作符 </a> </li> <li class=md-nav__item> <a href=#51076 class=md-nav__link> 5.10.7.6.三目条件表达式 </a> </li> <li class=md-nav__item> <a href=#51078 class=md-nav__link> 5.10.7.8.模式匹配符 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5108 class=md-nav__link> 5.10.8.变量 </a> <nav class=md-nav aria-label=5.10.8.变量> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51081 class=md-nav__link> 5.10.8.1.内置变量 </a> </li> <li class=md-nav__item> <a href=#51082 class=md-nav__link> 5.10.8.2.自定义变量 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5109beginend class=md-nav__link> 5.10.9.BEGIN/END </a> </li> <li class=md-nav__item> <a href=#51010 class=md-nav__link> 5.10.10.常用控制语句 </a> </li> <li class=md-nav__item> <a href=#51011 class=md-nav__link> 5.10.11.数组 </a> </li> <li class=md-nav__item> <a href=#51012awk class=md-nav__link> 5.10.12.awk函数 </a> <nav class=md-nav aria-label=5.10.12.awk函数> <ul class=md-nav__list> <li class=md-nav__item> <a href=#510121 class=md-nav__link> 5.10.12.1.内置函数 </a> </li> <li class=md-nav__item> <a href=#510122 class=md-nav__link> 5.10.12.2.自定义函数 </a> </li> <li class=md-nav__item> <a href=#510123awk class=md-nav__link> 5.10.12.3.awk脚本 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#511 class=md-nav__link> 5.11.小练习 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../06-FileLookup/ class=md-nav__link> 第六章 文件查找 </a> </li> <li class=md-nav__item> <a href=../07-FilePacking/ class=md-nav__link> 第七章 文件打包和解包 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> SUSE Linux Administration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Linux Administration" data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> SUSE Linux Administration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Administration/01/ class=md-nav__link> Linux File System Overview </a> </li> <li class=md-nav__item> <a href=../../Administration/02/ class=md-nav__link> Useful Commands </a> </li> <li class=md-nav__item> <a href=../../Administration/03/ class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4> SUSE Enterprise Storage Foundation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Enterprise Storage Foundation" data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> SUSE Enterprise Storage Foundation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../SES/linux_ses_memo/ class=md-nav__link> SUSE Enterprise Storage Foundation </a> </li> <li class=md-nav__item> <a href=../../SES/linux_ses_demo/ class=md-nav__link> SUSE Enterprise Storage Basic Operation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> CKA Learning Memo <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CKA Learning Memo" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> CKA Learning Memo </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_1 type=checkbox id=__nav_3_2_1> <label class=md-nav__link for=__nav_3_2_1> Installation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Installation data-md-level=3> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/installation/single-local/ class=md-nav__link> Single Node Installation </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/installation/multiple-local/ class=md-nav__link> Multiple Nodes Installation </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/installation/aliyun-ubuntu/ class=md-nav__link> Installation on Aliyun ECS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_2 type=checkbox id=__nav_3_2_2> <label class=md-nav__link for=__nav_3_2_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=3> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/docker/ class=md-nav__link> Fundamentals </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_3 type=checkbox id=__nav_3_2_3> <label class=md-nav__link for=__nav_3_2_3> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=3> <label class=md-nav__title for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/memo/ class=md-nav__link> Memo </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/basics/ class=md-nav__link> kubectl basics </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_4 type=checkbox id=__nav_3_2_4> <label class=md-nav__link for=__nav_3_2_4> Core Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Core Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_4> <span class="md-nav__icon md-icon"></span> Core Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_5 type=checkbox id=__nav_3_2_5> <label class=md-nav__link for=__nav_3_2_5> Application Modeling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Application Modeling" data-md-level=3> <label class=md-nav__title for=__nav_3_2_5> <span class="md-nav__icon md-icon"></span> Application Modeling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/secrets/ class=md-nav__link> Secrets </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/rbac/ class=md-nav__link> Role Based Access Control (RBAC) </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/ingress/ class=md-nav__link> Ingress </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_6 type=checkbox id=__nav_3_2_6> <label class=md-nav__link for=__nav_3_2_6> Advanced Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advanced Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_6> <span class="md-nav__icon md-icon"></span> Advanced Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_7 type=checkbox id=__nav_3_2_7> <label class=md-nav__link for=__nav_3_2_7> Operating Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Operating Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_7> <span class="md-nav__icon md-icon"></span> Operating Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/healthcheck/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/helming/ class=md-nav__link> Helming </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_8 type=checkbox id=__nav_3_2_8> <label class=md-nav__link for=__nav_3_2_8> Topics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Topics data-md-level=3> <label class=md-nav__title for=__nav_3_2_8> <span class="md-nav__icon md-icon"></span> Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/casestudy-operation-resources/ class=md-nav__link> Operations on Resources </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/casestudy-health-check/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/casestudy-calico/ class=md-nav__link> Calico Installation </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_en/foundamentals/kyma/ class=md-nav__link> Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> CKA学习笔记 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CKA学习笔记 data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> CKA学习笔记 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_1 type=checkbox id=__nav_3_3_1> <label class=md-nav__link for=__nav_3_3_1> 安装 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=安装 data-md-level=3> <label class=md-nav__title for=__nav_3_3_1> <span class="md-nav__icon md-icon"></span> 安装 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/installation/single-local/ class=md-nav__link> 单节点虚拟机安装Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/installation/multiple-local/ class=md-nav__link> 多节点虚拟机安装Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/installation/aliyun-ubuntu/ class=md-nav__link> 阿里云ECS安装Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_2 type=checkbox id=__nav_3_3_2> <label class=md-nav__link for=__nav_3_3_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=3> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/docker/ class=md-nav__link> Docker基础 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_3 type=checkbox id=__nav_3_3_3> <label class=md-nav__link for=__nav_3_3_3> 基础知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础知识 data-md-level=3> <label class=md-nav__title for=__nav_3_3_3> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/memo/ class=md-nav__link> Kubernetes随笔 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/overview/ class=md-nav__link> Kubernetes集群概览 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/basics/ class=md-nav__link> kubectl基础 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_4 type=checkbox id=__nav_3_3_4> <label class=md-nav__link for=__nav_3_3_4> 核心概念 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=核心概念 data-md-level=3> <label class=md-nav__title for=__nav_3_3_4> <span class="md-nav__icon md-icon"></span> 核心概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_5 type=checkbox id=__nav_3_3_5> <label class=md-nav__link for=__nav_3_3_5> 应用体系 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=应用体系 data-md-level=3> <label class=md-nav__title for=__nav_3_3_5> <span class="md-nav__icon md-icon"></span> 应用体系 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/secrets/ class=md-nav__link> secrets </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/rbac/ class=md-nav__link> RBAC鉴权 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/ingress/ class=md-nav__link> Ingress-nginx </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_6 type=checkbox id=__nav_3_3_6> <label class=md-nav__link for=__nav_3_3_6> 进阶概念 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=进阶概念 data-md-level=3> <label class=md-nav__title for=__nav_3_3_6> <span class="md-nav__icon md-icon"></span> 进阶概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/hpa/ class=md-nav__link> Horizontal Pod Autoscaling (HPA) </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_7 type=checkbox id=__nav_3_3_7> <label class=md-nav__link for=__nav_3_3_7> 日常维护 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=日常维护 data-md-level=3> <label class=md-nav__title for=__nav_3_3_7> <span class="md-nav__icon md-icon"></span> 日常维护 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/healthcheck/ class=md-nav__link> 健康检查 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/helming/ class=md-nav__link> Helm Chart </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_8 type=checkbox id=__nav_3_3_8> <label class=md-nav__link for=__nav_3_3_8> 主题讨论 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=主题讨论 data-md-level=3> <label class=md-nav__title for=__nav_3_3_8> <span class="md-nav__icon md-icon"></span> 主题讨论 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/casestudy-operation-resources/ class=md-nav__link> Kubernetes资源常见操作 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/casestudy-health-check/ class=md-nav__link> 健康检查 </a> </li> <li class=md-nav__item> <a href=../../../k8s/cka_cn/foundamentals/casestudy-calico/ class=md-nav__link> 安装Calico </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/demo/cap_on_kyma/ class=md-nav__link> Build CAP Application on Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Python基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python基础 data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Python基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/Foundation/ch00/ class=md-nav__link> Python安装 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch01/ class=md-nav__link> Python语言基础 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch02/ class=md-nav__link> Python打包和解包 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch03/ class=md-nav__link> Python内置函数及文件 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch04/ class=md-nav__link> Python面向对象概念 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch05/ class=md-nav__link> Python面向对象三大特性 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/Algorithms/ class=md-nav__link> Python数据结构和算法 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Python数据分析基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python数据分析基础 data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Python数据分析基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch01/ class=md-nav__link> NumPy基础 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch10/ class=md-nav__link> NumPy进阶 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch02/ class=md-nav__link> Pandas入门 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch03/ class=md-nav__link> 数据载入、存储及文件格式 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch04/ class=md-nav__link> 数据清洗与准备 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch05/ class=md-nav__link> 数据规整：连接、联合与重塑 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch06/ class=md-nav__link> 绘图与可视化 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch07/ class=md-nav__link> 数据聚合与分组操作 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch08/ class=md-nav__link> 时间序列 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch09/ class=md-nav__link> 高阶pandas </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch11/ class=md-nav__link> Python建模库介绍 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4> 数据结构和算法 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=数据结构和算法 data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 数据结构和算法 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/DataStructure/01_PythonFundmantal/ class=md-nav__link> 基础知识回顾 </a> </li> <li class=md-nav__item> <a href=../../../python/DataStructure/02_CollectionsOverview/ class=md-nav__link> 多项集的概述 </a> </li> <li class=md-nav__item> <a href=../../../python/DataStructure/03_TimeComplexity/ class=md-nav__link> 搜索、排序以及复杂度分析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_5 type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/Demo/CourseSystem/ class=md-nav__link> 选课系统 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#51 class=md-nav__link> 5.1.基本正则表达式符号 </a> </li> <li class=md-nav__item> <a href=#52 class=md-nav__link> 5.2.扩展正则表达式符号 </a> </li> <li class=md-nav__item> <a href=#53 class=md-nav__link> 5.3.字符匹配 </a> </li> <li class=md-nav__item> <a href=#54 class=md-nav__link> 5.4.位置标记 </a> </li> <li class=md-nav__item> <a href=#55 class=md-nav__link> 5.5.标识符 </a> </li> <li class=md-nav__item> <a href=#56 class=md-nav__link> 5.6.数量修饰符 </a> </li> <li class=md-nav__item> <a href=#57 class=md-nav__link> 5.7.分组 </a> </li> <li class=md-nav__item> <a href=#58grep class=md-nav__link> 5.8.三剑客grep命令 </a> </li> <li class=md-nav__item> <a href=#59sed class=md-nav__link> 5.9.三剑客sed命令 </a> </li> <li class=md-nav__item> <a href=#510awk class=md-nav__link> 5.10.三剑客awk命令 </a> <nav class=md-nav aria-label=5.10.三剑客awk命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#5101 class=md-nav__link> 5.10.1.命令格式 </a> </li> <li class=md-nav__item> <a href=#5102 class=md-nav__link> 5.10.2.工作过程 </a> </li> <li class=md-nav__item> <a href=#5103 class=md-nav__link> 5.10.3.分隔符、域和记录 </a> </li> <li class=md-nav__item> <a href=#5104action class=md-nav__link> 5.10.4.常用action分类 </a> </li> <li class=md-nav__item> <a href=#5105pattern class=md-nav__link> 5.10.5.模式Pattern </a> </li> <li class=md-nav__item> <a href=#5106 class=md-nav__link> 5.10.6.截取片段 </a> </li> <li class=md-nav__item> <a href=#5107 class=md-nav__link> 5.10.7.操作符 </a> <nav class=md-nav aria-label=5.10.7.操作符> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51071 class=md-nav__link> 5.10.7.1.算数操作符 </a> </li> <li class=md-nav__item> <a href=#51072 class=md-nav__link> 5.10.7.2.字符串操作符 </a> </li> <li class=md-nav__item> <a href=#51073 class=md-nav__link> 5.10.7.3.赋值操作符 </a> </li> <li class=md-nav__item> <a href=#51074 class=md-nav__link> 5.10.7.4.比较操作符 </a> </li> <li class=md-nav__item> <a href=#51075 class=md-nav__link> 5.10.7.5.逻辑操作符 </a> </li> <li class=md-nav__item> <a href=#51076 class=md-nav__link> 5.10.7.6.三目条件表达式 </a> </li> <li class=md-nav__item> <a href=#51078 class=md-nav__link> 5.10.7.8.模式匹配符 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5108 class=md-nav__link> 5.10.8.变量 </a> <nav class=md-nav aria-label=5.10.8.变量> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51081 class=md-nav__link> 5.10.8.1.内置变量 </a> </li> <li class=md-nav__item> <a href=#51082 class=md-nav__link> 5.10.8.2.自定义变量 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5109beginend class=md-nav__link> 5.10.9.BEGIN/END </a> </li> <li class=md-nav__item> <a href=#51010 class=md-nav__link> 5.10.10.常用控制语句 </a> </li> <li class=md-nav__item> <a href=#51011 class=md-nav__link> 5.10.11.数组 </a> </li> <li class=md-nav__item> <a href=#51012awk class=md-nav__link> 5.10.12.awk函数 </a> <nav class=md-nav aria-label=5.10.12.awk函数> <ul class=md-nav__list> <li class=md-nav__item> <a href=#510121 class=md-nav__link> 5.10.12.1.内置函数 </a> </li> <li class=md-nav__item> <a href=#510122 class=md-nav__link> 5.10.12.2.自定义函数 </a> </li> <li class=md-nav__item> <a href=#510123awk class=md-nav__link> 5.10.12.3.awk脚本 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#511 class=md-nav__link> 5.11.小练习 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/huyuhui001/mySite/edit/main/docs/linux/SRE/05-RegExpress.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=_1>第五章 正则表达式<a class=headerlink href=#_1 title="Permanent link"> ¶</a></h1> <p>正则表达式分两类：</p> <ul> <li>基本正则表达式（Basic Regular Expression， 又叫Basic RegEx，简称BREs）</li> <li>扩展正则表达式（Extended Regular Expression， 又叫Extended RegEx，简称EREs）</li> <li>Perl正则表达式（Perl Regular Expression， 又叫Perl RegEx 简称PREs</li> </ul> <p>基本的正则表达式和扩展正则表达式的区别就是元字符的不同。</p> <h2 id=51>5.1.基本正则表达式符号<a class=headerlink href=#51 title="Permanent link"> ¶</a></h2> <p><code>^</code>：表示以某个字符开始 <code>$</code>：表示以某个字符结尾 <code>.</code>：表示匹配一个且只匹配一个字符 <code>*</code>：表示匹配前边一个字符出现0次或者多次 <code>[]</code>：表示匹配括号内的多个字符信息,一个一个匹配 <code>.*</code>：表示匹配所有，空行也会进行匹配 <code>[^]</code>：表示不匹配括号内的每一个字符 <code>^$</code>：表示匹配空行信息 <code>\</code>：将有特殊含义的字符转义为通配符</p> <h2 id=52>5.2.扩展正则表达式符号<a class=headerlink href=#52 title="Permanent link"> ¶</a></h2> <p><code>+</code>：表示前一个字符出现一次或一次以上 <code>?</code>：表示前一个字符出现0次或者一次以上 <code>|</code>：表示或者的关系,匹配多个信息 <code>()</code>：匹配一个整体信息，也可以接后项引用 <code>{}</code>：定义前边字符出现几次</p> <p>提示：</p> <blockquote> <p><code>grep -E</code> 或者<code>egrep</code>只是表示扩展正则，不代表加了e就表示转义了。 当<code>grep</code>使用扩展正则的符号时候需要用<code>\</code>转义为通配符才能使用。</p> </blockquote> <h2 id=53>5.3.字符匹配<a class=headerlink href=#53 title="Permanent link"> ¶</a></h2> <ul> <li><code>[:alpha:]</code>：表示所有的字母（不区分大小写），效果同<code>[a-z]</code></li> <li><code>[:digit:]</code>：表示任意单个数字，效果同<code>[0-9]</code></li> <li><code>[:xdigit:]</code>：表示十六进制数字</li> <li><code>[:lower:]</code>：表示任意单个小写字母</li> <li><code>[:upper:]</code>：表示任意单个大写字母</li> <li><code>[:alnum:]</code>：表示任意单个字母或数字</li> <li><code>[:blank:]</code>：表示空白字符（空格和制表符）</li> <li><code>[:space:]</code>：表示包括空格、制表符（水平和垂直）、换行符、回车符等各种类型的空白，比<code>[:blank:]</code>范围更广</li> <li><code>[:cntrl:]</code>：表示不可打印的控制字符（退格、删除、警铃等）</li> <li><code>[:graph:]</code>：表示可打印的非空白字符</li> <li><code>[:print:]</code>：表示可打印字符</li> <li><code>[:punct:]</code>：表示标点符号</li> </ul> <h2 id=54>5.4.位置标记<a class=headerlink href=#54 title="Permanent link"> ¶</a></h2> <p>位置标记锚点（position marker anchor）是标识字符串位置的正则表达式。默认情况下，正则表达式所匹配的字符可以出现在字符串中任何位置。</p> <ul> <li><code>^</code>：行首锚定，指定了匹配正则表达式的文本必须起始于字符串的首部。</li> <li>例如：<code>^tux</code>能够匹配以<code>tux</code>起始的行</li> <li><code>$</code>：行尾锚定，指定了匹配正则表达式的文本必须结束于目标字符串的尾部。</li> <li><code>\&lt;</code>或<code>\b</code>：词首锚定，用于单词模式匹配左侧。（单词是有字母、数字、下划线组成）</li> <li><code>\&gt;</code>或<code>\b</code>：词尾锚定，用于单词模式匹配右侧。（单词是有字母、数字、下划线组成）</li> <li><code>^PATTERN$</code>：用模式PATTERN匹配整行。</li> <li><code>^$</code>：匹配空行。</li> <li><code>^[[:space:]]*$</code>：匹配空白行（整行）。</li> <li><code>\&lt;PATTERN\&gt;</code>：匹配整个单词。（单词是有字母、数字、下划线组成）</li> </ul> <p>关于行首锚定和词首锚定，对比下面例子。词尾锚定也是类似情况。 <code>;</code>和<code>-</code>都被认定为单词分隔符。</p> <div class=highlight><pre><span></span><code><span class=c1># 符合词首匹配</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;tux_01-tux02&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;\&lt;tux&#39;</span>
tux_01-tux02

<span class=c1># 符合词首匹配</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xut_01-tux02&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;\&lt;tux&#39;</span>
xut_01-tux02

<span class=c1># 符合行首匹配</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xut_01;tux02&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;\&lt;tux&#39;</span>
xut_01<span class=p>;</span>tux02

<span class=c1># 符合行首匹配</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;tux_01-tux02&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;^tux&#39;</span>
tux_01-tux02

<span class=c1># 不符合行首匹配</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;xut_01-tux02&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;^tux&#39;</span>
</code></pre></div> <h2 id=55>5.5.标识符<a class=headerlink href=#55 title="Permanent link"> ¶</a></h2> <p>标识符是正则表达式的基础组成部分。它定义了那些为了匹配正则表达式，必须存在（或不存在）的字符。</p> <ul> <li><code>A</code>字符：正则表达式必须匹配该字符。</li> <li>例如：<code>A</code>能够匹配字符<code>A</code>。</li> <li><code>.</code>：匹配任意一个字符。</li> <li>例如：<code>Hack.</code>能够匹配<code>Hackl</code>和<code>Hacki</code>，但是不能匹配<code>Hackl2</code>或<code>Hackil</code>，它只能匹配单个字符。</li> <li><code>[]</code>：匹配中括号内的任意一个字符。中括号内可以是一个字符组或字符范围</li> <li>例如：<code>coo[kl]</code>能够匹配<code>cook</code>或<code>cool</code></li> <li>例如：<code>[0-9]</code>匹配任意单个数字</li> <li>例如：<code>[.0-9]</code>匹配<code>.</code>或任意单个数字（中括号内的<code>.</code>就代表字符<code>.</code>，不代表任意单个字符）</li> <li><code>[^]</code>：匹配不在中括号内的任意一个字符。中括号内可以是一个字符组或字符范围</li> <li>例如：<code>9[^01]</code>能够匹配<code>92</code>和<code>93</code>，但是不匹配<code>91</code>和<code>90</code>。</li> <li>例如：<code>A[^0-9]</code>匹配A以及随后除数字外的任意单个字符</li> <li><code>\s</code>：匹配任何空白字符，包括空格、制表符、换页等。等价于<code>[\f\r\t\v]</code></li> <li><code>\S</code>：匹配任何非空白字符，等价于<code>[^\f\r\t\v]</code></li> <li><code>\w</code>：匹配一个字母、数字、下划线、汉字、其他国家文字字符，等价于<code>[_[:alnum:]字]</code></li> <li><code>\W</code>：匹配一个非字母、数字、下划线、汉字、其他国家文字字符，等价于<code>[^_[:alnum:]字]</code></li> </ul> <h2 id=56>5.6.数量修饰符<a class=headerlink href=#56 title="Permanent link"> ¶</a></h2> <p>一个标识符可以出现一次、多次或是不出现。数量修饰符定义了模式可以出现的次数。</p> <ul> <li><code>?</code>：匹配之前的项0次或1次。</li> <li>例如：<code>colou?r</code>能够匹配<code>color</code>或<code>colour</code>，但是不能匹配<code>colouur</code>。</li> <li><code>*</code>：匹配之前的项0次或多次。</li> <li>例如：<code>co*l</code>能够匹配<code>col</code>和<code>coool</code>。</li> <li>例如：<code>goo*gle</code>能匹配0个或多个<code>o</code>，如：<code>gogle</code>、<code>google</code>、<code>gooogle</code>、<code>gooooooooogle</code>等。</li> <li>例如：<code>gooo*gle</code>，则可以匹配<code>google</code>、<code>gooogle</code>、<code>gooooooooogle</code>等，对比上面等差别。</li> <li><code>+</code>：匹配之前的项1次或多次。</li> <li>例如：<code>Rollno-9+</code>能够匹配<code>Rollno-99</code>和<code>Rollno-9</code>，但是不能匹配<code>Rollno-</code>。</li> <li>例如：<code>colou+r</code>能够匹配<code>colour</code>或<code>colouur</code>，不能匹配<code>color</code>。</li> <li>例如：<code>goo\+gle</code>能够匹配1个或多个<code>o</code>，如：<code>google</code>，<code>gooogle</code>，<code>goooogle</code>等。</li> <li><code>.*</code>：匹配任意长度等任意字符。相当于通配符中的<code>*</code>。</li> <li><code>{n}</code>：匹配之前的项<code>n</code>次。</li> <li>例如：<code>[0-9]{3}</code>能够匹配任意的三位数。</li> <li>例如：<code>[0-9]{3}</code>可以扩展为<code>[0-9][0-9][0-9]</code>。</li> <li><code>{n}</code>：之前的项至少需要匹配<code>n</code>次。</li> <li>例如：<code>[0-9]{2,}</code>能够匹配任意一个两位或更多位的数字。</li> <li>例如：<code>go\{2,\}gle</code>能够匹配2个或者多个<code>o</code>，如<code>google</code>，<code>gooooogle</code>等，不能匹配<code>gogle</code>。</li> <li><code>{n,m}</code>：之前的项所必须匹配的最小<code>n</code>次数和最大<code>m</code>次数。</li> <li>例如：<code>[0-9]{2,5}</code>能够匹配两位数到五位数之间的任意一个数字。</li> </ul> <h2 id=57>5.7.分组<a class=headerlink href=#57 title="Permanent link"> ¶</a></h2> <p>有一些特殊字符可以调整正则表达式的匹配方式。</p> <ul> <li><code>\</code>：转义字符可以转义特殊字符。</li> <li>例如：<code>a\.b</code>能够匹配<code>a.b</code>，但不能匹配<code>ajb</code>。因为<code>\</code>忽略了<code>.</code>的特殊意义。</li> <li><code>()</code>：将括号中的内容视为一个整体。</li> <li>例如：<code>ma(tri)?x</code> 能够匹配<code>max</code>或<code>matrix</code></li> <li>例如：<code>\(root\)+</code></li> <li>后向引用：分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部变量中，这些变量名方式为：<code>\1</code>，<code>\2</code>，<code>\3</code>。</li> <li><code>\1</code>：表示从左侧起第一个左括号以及与之匹配的右括号之间的模式所匹配到的字符<ul> <li>例如：<code>\(string1\(string2\)\)</code>，<code>\1</code>是<code>string1\(string2\)</code>，<code>\2</code>是<code>string2</code></li> </ul> </li> <li><code>\0</code>：表示正则表达式匹配的所有字符</li> <li><code>|</code>：指定了一种选择结构，可以匹配<code>|</code>两边的任意一项。</li> <li>例如：<code>Oct (1st|2nd)</code>能够匹配<code>Oct 1st</code>或<code>Oct 2nd</code>。</li> </ul> <p>举例：匹配正负数</p> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nb>echo</span><span class=w> </span>-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span><span class=m>23</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;\-\?[0-9]\+&#39;</span><span class=w> </span>
-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u

$<span class=w> </span><span class=nb>echo</span><span class=w> </span>-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;\-\?[0-9]\+&#39;</span>
-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u

$<span class=w> </span><span class=nb>echo</span><span class=w> </span>-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;\-\?[0-9]*&#39;</span>
-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u

$<span class=w> </span><span class=nb>echo</span><span class=w> </span>-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;\-\?[0-9]\+&#39;</span>


$<span class=w> </span><span class=nb>echo</span><span class=w> </span>-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span>--<span class=w> </span><span class=s1>&#39;-?[0-9]+&#39;</span>
-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u

$<span class=w> </span><span class=nb>echo</span><span class=w> </span>-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;(-)?[0-9]+&#39;</span>
-1<span class=w> </span>-2<span class=w> </span><span class=m>12</span><span class=w> </span>-125<span class=w> </span>3log<span class=w> </span><span class=m>23</span><span class=w> </span>it4u
</code></pre></div> <p>举例：获取IP地址</p> <div class=highlight><pre><span></span><code>ifconfig<span class=w> </span>eth0
eth0:<span class=w> </span><span class=nv>flags</span><span class=o>=</span><span class=m>4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;<span class=w>  </span>mtu<span class=w> </span><span class=m>1500</span>
<span class=w>        </span>inet<span class=w> </span><span class=m>192</span>.168.10.210<span class=w>  </span>netmask<span class=w> </span><span class=m>255</span>.255.255.0<span class=w>  </span>broadcast<span class=w> </span><span class=m>192</span>.168.10.255
<span class=w>        </span>inet6<span class=w> </span>fe80::20c:29ff:fea4:e17a<span class=w>  </span>prefixlen<span class=w> </span><span class=m>64</span><span class=w>  </span>scopeid<span class=w> </span>0x20&lt;link&gt;
<span class=w>        </span>ether<span class=w> </span><span class=m>00</span>:0c:29:a4:e1:7a<span class=w>  </span>txqueuelen<span class=w> </span><span class=m>1000</span><span class=w>  </span><span class=o>(</span>Ethernet<span class=o>)</span>
<span class=w>        </span>RX<span class=w> </span>packets<span class=w> </span><span class=m>7654</span><span class=w>  </span>bytes<span class=w> </span><span class=m>635932</span><span class=w> </span><span class=o>(</span><span class=m>621</span>.0<span class=w> </span>KiB<span class=o>)</span>
<span class=w>        </span>RX<span class=w> </span>errors<span class=w> </span><span class=m>0</span><span class=w>  </span>dropped<span class=w> </span><span class=m>1</span><span class=w>  </span>overruns<span class=w> </span><span class=m>0</span><span class=w>  </span>frame<span class=w> </span><span class=m>0</span>
<span class=w>        </span>TX<span class=w> </span>packets<span class=w> </span><span class=m>1934</span><span class=w>  </span>bytes<span class=w> </span><span class=m>279649</span><span class=w> </span><span class=o>(</span><span class=m>273</span>.0<span class=w> </span>KiB<span class=o>)</span>
<span class=w>        </span>TX<span class=w> </span>errors<span class=w> </span><span class=m>0</span><span class=w>  </span>dropped<span class=w> </span><span class=m>0</span><span class=w> </span>overruns<span class=w> </span><span class=m>0</span><span class=w>  </span>carrier<span class=w> </span><span class=m>0</span><span class=w>  </span>collisions<span class=w> </span><span class=m>0</span>

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>netmask<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-o<span class=w> </span><span class=s1>&#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39;</span>
<span class=m>192</span>.168.10.210
<span class=m>255</span>.255.255.0
<span class=m>192</span>.168.10.255

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>netmask<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-o<span class=w> </span><span class=s1>&#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n<span class=w> </span><span class=m>1</span>
<span class=m>192</span>.168.10.210

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-o<span class=w> </span><span class=s1>&#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39;</span>
<span class=m>192</span>.168.10.210
<span class=m>255</span>.255.255.0
<span class=m>192</span>.168.10.255

ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-o<span class=w> </span><span class=s1>&#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n<span class=w> </span><span class=m>1</span>
<span class=m>192</span>.168.10.210
</code></pre></div> <p>匹配空行和非空行：</p> <div class=highlight><pre><span></span><code>grep<span class=w> </span><span class=s1>&#39;^$&#39;</span><span class=w> </span>/etc/profile
grep<span class=w> </span>-v<span class=w> </span><span class=s1>&#39;^$&#39;</span><span class=w> </span>/etc/profile
</code></pre></div> <p>匹配非空行和非#开头的行：（三种方法）</p> <div class=highlight><pre><span></span><code>grep<span class=w> </span>-v<span class=w> </span><span class=s1>&#39;^$&#39;</span><span class=w> </span>/etc/profile<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span><span class=s1>&#39;^#&#39;</span>
grep<span class=w> </span>-v<span class=w> </span><span class=s1>&#39;^$\|#&#39;</span><span class=w> </span>/etc/profile
grep<span class=w> </span><span class=s1>&#39;^[^$#]&#39;</span><span class=w> </span>/etc/profile
</code></pre></div> <p>注意，如果写成下面这样，则不会过滤掉空行，<code>[$]</code>会被视为<code>$</code>符号。 所以正则表达式的元字符放在中括号<code>[]</code>内就被视为普通字符。</p> <div class=highlight><pre><span></span><code>grep<span class=w> </span>-v<span class=w> </span><span class=s1>&#39;^[$#]&#39;</span><span class=w> </span>/etc/profile
</code></pre></div> <h2 id=58grep>5.8.三剑客<code>grep</code>命令<a class=headerlink href=#58grep title="Permanent link"> ¶</a></h2> <p>格式：</p> <ul> <li>grep [OPTIONS] PATTERN [FILE...]</li> <li>grep [OPTIONS] -e PATTERN ... [FILE...]</li> <li>grep [OPTIONS] -f FILE ... [FILE...]</li> </ul> <p>参数：</p> <ul> <li><code>-n</code>：显示过滤出来的文件在文件当中的行号</li> <li><code>-c</code>：显示匹配到的行数</li> <li><code>-o</code>：只显示匹配到的内容</li> <li><code>-q</code>：静默输出（一般用在shell脚本当中，通过<code>echo $?</code>查看命令执行结果，0表示成功，非0表示失败））</li> <li><code>-i</code>：忽略大小写</li> <li><code>-v</code>：反向查找</li> <li><code>-w</code>：匹配某个词词：在Linux中，词为一连串字母、数字和下划线组成的字符串</li> <li><code>-E</code>：使用扩展正则</li> <li><code>-R</code>：递归查询</li> <li><code>-l</code>：只打印文件路径</li> </ul> <p>扩展参数：</p> <ul> <li><code>-A</code>：显示匹配到的数据的后几n行</li> <li><code>-B</code>：显示匹配到的数据的前几n行</li> <li><code>-C</code>：显示匹配到的数据的前后各几n行</li> </ul> <p>示例：</p> <p>匹配用户：</p> <div class=highlight><pre><span></span><code>grep<span class=w> </span>root<span class=w> </span>/etc/passwd
root:x:0:0:root:/root:/bin/bash

$<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;USER&quot;</span><span class=w> </span>/etc/passwd

$<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;</span><span class=nv>$USER</span><span class=s2>&quot;</span><span class=w> </span>/etc/passwd
vagrant:x:1000:478:vagrant:/home/vagrant:/bin/bash

$<span class=w> </span>grep<span class=w> </span><span class=s1>&#39;$USER&#39;</span><span class=w> </span>/etc/passwd
</code></pre></div> <p>匹配关键字：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>grep<span class=w> </span>processor<span class=w> </span>/proc/cpuinfo
processor<span class=w>       </span>:<span class=w> </span><span class=m>0</span>
processor<span class=w>       </span>:<span class=w> </span><span class=m>1</span>

$<span class=w> </span>grep<span class=w> </span>-o<span class=w> </span>processor<span class=w> </span>/proc/cpuinfo
processor
processor

$<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;cpu family&quot;</span><span class=w> </span>/proc/cpuinfo
cpu<span class=w> </span>family<span class=w>      </span>:<span class=w> </span><span class=m>6</span>
cpu<span class=w> </span>family<span class=w>      </span>:<span class=w> </span><span class=m>6</span>

$<span class=w> </span>grep<span class=w> </span>-o<span class=w> </span><span class=s2>&quot;cpu family&quot;</span><span class=w> </span>/proc/cpuinfo
cpu<span class=w> </span>family
cpu<span class=w> </span>family
</code></pre></div> <p>通过grep进行文件比较。</p> <div class=highlight><pre><span></span><code><span class=c1># 最后一行是空行</span>
$<span class=w> </span>cat<span class=w> </span>f1
a
b
<span class=m>1</span>
c


<span class=c1># 最后一行是空行</span>
$<span class=w> </span>cat<span class=w> </span>f2
b
e
f
c
<span class=m>1</span>
<span class=m>2</span>


<span class=c1># 高亮显示相同内容的行，包含最后一行空行</span>
$<span class=w> </span>grep<span class=w> </span>-f<span class=w> </span>f1<span class=w> </span>f2
b
e
f
c
<span class=m>1</span>
<span class=m>2</span>


<span class=c1># 只显示相同内容的行，包含最后一行空行</span>
$<span class=w> </span>grep<span class=w> </span>-wf<span class=w> </span>f1<span class=w> </span>f2
b
c
<span class=m>1</span>


<span class=c1># 只显示不同内容的行</span>
$<span class=w> </span>grep<span class=w> </span>-wvf<span class=w> </span>f1<span class=w> </span>f2
e
f
<span class=m>2</span>
</code></pre></div> <p>提示：</p> <blockquote> <p><code>grep -wvf f1 f2</code> 或者<code>grep -w -v -f f1 f2</code>中，<code>-f</code>只能作为最后一个参数，否则会报错。</p> </blockquote> <p>体会基本正则和扩展正则的差异。</p> <p>例1：转义。</p> <div class=highlight><pre><span></span><code><span class=c1># 下面几个命令返回的结果是一样的。</span>
$<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;root\|bash&quot;</span><span class=w> </span>/etc/passwd
$<span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;root|bash&quot;</span><span class=w> </span>/etc/passwd
$<span class=w> </span>grep<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;root&quot;</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;bash&quot;</span><span class=w> </span>/etc/passwd

<span class=c1># 下面的命令没有匹配结果返回。</span>
$<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;root|bash&quot;</span><span class=w> </span>/etc/passwd
</code></pre></div> <p>例2：下面4个命令返回同样的结果。</p> <div class=highlight><pre><span></span><code>grep<span class=w> </span><span class=s2>&quot;root&quot;</span><span class=w> </span>/etc/passwd
grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;root&quot;</span><span class=w> </span>/etc/passwd
grep<span class=w> </span><span class=s2>&quot;\&lt;root\&gt;&quot;</span><span class=w> </span>/etc/passwd
grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;\&lt;root\&gt;&quot;</span><span class=w> </span>/etc/passwd
</code></pre></div> <p>例3：行首行尾锚定。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;^\(.*\)\&gt;.*\&lt;\1</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/passwd
$<span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;^(.*)\&gt;.*\&lt;\1</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/passwd
$<span class=w> </span>egrep<span class=w> </span><span class=s2>&quot;^(.*)\&gt;.*\&lt;\1</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/passwd
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
</code></pre></div> <p>例4：三种方法求和计算，运用<code>grep</code>，<code>cut</code>，<code>bc</code>和<code>paste</code>命令。</p> <div class=highlight><pre><span></span><code><span class=nv>$cat</span><span class=w> </span>age
<span class=nv>Jason</span><span class=o>=</span><span class=m>20</span>
<span class=nv>Tom</span><span class=o>=</span><span class=m>30</span>
<span class=nv>Jack</span><span class=o>=</span><span class=m>40</span>

<span class=c1># 方法1</span>
$<span class=w> </span>cat<span class=w> </span>age<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;=&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>2</span><span class=w> </span><span class=p>|</span><span class=w> </span>tr<span class=w> </span><span class=s2>&quot;\n&quot;</span><span class=w> </span>+<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Eo<span class=w> </span><span class=s2>&quot;.*[0-9]&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>bc
<span class=m>90</span>

<span class=c1># 方法2</span>
$<span class=w> </span>grep<span class=w> </span>-Eo<span class=w> </span><span class=s2>&quot;[0-9]+&quot;</span><span class=w> </span>age<span class=w> </span><span class=p>|</span><span class=w> </span>tr<span class=w> </span><span class=s2>&quot;\n&quot;</span><span class=w> </span>+<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Eo<span class=w> </span><span class=s2>&quot;.*[0-9]&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>bc
<span class=m>90</span>

<span class=c1># 方法3</span>
$<span class=w>  </span>grep<span class=w> </span>-Eo<span class=w> </span><span class=s2>&quot;[0-9]+&quot;</span><span class=w> </span>age<span class=w> </span><span class=p>|</span><span class=w> </span>paste<span class=w> </span>-s<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;+&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>bc
<span class=m>90</span>
</code></pre></div> <h2 id=59sed>5.9.三剑客<code>sed</code>命令<a class=headerlink href=#59sed title="Permanent link"> ¶</a></h2> <p><code>sed</code>是stream editor的缩写，中文称之为“流编辑器”。 <code>sed</code>命令是一个面向行处理的工具，它以“行”为处理单位，针对每一行进行处理，处理后的结果会输出到标准输出<code>STDOUT</code>，不会对读取的文件做任何修改。</p> <p><code>sed</code>的工作原理：</p> <p><code>sed</code>命令是面向“行”进行处理的，每一次处理一行内容。 处理时，<code>sed</code>会把要处理的行存储在缓冲区中，接着用<code>sed</code>命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。这个缓冲区被称为“<strong>模式空间</strong>”（pattern space）。</p> <p>保持空间(hold space)</p> <p><code>sed</code>的保持空间像一个长期储存， 可以把获取的信息储存到其中，待后续调用。不能直接对保持空间进行操作， 而是将保持空间的内容复制或者添加到模式空间进行操作。</p> <p>非交互式批量修改文件。</p> <p><code>sed</code>命令格式：</p> <div class=highlight><pre><span></span><code>sed<span class=w> </span><span class=o>[</span>option<span class=o>]</span><span class=w> </span><span class=nb>command</span><span class=w> </span>file
</code></pre></div> <p><code>option</code>常用选项：</p> <ul> <li><code>-n</code>：不输出模式pattern的内容到屏幕（即不自动打印）</li> <li><code>-e</code>：多点编辑</li> <li><code>-f filename</code>：从指定文件读取编辑脚本</li> <li><code>-r</code>，<code>-E</code>：使用扩展正则表达式</li> <li><code>-i .bak</code>：备份文件并原处编辑</li> <li><code>-s</code>：将多个文件视为独立文件，而不是单个连续的长文件流</li> <li><code>-ir</code>： 不支持</li> <li><code>-i -r</code>： 支持</li> <li><code>-ri</code>： 支持</li> <li><code>-ni</code>： 危险选项，会清空文件</li> </ul> <p><code>command</code>部分可以分为两部分：</p> <ul> <li> <p>范围设定，可以采用两种不同的方式来表达：</p> </li> <li> <p>指定行数：如：</p> <ul> <li><code>3,5</code>表示第3、4、5行</li> <li><code>5,$</code>表示第5行至文件最后一行</li> </ul> </li> <li> <p>模式匹配：如：</p> <ul> <li><code>/^[^dD]/</code>表示匹配行首不是以<code>d</code>或<code>D</code>开头的行</li> </ul> </li> <li> <p>动作处理，下面是常用的动作：</p> </li> <li> <p><code>a</code>：新增， <code>a</code>后面的字串会在新的一行出现（当前行的下一行）</p> </li> <li><code>i</code>：插入， <code>i</code>后面的字串会在新的一行出现（当前行的上一行）</li> <li><code>r filename</code>：读取指定文件<code>fllename</code>的内容，追加到当前行的下一行</li> <li><code>R filename</code>：读取指定文件<code>fllename</code>的一行，追加到当前行的下一行</li> <li><code>d</code>：删除该行</li> <li><code>p</code>：打印该行</li> <li><code>Ip</code>：忽略大小写输出</li> <li><code>w filename</code>：写入到指定文件filename中。</li> <li><code>s/regexp/replacement/</code>：取代，用replacement取代正则regexp匹配到的内容</li> <li><code>=</code>：为模式pattern中的匹配行打印行号</li> <li><code>!</code>：为模式pattern中的匹配行取反操作</li> <li><code>q</code>：结束或退出sed</li> </ul> <p>创建一个<code>testfile</code>文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF &gt; testfile</span>
<span class=s>HELLO LINUX!</span>
<span class=s>Linux is a free unix-type opterating system.</span>
<span class=s>This is a linux testfile!</span>
<span class=s>Linux test</span>
<span class=s>Google</span>
<span class=s>Taobao</span>
<span class=s>Banbooob</span>
<span class=s>Tesetfile</span>
<span class=s>Wiki</span>
<span class=s>EOF</span>
</code></pre></div> <p>匹配定位文件<code>testfile</code>第二行，并输出（包含匹配第二行和输出第二行）。</p> <div class=highlight><pre><span></span><code><span class=c1># nl testfile | sed &#39;2p&#39;</span>
<span class=w>     </span><span class=m>1</span><span class=w>    </span>HELLO<span class=w> </span>LINUX!
<span class=w>     </span><span class=m>2</span><span class=w>    </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
<span class=w>     </span><span class=m>2</span><span class=w>    </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
<span class=w>     </span><span class=m>3</span><span class=w>    </span>This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
<span class=w>     </span><span class=m>4</span><span class=w>    </span>Linux<span class=w> </span><span class=nb>test</span>
<span class=w>     </span><span class=m>5</span><span class=w>    </span>Google
<span class=w>     </span><span class=m>6</span><span class=w>    </span>Taobao
<span class=w>     </span><span class=m>7</span><span class=w>    </span>Banbooob
<span class=w>     </span><span class=m>8</span><span class=w>    </span>Tesetfile
<span class=w>     </span><span class=m>9</span><span class=w>    </span>Wiki
</code></pre></div> <p>匹配定位文件<code>testfile</code>第二行，不输出。</p> <div class=highlight><pre><span></span><code><span class=c1># nl testfile | sed -n &#39;2p&#39;</span>
<span class=w>     </span><span class=m>2</span><span class=w>    </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
</code></pre></div> <p>匹配定位文件<code>testfile</code>最后一行。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;$p&#39;</span>
<span class=w>     </span><span class=m>9</span><span class=w>    </span>Wiki
</code></pre></div> <p>匹配定位文件<code>testfile</code>倒数第二行。</p> <div class=highlight><pre><span></span><code><span class=c1># sed -n &quot;$(echo $[`cat testfile | wc -l`-1])p&quot; testfile</span>
Tesetfile
</code></pre></div> <p>将<code>testfile</code>的内容列出第2～3行，并且打印行号。</p> <div class=highlight><pre><span></span><code>$<span class=w>  </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2,3p&#39;</span>
<span class=w>     </span><span class=m>2</span><span class=w>  </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
<span class=w>     </span><span class=m>3</span><span class=w>  </span>This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
</code></pre></div> <p>将<code>testfile</code>的内容从第2行开始，向后输出额外的3行，并且打印行号。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2,+3p&#39;</span>
<span class=w>     </span><span class=m>2</span><span class=w>  </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
<span class=w>     </span><span class=m>3</span><span class=w>  </span>This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
<span class=w>     </span><span class=m>4</span><span class=w>  </span>Linux<span class=w> </span><span class=nb>test</span>
<span class=w>     </span><span class=m>5</span><span class=w>  </span>Google
</code></pre></div> <p>将<code>testfile</code>的内容从第2行开始，向后以2为步进单位输出所有匹配行，并且打印行号（即，从第2行开始输出偶数行）。</p> <div class=highlight><pre><span></span><code>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2~2p&#39;</span>
<span class=w>     </span><span class=m>2</span><span class=w>  </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
<span class=w>     </span><span class=m>4</span><span class=w>  </span>Linux<span class=w> </span><span class=nb>test</span>
<span class=w>     </span><span class=m>6</span><span class=w>  </span>Taobao
<span class=w>     </span><span class=m>8</span><span class=w>  </span>Tesetfile
</code></pre></div> <p>将<code>testfile</code>的内容从第2行开始，向后以2为步进单位删除所有匹配行，输出剩余行，并且打印行号（即，从第2行开始删除偶数行，输出奇数行）。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;2~2d&#39;</span>
<span class=w>     </span><span class=m>1</span><span class=w>  </span>HELLO<span class=w> </span>LINUX!
<span class=w>     </span><span class=m>3</span><span class=w>  </span>This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
<span class=w>     </span><span class=m>5</span><span class=w>  </span>Google
<span class=w>     </span><span class=m>7</span><span class=w>  </span>Banbooob
<span class=w>     </span><span class=m>9</span><span class=w>  </span>Wiki
</code></pre></div> <p>将<code>testfile</code>的内容输出，删除第2行和第5行，并打印行号。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;2d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;5d&#39;</span>
$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;2d;5d&#39;</span>
$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;2d;5d&#39;</span>
<span class=w>     </span><span class=m>1</span><span class=w>  </span>HELLO<span class=w> </span>LINUX!
<span class=w>     </span><span class=m>3</span><span class=w>  </span>This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
<span class=w>     </span><span class=m>4</span><span class=w>  </span>Linux<span class=w> </span><span class=nb>test</span>
<span class=w>     </span><span class=m>6</span><span class=w>  </span>Taobao
<span class=w>     </span><span class=m>7</span><span class=w>  </span>Banbooob
<span class=w>     </span><span class=m>8</span><span class=w>  </span>Tesetfile
<span class=w>     </span><span class=m>9</span><span class=w>  </span>Wiki
</code></pre></div> <p>将<code>testfile</code>的内容输出，输出区间是从行首<code>L</code>的行到行首<code>G</code>的行结束。不修改原文件。 如果行首匹配不到，则无结果输出；如果行尾匹配不到，则输出到文件结束。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;/^L/,/^G/p&#39;</span><span class=w> </span>testfile
Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
Linux<span class=w> </span><span class=nb>test</span>
Google
</code></pre></div> <p>将<code>testfile</code>的内容输出，且在第6行后加上<code>I love Linux</code>。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;6a I love Linux&#39;</span><span class=w> </span>testfile
HELLO<span class=w> </span>LINUX!
Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
Linux<span class=w> </span><span class=nb>test</span>
Google
Taobao
I<span class=w> </span>love<span class=w> </span>Linux
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且在第6行后添加<code>I love Linux</code>。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;6a I love Linux&#39;</span>
$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;6a\I love Linux&#39;</span>
<span class=w>     </span><span class=m>1</span><span class=w>    </span>HELLO<span class=w> </span>LINUX!
<span class=w>     </span><span class=m>2</span><span class=w>    </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
<span class=w>     </span><span class=m>3</span><span class=w>    </span>This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
<span class=w>     </span><span class=m>4</span><span class=w>    </span>Linux<span class=w> </span><span class=nb>test</span>
<span class=w>     </span><span class=m>5</span><span class=w>    </span>Google
<span class=w>     </span><span class=m>6</span><span class=w>    </span>Taobao
I<span class=w> </span>love<span class=w> </span>Linux
<span class=w>     </span><span class=m>7</span><span class=w>    </span>Banbooob
<span class=w>     </span><span class=m>8</span><span class=w>    </span>Tesetfile
<span class=w>     </span><span class=m>9</span><span class=w>    </span>Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且在第3行前添加<code>I am a journer learner</code>。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;3i\I am a journer learner&#39;</span>
<span class=w>     </span><span class=m>1</span><span class=w>    </span>HELLO<span class=w> </span>LINUX!
<span class=w>     </span><span class=m>2</span><span class=w>    </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
I<span class=w> </span>am<span class=w> </span>a<span class=w> </span>journer<span class=w> </span>learner
<span class=w>     </span><span class=m>3</span><span class=w>    </span>This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
<span class=w>     </span><span class=m>4</span><span class=w>    </span>Linux<span class=w> </span><span class=nb>test</span>
<span class=w>     </span><span class=m>5</span><span class=w>    </span>Google
<span class=w>     </span><span class=m>6</span><span class=w>    </span>Taobao
<span class=w>     </span><span class=m>7</span><span class=w>    </span>Banbooob
<span class=w>     </span><span class=m>8</span><span class=w>    </span>Tesetfile
<span class=w>     </span><span class=m>9</span><span class=w>    </span>Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且在第3行前添加三行内容<code>Add line 1</code>，<code>Add line 2</code>，<code>Add line 3</code>。用符合<code>\</code>进行换行。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;3i\Add line 1 \</span>
<span class=s1>Add line 2 \</span>
<span class=s1>Add line 3&#39;</span>
<span class=w>     </span><span class=m>1</span><span class=w>    </span>HELLO<span class=w> </span>LINUX!
<span class=w>     </span><span class=m>2</span><span class=w>    </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
Add<span class=w> </span>line<span class=w> </span><span class=m>1</span>
Add<span class=w> </span>line<span class=w> </span><span class=m>2</span>
Add<span class=w> </span>line<span class=w> </span><span class=m>3</span>
<span class=w>     </span><span class=m>3</span><span class=w>    </span>This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
<span class=w>     </span><span class=m>4</span><span class=w>    </span>Linux<span class=w> </span><span class=nb>test</span>
<span class=w>     </span><span class=m>5</span><span class=w>    </span>Google
<span class=w>     </span><span class=m>6</span><span class=w>    </span>Taobao
<span class=w>     </span><span class=m>7</span><span class=w>    </span>Banbooob
<span class=w>     </span><span class=m>8</span><span class=w>    </span>Tesetfile
<span class=w>     </span><span class=m>9</span><span class=w>    </span>Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且将第2-5行的内容取代成为<code>replaced</code>。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;2,5c\replaced&#39;</span>
$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;2,5c replaced&#39;</span>
$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;2,5creplaced&#39;</span>
<span class=w>     </span><span class=m>1</span><span class=w>    </span>HELLO<span class=w> </span>LINUX!
replaced
<span class=w>     </span><span class=m>6</span><span class=w>    </span>Taobao
<span class=w>     </span><span class=m>7</span><span class=w>    </span>Banbooob
<span class=w>     </span><span class=m>8</span><span class=w>    </span>Tesetfile
<span class=w>     </span><span class=m>9</span><span class=w>    </span>Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且删除第2~5行。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;2,5d&#39;</span>
<span class=w>     </span><span class=m>1</span><span class=w>    </span>HELLO<span class=w> </span>LINUX!
<span class=w>     </span><span class=m>6</span><span class=w>    </span>Taobao
<span class=w>     </span><span class=m>7</span><span class=w>    </span>Banbooob
<span class=w>     </span><span class=m>8</span><span class=w>    </span>Tesetfile
<span class=w>     </span><span class=m>9</span><span class=w>    </span>Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且删除第5行到最后一行。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>nl<span class=w> </span>testfile<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;5,$d&#39;</span>
<span class=w>     </span><span class=m>1</span><span class=w>    </span>HELLO<span class=w> </span>LINUX!
<span class=w>     </span><span class=m>2</span><span class=w>    </span>Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
<span class=w>     </span><span class=m>3</span><span class=w>    </span>This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
<span class=w>     </span><span class=m>4</span><span class=w>    </span>Linux<span class=w> </span><span class=nb>test</span>
</code></pre></div> <p>匹配定位文件<code>testfile</code>中包含关键字<code>linux</code>的行。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;/linux/p&#39;</span><span class=w> </span>testfile
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
</code></pre></div> <p>匹配定位命令<code>df</code>输出中以<code>/dev/sd</code>关键字开头的行。（需要转义符<code>\</code>）</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;/^\/dev\/sd/p&#39;</span>
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/.snapshots
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/home
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/opt
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/root
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/boot/grub2/x86_64-efi
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/boot/grub2/i386-pc
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/srv
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/tmp
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/usr/local
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7077280</span><span class=w>  </span><span class=m>92055312</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/var
</code></pre></div> <p>匹配定位命令<code>df</code>输出中不以<code>/dev/sd</code>关键字开头的行。通过<code>!p</code>进行求反输出。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;/^\/dev\/sd/!p&#39;</span>
Filesystem<span class=w>     </span>1K-blocks<span class=w>    </span>Used<span class=w> </span>Available<span class=w> </span>Use%<span class=w> </span>Mounted<span class=w> </span>on
devtmpfs<span class=w>            </span><span class=m>4096</span><span class=w>       </span><span class=m>0</span><span class=w>      </span><span class=m>4096</span><span class=w>   </span><span class=m>0</span>%<span class=w> </span>/dev
tmpfs<span class=w>            </span><span class=m>1971208</span><span class=w>       </span><span class=m>0</span><span class=w>   </span><span class=m>1971208</span><span class=w>   </span><span class=m>0</span>%<span class=w> </span>/dev/shm
tmpfs<span class=w>             </span><span class=m>788484</span><span class=w>    </span><span class=m>9612</span><span class=w>    </span><span class=m>778872</span><span class=w>   </span><span class=m>2</span>%<span class=w> </span>/run
tmpfs<span class=w>               </span><span class=m>4096</span><span class=w>       </span><span class=m>0</span><span class=w>      </span><span class=m>4096</span><span class=w>   </span><span class=m>0</span>%<span class=w> </span>/sys/fs/cgroup
tmpfs<span class=w>             </span><span class=m>394240</span><span class=w>       </span><span class=m>0</span><span class=w>    </span><span class=m>394240</span><span class=w>   </span><span class=m>0</span>%<span class=w> </span>/run/user/1000
</code></pre></div> <p>匹配定位命令<code>df</code>输出中不以<code>/dev/sd</code>和<code>tmp</code>关键字开头的行。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;/^\/dev\/sd/d;/^tmp/d&#39;</span>
Filesystem<span class=w>     </span>1K-blocks<span class=w>    </span>Used<span class=w> </span>Available<span class=w> </span>Use%<span class=w> </span>Mounted<span class=w> </span>on
devtmpfs<span class=w>            </span><span class=m>4096</span><span class=w>       </span><span class=m>0</span><span class=w>      </span><span class=m>4096</span><span class=w>   </span><span class=m>0</span>%<span class=w> </span>/dev

$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Ev<span class=w> </span><span class=s1>&#39;^\/dev\/sd|^tmp&#39;</span>
Filesystem<span class=w>     </span>1K-blocks<span class=w>    </span>Used<span class=w> </span>Available<span class=w> </span>Use%<span class=w> </span>Mounted<span class=w> </span>on
devtmpfs<span class=w>            </span><span class=m>4096</span><span class=w>       </span><span class=m>0</span><span class=w>      </span><span class=m>4096</span><span class=w>   </span><span class=m>0</span>%<span class=w> </span>/dev
</code></pre></div> <p>搜索文件<code>testfile</code>所有包含<code>oo</code>关键字的行并匹配输出。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;/ooo/p&#39;</span><span class=w> </span>testfile
Banbooob

$<span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;/oo/p&#39;</span><span class=w> </span>testfile
Google
Banbooob
</code></pre></div> <p>搜索文件<code>testfile</code>所有包含<code>oo</code>关键字的行并删除。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span><span class=s1>&#39;/oo/d&#39;</span><span class=w> </span>testfile
HELLO<span class=w> </span>LINUX!
Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
Linux<span class=w> </span><span class=nb>test</span>
Taobao
Tesetfile
Wiki
</code></pre></div> <p>搜索文件<code>testfile</code>所有包含<code>oo</code>的行，把<code>oo</code>替换为<code>kk</code>，再输出这行。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;/oo/{s/oo/kk/;p;q}&#39;</span><span class=w> </span>testfile
$<span class=w> </span>sed<span class=w> </span>-ne<span class=w> </span><span class=s1>&#39;/oo/{s/oo/kk/;p;q}&#39;</span><span class=w> </span>testfile
Gkkgle
</code></pre></div> <p>将<code>testfile</code>的每行中第一次出现<code>ao</code>的替换成<code>HH</code>。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s/ao/HH/&#39;</span><span class=w> </span>testfile
HELLO<span class=w> </span>LINUX!
Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
Linux<span class=w> </span><span class=nb>test</span>
Google
THHbao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>下面是把<code>testfile</code>的匹配到<code>ao</code>的行替换成<code>HH</code>。</p> <div class=highlight><pre><span></span><code>sed<span class=w> </span><span class=s1>&#39;/ao/cHH&#39;</span><span class=w> </span>testfile
HELLO<span class=w> </span>LINUX!
SUSE
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
SUSE
Google
Taobao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>搜索文件<code>testfile</code>所有包含<code>ao</code>的全部替换成<code>HH</code>。<code>g</code>表示全局匹配。不修改原文件。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s/ao/HH/g&#39;</span><span class=w> </span>testfile
$<span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s/ao/HH/g&#39;</span><span class=w> </span>testfile
HELLO<span class=w> </span>LINUX!
Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
Linux<span class=w> </span><span class=nb>test</span>
Google
THHbHH
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>在文件<code>/etc/passwd</code>中查找匹配所有符合<code>r</code>开头<code>t</code>结尾且中间含任意两个字符的行，并在<code>t</code>字母后添加<code>er</code>。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span>-nr<span class=w> </span><span class=s1>&#39;s/r..t/&amp;er/gp&#39;</span><span class=w> </span>/etc/passwd
rooter:x:0:0:rooter:/rooter:/bin/bash
lp:x:493:487:Printering<span class=w> </span>daemon:/var/spool/lpd:/usr/sbin/nologin
tftp:x:487:474:TFTP<span class=w> </span>account:/srv/terftpboot:/bin/false
vagranter:x:1000:478:vagranter:/home/vagranter:/bin/bash
tester1:x:600:1530:<span class=s2>&quot;Test User1,terestuser1@abc.com&quot;</span>:/home/tester1:/bin/bash
</code></pre></div> <p>将上述结果和原始内容进行对比，能更好的理解<code>s/r..t/&amp;er</code>的操作。</p> <div class=highlight><pre><span></span><code>rooter:x:0:0:rooter:/rooter:/bin/bash
root:x:0:0:root:/root:/bin/bash

lp:x:493:487:Printering<span class=w> </span>daemon:/var/spool/lpd:/usr/sbin/nologin
lp:x:493:487:Printing<span class=w> </span>daemon:/var/spool/lpd:/usr/sbin/nologin

tftp:x:487:474:TFTP<span class=w> </span>account:/srv/terftpboot:/bin/false
tftp:x:487:474:TFTP<span class=w> </span>account:/srv/tftpboot:/bin/false

vagranter:x:1000:478:vagranter:/home/vagranter:/bin/bash
vagrant:x:1000:478:vagrant:/home/vagrant:/bin/bash

tester1:x:600:1530:<span class=s2>&quot;Test User1,terestuser1@abc.com&quot;</span>:/home/tester1:/bin/bash
tester1:x:600:1530:<span class=s2>&quot;Test User1,testuser1@abc.com&quot;</span>:/home/tester1:/bin/bash
</code></pre></div> <p>体会<code>&amp;</code>的位置不同的不同含义。</p> <div class=highlight><pre><span></span><code><span class=c1># 附加在root单词后</span>
$<span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;s/root/&amp;superman/p&#39;</span><span class=w> </span>/etc/passwd
rootsuperman:x:0:0:root:/root:/bin/bash

<span class=c1># 附加在root单词前</span>
$<span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;s/root/superman&amp;/p&#39;</span><span class=w> </span>/etc/passwd
supermanroot:x:0:0:root:/root:/bin/bash
</code></pre></div> <p>使用参数<code>-i</code>进行源文件修改。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/ao/HH/&#39;</span><span class=w> </span>testfile
$<span class=w> </span>cat<span class=w> </span>testfile
HELLO<span class=w> </span>LINUX!
Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
Linux<span class=w> </span><span class=nb>test</span>
Google
THHbao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>源文件修改前，备份在新文件<code>testfile.new</code>。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>sed<span class=w> </span>-i.new<span class=w> </span><span class=s1>&#39;s/ao/HH/&#39;</span><span class=w> </span>testfile

$<span class=w> </span>cat<span class=w> </span>testfile.new
HELLO<span class=w> </span>LINUX!
Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
Linux<span class=w> </span><span class=nb>test</span>
Google
Taobao
Banbooob
Tesetfile
Wiki

$<span class=w> </span>cat<span class=w> </span>testfile
HELLO<span class=w> </span>LINUX!
Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
Linux<span class=w> </span><span class=nb>test</span>
Google
THHbao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>范例：除指定文件外，其余都删除。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>touch<span class=w> </span><span class=o>{</span><span class=m>1</span>..9<span class=o>}</span>file.txt

$<span class=w> </span>ls
1file.txt<span class=w>  </span>2file.txt<span class=w>  </span>3file.txt<span class=w>  </span>4file.txt<span class=w>  </span>5file.txt<span class=w>  </span>6file.txt<span class=w>  </span>7file.txt<span class=w>  </span>8file.txt<span class=w>  </span>9file.txt

$<span class=w> </span>ls<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;(3|5|7)file\.txt&#39;</span>
3file.txt
5file.txt
7file.txt

$<span class=w> </span>ls<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Ev<span class=w> </span><span class=s1>&#39;(3|5|7)file\.txt&#39;</span>
1file.txt
2file.txt
4file.txt
6file.txt
8file.txt
9file.txt
</code></pre></div> <p>下面四种方法实现同样的功能</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>rm<span class=w> </span><span class=sb>`</span>ls<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Ev<span class=w> </span><span class=s1>&#39;(3|5|7)file\.txt&#39;</span><span class=sb>`</span>
$<span class=w> </span>ls<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;/^[357]file.txt/!p&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>rm
$<span class=w> </span>ls<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Ev<span class=w> </span><span class=s1>&#39;(3|5|7)file\.txt&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;s/.*/rm &amp;/p&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>bash
$<span class=w> </span>ls<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Ev<span class=w> </span><span class=s1>&#39;(3|5|7)file\.txt&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;s/(.*)/rm &amp;/p&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>bash
$<span class=w> </span>ls<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Ev<span class=w> </span><span class=s1>&#39;(3|5|7)file\.txt&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;s/(.*)/rm \1/p&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>bash

$<span class=w> </span>ls
3file.txt<span class=w>  </span>5file.txt<span class=w>  </span>7file.txt
</code></pre></div> <p>后向引用<code>\0</code> <code>\1</code> <code>\2</code>等。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nv>$echo</span><span class=w> </span><span class=m>123456789</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-nE<span class=w> </span><span class=s1>&#39;s/(123)(456)(789)/\1/p&#39;</span>
<span class=m>123</span>

$<span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=m>123456789</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-nE<span class=w> </span><span class=s1>&#39;s/(123)(456)(789)/\2/p&#39;</span>
<span class=m>456</span>

$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=m>123456789</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-nE<span class=w> </span><span class=s1>&#39;s/(123)(456)(789)/\3/p&#39;</span>
<span class=m>789</span>

$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=m>123456789</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-nE<span class=w> </span><span class=s1>&#39;s/(123)(456)(789)/\3\1\2/p&#39;</span>
<span class=m>789123456</span>

$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=m>123456789</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-nE<span class=w> </span><span class=s1>&#39;s/(123)(456)(789)/\1xyz\2/p&#39;</span>
123xyz456
</code></pre></div> <p>范例：获取分区利用率</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;/^\/dev\/sd/p&#39;</span>
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/.snapshots
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/boot/grub2/i386-pc
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/boot/grub2/x86_64-efi
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/home
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/opt
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/root
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/srv
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/usr/local
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/tmp
/dev/sda2<span class=w>      </span><span class=m>102750208</span><span class=w> </span><span class=m>7079236</span><span class=w>  </span><span class=m>92053692</span><span class=w>   </span><span class=m>8</span>%<span class=w> </span>/var

$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;/^\/dev\/sd/s@.*([0-9]+)%.*@\1@p&#39;</span>
$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;/^\/dev\/sd/s#.*([0-9]+)%.*#\1#p&#39;</span>
<span class=c1># df | sed -En &#39;/^\/dev\/sd/s/.*([0-9]+)%.*/\1/p&#39;</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
</code></pre></div> <p>体会下面空格和括弧带来的不同。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;/^\/dev\/sd/s# .*([0-9]+)%.*# \1#p&#39;</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>

$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;/^\/dev\/sd/s#( .*)([0-9]+)%.*# \1#p&#39;</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>
/dev/sda2<span class=w>       </span><span class=m>102750208</span><span class=w> </span><span class=m>7079804</span><span class=w>  </span><span class=m>92053156</span>

$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;/^\/dev\/sd/s#( .*)([0-9]+)%.*# \2#p&#39;</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
</code></pre></div> <p>范例：取得当前IP地址。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>ifconfig<span class=w> </span>eth0
eth0:<span class=w> </span><span class=nv>flags</span><span class=o>=</span><span class=m>4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;<span class=w>  </span>mtu<span class=w> </span><span class=m>1500</span>
<span class=w>        </span>inet<span class=w> </span><span class=m>192</span>.168.10.210<span class=w>  </span>netmask<span class=w> </span><span class=m>255</span>.255.255.0<span class=w>  </span>broadcast<span class=w> </span><span class=m>192</span>.168.10.255
<span class=w>        </span>inet6<span class=w> </span>fe80::20c:29ff:fea4:e17a<span class=w>  </span>prefixlen<span class=w> </span><span class=m>64</span><span class=w>  </span>scopeid<span class=w> </span>0x20&lt;link&gt;
<span class=w>        </span>ether<span class=w> </span><span class=m>00</span>:0c:29:a4:e1:7a<span class=w>  </span>txqueuelen<span class=w> </span><span class=m>1000</span><span class=w>  </span><span class=o>(</span>Ethernet<span class=o>)</span>
<span class=w>        </span>RX<span class=w> </span>packets<span class=w> </span><span class=m>22923</span><span class=w>  </span>bytes<span class=w> </span><span class=m>1658298</span><span class=w> </span><span class=o>(</span><span class=m>1</span>.5<span class=w> </span>MiB<span class=o>)</span>
<span class=w>        </span>RX<span class=w> </span>errors<span class=w> </span><span class=m>0</span><span class=w>  </span>dropped<span class=w> </span><span class=m>0</span><span class=w>  </span>overruns<span class=w> </span><span class=m>0</span><span class=w>  </span>frame<span class=w> </span><span class=m>0</span>
<span class=w>        </span>TX<span class=w> </span>packets<span class=w> </span><span class=m>3763</span><span class=w>  </span>bytes<span class=w> </span><span class=m>442641</span><span class=w> </span><span class=o>(</span><span class=m>432</span>.2<span class=w> </span>KiB<span class=o>)</span>
<span class=w>        </span>TX<span class=w> </span>errors<span class=w> </span><span class=m>0</span><span class=w>  </span>dropped<span class=w> </span><span class=m>0</span><span class=w> </span>overruns<span class=w> </span><span class=m>0</span><span class=w>  </span>carrier<span class=w> </span><span class=m>0</span><span class=w>  </span>collisions<span class=w> </span><span class=m>0</span>

$<span class=w> </span>ip<span class=w> </span>addr<span class=w> </span>show<span class=w> </span>eth0
<span class=m>2</span>:<span class=w> </span>eth0:<span class=w> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>1500</span><span class=w> </span>qdisc<span class=w> </span>pfifo_fast<span class=w> </span>state<span class=w> </span>UP<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/ether<span class=w> </span><span class=m>00</span>:0c:29:a4:e1:7a<span class=w> </span>brd<span class=w> </span>ff:ff:ff:ff:ff:ff
<span class=w>    </span>altname<span class=w> </span>enp2s1
<span class=w>    </span>altname<span class=w> </span>ens33
<span class=w>    </span>inet<span class=w> </span><span class=m>192</span>.168.10.210/24<span class=w> </span>brd<span class=w> </span><span class=m>192</span>.168.10.255<span class=w> </span>scope<span class=w> </span>global<span class=w> </span>eth0
<span class=w>       </span>valid_lft<span class=w> </span>forever<span class=w> </span>preferred_lft<span class=w> </span>forever
<span class=w>    </span>inet6<span class=w> </span>fe80::20c:29ff:fea4:e17a/64<span class=w> </span>scope<span class=w> </span>link
<span class=w>       </span>valid_lft<span class=w> </span>forever<span class=w> </span>preferred_lft<span class=w> </span>forever


$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;2s/[^0-9]+([0-9.]+).*/\1/p&#39;</span>
$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;2s/^[^0-9]+([0-9.]{7,15}).*/\1/p&#39;</span>
$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;2s/^[^0-9]+([0-9.]{7,15}).*$/\1/p&#39;</span>
$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2s/^.*inet //p&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;s/netmask.*//p&#39;</span>
$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2s/^.*inet //;s/ netmask.*//p&#39;</span>
$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;2s/(.*inet )([0-9].*)(netmask.*)/\2/p&#39;</span>
<span class=m>192</span>.168.10.210
<span class=m>192</span>.168.10.210
<span class=m>192</span>.168.10.210
</code></pre></div> <p>使用<code>\0</code>输出全部变量。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;2s/(.*inet )([0-9].*)(netmask.*)/\0/p&#39;</span>
<span class=w>        </span>inet<span class=w> </span><span class=m>192</span>.168.10.210<span class=w>  </span>netmask<span class=w> </span><span class=m>255</span>.255.255.0<span class=w>  </span>broadcast<span class=w> </span><span class=m>192</span>.168.10.255

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;2s/(.*inet )([0-9].*)(netmask.*)/\1/p&#39;</span>
<span class=w>        </span>inet

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;2s/(.*inet )([0-9].*)(netmask.*)/\2/p&#39;</span>
<span class=m>192</span>.168.10.210

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;2s/(.*inet )([0-9].*)(netmask.*)/\3/p&#39;</span>
netmask<span class=w> </span><span class=m>255</span>.255.255.0<span class=w>  </span>broadcast<span class=w> </span><span class=m>192</span>.168.10.255
</code></pre></div> <p>对比下面两个指令的匹配差异。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2s/^.*inet //p&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;s/ netmask.*//p&#39;</span>
<span class=m>192</span>.168.10.210

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2s/^.*inet //p&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;s/netmask.* //p&#39;</span>
<span class=m>192</span>.168.10.210<span class=w>  </span><span class=m>192</span>.168.10.255

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2s/^.*inet //p&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;s/netmask .*//p&#39;</span>
<span class=m>192</span>.168.10.210

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2s/^.*inet //p&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;s/netmask.*//p&#39;</span>
<span class=m>192</span>.168.10.210
</code></pre></div> <p>范例：取基名和目录名。 （<code>/etc/sysconfig/network-scripts/</code>目录在Rocky9中默认已创建，在openSUSE和Ubuntu中没有）</p> <div class=highlight><pre><span></span><code><span class=c1># 取目录名</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/sysconfig/network-scripts/&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s#(^/.*/)([^/]+/?)#\1#&#39;</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/sysconfig/network-scripts/&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s/(^\/.*\/)([^\/]+\/?)/\1/&#39;</span>
/etc/sysconfig/
<span class=c1># 取基名</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/sysconfig/network-scripts/&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s#(^/.*/)([^/]+/?)#\2#&#39;</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/sysconfig/network-scripts/&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s/(^\/.*\/)([^\/]+\/?)/\2/&#39;</span>
network-scripts/

<span class=c1># 取目录名</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/sysconfig/network-scripts/dummyfile&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s#(^/.*/)([^/]+/?)#\1#&#39;</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/sysconfig/network-scripts/dummyfille&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s/(^\/.*\/)([^\/]+\/?)/\1/&#39;</span>
/etc/sysconfig/network-scripts/
<span class=c1># 取基名</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/sysconfig/network-scripts/dummyfile&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s#(^/.*/)([^/]+/?)#\2#&#39;</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/sysconfig/network-scripts/dummyfille&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s/(^\/.*\/)([^\/]+\/?)/\2/&#39;</span>
dummyfille
</code></pre></div> <p>范例：取文件名和文件扩展名</p> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nb>echo</span><span class=w> </span>1_.file.tar.gz<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;s/(.*)\.([^.]+)$/\1/p&#39;</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span>1_.file.tar.gz<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;s@(.*)\.([^.]+)$@\1@p&#39;</span>
1_.file.tar

$<span class=w> </span><span class=nb>echo</span><span class=w> </span>1_.file.tar.gz<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;s/(.*)\.([^.]+)$/\2/p&#39;</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span>1_.file.tar.gz<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;s@(.*)\.([^.]+)$@\2@p&#39;</span>
gz
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nb>echo</span><span class=w> </span>1_.file.tar.gz<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Eo<span class=w> </span><span class=s1>&#39;.*\.&#39;</span>
1_.file.tar.

$<span class=w> </span><span class=nb>echo</span><span class=w> </span>1_.file.tar.gz<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Eo<span class=w> </span><span class=s1>&#39;[^.]+$&#39;</span>
gz
</code></pre></div> <p>范例：将非<code>#</code>开头的行添加<code>#</code></p> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF &gt; testfile</span>
<span class=s>HELLO LINUX!</span>
<span class=s>Linux is a free unix-type opterating system.</span>
<span class=s>This is a linux testfile!</span>
<span class=s>Linux test</span>
<span class=s>Google</span>
<span class=s>Taobao</span>
<span class=s>Banbooob</span>
<span class=s>#Tesetfile</span>
<span class=s>#Wiki</span>
<span class=s>EOF</span>

$<span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;s/^[^#]/#&amp;/p&#39;</span><span class=w> </span>testfile
$<span class=w> </span>sed<span class=w> </span>-En<span class=w> </span><span class=s1>&#39;s/^[^#](.*)/#\1/p&#39;</span><span class=w> </span>testfile
<span class=c1>#HELLO LINUX!</span>
<span class=c1>#Linux is a free unix-type opterating system.</span>
<span class=c1>#This is a linux testfile!</span>
<span class=c1>#Linux test</span>
<span class=c1>#Google</span>
<span class=c1>#Taobao</span>
<span class=c1>#Banbooob</span>
</code></pre></div> <p>范例：将<code>#</code>开头的行删除<code>#</code></p> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF &gt; testfile</span>
<span class=s>HELLO LINUX!</span>
<span class=s>Linux is a free unix-type opterating system.</span>
<span class=s>This is a linux testfile!</span>
<span class=s>Linux test</span>
<span class=s>Google</span>
<span class=s>Taobao</span>
<span class=s>Banbooob</span>
<span class=s>#Tesetfile</span>
<span class=s>#Wiki</span>
<span class=s>EOF</span>

$<span class=w> </span>sed<span class=w> </span>-Ei.bak<span class=w> </span><span class=s1>&#39;/^#/s/^#//&#39;</span><span class=w> </span>testfile

$<span class=w> </span>cat<span class=w> </span>testfile
HELLO<span class=w> </span>LINUX!
Linux<span class=w> </span>is<span class=w> </span>a<span class=w> </span>free<span class=w> </span>unix-type<span class=w> </span>opterating<span class=w> </span>system.
This<span class=w> </span>is<span class=w> </span>a<span class=w> </span>linux<span class=w> </span>testfile!
Linux<span class=w> </span><span class=nb>test</span>
Google
Taobao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p><code>sed</code>保持空间（hold space）的例子：</p> <ul> <li> <p><code>d</code>：删除pattern space的内容，开始下一个循环。</p> </li> <li> <p><code>D</code>：如果模式空间保护换行符，则删除直到第一个换行符到模式空间中的文本，并不读取新的输入行，而使用合成的模式空间重新启动循环。如果模式空间不包含换行符，则类似<code>d</code>命令启动正常的新循环。</p> </li> <li> <p><code>h</code>、 <code>H</code>：复制/追加模式空间的内容到保持空间。</p> </li> <li> <p><code>g</code>、 <code>G</code>：复制/追加保持空间的内容到模式空间。</p> </li> <li> <p><code>n</code>、<code>N</code>：复制/追加匹配到的下一行到模式空间。</p> </li> <li> <p>p：打印当前模式空间内容。</p> </li> <li> <p>P：打印模式空间开头至<code>\n</code>的内容，并追加到默认输出之前。</p> </li> <li> <p><code>x</code>：交换保持空间和模式空间的内容.</p> </li> </ul> <p>举例解读1：</p> <ol> <li> <p><code>seq 10</code>命令输出1～10个数字，每个数字一行。</p> </li> <li> <p><code>sed</code>命令读取第一行<code>1</code>到模式空间。因为参数<code>-n</code>，所以读取到的<code>1</code>不打印到屏幕。</p> </li> <li> <p>执行<code>n</code>命令，即读取匹配到的下一行到模式空间，即把第二行的<code>2</code>读取并覆盖到模式空间。</p> </li> <li> <p>执行<code>p</code>命令，把<code>2</code>输出到屏幕。</p> </li> <li> <p>以此类推，读取第三行的<code>3</code>到模式空间，执行<code>n</code>命令，将第四行的<code>4</code>读取并覆盖到模式空间。执行<code>p</code>命令，输出<code>4</code>到屏幕。</p> </li> <li> <p>以此类推。</p> </li> </ol> <div class=highlight><pre><span></span><code>$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;n;p&#39;</span>
<span class=m>2</span>
<span class=m>4</span>
<span class=m>6</span>
<span class=m>8</span>
<span class=m>10</span>

seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;n;p&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>4</span>
<span class=m>5</span>
<span class=m>6</span>
<span class=m>6</span>
<span class=m>7</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>9</span>
<span class=m>10</span>
<span class=m>10</span>
</code></pre></div> <p>举例解读2：</p> <ul> <li> <p><code>seq 10</code>命令输出1～10个数字，每个数字一行。</p> </li> <li> <p><code>sed</code>命令读取第一行到<code>1</code>到模式空间（覆盖）。</p> </li> <li> <p>执行命令<code>N</code>，即读取下一行，即第二行的<code>2</code>，追加到模式空间。所以当前模式空间有<code>1</code>和<code>2</code>这2行记录。</p> </li> <li> <p>执行<code>s/\n//</code>，把模式空间中的第一行的<code>1</code>后面的<code>\n</code>替换为空，即，原来模式空间的两行<code>1</code>和<code>2</code>现在合并为一行，即<code>12</code>。</p> </li> <li> <p>读取第三行的<code>3</code>到模式空间（覆盖）。</p> </li> <li> <p>执行命令<code>N</code>，即读取下一行，即第四行的<code>4</code>，追加到模式空间。所以当前模式空间有<code>3</code>和<code>4</code>这2行记录。</p> </li> <li> <p>执行<code>s/\n//</code>，把模式空间中的第一行<code>3</code>后面的<code>\n</code>替换为空，即，原来模式空间的两行<code>3</code>和<code>4</code>现在合并为一行，即<code>34</code>。</p> </li> <li> <p>以此类推。</p> </li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;N;s/\n//&#39;</span>
<span class=m>12</span>
<span class=m>34</span>
<span class=m>56</span>
<span class=m>78</span>
<span class=m>910</span>
</code></pre></div> <p>举例解读3：</p> <ul> <li> <p><code>seq 10</code>命令输出1～10个数字，每个数字一行。</p> </li> <li> <p><code>sed</code>命令读取第一行到<code>1</code>到模式空间（覆盖）。</p> </li> <li> <p>执行<code>!G</code>，即对第一行的<code>1</code>不执行<code>G</code>命令。</p> </li> <li> <p>执行<code>h</code>命令，即把<code>1</code>从模式空间覆盖至保持空间。至此，保持空间和模式空间都存有<code>1</code>。</p> </li> <li> <p>执行<code>$!d</code>，即不是最后一行就从模式空间删除，所以把<code>1</code>从模式空间中删除。</p> </li> <li> <p><code>sed</code>命令读取第二行到<code>2</code>到模式空间（覆盖）。</p> </li> <li> <p>执行<code>!G</code>，即对第二行的<code>2</code>执行<code>G</code>命令，把<code>1</code>从保持空间追加到模式空间。至此，保持空间存有<code>1</code>，模式空间存有<code>2</code>和<code>1</code>。</p> </li> <li> <p>执行<code>h</code>命令，即把<code>2</code>和<code>1</code>从模式空间覆盖至保持空间。至此，保持空间和模式空间都存有<code>2</code>和<code>1</code>。</p> </li> <li> <p>执行<code>$!d</code>，即不是最后一行就从模式空间删除，所以把<code>2</code>和<code>1</code>从模式空间中删除。</p> </li> <li> <p>以此类推，直至读取最后一行10。此时，模式空间是<code>10</code>，保持空间存有<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>。</p> </li> <li> <p>执行<code>!G</code>，即对最后一行的<code>10</code>执行<code>G</code>命令，把<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>从保持空间追加到模式空间。至此，保持空间存有<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>。，模式空间存有<code>10</code>、<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>。</p> </li> <li> <p>执行<code>h</code>命令，即把<code>10</code>、<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>从模式空间覆盖至保持空间。至此，保持空间和模式空间都存有<code>10</code>、<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>。</p> </li> <li> <p>执行<code>$!d</code>，当前是最后一行，所以不从模式空间删除当前内容。</p> </li> <li> <p>输出模式空间内容至屏幕。即10～1。</p> </li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;1!G;h;$!d&#39;</span>
<span class=m>10</span>
<span class=m>9</span>
<span class=m>8</span>
<span class=m>7</span>
<span class=m>6</span>
<span class=m>5</span>
<span class=m>4</span>
<span class=m>3</span>
<span class=m>2</span>
<span class=m>1</span>
</code></pre></div> <p>其他一些例子：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;/3/{g;1!p;};h&#39;</span>
<span class=m>2</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-nr<span class=w> </span><span class=s1>&#39;/3/{n;p}&#39;</span>
<span class=m>4</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;N;D&#39;</span>
<span class=m>10</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;3h;9G;9!d&#39;</span>
<span class=m>9</span>
<span class=m>3</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;$!N;$!D&#39;</span>
<span class=m>9</span>
<span class=m>10</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;$!d&#39;</span>
<span class=m>10</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;G&#39;</span>
<span class=m>1</span>

<span class=m>2</span>

<span class=m>3</span>

<span class=m>4</span>

<span class=m>5</span>

<span class=m>6</span>

<span class=m>7</span>

<span class=m>8</span>

<span class=m>9</span>

<span class=m>10</span>

$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;g&#39;</span>










$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;/^$/d;G&#39;</span>
<span class=m>1</span>

<span class=m>2</span>

<span class=m>3</span>

<span class=m>4</span>

<span class=m>5</span>

<span class=m>6</span>

<span class=m>7</span>

<span class=m>8</span>

<span class=m>9</span>

<span class=m>10</span>

$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;n;d&#39;</span>
<span class=m>1</span>
<span class=m>3</span>
<span class=m>5</span>
<span class=m>7</span>
<span class=m>9</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;1!G;h;$p&#39;</span>
<span class=m>10</span>
<span class=m>9</span>
<span class=m>8</span>
<span class=m>7</span>
<span class=m>6</span>
<span class=m>5</span>
<span class=m>4</span>
<span class=m>3</span>
<span class=m>2</span>
<span class=m>1</span>
</code></pre></div> <h2 id=510awk>5.10.三剑客<code>awk</code>命令<a class=headerlink href=#510awk title="Permanent link"> ¶</a></h2> <p><code>awk</code>是一个文本分析工具。<code>grep</code>擅长查找，<code>sed</code>擅长编辑，<code>awk</code>擅长数据分析并生成报告。</p> <p><code>awk</code>的名称得自于它的创始人Alfred Aho 、Peter Weinberger 和 Brian Kernighan 姓氏的首个字母。</p> <p><code>awk</code>有3个不同版本: <code>awk</code>、<code>nawk</code>和<code>gawk</code>。我们说的<code>awk</code>一般指<code>gawk</code>。<code>gawk</code> 是<code>awk</code>的GNU版本。</p> <p><code>awk</code>把文件逐行读入，以空格为默认分隔符将每行切片，再对切片进行分析处理。</p> <h3 id=5101>5.10.1.命令格式<a class=headerlink href=#5101 title="Permanent link"> ¶</a></h3> <p><code>awk 'pattern{action statements;...}' {filenames}</code></p> <ul> <li> <p><code>pattern</code>表示<code>awk</code>在数据中查找的内容。是要表示的正则表达式，用斜杠括起来。</p> </li> <li> <p><code>action</code>是在找到匹配内容时所执行的一系列命令。</p> </li> <li> <p><code>-F</code>：指定分隔符，后面紧跟单引号，单引号内是分隔符。如不加<code>-F</code>选项，则以空格或者tab作为分隔符。</p> </li> <li> <p><code>-v</code>：var=value，变量赋值。</p> </li> </ul> <p>提示：</p> <ul> <li><code>-F ""</code>指定空字符串作为字段分隔符，从而将输入字符串中的每个字符作为一个独立的字段进行处理。然后，使用循环遍历每个字段，如果字段中包含数字，则将其添加到str1变量中。最后，打印str1的值。</li> <li><code>-F ''</code>中的两个单引号之间没有提供有效的字段分隔符。在awk中，字段分隔符必须是一个非空字符串。</li> </ul> <p>示例：第一个和第三个命令是正确的。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++){if($i ~ /[[:digit:]]/){str=$i;str1=(str1 str)}};print str1}&#39;</span>
<span class=m>05989233334455</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=s2>&quot;&quot;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++){if($i ~ /[[:digit:]]/){str=$i;str1=(str1 str)}};print str1}&#39;</span>

$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++){if($i ~ /[[:digit:]]/){str=$i;str1=(str1 str)}};print str1}&#39;</span>
<span class=m>05989233334455</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=s1>&#39;&#39;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++){if($i ~ /[[:digit:]]/){str=$i;str1=(str1 str)}};print str1}&#39;</span>
</code></pre></div> <h3 id=5102>5.10.2.工作过程<a class=headerlink href=#5102 title="Permanent link"> ¶</a></h3> <ol> <li> <p>执行BEGIN{action;...}语句块中的语句。</p> </li> <li> <p>BEGIN语句块再awk读入输入流之前被执行。</p> </li> <li> <p>是可选语句块。</p> </li> <li> <p>包含初始化变量，打印输出表格的表头等语句。</p> </li> <li> <p>从文件或者标准输入stdin读取一行，然后执行pattern{action;...}语句块。从第一行开始到最后一行，逐行扫描文件，重复这个动作，直到文件或者输入流全部被读取完毕。</p> </li> <li> <p>可选语句块。</p> </li> <li> <p>如果没有提供pattern语句块，则默认执行{print}。</p> </li> <li> <p>当读至文件或者输入流末尾时，执行END{action;...}语句块，比如打印所有行的分析结果这类汇总信息。也是一个可选语句块。</p> </li> </ol> <h3 id=5103>5.10.3.分隔符、域和记录<a class=headerlink href=#5103 title="Permanent link"> ¶</a></h3> <ul> <li> <p>有分隔符分隔的字段（列column，域field），标记<code>$1</code>、<code>$2</code>、<code>$3</code>、...、<code>$n</code>称为域标识，<code>$0</code>为所有域。注意，和shell变量中的<code>$</code>不同。</p> </li> <li> <p>每一行成为记录（record）。</p> </li> <li> <p>如果省略action，则默认执行<code>print $0</code>操作。</p> </li> </ul> <h3 id=5104action>5.10.4.常用action分类<a class=headerlink href=#5104action title="Permanent link"> ¶</a></h3> <ul> <li> <p>Output statements: <code>print</code>, <code>printf</code></p> </li> <li> <p>Expressions: 算术、比较表达式</p> </li> <li> <p>Compund statements: 组合语句</p> </li> <li> <p>Control statements: <code>if</code>, <code>while</code>语句</p> </li> <li> <p>Input statements:</p> </li> </ul> <p>动作<code>print</code></p> <p>格式：<code>print item1, item2, ...</code></p> <p>说明：</p> <ul> <li> <p>逗号分隔符</p> </li> <li> <p>输出item可以是字符串，也可以是数值，是当前记录的字段、变量或<code>awk</code>表达式。</p> </li> <li> <p>如果省略item，相当于<code>print $0</code></p> </li> <li> <p>固定字符需要用双引号，而变量和数字不需要。</p> </li> </ul> <p>示例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print &quot;hello awk&quot;}&#39;</span>
hello<span class=w> </span>awk
hello<span class=w> </span>awk
hello<span class=w> </span>awk
hello<span class=w> </span>awk
hello<span class=w> </span>awk

$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print 3*5}&#39;</span>
<span class=m>15</span>
<span class=m>15</span>
<span class=m>15</span>
<span class=m>15</span>
<span class=m>15</span>

$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print &quot;hello&quot;}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-5
hello
hello
hello
hello
hello

$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-5
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User<span class=w> </span><span class=k>for</span><span class=w> </span>D-Bus:/run/dbus:/usr/bin/false
systemd-network:x:497:497:systemd<span class=w> </span>Network<span class=w> </span>Management:/:/usr/sbin/nologin
systemd-timesync:x:496:496:systemd<span class=w> </span>Time<span class=w> </span>Synchronization:/:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/var/lib/nobody:/bin/bash

$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $0}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-5
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User<span class=w> </span><span class=k>for</span><span class=w> </span>D-Bus:/run/dbus:/usr/bin/false
systemd-network:x:497:497:systemd<span class=w> </span>Network<span class=w> </span>Management:/:/usr/sbin/nologin
systemd-timesync:x:496:496:systemd<span class=w> </span>Time<span class=w> </span>Synchronization:/:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/var/lib/nobody:/bin/bash

$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $1,$3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-5
root<span class=w> </span><span class=m>0</span>
messagebus<span class=w> </span><span class=m>499</span>
systemd-network<span class=w> </span><span class=m>497</span>
systemd-timesync<span class=w> </span><span class=m>496</span>
nobody<span class=w> </span><span class=m>65534</span>

$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $1&quot;\t&quot;$3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-5
root<span class=w>    </span><span class=m>0</span>
messagebus<span class=w>    </span><span class=m>499</span>
systemd-network<span class=w>    </span><span class=m>497</span>
systemd-timesync<span class=w>    </span><span class=m>496</span>
nobody<span class=w>    </span><span class=m>65534</span>


$<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;^UUID&quot;</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2,$3}&#39;</span>
/<span class=w> </span>btrfs
/var<span class=w> </span>btrfs
/usr/local<span class=w> </span>btrfs
/tmp<span class=w> </span>btrfs
/srv<span class=w> </span>btrfs
/root<span class=w> </span>btrfs
/opt<span class=w> </span>btrfs
/home<span class=w> </span>btrfs
/boot/grub2/x86_64-efi<span class=w> </span>btrfs
/boot/grub2/i386-pc<span class=w> </span>btrfs
/.snapshots<span class=w> </span>btrfs
swap<span class=w> </span>swap
</code></pre></div> <p>示例：读取分区利用率。</p> <p>分隔符中的定义<code>[[:space:]]+|%</code>的含义，一个或多个空格或者<code>%</code>作为分隔符。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>df<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $1,$5}&#39;</span>
Filesystem<span class=w> </span>Use%
devtmpfs<span class=w> </span><span class=m>0</span>%
tmpfs<span class=w> </span><span class=m>0</span>%
tmpfs<span class=w> </span><span class=m>2</span>%
tmpfs<span class=w> </span><span class=m>0</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
/dev/sda2<span class=w> </span><span class=m>8</span>%
tmpfs<span class=w> </span><span class=m>0</span>%

$<span class=w> </span>df<span class=w> </span><span class=p>|</span>grep<span class=w> </span><span class=s1>&#39;^/dev/sd&#39;</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=s1>&#39;[[:space:]]+|%&#39;</span><span class=w> </span><span class=s1>&#39;{print $1,$5}&#39;</span>
$<span class=w> </span>df<span class=w> </span><span class=p>|</span>grep<span class=w> </span><span class=s1>&#39;^/dev/sd&#39;</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=s1>&#39; +|%&#39;</span><span class=w> </span><span class=s1>&#39;{print $1,$5}&#39;</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
/dev/sda2<span class=w> </span><span class=m>8</span>
</code></pre></div> <p>示例：读取ifconfig输出结果中的ip地址。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2p&#39;</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;/netmask/{print $2}&#39;</span>
<span class=m>192</span>.168.10.210

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;2p&#39;</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span>
<span class=m>192</span>.168.10.210
</code></pre></div> <h3 id=5105pattern>5.10.5.模式Pattern<a class=headerlink href=#5105pattern title="Permanent link"> ¶</a></h3> <p>根据pattern条件，过滤匹配的行，再做处理。</p> <ul> <li> <p>如果未指定，即空模式，则匹配每一行。</p> </li> <li> <p><code>/regular expression/</code>，仅处理能够模式匹配到的行（即结果为真），需要用<code>/</code>进行括起来。</p> </li> <li> <p>结果为真，即非0值、非空字符串</p> </li> <li> <p>结果为假，即0值、空字符串</p> </li> </ul> <p>示例：空模式</p> <div class=highlight><pre><span></span><code>awk<span class=w> </span>-F<span class=s2>&quot;:&quot;</span><span class=w> </span><span class=s1>&#39;{print $1, $3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n5
root<span class=w> </span><span class=m>0</span>
messagebus<span class=w> </span><span class=m>499</span>
systemd-network<span class=w> </span><span class=m>497</span>
systemd-timesync<span class=w> </span><span class=m>496</span>
nobody<span class=w> </span><span class=m>65534</span>
</code></pre></div> <p>示例：非空模式</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;0&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;1&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;2&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;&quot;true&quot;&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;&quot;false&quot;&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;true&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;false&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;&quot;&quot;&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;&quot;0&quot;&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
</code></pre></div> <p>体会下面变量的值和正确使用变量（字符串还是变量？）</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;&quot;test&quot;&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;test&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>test</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=s1>&#39;&quot;test&quot;&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>test</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=s1>&#39;test&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>test</span><span class=o>=</span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=s1>&#39;test&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>test</span><span class=o>=</span><span class=s2>&quot;0&quot;</span><span class=w> </span><span class=s1>&#39;&quot;test&quot;&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>test</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=s1>&#39;test&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
</code></pre></div> <p>体会下面的与非判断。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User<span class=w> </span><span class=k>for</span><span class=w> </span>D-Bus:/run/dbus:/usr/bin/false
systemd-network:x:497:497:systemd<span class=w> </span>Network<span class=w> </span>Management:/:/usr/sbin/nologin
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;!1&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;!0&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User<span class=w> </span><span class=k>for</span><span class=w> </span>D-Bus:/run/dbus:/usr/bin/false
systemd-network:x:497:497:systemd<span class=w> </span>Network<span class=w> </span>Management:/:/usr/sbin/nologin
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># i没有赋值，为假，没有输出</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;i&#39;</span>
<span class=c1># i赋值为0，为假，没有输出</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;i=0&#39;</span>
<span class=c1># i赋值为1，为真，输出第一行结果，以此类推，每行都为真，输出全部seq的结果</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;i=1&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
<span class=c1># 第一次初始i未赋值，为假，!i则为真，赋值给i，所以i为真,输出seq第1行结果</span>
<span class=c1># 第二次初始i为真，!i则为假，赋值给i，所以i为假，不输出seq第2行结果</span>
<span class=c1># 第三次初始i为假，!i则为真，赋值给i，所以i为真，输出seq第3行结果</span>
<span class=c1># 以此类推，输出seq结果的奇数行</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;i=!i&#39;</span>
<span class=m>1</span>
<span class=m>3</span>
<span class=m>5</span>
<span class=c1># 与上例的区别在于i初始值未真，第一次的i值为假，不输出seq第1行结果</span>
<span class=c1># 第二次i的初始值为假，通过i=!i变为真，所以输出seq的第2行结果</span>
<span class=c1># 以此类推，输出seq结果的偶数行</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=s1>&#39;i=!i&#39;</span>
<span class=m>2</span>
<span class=m>4</span>
<span class=c1># 输出计数行</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=s1>&#39;i=!i&#39;</span>
<span class=m>1</span>
<span class=m>3</span>
<span class=m>5</span>
<span class=c1># 只输出i的值，不输出seq的值</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{i=!i;print i}&#39;</span>
<span class=m>1</span>
<span class=m>0</span>
<span class=m>1</span>
<span class=m>0</span>
<span class=m>1</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{i=!i}&#39;</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;(i=!i)&#39;</span>
<span class=m>1</span>
<span class=m>3</span>
<span class=m>5</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>5</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;!(i=!i)&#39;</span>
<span class=m>2</span>
<span class=m>4</span>
</code></pre></div> <h3 id=5106>5.10.6.截取片段<a class=headerlink href=#5106 title="Permanent link"> ¶</a></h3> <p>示例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>head<span class=w> </span>-n2<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $0}&#39;</span>
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User<span class=w> </span><span class=k>for</span><span class=w> </span>D-Bus:/run/dbus:/usr/bin/false

$<span class=w> </span>head<span class=w> </span>-n2<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span>
x
x

$<span class=w> </span>head<span class=w> </span>-n2<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $1}&#39;</span>
root
messagebus
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>head<span class=w> </span>-n2<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $1&quot;#&quot;$2&quot;#&quot;$3&quot;#&quot;$4}&#39;</span>
root#x#0#0
messagebus#x#499#499
</code></pre></div> <h3 id=5107>5.10.7.操作符<a class=headerlink href=#5107 title="Permanent link"> ¶</a></h3> <h4 id=51071>5.10.7.1.算数操作符<a class=headerlink href=#51071 title="Permanent link"> ¶</a></h4> <p><code>x+y</code>，<code>x-y</code>，<code>x*y</code>，<code>x/y</code>，<code>x^y</code>，<code>x%y</code>。</p> <p><code>-x</code>：转换为负数</p> <p><code>+x</code>：将字符串转换为数值</p> <p>列值之间进行算术运算。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{$7=$3+$4;print $1,$3,$4,$7}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n5
root<span class=w> </span><span class=m>0</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=m>0</span>
messagebus<span class=w> </span><span class=m>499</span><span class=w> </span><span class=m>499</span><span class=w> </span><span class=m>998</span>
systemd-network<span class=w> </span><span class=m>497</span><span class=w> </span><span class=m>497</span><span class=w> </span><span class=m>994</span>
systemd-timesync<span class=w> </span><span class=m>496</span><span class=w> </span><span class=m>496</span><span class=w> </span><span class=m>992</span>
nobody<span class=w> </span><span class=m>65534</span><span class=w> </span><span class=m>65534</span><span class=w> </span><span class=m>131068</span>
</code></pre></div> <p>计算某个列的总和。 <code>END</code>表示所有的行都已经执行。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{(total=total+$3)}; END {print total}&#39;</span><span class=w> </span>/etc/passwd
<span class=m>103011</span>
</code></pre></div> <h4 id=51072>5.10.7.2.字符串操作符<a class=headerlink href=#51072 title="Permanent link"> ¶</a></h4> <p>没有操作符号，字符串连接。</p> <h4 id=51073>5.10.7.3.赋值操作符<a class=headerlink href=#51073 title="Permanent link"> ¶</a></h4> <p><code>=</code>，<code>+=</code>，<code>-=</code>，<code>*=</code>，<code>/=</code>，<code>%=</code>，<code>^=</code>，<code>++</code>，<code>--</code>。</p> <p>示例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print i}&#39;</span>

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print i++}&#39;</span><span class=w> </span><span class=c1>#从0开始</span>
<span class=m>0</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print ++i}&#39;</span>
<span class=m>1</span>

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print i++, i}&#39;</span>
<span class=m>0</span><span class=w> </span><span class=m>1</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;print i++, i}&#39;</span>
<span class=m>0</span><span class=w> </span><span class=m>1</span>

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print ++i, i}&#39;</span>
<span class=m>1</span><span class=w> </span><span class=m>1</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;print ++i, i}&#39;</span>
<span class=m>1</span><span class=w> </span><span class=m>1</span>

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;print i, i++}&#39;</span>
<span class=m>0</span><span class=w> </span><span class=m>0</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;print i, ++i}&#39;</span>
<span class=m>0</span><span class=w> </span><span class=m>1</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>seq<span class=w> </span><span class=m>10</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
<span class=m>6</span>
<span class=m>7</span>
<span class=m>8</span>
<span class=m>9</span>
<span class=m>10</span>
<span class=c1># n从0开始计数，输出的是n值，不是seq的输出结果</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{print n++}&#39;</span>
<span class=m>0</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
<span class=m>6</span>
<span class=m>7</span>
<span class=m>8</span>
<span class=m>9</span>
<span class=c1># seq=1时，初始n未赋值，为假，不输出seq结果，n++为真</span>
<span class=c1># seq=2时，n为真，输出seq结果，n++为真</span>
<span class=c1># 后续n++都为真，所以seq的结果出了第一行由于n为假没有输出，其他行都输出</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;n++&#39;</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
<span class=m>6</span>
<span class=m>7</span>
<span class=m>8</span>
<span class=m>9</span>
<span class=m>10</span>
<span class=c1># 参考上例，n初始未赋值，但执行++n后为真，所以输出第一行，后续行都输出因为n一直为真</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;++n&#39;</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
<span class=m>6</span>
<span class=m>7</span>
<span class=m>8</span>
<span class=m>9</span>
<span class=m>10</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># n=0时++n=1，!++n=0，输出第0行</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>n</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=s1>&#39;!++n&#39;</span><span class=w> </span>/etc/passwd

<span class=c1># n=0时n++=1，!n++=1，输出第1行</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>n</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=s1>&#39;!n++&#39;</span><span class=w> </span>/etc/passwd
root:x:0:0:root:/root:/bin/bash

$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>n</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=s1>&#39;!n++{print n}&#39;</span><span class=w> </span>/etc/passwd
<span class=m>1</span>
<span class=c1># 无结果输出</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>n</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=s1>&#39;!++n{print n}&#39;</span><span class=w> </span>/etc/passwd
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>n</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=s1>&#39;!n++{print n}&#39;</span><span class=w> </span>/etc/passwd

$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>n</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=s1>&#39;!n++&#39;</span><span class=w> </span>/etc/passwd
root:x:0:0:root:/root:/bin/bash
<span class=c1># 无结果输出</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>n</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=s1>&#39;!n++&#39;</span><span class=w> </span>/etc/passwd
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>n</span><span class=o>=</span><span class=m>2</span><span class=w> </span><span class=s1>&#39;!n++&#39;</span><span class=w> </span>/etc/passwd
</code></pre></div> <h4 id=51074>5.10.7.4.比较操作符<a class=headerlink href=#51074 title="Permanent link"> ¶</a></h4> <p>使用 <code>==</code> 代表等于，即精确匹配。类似还有 <code>&gt;</code>、<code>&gt;=</code>、<code>&lt;</code>、<code>&lt;=</code>、<code>!=</code>符号。</p> <p>以<code>:</code>为分隔符，匹配第三列的值为<code>1000</code>的行。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;$3==&quot;100&quot;&#39;</span><span class=w> </span>/etc/passwd
vagrant:x:1000:478:vagrant:/home/vagrant:/bin/bash
</code></pre></div> <p>在和数字比较时，若把要比较的数字用双引号引起来，<code>awk</code>会按字符处理，不加双引号，则会按数字处理。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;$3&lt;=&quot;100&quot;&#39;</span><span class=w> </span>/etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/usr/sbin/nologin

$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;$3&lt;=100&#39;</span><span class=w> </span>/etc/passwd
root:x:0:0:root:/root:/bin/bash
postfix:x:51:51:Postfix<span class=w> </span>Daemon:/var/spool/postfix:/usr/sbin/nologin
man:x:13:62:Manual<span class=w> </span>pages<span class=w> </span>viewer:/var/lib/empty:/usr/sbin/nologin
daemon:x:2:2:Daemon:/sbin:/usr/sbin/nologin
at:x:25:25:Batch<span class=w> </span><span class=nb>jobs</span><span class=w> </span>daemon:/var/spool/atjobs:/usr/sbin/nologin
bin:x:1:1:bin:/bin:/usr/sbin/nologin
</code></pre></div> <div class=highlight><pre><span></span><code>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{if ($1==&quot;root&quot;) {print $0}}&#39;</span><span class=w> </span>/etc/passwd
</code></pre></div> <div class=highlight><pre><span></span><code>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;$7!=&quot;/bin/false&quot;&#39;</span><span class=w> </span>/etc/passwd
awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;$3&lt;$2&#39;</span><span class=w> </span>/etc/passwd
</code></pre></div> <h4 id=51075>5.10.7.5.逻辑操作符<a class=headerlink href=#51075 title="Permanent link"> ¶</a></h4> <p><code>&amp;&amp;</code> 表示“并且”</p> <p><code>||</code>表示“或者”</p> <p><code>!</code>表示“非”（取反）</p> <div class=highlight><pre><span></span><code>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;$3&gt;10 &amp;&amp; $3&lt;100&#39;</span><span class=w> </span>/etc/passwd
awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;$3&gt;10 || $3&lt;100&#39;</span><span class=w> </span>/etc/passwd
awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;($3==0)&#39;</span><span class=w> </span>/etc/passwd
awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;!($3==0)&#39;</span><span class=w> </span>/etc/passwd
</code></pre></div> <p>注意下面对字符和数值进行取反操作的结果。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print i}&#39;</span>

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print !i}&#39;</span>
<span class=m>1</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span><span class=m>10</span><span class=w> </span><span class=s1>&#39;BEGIN{print i}&#39;</span>
<span class=m>10</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span><span class=m>10</span><span class=w> </span><span class=s1>&#39;BEGIN{print !i}&#39;</span>
<span class=m>0</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span>-5<span class=w> </span><span class=s1>&#39;BEGIN{print i}&#39;</span>
-5
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span>-5<span class=w> </span><span class=s1>&#39;BEGIN{print !i}&#39;</span>
<span class=m>0</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span><span class=s2>&quot;abc&quot;</span><span class=w> </span><span class=s1>&#39;BEGIN{print i}&#39;</span>
abc
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span><span class=s2>&quot;abc&quot;</span><span class=w> </span><span class=s1>&#39;BEGIN{print !i}&#39;</span>
<span class=m>0</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span>abc<span class=w> </span><span class=s1>&#39;BEGIN{print i}&#39;</span>
abc
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span>abc<span class=w> </span><span class=s1>&#39;BEGIN{print !i}&#39;</span>
<span class=m>0</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=w> </span><span class=s1>&#39;BEGIN{print i}&#39;</span>

$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>i</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=w> </span><span class=s1>&#39;BEGIN{print !i}&#39;</span>
<span class=m>1</span>
</code></pre></div> <p>在分隔符定义中使用正则表达式。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>df<span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=s2>&quot; +|%&quot;</span><span class=w> </span><span class=s1>&#39;{print $5}&#39;</span>
Use
<span class=m>0</span>
<span class=m>0</span>
<span class=m>2</span>
<span class=m>0</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>0</span>
$<span class=w> </span>df<span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=s2>&quot;[[:space:]]+|%&quot;</span><span class=w> </span><span class=s1>&#39;{print $5}&#39;</span>
Use
<span class=m>0</span>
<span class=m>0</span>
<span class=m>2</span>
<span class=m>0</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>0</span>
</code></pre></div> <h4 id=51076>5.10.7.6.三目条件表达式<a class=headerlink href=#51076 title="Permanent link"> ¶</a></h4> <p>格式：<code>selector?if-true-expression:if-false-expression</code></p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{$3&gt;1000?usertype=&quot;Common User&quot;:usertype=&quot;Superuser&quot;;printf&quot;%-20s:%12s\n&quot;, $1, usertype}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n5
root<span class=w>                </span>:<span class=w>   </span>Superuser
messagebus<span class=w>          </span>:<span class=w>   </span>Superuser
systemd-network<span class=w>     </span>:<span class=w>   </span>Superuser
systemd-timesync<span class=w>    </span>:<span class=w>   </span>Superuser
nobody<span class=w>              </span>:<span class=w> </span>Common<span class=w> </span>User
</code></pre></div> <h4 id=51078>5.10.7.8.模式匹配符<a class=headerlink href=#51078 title="Permanent link"> ¶</a></h4> <p><code>~</code>：左右是否匹配</p> <p><code>!~</code>：左右是否不匹配</p> <p>示例：</p> <p>匹配文件中指定字符串<code>root</code>的所有行，类似grep命令，但没有高亮显示。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/root/&#39;</span><span class=w> </span>/etc/passwd
root:x:0:0:root:/root:/bin/bash
</code></pre></div> <p>以<code>:</code>为分隔符，匹配第一列<code>$1</code>中包含指定字符串<code>oo</code>的行。<code>~</code>是代表左右匹配。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;$1 ~/oo/&#39;</span><span class=w> </span>/etc/passwd
root:x:0:0:root:/root:/bin/bash
gentoo:x:1014:100:Gentoo<span class=w> </span>Distribution:/home/gentoo:/bin/csh
</code></pre></div> <p>以<code>:</code>为分隔符，匹配所有列<code>$0</code>（整行）中包含<code>root</code>行的第一列<code>$1</code>。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;$0 ~/root/{print $1}&#39;</span><span class=w> </span>/etc/passwd
$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;$0 ~&quot;root&quot;{print $1}&#39;</span><span class=w> </span>/etc/passwd
root
daemon
_cvmsroot
</code></pre></div> <p>以<code>:</code>为分隔符，匹配所有列<code>$0</code>（整行）中以<code>root</code>开头行的第一列<code>$1</code>。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;$0 ~&quot;^root&quot;{print $1}&#39;</span><span class=w> </span>/etc/passwd
$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;$0 ~/^root/{print $1}&#39;</span><span class=w> </span>/etc/passwd
root
</code></pre></div> <p>以<code>:</code>为分隔符，匹配所有列<code>$0</code>（整行）中不以<code>root</code>开头行的第一列<code>$1</code>。</p> <div class=highlight><pre><span></span><code>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;$0 !~/^root/{print $1}&#39;</span><span class=w> </span>/etc/passwd
awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;$0 ~/^[^root]/{print $1}&#39;</span><span class=w> </span>/etc/passwd
</code></pre></div> <p>多条件匹配，以<code>:</code>为分隔符，匹配所有含有<code>root</code>或<code>ftp</code>的行，并打印第1、3列。</p> <div class=highlight><pre><span></span><code>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;/root/ {print $1,$3} /bin/ {print $1,$3}&#39;</span><span class=w> </span>/etc/passwd
</code></pre></div> <p>多条件匹配，以<code>:</code>为分隔符，匹配第一列中含有<code>root</code>或<code>bin</code>的行，并打印第1、3列。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;$1 ~/root/ {print $1,$3} $1 ~/bin/ {print $1,$3}&#39;</span><span class=w> </span>/etc/passwd
root<span class=w> </span><span class=m>0</span>
bin<span class=w> </span><span class=m>1</span>
</code></pre></div> <p>以<code>:</code>为分隔符，匹配第三列<code>$3</code>中值为<code>0</code>的行。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=s2>&quot;:&quot;</span><span class=w> </span><span class=s1>&#39;$3==0&#39;</span><span class=w> </span>/etc/passwd
root:x:0:0:root:/root:/bin/bash
</code></pre></div> <p>以至少一个空格或%为分隔符，匹配以<code>/dev/sd</code>开头的行，打印第五列。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>df<span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=s2>&quot;[[:space:]]+|%&quot;</span><span class=w> </span><span class=s1>&#39;$0 ~ /^\/dev\/sd/{print $5}&#39;</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
<span class=m>8</span>
</code></pre></div> <p>读取<code>ifconfig eth0</code>输出结果的第二行<code>NR==2</code>的第二列<code>$2</code>。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $2}&#39;</span>
<span class=m>192</span>.168.10.210
</code></pre></div> <h3 id=5108>5.10.8.变量<a class=headerlink href=#5108 title="Permanent link"> ¶</a></h3> <h4 id=51081>5.10.8.1.内置变量<a class=headerlink href=#51081 title="Permanent link"> ¶</a></h4> <p><code>awk</code>常用的变量有<code>FS</code>、<code>OFS</code>、<code>NF</code> 和 <code>NR</code>。</p> <p><code>FS</code>用来定义输入字段分隔符，默认为空白字符。与<code>-F</code> 选项功能类似，同时使用会报错。</p> <p><code>OFS</code>用来定义输出字段分隔符，默认为空白字符。</p> <p><code>RS</code>指定输入时的换行符。</p> <p><code>ORS</code>指定符号在输出时替换换行符。</p> <p><code>NF</code> 表示用分隔符分隔后一共有多少列。</p> <p><code>NR</code> 表示行号。</p> <p><code>FNR</code>表示个文件分别计数各自记录的编号。</p> <p><code>FILENAME</code>表示当前文件名。</p> <p><code>ARGC</code>表示命令行参数的个数。</p> <p><code>ARVC</code>以数组形式保存命令行所给定的各参数，每个参数：<code>ARGV[0]</code>，......。</p> <p><code>FS</code>的用法：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>FS</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $1, FS, $3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n5
root<span class=w> </span>:<span class=w> </span><span class=m>0</span>
messagebus<span class=w> </span>:<span class=w> </span><span class=m>499</span>
systemd-network<span class=w> </span>:<span class=w> </span><span class=m>497</span>

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{print $1FS$3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n3
root:0
messagebus:499
systemd-network:497
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nv>S</span><span class=o>=</span>:<span class=p>;</span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>FS</span><span class=o>=</span><span class=nv>$S</span><span class=w> </span><span class=s1>&#39;{print $1FS$3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n3
root:0
messagebus:499
systemd-network:497
systemd-timesync:496
nobody:65534

$<span class=w> </span><span class=nv>S</span><span class=o>=</span>:<span class=p>;</span>awk<span class=w> </span>-F<span class=nv>$S</span><span class=w> </span><span class=s1>&#39;{print $1FS$3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n3
root:0
messagebus:499
systemd-network:497
</code></pre></div> <p><code>FS</code>和 <code>-F</code> 选项功同时使用会冲突，<code>-F</code>的优先级更高。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>FS</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=w> </span>-F<span class=s1>&#39;;&#39;</span><span class=w> </span><span class=s1>&#39;{print $1FS$3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n3
root:x:0:0:root:/root:/bin/bash<span class=p>;</span>
messagebus:x:499:499:User<span class=w> </span><span class=k>for</span><span class=w> </span>D-Bus:/run/dbus:/usr/bin/false<span class=p>;</span>
systemd-network:x:497:497:systemd<span class=w> </span>Network<span class=w> </span>Management:/:/usr/sbin/nologin<span class=p>;</span>

$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>FS</span><span class=o>=</span><span class=s1>&#39;;&#39;</span><span class=w> </span>-F<span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $1FS$3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n3
root:0
messagebus:499
systemd-network:497
</code></pre></div> <p><code>OFS</code>的用法：</p> <p>以<code>:</code>为分隔符，打印第1、3、4列第内容，并以<code>#</code>为分隔符。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{OFS=&quot;#&quot;} {print $1,$3,$4}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n5
root#0#0
messagebus#499#499
systemd-network#497#497
systemd-timesync#496#496
nobody#65534#65534

$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>FS</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=w> </span>-v<span class=w> </span><span class=nv>OFS</span><span class=o>=</span><span class=s1>&#39;#&#39;</span><span class=w> </span><span class=s1>&#39;{print $1,$3,$4}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n5
root#0#0
messagebus#499#499
systemd-network#497#497
systemd-timesync#496#496
nobody#65534#65534
</code></pre></div> <p>以<code>:</code>为分隔符，当第三列大于等于5000时，打印第1、2、3、4列第内容，并以<code>#</code>为分隔符。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{OFS=&quot;#&quot;} {if ($3&gt;=5000) {print $1,$2,$3,$4}}&#39;</span><span class=w> </span>/etc/passwd
nobody#x#65534#65534
</code></pre></div> <p><code>RS</code>的用法：</p> <div class=highlight><pre><span></span><code><span class=c1># 以空格为换行标志</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>RS</span><span class=o>=</span><span class=s1>&#39; &#39;</span><span class=w> </span><span class=s1>&#39;{print $0}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User
<span class=k>for</span>

<span class=c1># 以冒号为换行标志</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>RS</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $0}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
root
x
<span class=m>0</span>
</code></pre></div> <p><code>ORS</code>的用法：</p> <div class=highlight><pre><span></span><code><span class=c1># 以冒号为换行标志，替换成###</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>RS</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=w> </span>-v<span class=w> </span><span class=nv>ORS</span><span class=o>=</span><span class=s1>&#39;###&#39;</span><span class=w> </span><span class=s1>&#39;{print $0}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
root###x###0###0###root###/root###/bin/bash
messagebus###x###499###499###User<span class=w> </span><span class=k>for</span><span class=w> </span>D-Bus###/run/dbus###/usr/bin/false
systemd-network###x###497###497###systemd<span class=w> </span>Network<span class=w> </span>Management###/###/usr/sbin/nologin
</code></pre></div> <p><code>NF</code> 的用法：</p> <p>其中 <code>NF</code> 是多少列，<code>$NF</code> 是最后一列的值。</p> <p>下例中以<code>:</code>为分隔符一共分为7列，最后一列的值是<code>$NF</code>。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print $NF}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n2
/bin/bash
/usr/bin/false

$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print NF}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-n2
<span class=m>7</span>
<span class=m>7</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>ss<span class=w> </span>-nt<span class=w> </span><span class=p>|</span>grep<span class=w> </span><span class=s2>&quot;^ESTAB&quot;</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=s2>&quot;[[:space:]]+|:&quot;</span><span class=w> </span><span class=s1>&#39;{print $(NF-2)}&#39;</span>
<span class=m>192</span>.168.10.103

$<span class=w> </span>ss<span class=w> </span>-nt<span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=s2>&quot;[[:space:]]+|:&quot;</span><span class=w> </span><span class=s1>&#39;/^ESTAB/{print $(NF-2)}&#39;</span>
<span class=m>192</span>.168.10.103
</code></pre></div> <p><code>NR</code> 的用法：</p> <p>通过<code>NR</code>输出行号。以<code>:</code>为分隔符，打印前三行的行号。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;{print NR}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
</code></pre></div> <p>取奇、偶数行。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR%2==0&#39;</span>
<span class=m>2</span>
<span class=m>4</span>
<span class=m>6</span>
<span class=m>8</span>
<span class=m>10</span>
$<span class=w> </span>seq<span class=w> </span><span class=m>10</span><span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR%2==1&#39;</span>
<span class=m>1</span>
<span class=m>3</span>
<span class=m>5</span>
<span class=m>7</span>
<span class=m>9</span>
</code></pre></div> <p>通过<code>NR</code>设定行号条件。以<code>:</code>为分隔符，打印第40行以后的行内容。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;NR&gt;45&#39;</span><span class=w> </span>/etc/passwd
admin3:x:1020:100::/home/admin3:/bin/bash
smith:x:2002:0:,,,:/home/admin2:/bin/bash
pm1:x:2003:1535::/home/pm1:/bin/bash
tm1:x:2004:1535::/home/tm1:/bin/bash
tm2:x:2005:1536::/home/tm2:/bin/bash

$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;NR&gt;45&#39;</span><span class=w> </span>/etc/passwd
admin3:x:1020:100::/home/admin3:/bin/bash
smith:x:2002:0:,,,:/home/admin2:/bin/bash
pm1:x:2003:1535::/home/pm1:/bin/bash
tm1:x:2004:1535::/home/tm1:/bin/bash
tm2:x:2005:1536::/home/tm2:/bin/bash

$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;NR&gt;45 {print NR,$1,$3}&#39;</span><span class=w> </span>/etc/passwd
<span class=m>46</span><span class=w> </span>admin3<span class=w> </span><span class=m>1020</span>
<span class=m>47</span><span class=w> </span>smith<span class=w> </span><span class=m>2002</span>
<span class=m>48</span><span class=w> </span>pm1<span class=w> </span><span class=m>2003</span>
<span class=m>49</span><span class=w> </span>tm1<span class=w> </span><span class=m>2004</span>
<span class=m>50</span><span class=w> </span>tm2<span class=w> </span><span class=m>2005</span>

$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;BEGIN{print NR}&#39;</span><span class=w> </span>/etc/passwd
<span class=m>0</span>

$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;END{print NR}&#39;</span><span class=w> </span>/etc/passwd
<span class=m>50</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;/netmask/{print $0}&#39;</span>
<span class=w>        </span>inet<span class=w> </span><span class=m>192</span>.168.10.210<span class=w>  </span>netmask<span class=w> </span><span class=m>255</span>.255.255.0<span class=w>  </span>broadcast<span class=w> </span><span class=m>192</span>.168.10.255

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;/netmask/{print $1}&#39;</span>
inet

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;/netmask/{print $2}&#39;</span>
<span class=m>192</span>.168.10.210

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $0}&#39;</span>
<span class=w>        </span>inet<span class=w> </span><span class=m>192</span>.168.10.210<span class=w>  </span>netmask<span class=w> </span><span class=m>255</span>.255.255.0<span class=w>  </span>broadcast<span class=w> </span><span class=m>192</span>.168.10.255

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $1}&#39;</span>
inet

$<span class=w> </span>ifconfig<span class=w> </span>eth0<span class=w> </span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;NR==2{print $2}&#39;</span>
<span class=m>192</span>.168.10.210
</code></pre></div> <p>通过<code>NR</code> 与列匹配一起使用。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;:&#39;</span><span class=w> </span><span class=s1>&#39;NR&lt;5 &amp;&amp; $1 ~/roo/&#39;</span><span class=w> </span>/etc/passwd
root:x:0:0:root:/root:/bin/bash
</code></pre></div> <p><code>FNR</code>的用法：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print FNR}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/networks
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
<span class=m>6</span>
<span class=m>7</span>
<span class=m>8</span>
<span class=m>9</span>
<span class=m>10</span>
<span class=m>11</span>
<span class=m>12</span>
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
<span class=m>6</span>
<span class=m>7</span>
<span class=m>8</span>
<span class=m>9</span>
<span class=m>10</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print NR, $0}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/networks
<span class=m>1</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/<span class=w>                       </span>btrfs<span class=w>  </span>defaults<span class=w>                      </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>2</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/var<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/var<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>3</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/usr/local<span class=w>              </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/usr/local<span class=w>           </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>4</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/tmp<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/tmp<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>5</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/srv<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/srv<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>6</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/root<span class=w>                   </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/root<span class=w>                </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>7</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/opt<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/opt<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>8</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/home<span class=w>                   </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/home<span class=w>                </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>9</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/boot/grub2/x86_64-efi<span class=w>  </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/boot/grub2/x86_64-efi<span class=w>  </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>10</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/boot/grub2/i386-pc<span class=w>     </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/boot/grub2/i386-pc<span class=w>  </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>11</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/.snapshots<span class=w>             </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/.snapshots<span class=w>          </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>12</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>47c36ad7-f49f-4ecd-9b72-4801c5bb3a04<span class=w>  </span>swap<span class=w>                    </span>swap<span class=w>   </span>defaults<span class=w>                      </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>13</span><span class=w> </span><span class=c1>#</span>
<span class=m>14</span><span class=w> </span><span class=c1># networks    This file describes a number of netname-to-address</span>
<span class=m>15</span><span class=w> </span><span class=c1>#        mappings for the TCP/IP subsystem.  It is mostly</span>
<span class=m>16</span><span class=w> </span><span class=c1>#        used at boot time, when no name servers are running.</span>
<span class=m>17</span><span class=w> </span><span class=c1>#</span>
<span class=m>18</span>
<span class=m>19</span><span class=w> </span>loopback<span class=w>    </span><span class=m>127</span>.0.0.0
<span class=m>20</span><span class=w> </span>link-local<span class=w>    </span><span class=m>169</span>.254.0.0
<span class=m>21</span>
<span class=m>22</span><span class=w> </span><span class=c1># End.</span>

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print FNR, $0}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/networks
<span class=m>1</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/<span class=w>                       </span>btrfs<span class=w>  </span>defaults<span class=w>                      </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>2</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/var<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/var<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>3</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/usr/local<span class=w>              </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/usr/local<span class=w>           </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>4</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/tmp<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/tmp<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>5</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/srv<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/srv<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>6</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/root<span class=w>                   </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/root<span class=w>                </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>7</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/opt<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/opt<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>8</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/home<span class=w>                   </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/home<span class=w>                </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>9</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/boot/grub2/x86_64-efi<span class=w>  </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/boot/grub2/x86_64-efi<span class=w>  </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>10</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/boot/grub2/i386-pc<span class=w>     </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/boot/grub2/i386-pc<span class=w>  </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>11</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/.snapshots<span class=w>             </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/.snapshots<span class=w>          </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>12</span><span class=w> </span><span class=nv>UUID</span><span class=o>=</span>47c36ad7-f49f-4ecd-9b72-4801c5bb3a04<span class=w>  </span>swap<span class=w>                    </span>swap<span class=w>   </span>defaults<span class=w>                      </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>1</span><span class=w> </span><span class=c1>#</span>
<span class=m>2</span><span class=w> </span><span class=c1># networks    This file describes a number of netname-to-address</span>
<span class=m>3</span><span class=w> </span><span class=c1>#        mappings for the TCP/IP subsystem.  It is mostly</span>
<span class=m>4</span><span class=w> </span><span class=c1>#        used at boot time, when no name servers are running.</span>
<span class=m>5</span><span class=w> </span><span class=c1>#</span>
<span class=m>6</span>
<span class=m>7</span><span class=w> </span>loopback<span class=w>    </span><span class=m>127</span>.0.0.0
<span class=m>8</span><span class=w> </span>link-local<span class=w>    </span><span class=m>169</span>.254.0.0
<span class=m>9</span>
<span class=m>10</span><span class=w> </span><span class=c1># End.</span>
</code></pre></div> <p><code>FILENAME</code>的用法：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print FILENAME}&#39;</span><span class=w> </span>/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print FNR, FILENAME, $0}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/networks
<span class=m>1</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/<span class=w>                       </span>btrfs<span class=w>  </span>defaults<span class=w>                      </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>2</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/var<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/var<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>3</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/usr/local<span class=w>              </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/usr/local<span class=w>           </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>4</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/tmp<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/tmp<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>5</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/srv<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/srv<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>6</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/root<span class=w>                   </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/root<span class=w>                </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>7</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/opt<span class=w>                    </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/opt<span class=w>                 </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>8</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/home<span class=w>                   </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/home<span class=w>                </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>9</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/boot/grub2/x86_64-efi<span class=w>  </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/boot/grub2/x86_64-efi<span class=w>  </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>10</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/boot/grub2/i386-pc<span class=w>     </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/boot/grub2/i386-pc<span class=w>  </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>11</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>5ffa8dbd-473e-4308-804a-0033c3b5f7af<span class=w>  </span>/.snapshots<span class=w>             </span>btrfs<span class=w>  </span><span class=nv>subvol</span><span class=o>=</span>/@/.snapshots<span class=w>          </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>12</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=nv>UUID</span><span class=o>=</span>47c36ad7-f49f-4ecd-9b72-4801c5bb3a04<span class=w>  </span>swap<span class=w>                    </span>swap<span class=w>   </span>defaults<span class=w>                      </span><span class=m>0</span><span class=w>  </span><span class=m>0</span>
<span class=m>1</span><span class=w> </span>/etc/networks<span class=w> </span><span class=c1>#</span>
<span class=m>2</span><span class=w> </span>/etc/networks<span class=w> </span><span class=c1># networks    This file describes a number of netname-to-address</span>
<span class=m>3</span><span class=w> </span>/etc/networks<span class=w> </span><span class=c1>#        mappings for the TCP/IP subsystem.  It is mostly</span>
<span class=m>4</span><span class=w> </span>/etc/networks<span class=w> </span><span class=c1>#        used at boot time, when no name servers are running.</span>
<span class=m>5</span><span class=w> </span>/etc/networks<span class=w> </span><span class=c1>#</span>
<span class=m>6</span><span class=w> </span>/etc/networks
<span class=m>7</span><span class=w> </span>/etc/networks<span class=w> </span>loopback<span class=w>    </span><span class=m>127</span>.0.0.0
<span class=m>8</span><span class=w> </span>/etc/networks<span class=w> </span>link-local<span class=w>    </span><span class=m>169</span>.254.0.0
<span class=m>9</span><span class=w> </span>/etc/networks
<span class=m>10</span><span class=w> </span>/etc/networks<span class=w> </span><span class=c1># End.</span>
</code></pre></div> <p><code>ARGC</code>的用法：</p> <p>每个变量的名字通过<code>ARGV</code>获取。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print ARGC}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/issue
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>
<span class=m>3</span>

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print ARGC}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/issue
<span class=m>3</span>
</code></pre></div> <p><code>ARGV</code>的用法：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print ARGV[0]}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/issue
awk
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print ARGV[1]}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/issue
/etc/fstab
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print ARGV[2]}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/issue
/etc/issue
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print ARGV[3]}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span>/etc/issue
</code></pre></div> <h4 id=51082>5.10.8.2.自定义变量<a class=headerlink href=#51082 title="Permanent link"> ¶</a></h4> <p>自定义变量是区分字符大小写的，使用下面的方式进行赋值。</p> <ul> <li> <p>-v var=value</p> </li> <li> <p>在program中直接定义</p> </li> </ul> <p>举例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>t1</span><span class=o>=</span><span class=nv>t2</span><span class=o>=</span><span class=s2>&quot;hello awk&quot;</span><span class=w> </span><span class=s1>&#39;BEGIN{print t1, t2}&#39;</span>
<span class=nv>t2</span><span class=o>=</span>hello<span class=w> </span>awk
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>t1</span><span class=o>=</span><span class=nv>t2</span><span class=o>=</span><span class=s2>&quot;hello awk&quot;</span><span class=w> </span><span class=s1>&#39;BEGIN{t1=t2=&quot;gawk&quot;; print t1, t2}&#39;</span>
gawk<span class=w> </span>gawk
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{t1=t2=&quot;hello awk&quot;; print t1, t2}&#39;</span>
hello<span class=w> </span>awk<span class=w> </span>hello<span class=w> </span>awk
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>t1</span><span class=o>=</span><span class=s2>&quot;hello awk&quot;</span><span class=w> </span><span class=s1>&#39;{print t1}&#39;</span><span class=w> </span>/etc/issue
hello<span class=w> </span>awk
hello<span class=w> </span>awk
hello<span class=w> </span>awk
hello<span class=w> </span>awk
hello<span class=w> </span>awk
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>t1</span><span class=o>=</span><span class=s2>&quot;hello awk&quot;</span><span class=w> </span><span class=s1>&#39;BEGIN{print t1}&#39;</span><span class=w> </span>/etc/issue
hello<span class=w> </span>awk
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>t1</span><span class=o>=</span><span class=s2>&quot;hello awk&quot;</span><span class=w> </span><span class=s1>&#39;BEGIN{print t1}&#39;</span>
hello<span class=w> </span>awk
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{sex=&quot;male&quot;; print $1, sex, age; age=28}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
root<span class=w> </span>male
messagebus<span class=w> </span>male<span class=w> </span><span class=m>28</span>
systemd-network<span class=w> </span>male<span class=w> </span><span class=m>28</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF &gt; awkscript</span>
<span class=s>{print script,$1,$2}</span>
<span class=s>EOF</span>

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span>-f<span class=w> </span>awkscript<span class=w> </span><span class=nv>script</span><span class=o>=</span><span class=s2>&quot;awk&quot;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n2
awk<span class=w> </span>root<span class=w> </span>x
awk<span class=w> </span>messagebus<span class=w> </span>x
</code></pre></div> <p>动作<code>printf</code>。</p> <p>动作printf可以实现格式化输出。</p> <p>格式：<code>printf "FORMAT", item1, item2, ......</code></p> <p>说明：</p> <ul> <li> <p>必须指定FORMAT</p> </li> <li> <p>不会自动换行，需要显式给出换行控制符<code>\n</code>。</p> </li> <li> <p>FORMAT中需要分别为后面每个item指定格式符。</p> </li> </ul> <p>格式符：与item是一一对应的</p> <ul> <li> <p><code>%s</code>：显示字符串</p> </li> <li> <p><code>%d</code>, <code>%i</code>：显示十进制整数</p> </li> <li> <p><code>%f</code>：显示为浮点数</p> </li> <li> <p><code>%e</code>, <code>%E</code>：显示科学计数法数值</p> </li> <li> <p><code>%c</code>：显示字符的ASCII码</p> </li> <li> <p><code>%g</code>, <code>%G</code>：以科学计数法或浮点形式显示数值</p> </li> <li> <p><code>%u</code>：无符号整数</p> </li> <li> <p><code>%%</code>：显示<code>%</code>自身</p> </li> </ul> <p>修饰符：</p> <ul> <li> <p><code>#[.#]</code>：第一个数字控制显示的宽度，第二个#表示小数点后精度，如<code>%3.1f</code></p> </li> <li> <p><code>-</code>：左对齐（默认右对齐），如<code>%-15s</code></p> </li> <li> <p><code>+</code>：显示数值的正负符号，如<code>%+d</code></p> </li> </ul> <p>示例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{printf &quot;%s&quot;, $1}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
rootmessagebussystemd-networksystemd-timesyncnobodymailchronypostfixmanlpgamesftpdaemonrpcnscdpolkitdattftpftpsecurebinstatdsshdvagrantpesignsvntester1tester2tester3tester4tester5user0user1user2user3user4user5user6user7user8user9gentoonginxvarnishmysqlwebuseradmin3smithpm1tm1tm2

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{printf &quot;%s\n&quot;, $1}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
root
messagebus
systemd-network

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{printf &quot;%20s\n&quot;, $1}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
<span class=w>                </span>root
<span class=w>          </span>messagebus
<span class=w>     </span>systemd-network

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{printf &quot;%-20s\n&quot;, $1}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
root
messagebus
systemd-network

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{printf &quot;%-20s %10d\n&quot;, $1, $3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
root<span class=w>                          </span><span class=m>0</span>
messagebus<span class=w>                  </span><span class=m>499</span>
systemd-network<span class=w>             </span><span class=m>497</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{printf &quot;Username: %s\n&quot;, $1}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
Username:<span class=w> </span>root
Username:<span class=w> </span>messagebus
Username:<span class=w> </span>systemd-network

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{printf &quot;Username: %s UID:%d\n&quot;, $1, $3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
Username:<span class=w> </span>root<span class=w> </span>UID:0
Username:<span class=w> </span>messagebus<span class=w> </span>UID:499
Username:<span class=w> </span>systemd-network<span class=w> </span>UID:497

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{printf &quot;Username: %25s UID:%d\n&quot;, $1, $3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
Username:<span class=w>                      </span>root<span class=w> </span>UID:0
Username:<span class=w>                </span>messagebus<span class=w> </span>UID:499
Username:<span class=w>           </span>systemd-network<span class=w> </span>UID:497

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{printf &quot;Username: %-25s UID:%d\n&quot;, $1, $3}&#39;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span>head<span class=w> </span>-n3
Username:<span class=w> </span>root<span class=w>                      </span>UID:0
Username:<span class=w> </span>messagebus<span class=w>                </span>UID:499
Username:<span class=w> </span>systemd-network<span class=w>           </span>UID:497
</code></pre></div> <h3 id=5109beginend>5.10.9.BEGIN/END<a class=headerlink href=#5109beginend title="Permanent link"> ¶</a></h3> <p>示例：</p> <div class=highlight><pre><span></span><code>awk<span class=w> </span>-F<span class=s2>&quot;:&quot;</span><span class=w> </span><span class=s1>&#39;BEGIN{printf &quot;--------------------------------\n%-20s|%10s|\n--------------------------------\n&quot;, &quot;Username&quot;, &quot;UID&quot;}{printf &quot;%-20s|%-10d|\n--------------------------------\n&quot;, $1, $3}END{print &quot;end&quot;}&#39;</span><span class=w> </span>/etc/passwd
--------------------------------
Username<span class=w>            </span><span class=p>|</span><span class=w>       </span>UID<span class=p>|</span>
--------------------------------
root<span class=w>                </span><span class=p>|</span><span class=m>0</span><span class=w>         </span><span class=p>|</span>
--------------------------------
daemon<span class=w>              </span><span class=p>|</span><span class=m>1</span><span class=w>         </span><span class=p>|</span>
--------------------------------
bin<span class=w>                 </span><span class=p>|</span><span class=m>2</span><span class=w>         </span><span class=p>|</span>
-------------------------------
...<span class=w> </span>...
--------------------------------
mfe<span class=w>                 </span><span class=p>|</span><span class=m>997</span><span class=w>       </span><span class=p>|</span>
--------------------------------
end
</code></pre></div> <h3 id=51010>5.10.10.常用控制语句<a class=headerlink href=#51010 title="Permanent link"> ¶</a></h3> <ul> <li> <p>{statements;...} 组合语句</p> </li> <li> <p>if(condition){statements;...}</p> </li> <li> <p>if(condition){statements;...} else(statements;...)</p> </li> <li> <p>switch(expression){case VALUE1 or /REGEXP/: statement1; case VALUE2 or /REGEXP2/: statement2;......;default: statementn}</p> </li> <li> <p>while(condition){statements;...}</p> </li> <li> <p>do(statements;...) while{condition}</p> </li> <li> <p>for(expr1;expr2;expr3) {statements;...}</p> </li> <li> <p>break</p> </li> <li> <p>continue</p> </li> <li> <p>exit</p> </li> </ul> <p>if-else示例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF &gt; score.txt</span>
<span class=s>Name  Score</span>
<span class=s>Tom   100</span>
<span class=s>Jack  91</span>
<span class=s>Bill  81</span>
<span class=s>Jim   51</span>
<span class=s>EOF</span>

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;NR!=1{score=$2;if($2&gt;=80){print $1, &quot;Good&quot;}else if($2&gt;=60){print $1, &quot;Pass&quot;}else{print $1, &quot;failed&quot;}}&#39;</span>
score.txt
Tom<span class=w> </span>Good
Jack<span class=w> </span>Good
Bill<span class=w> </span>Good
Jim<span class=w> </span>failed
</code></pre></div> <p>switch示例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;NR!=1{switch($2){case 100:print $1,&quot;good&quot;; case 60:print $1,&quot;Pass&quot;; default:print $1,&quot;others&quot;}}&#39;</span><span class=w> </span>score.txt
Tom<span class=w> </span>good
Tom<span class=w> </span>Pass
Tom<span class=w> </span>others
Jack<span class=w> </span>others
Bill<span class=w> </span>others
Jim<span class=w> </span>others
</code></pre></div> <p>while示例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;sum=0;while(i&lt;=100){sum+=i;i++};print sum}&#39;</span>
<span class=m>5050</span>
</code></pre></div> <p>do-while示例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;sum=0;do{sum+=i;i++}while(i&lt;101);print sum}&#39;</span>
<span class=m>5050</span>
</code></pre></div> <p>for示例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;sum=0;for(i=1;i&lt;=100;i++){sum+=i};print sum}&#39;</span>
<span class=m>5050</span>
</code></pre></div> <p>命令效率比较：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>time<span class=o>(</span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;sum=0;while(i&lt;=100000){sum+=i;i++};print sum}&#39;</span><span class=o>)</span>
<span class=m>5000050000</span>

real<span class=w>    </span>0m0.028s
user<span class=w>    </span>0m0.027s
sys<span class=w>    </span>0m0.001s

$<span class=w> </span>time<span class=o>(</span>seq<span class=w> </span>-s+<span class=w> </span><span class=m>1000000</span><span class=w> </span><span class=p>|</span>bc<span class=o>)</span>
<span class=m>500000500000</span>

real<span class=w>    </span>0m0.329s
user<span class=w>    </span>0m0.240s
sys<span class=w>    </span>0m0.094s

$<span class=w> </span>time<span class=o>(</span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;sum=0;for(i=1;i&lt;=1000000;i++){sum+=i};print sum}&#39;</span><span class=o>)</span>
<span class=m>500000500000</span>

real<span class=w>    </span>0m0.050s
user<span class=w>    </span>0m0.046s
sys<span class=w>    </span>0m0.004s
</code></pre></div> <p>contine示例：中断当前循环，进入下一次循环。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;sum=0;for(i=1;i&lt;=100;i++){if(i==50)continue;sum+=i};print sum}&#39;</span>
<span class=m>5000</span>
</code></pre></div> <p>contine示例：中断整个循环。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{i=0;sum=0;for(i=1;i&lt;=100;i++){if(i==50)break;sum+=i};print sum}&#39;</span>
<span class=m>1225</span>
</code></pre></div> <p>next示例：提前结束对本行处理，直接进入下一行处理（注，awk自循环，并非前面的for或while循环）</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{if($3%2!=0)next;print $1,$3}&#39;</span><span class=w> </span>/etc/passwd<span class=w>  </span><span class=c1># 奇数行打印</span>
root<span class=w> </span><span class=m>0</span>
systemd-timesync<span class=w> </span><span class=m>496</span>
nobody<span class=w> </span><span class=m>65534</span>
chrony<span class=w> </span><span class=m>494</span>
games<span class=w> </span><span class=m>492</span>
daemon<span class=w> </span><span class=m>2</span>
rpc<span class=w> </span><span class=m>490</span>
polkitd<span class=w> </span><span class=m>488</span>
ftpsecure<span class=w> </span><span class=m>486</span>
sshd<span class=w> </span><span class=m>484</span>
vagrant<span class=w> </span><span class=m>1000</span>
svn<span class=w> </span><span class=m>482</span>
tester1<span class=w> </span><span class=m>600</span>
tester4<span class=w> </span><span class=m>1002</span>
user0<span class=w> </span><span class=m>1004</span>
user2<span class=w> </span><span class=m>1006</span>
user4<span class=w> </span><span class=m>1008</span>
user6<span class=w> </span><span class=m>1010</span>
user8<span class=w> </span><span class=m>1012</span>
gentoo<span class=w> </span><span class=m>1014</span>
varnish<span class=w> </span><span class=m>1016</span>
webuser<span class=w> </span><span class=m>666</span>
admin3<span class=w> </span><span class=m>1020</span>
smith<span class=w> </span><span class=m>2002</span>
tm1<span class=w> </span><span class=m>2004</span>

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{if($3%2==0)next;print $1,$3}&#39;</span><span class=w> </span>/etc/passwd<span class=w>  </span><span class=c1># 偶数行打印</span>
messagebus<span class=w> </span><span class=m>499</span>
systemd-network<span class=w> </span><span class=m>497</span>
mail<span class=w> </span><span class=m>495</span>
postfix<span class=w> </span><span class=m>51</span>
man<span class=w> </span><span class=m>13</span>
lp<span class=w> </span><span class=m>493</span>
ftp<span class=w> </span><span class=m>491</span>
nscd<span class=w> </span><span class=m>489</span>
at<span class=w> </span><span class=m>25</span>
tftp<span class=w> </span><span class=m>487</span>
bin<span class=w> </span><span class=m>1</span>
statd<span class=w> </span><span class=m>485</span>
pesign<span class=w> </span><span class=m>483</span>
tester2<span class=w> </span><span class=m>601</span>
tester3<span class=w> </span><span class=m>1001</span>
tester5<span class=w> </span><span class=m>1003</span>
user1<span class=w> </span><span class=m>1005</span>
user3<span class=w> </span><span class=m>1007</span>
user5<span class=w> </span><span class=m>1009</span>
user7<span class=w> </span><span class=m>1011</span>
user9<span class=w> </span><span class=m>1013</span>
nginx<span class=w> </span><span class=m>1015</span>
mysql<span class=w> </span><span class=m>1017</span>
pm1<span class=w> </span><span class=m>2003</span>
tm2<span class=w> </span><span class=m>2005</span>
</code></pre></div> <h3 id=51011>5.10.11.数组<a class=headerlink href=#51011 title="Permanent link"> ¶</a></h3> <p>关联数组是一种数据结构，也称为字典或映射。与传统的数组不同，关联数组的索引可以是任何类型的数据，例如字符串或对象，而不仅仅是整数。</p> <p>提示：</p> <blockquote> <p>在计算机编程中，除了关联数组，还有其他几种常见的数组类型，包括：</p> <ol> <li>线性数组（或称为索引数组）：这是最常见的数组类型，其中每个元素都有一个数字索引，可以用来快速访问数组中的元素。例如，在C语言中，数组的每个元素都可以通过数组下标来访问。</li> <li>多维数组：多维数组是一种数组，其中每个元素也是一个数组。在二维数组中，每个元素都有两个索引（例如，行和列），可以用于访问数组中的元素。在高维数组中，每个元素都具有更多的索引。</li> <li>动态数组：动态数组是一种可以动态调整大小的数组。在许多编程语言中，动态数组可以动态分配内存，以便在程序运行时根据需要调整数组的大小。</li> <li>向量：向量是一种数组，其中每个元素都是相同的数据类型。向量通常用于执行数学运算或处理大量数字数据。</li> </ol> </blockquote> <p>在<code>awk</code>中使用数组时，通常会将某些值与一个字符串相关联，以便在需要时可以通过该字符串快速地检索该值。 <code>awk</code>的数组是一个关联数组，其中每个元素都由一个唯一的键值和一个对应的值组成。键值（或称为索引）可以是任何类型的字符串。</p> <p>数组可以通过以下语法进行声明：</p> <div class=highlight><pre><span></span><code>array_name<span class=o>[</span>index<span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span>value
</code></pre></div> <p>其中，<code>array_name</code>是数组的名称，<code>index</code>是元素的索引值，<code>value</code>是元素的值。</p> <p>例如，以下是一个包含三个元素的关联数组的示例：</p> <div class=highlight><pre><span></span><code>array<span class=o>[</span><span class=s2>&quot;apple&quot;</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>1</span>
array<span class=o>[</span><span class=s2>&quot;banana&quot;</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span>
array<span class=o>[</span><span class=s2>&quot;orange&quot;</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>3</span>
</code></pre></div> <p>在上面的示例中，<code>array</code>是一个关联数组，其索引为字符串类型，而值为整数类型。可以使用以下的方式访问该数组中的元素：</p> <div class=highlight><pre><span></span><code><span class=nv>value</span><span class=w> </span><span class=o>=</span><span class=w> </span>array<span class=o>[</span><span class=s2>&quot;apple&quot;</span><span class=o>]</span>
</code></pre></div> <p>在上面的示例中，<code>value</code>的值将为<code>1</code>，因为<code>array["apple"]</code>的值为<code>1</code>。</p> <p>以下是用<code>awk</code>命令来创建上面那个包含三个元素的关联数组，遍历并输出数组值：</p> <div class=highlight><pre><span></span><code>awk<span class=w> </span><span class=s1>&#39;BEGIN { array[&quot;apple&quot;]=1; array[&quot;banana&quot;]=2; array[&quot;orange&quot;]=3; for(i in array){print array[i]}}&#39;</span>
<span class=m>3</span>
<span class=m>1</span>
<span class=m>2</span>
</code></pre></div> <p>下面例子中，我们互换了数组的键和值。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN {arr[1]=&quot;apple&quot;;arr[2]=&quot;banana&quot;;arr[3]=&quot;orange&quot;;for(i in arr){print arr[i]}}&#39;</span>
apple
banana
orange
</code></pre></div> <p>在上面的示例中，<code>i</code>是数组<code>arr</code>的索引值，<code>arr[i]</code>是数组中对应的元素值。通过这种方式可以循环遍历整个数组，并输出其中的元素。</p> <p>除了使用循环遍历数组之外，还可以使用<code>length</code>函数获取数组中元素的数量。例如：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { arr[1]=&quot;apple&quot;; arr[2]=&quot;banana&quot;; arr[3]=&quot;orange&quot;; print length(arr) }&#39;</span>
<span class=m>3</span>
</code></pre></div> <p>上面的示例将输出数字3，表示数组<code>arr</code>中包含三个元素。</p> <p>举例：去重复记录。 <code>line</code>是数组名，<code>$0</code>是<code>awk</code>读取的当前行的内容。 <code>line[$0]</code>等价于<code>line["a"]</code>，<code>line["b"]</code>，......。</p> <p>我们看执行过程：</p> <ol> <li>awk读入第1行；</li> <li>执行<code>line["a"]</code>，值为空；</li> <li>求反，则第一行的值变为<code>true</code>，即<code>!line["a"]=true</code>；</li> <li>当<code>!line["a"]</code>为<code>true</code>，则打印当前行，即输出<code>a</code>到屏幕；</li> <li>执行<code>line["a"]++</code>，注意第2步中<code>line["a"]</code>的值是空，执行<code>++</code>后值变为<code>1</code>。</li> <li>同理，我们可以看到第2，3，4行都输出了。</li> <li>当读入第5行时（第二个<code>a</code>），执行<code>line["a"]</code>，值为<code>1</code>；<code>!line["a"]=0</code>，即false；则不打印当前行，即不输出<code>a</code>到屏幕；执行<code>++</code>后值变为<code>2</code></li> <li>当读入第8行时（第三个<code>a</code>），执行<code>line["a"]</code>，值为<code>2</code>；<code>!line["a"]=0</code>，即false；则不打印当前行，即不输出<code>a</code>到屏幕；执行<code>++</code>后值变为<code>3</code></li> <li>以此类推，读入第二个<code>b</code>，<code>c</code>，<code>d</code>，<code>e</code>，都不会再输出到屏幕，从而实现去重输出到功能。</li> </ol> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span><span class=nb>test</span><span class=w> </span><span class=s>&lt;&lt; EOF</span>
<span class=s>a</span>
<span class=s>b</span>
<span class=s>c</span>
<span class=s>d</span>
<span class=s>a</span>
<span class=s>c</span>
<span class=s>d</span>
<span class=s>a</span>
<span class=s>b</span>
<span class=s>b</span>
<span class=s>e</span>
<span class=s>EOF</span>

$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;!line[$0]++&#39;</span><span class=w> </span><span class=nb>test</span>
a
b
c
d
e
</code></pre></div> <p>举例：判断数组索引是否存在。 方法：<code>&lt;your_var&gt; in array</code>，<code>0</code>表示不存在，<code>1</code>表示存在。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{array[&quot;i&quot;]=&quot;x&quot;;array[&quot;j&quot;]=&quot;j&quot;;print &quot;i&quot; in array, &quot;y&quot; in array}&#39;</span>
<span class=m>1</span><span class=w> </span><span class=m>0</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{array[&quot;i&quot;]=&quot;x&quot;;array[&quot;j&quot;]=&quot;j&quot;;if(&quot;i&quot; in array){print &quot;exits!&quot;}else{print &quot;not exists!&quot;}}&#39;</span>
exits!
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{array[&quot;i&quot;]=&quot;x&quot;;array[&quot;j&quot;]=&quot;j&quot;;if(&quot;abc&quot; in array){print &quot;exits!&quot;}else{print &quot;not exists!&quot;}}&#39;</span>
not<span class=w> </span>exists!
</code></pre></div> <p>举例：遍历数组中每个元素。 方法：<code>for(your_var in array){your_for_body}</code>，注意，your_var会遍历每个索引。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{weekday[&quot;mon&quot;]=&quot;Monday&quot;;weekday[&quot;tue&quot;]=&quot;Tuesday&quot;;for(i in weekday){print i,weekday[i]}}&#39;</span>
tue<span class=w> </span>Tuesday
mon<span class=w> </span>Monday
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{weekday[&quot;mon&quot;]=&quot;Monday&quot;;weekday[&quot;tue&quot;]=&quot;Tuesday&quot;;for(i in weekday){print i&quot;: &quot;weekday[i]}}&#39;</span>
tue:<span class=w> </span>Tuesday
mon:<span class=w> </span>Monday
</code></pre></div> <p>注意下面的换行写法，不需要反斜杠<code>\</code>。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{</span>
<span class=s1>arr[&quot;x&quot;]=&quot;welcome&quot;</span>
<span class=s1>arr[&quot;y&quot;]=&quot;to&quot;</span>
<span class=s1>arr[&quot;z&quot;]=&quot;Shanghai&quot;</span>
<span class=s1>for (i in arr) {</span>
<span class=s1> print i, arr[i]</span>
<span class=s1>}</span>
<span class=s1>}&#39;</span>
x<span class=w> </span>welcome
y<span class=w> </span>to
z<span class=w> </span>Shanghai
</code></pre></div> <p>示例：格式化输出用户名和密码。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span><span class=s1>&#39;{user[$1]=$3}END{for (i in user){print &quot;Username: &quot; i, &quot;UID: &quot; user[i]}}&#39;</span><span class=w> </span>/etc/passwd
Username:<span class=w> </span>sshd<span class=w> </span>UID:<span class=w> </span><span class=m>476</span>
Username:<span class=w> </span>rpc<span class=w> </span>UID:<span class=w> </span><span class=m>482</span>
Username:<span class=w> </span>tftp<span class=w> </span>UID:<span class=w> </span><span class=m>488</span>
Username:<span class=w> </span>usbmux<span class=w> </span>UID:<span class=w> </span><span class=m>480</span>
Username:<span class=w> </span>srvGeoClue<span class=w> </span>UID:<span class=w> </span><span class=m>487</span>
......
</code></pre></div> <p>示例：显示主机连接状态出现的次数。</p> <div class=highlight><pre><span></span><code><span class=c1># 传统方法</span>
$<span class=w> </span>ss<span class=w> </span>-ant<span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;NR&gt;=2{print $1}&#39;</span><span class=p>|</span><span class=w> </span>sort<span class=p>|</span><span class=w> </span>uniq<span class=w> </span>-c
$<span class=w> </span>ss<span class=w> </span>-ant<span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;NR!=1{print $1}&#39;</span><span class=p>|</span><span class=w> </span>sort<span class=p>|</span><span class=w> </span>uniq<span class=w> </span>-c
<span class=w>      </span><span class=m>1</span><span class=w> </span>ESTAB
<span class=w>      </span><span class=m>6</span><span class=w> </span>LISTEN

<span class=c1># 使用awk数组</span>
$<span class=w> </span>ss<span class=w> </span>-ant<span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;NR&gt;=2{state[$1]++}END{for(i in state){print state[i], i}}&#39;</span>
$<span class=w> </span>ss<span class=w> </span>-ant<span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;NR!=1{state[$1]++}END{for(i in state){print state[i], i}}&#39;</span>
<span class=m>6</span><span class=w> </span>LISTEN
<span class=m>1</span><span class=w> </span>ESTAB
</code></pre></div> <h3 id=51012awk>5.10.12.awk函数<a class=headerlink href=#51012awk title="Permanent link"> ¶</a></h3> <p>参考：<a href=https://www.gnu.org/software/gawk/manual/html_node/Functions.html><code>awk</code>函数官网</a></p> <h4 id=510121>5.10.12.1.内置函数<a class=headerlink href=#510121 title="Permanent link"> ¶</a></h4> <p>在<code>awk</code>中，函数是一种用于执行特定任务或计算特定值的可重用代码块。 <code>awk</code>提供了许多内置函数，可以用于处理文本数据、执行数学运算、操作字符串等。</p> <p>以下是一些常用的awk函数示例：</p> <ul> <li><code>length(string)</code>：返回字符串的长度。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { str = &quot;Hello World&quot;; len = length(str); print len }&#39;</span>
<span class=m>11</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>cut<span class=w> </span>-d:<span class=w> </span>-f1<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print length($1)}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-3
<span class=m>4</span>
<span class=m>10</span>
<span class=m>15</span>
</code></pre></div> <ul> <li><code>substr(string, start, length)</code>：从指定位置开始提取字符串的子串。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { str = &quot;Hello World&quot;; substring = substr(str, 7, 5); print substring }&#39;</span>
World
</code></pre></div> <ul> <li><code>sub(regexp, replacement [, target])</code>：从字符串target中搜索匹配regexp的内容，并把第一个匹配的内容替换为replacement。懒惰模式。 注意：<code>sub()</code>函数在原始字符串上进行替换操作，并返回替换的次数。</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># 在原始字符串中，第一个匹配到的&quot;at&quot;被替换为&quot;ith&quot;，因此输出结果中的&quot;at&quot;变为&quot;ith&quot;，其他地方的&quot;at&quot;保持不变</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { str = &quot;water, water, everywhere&quot;; sub(/at/, &quot;ith&quot;, str); print str }&#39;</span>
wither,<span class=w> </span>water,<span class=w> </span>everywhere
<span class=c1># 返回匹配次数</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { str = &quot;water, water, everywhere&quot;; str_new = sub(/at/, &quot;ith&quot;, str); print str_new }&#39;</span>
<span class=m>1</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;2023:15:35 08:15:26&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;sub(/:/, &quot;-&quot;, $0)&#39;</span>
<span class=m>2023</span>-15:35<span class=w> </span><span class=m>08</span>:15:26
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;2023:15:35 08:15:26&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;sub(/:/, &quot;-&quot;, $1)&#39;</span>
<span class=m>2023</span>-15:35<span class=w> </span><span class=m>08</span>:15:26
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;2023:15:35 08:15:26&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;sub(/:/, &quot;-&quot;, $2)&#39;</span>
<span class=m>2023</span>:15:35<span class=w> </span><span class=m>08</span>-15:26
</code></pre></div> <ul> <li>gsub(regexp, replacement [, target])：从字符串target中搜索匹配regexp的内容，并把全部匹配的内容替换为replacement。贪婪模式。</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># 在原始字符串中，将所有匹配到的&quot;at&quot;被替换为&quot;ith&quot;</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { str = &quot;water, water, everywhere&quot;; gsub(/at/, &quot;ith&quot;, str); print str }&#39;</span>
wither,<span class=w> </span>wither,<span class=w> </span>everywhere
<span class=c1># 返回匹配次数</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { str = &quot;water, water, everywhere&quot;; str_new = gsub(/at/, &quot;ith&quot;, str); print str_new }&#39;</span>
<span class=m>2</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;2023:15:35 08:15:26&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;gsub(/:/, &quot;-&quot;, $0)&#39;</span>
<span class=m>2023</span>-15-35<span class=w> </span><span class=m>08</span>-15-26
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;2023:15:35 08:15:26&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;gsub(/:/, &quot;-&quot;, $1)&#39;</span>
<span class=m>2023</span>-15-35<span class=w> </span><span class=m>08</span>:15:26
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;2023:15:35 08:15:26&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;gsub(/:/, &quot;-&quot;, $2)&#39;</span>
<span class=m>2023</span>:15:35<span class=w> </span><span class=m>08</span>-15-26
</code></pre></div> <ul> <li><code>split(string, array, delimiter)</code>：将字符串string按指定分隔符delimiter拆分成数组array的元素。 注意：第一个索引值为<code>1</code>，第二个索引值为<code>2</code>.</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { str = &quot;apple,banana,orange&quot;; split(str, fruits, &quot;,&quot;); print fruits[2] }&#39;</span>
banana
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>head<span class=w> </span>-n2<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{split($0, array, &quot;:&quot;)}END{print array[1]}&#39;</span>
messagebus
$<span class=w> </span>head<span class=w> </span>-n2<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{split($0, array, &quot;:&quot;)}END{print array[2]}&#39;</span>
x
$<span class=w> </span>head<span class=w> </span>-n2<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{split($0, array, &quot;:&quot;)}END{print array[3]}&#39;</span>
<span class=m>499</span>
$<span class=w> </span>head<span class=w> </span>-n2<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{split($0, array, &quot;:&quot;)}END{print array[7]}&#39;</span>
/usr/bin/false
</code></pre></div> <ul> <li><code>index(string, search)</code>：在字符串中查找指定子串的位置。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { str = &quot;Hello World&quot;; pos = index(str, &quot;World&quot;); print pos }&#39;</span>
<span class=m>7</span>
</code></pre></div> <ul> <li><code>sprintf(format, expression)</code>：根据指定的格式将表达式转换为字符串。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { num = 3.14159; str = sprintf(&quot;%.2f&quot;, num); print str }&#39;</span>
<span class=m>3</span>.14
</code></pre></div> <ul> <li><code>rand()</code>：返回一个随机数，值在<code>0</code>和<code>1</code>之间均匀分布。这个值可以是<code>0</code>，但不会是<code>1</code>。从下面的例子可以看出，运行结果都是一样的，所以产生随机数的种子是一样的。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print rand()}&#39;</span>
<span class=m>0</span>.924046
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print rand()}&#39;</span>
<span class=m>0</span>.924046
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print rand()}&#39;</span>
<span class=m>0</span>.924046
</code></pre></div> <ul> <li><code>srand()</code>：配合<code>rand()</code>函数，生成随机数种子。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{srand();print rand()}&#39;</span>
<span class=m>0</span>.112006
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{srand();print rand()}&#39;</span>
<span class=m>0</span>.663431
$<span class=w>  </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{srand();print rand()}&#39;</span>
<span class=m>0</span>.541305
</code></pre></div> <ul> <li><code>int()</code>：返回整数。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{srand();print int(rand()*100)}&#39;</span>
<span class=m>84</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{srand();print int(rand()*100)}&#39;</span>
<span class=m>66</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{srand();print int(rand()*100)}&#39;</span>
<span class=m>8</span>
</code></pre></div> <ul> <li><code>system(command)</code>：执行command命令（可以是任何有效的Shell命令）并返回命令的退出状态码。允许在<code>awk</code>脚本中执行外部命令，并获取命令执行的结果。</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># 执行ls -l命令，并将命令的退出状态码存储在status变量中，并打印status变量的值</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { status = system(&quot;ls -l&quot;); print &quot;Exit status:&quot;, status }&#39;</span>
total<span class=w> </span><span class=m>0</span>
drwxr-xr-x<span class=w> </span><span class=m>1</span><span class=w> </span>vagrant<span class=w> </span>users<span class=w> </span><span class=m>70</span><span class=w> </span>Jan<span class=w>  </span><span class=m>2</span><span class=w> </span><span class=m>15</span>:54<span class=w> </span>Desktop
drwxr-xr-x<span class=w> </span><span class=m>1</span><span class=w> </span>vagrant<span class=w> </span>users<span class=w>  </span><span class=m>0</span><span class=w> </span>Jan<span class=w>  </span><span class=m>2</span><span class=w> </span><span class=m>15</span>:54<span class=w> </span>Documents
drwxr-xr-x<span class=w> </span><span class=m>1</span><span class=w> </span>vagrant<span class=w> </span>users<span class=w>  </span><span class=m>0</span><span class=w> </span>Jan<span class=w>  </span><span class=m>2</span><span class=w> </span><span class=m>15</span>:54<span class=w> </span>Downloads
drwxr-xr-x<span class=w> </span><span class=m>1</span><span class=w> </span>vagrant<span class=w> </span>users<span class=w>  </span><span class=m>0</span><span class=w> </span>Jan<span class=w>  </span><span class=m>2</span><span class=w> </span><span class=m>15</span>:54<span class=w> </span>Music
drwxr-xr-x<span class=w> </span><span class=m>1</span><span class=w> </span>vagrant<span class=w> </span>users<span class=w>  </span><span class=m>0</span><span class=w> </span>Jan<span class=w>  </span><span class=m>2</span><span class=w> </span><span class=m>15</span>:54<span class=w> </span>Pictures
drwxr-xr-x<span class=w> </span><span class=m>1</span><span class=w> </span>vagrant<span class=w> </span>users<span class=w>  </span><span class=m>0</span><span class=w> </span>Jan<span class=w>  </span><span class=m>2</span><span class=w> </span><span class=m>15</span>:54<span class=w> </span>Public
drwxr-xr-x<span class=w> </span><span class=m>1</span><span class=w> </span>vagrant<span class=w> </span>users<span class=w>  </span><span class=m>0</span><span class=w> </span>Jan<span class=w>  </span><span class=m>2</span><span class=w> </span><span class=m>15</span>:54<span class=w> </span>Templates
drwxr-xr-x<span class=w> </span><span class=m>1</span><span class=w> </span>vagrant<span class=w> </span>users<span class=w>  </span><span class=m>0</span><span class=w> </span>Jan<span class=w>  </span><span class=m>2</span><span class=w> </span><span class=m>15</span>:54<span class=w> </span>Videos
drwxr-xr-x<span class=w> </span><span class=m>1</span><span class=w> </span>vagrant<span class=w> </span>users<span class=w>  </span><span class=m>0</span><span class=w> </span>Mar<span class=w> </span><span class=m>15</span><span class=w>  </span><span class=m>2022</span><span class=w> </span>bin
Exit<span class=w> </span>status:<span class=w> </span><span class=m>0</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{score=100; system(&quot;echo your score is &quot; score)}&#39;</span>
your<span class=w> </span>score<span class=w> </span>is<span class=w> </span><span class=m>100</span>
</code></pre></div> <ul> <li><code>systime()</code>：当前时间到1970年1月1日到秒数</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN{print systime()}&#39;</span>
<span class=m>1684158395</span>
</code></pre></div> <ul> <li><code>strftime(format, timestamp)</code>：将时间戳timestamp转换为指定格式format的日期和时间字符串。timestamp通常是一个以秒为单位表示的整数。</li> </ul> <p>常见的格式化字符串选项：</p> <ul> <li><code>%Y</code>：四位数的年份（例如：2023）</li> <li><code>%m</code>：两位数的月份（01-12）</li> <li><code>%d</code>：两位数的日期（01-31）</li> <li><code>%H</code>：两位数的小时（00-23）</li> <li><code>%M</code>：两位数的分钟（00-59）</li> <li><code>%S</code>：两位数的秒（00-60）</li> <li><code>%Z</code>：时区名称（例如：GMT）</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># 将当前时间戳转换为格式为&quot;YYYY-MM-DD HH:MM:SS&quot;的日期和时间字符串</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { timestamp = systime(); str = strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, timestamp); print str }&#39;</span>
<span class=m>2023</span>-05-15<span class=w> </span><span class=m>22</span>:01:35
<span class=c1># 将当前时间戳的前一小时（3600秒）转换为格式为&quot;YYYY-MM-DD HH:MM:SS&quot;的日期和时间字符串</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;BEGIN { timestamp = systime()-3600; str = strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, timestamp); print str }&#39;</span>
<span class=m>2023</span>-05-15<span class=w> </span><span class=m>21</span>:01:43
</code></pre></div> <h4 id=510122>5.10.12.2.自定义函数<a class=headerlink href=#510122 title="Permanent link"> ¶</a></h4> <p>举例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span>func.awk<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<span class=s>function max(x,y){</span>
<span class=s>  x&gt;y?var=x:var=y</span>
<span class=s>  return var</span>
<span class=s>}</span>
<span class=s>BEGIN{print max(a,b)}</span>
<span class=s>EOF</span>

$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>a</span><span class=o>=</span><span class=m>30</span><span class=w> </span>-v<span class=w> </span><span class=nv>b</span><span class=o>=</span><span class=m>20</span><span class=w> </span>-f<span class=w> </span>func.awk
<span class=m>30</span>
</code></pre></div> <p>举例：</p> <p>在下面的例子中，我们定义了一个名为<code>square()</code>的自定义函数，它接受一个参数<code>x</code>，并返回<code>x</code>的平方。然后，在主代码块中，我们声明了一个变量<code>num</code>并赋值为<code>5</code>。接下来，我们调用了自定义函数<code>square()</code>，传递<code>num</code>作为参数，并将返回值存储在变量<code>result</code>中。最后，我们打印出<code>result</code>的值。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span>func.awk<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<span class=s># 自定义函数：计算平方</span>
<span class=s>function square(x) {</span>
<span class=s>  return x * x;</span>
<span class=s>}</span>

<span class=s># 使用自定义函数</span>
<span class=s>{</span>
<span class=s>  num = 5;</span>
<span class=s>  result = square(num);</span>
<span class=s>  print &quot;平方结果：&quot; result;</span>
<span class=s>}</span>
<span class=s>EOF</span>

$<span class=w> </span>awk<span class=w> </span>-f<span class=w> </span>func.awk
平方结果：25
</code></pre></div> <p>举例：</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span>func.awk<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<span class=s># 自定义函数：计算数组平均值</span>
<span class=s>function calculateAverage(arr, size) {</span>
<span class=s>  sum = 0;</span>
<span class=s>  for (i = 1; i &lt;= size; i++) {</span>
<span class=s>    sum += arr[i];</span>
<span class=s>  }</span>
<span class=s>  return sum / size;</span>
<span class=s>}</span>

<span class=s># 使用自定义函数</span>
<span class=s>{</span>
<span class=s>  # 定义数组</span>
<span class=s>  numbers[1] = 10;</span>
<span class=s>  numbers[2] = 20;</span>
<span class=s>  numbers[3] = 30;</span>
<span class=s>  numbers[4] = 40;</span>
<span class=s>  numbers[5] = 50;</span>

<span class=s>  # 计算数组的平均值</span>
<span class=s>  size = 5;</span>
<span class=s>  average = calculateAverage(numbers, size);</span>

<span class=s>  print &quot;数组的平均值：&quot; average;</span>
<span class=s>}</span>
<span class=s>EOF</span>

$<span class=w> </span>awk<span class=w> </span>-f<span class=w> </span>func.awk
数组的平均值：30
</code></pre></div> <h4 id=510123awk>5.10.12.3.awk脚本<a class=headerlink href=#510123awk title="Permanent link"> ¶</a></h4> <p>举例：</p> <div class=highlight><pre><span></span><code><span class=c1># 注意转义</span>
$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span>passwd.awk<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<span class=s>{if(\$3&gt;=1000)print \$1,\$3}</span>
<span class=s>EOF</span>

$<span class=w> </span>awk<span class=w> </span>-F:<span class=w> </span>-f<span class=w> </span>passwd.awk<span class=w> </span>/etc/passwd
nobody<span class=w> </span><span class=m>65534</span>
vagrant<span class=w> </span><span class=m>1000</span>
</code></pre></div> <p>上面例子也可以写成如下脚步格式。</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span>test.awk<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<span class=s>#!/bin/awk -f</span>
<span class=s># This is an awk script</span>
<span class=s>{if(\$3&gt;=1000)print \$1,\$3}</span>
<span class=s>EOF</span>

$<span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>test.awk
$<span class=w> </span>./test.awk<span class=w> </span>-F:<span class=w> </span>/etc/passwd
nobody<span class=w> </span><span class=m>65534</span>
vagrant<span class=w> </span><span class=m>1000</span>
</code></pre></div> <p>向awk脚本传递参数：</p> <p>格式：<code>awkfile var=value var2=value2 ... inputfile</code></p> <p>说明：</p> <ul> <li>上面格式变量在<code>BEGIN</code>过程中不可用，直到首行输入完成以后，变量才可用。</li> <li>可以通过<code>-v</code>参数，让<code>awk</code>在执行<code>BEGIN</code>之前得到变量。</li> <li>命令行中每一个指定的变量都需要一个<code>-v</code>参数。</li> </ul> <p>举例：</p> <div class=highlight><pre><span></span><code><span class=c1># x=100在BEGIN{print x}区段可用</span>
$<span class=w> </span>awk<span class=w> </span>-v<span class=w> </span><span class=nv>x</span><span class=o>=</span><span class=m>100</span><span class=w> </span><span class=s1>&#39;BEGIN{print x}{print x+100}&#39;</span><span class=w> </span>/etc/hosts
<span class=m>100</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=c1># 不加-v则x=100在BEGIN{print x}区段不可用</span>
$<span class=w> </span>awk<span class=w> </span><span class=nv>x</span><span class=o>=</span><span class=m>100</span><span class=w> </span><span class=s1>&#39;BEGIN{print x}{print x+100}&#39;</span><span class=w> </span>/etc/hosts
awk:<span class=w> </span>fatal:<span class=w> </span>cannot<span class=w> </span>open<span class=w> </span>file<span class=w> </span><span class=sb>`</span>BEGIN<span class=o>{</span>print<span class=w> </span>x<span class=o>}{</span>print<span class=w> </span>x+100<span class=o>}</span><span class=s1>&#39; for reading (No such file or directory)</span>
<span class=s1># 修正上面的错误，将x=100放在后面，因为没有-v，所以x=100在BEGIN{print x}区段不可用，第一行输出空白</span>
<span class=s1>$ awk &#39;</span>BEGIN<span class=o>{</span>print<span class=w> </span>x<span class=o>}{</span>print<span class=w> </span>x+100<span class=o>}</span><span class=err>&#39;</span><span class=w> </span><span class=nv>x</span><span class=o>=</span><span class=m>100</span><span class=w> </span>/etc/hosts

<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
<span class=m>200</span>
</code></pre></div> <h2 id=511>5.11.小练习<a class=headerlink href=#511 title="Permanent link"> ¶</a></h2> <ul> <li>显示<code>/proc/meminfo</code>文件中以大小s开头的行，要求使用两种方法。</li> </ul> <div class=highlight><pre><span></span><code>cat<span class=w> </span>/proc/meminfo<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;^s&quot;</span>
cat<span class=w> </span>/proc/meminfo<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s2>&quot;^[sS]&quot;</span>
</code></pre></div> <ul> <li>显示<code>/etc/passwd</code>文件中不以<code>/bin/bash</code>结尾的行。</li> </ul> <div class=highlight><pre><span></span><code>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;/bin/bash</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/passwd
</code></pre></div> <ul> <li>显示用户<code>rpc</code>默认的shell程序。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;rpc&quot;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;:&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>7</span>
/sbin/nologin
</code></pre></div> <ul> <li>找出<code>/etc/passwd</code>中的两位或三位数。</li> </ul> <div class=highlight><pre><span></span><code>grep<span class=w> </span>-Eo<span class=w> </span><span class=s2>&quot;[:digit:]{2,3}&quot;</span><span class=w> </span>/etc/passwd
grep<span class=w> </span>-Eo<span class=w> </span><span class=s2>&quot;[0-9]{2,3}&quot;</span><span class=w> </span>/etc/passwd
</code></pre></div> <p>这里用到了<code>{}</code>，属于扩展正则符号，所以要用<code>-E</code>。</p> <ul> <li>显示Rocky 9的<code>/etc/grub2.cfg</code>文件中，至少以一个空白字符开头的且后面有非空白字符的行。（注：<code>/etc/grub2.cfg</code>在openSUSE和Ubuntu中没有）</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># 不含首字符为tab</span>
$<span class=w> </span>sudo<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;^ &quot;</span><span class=w> </span>/etc/grub2.cfg

<span class=c1># 包含首字符为tab</span>
$<span class=w> </span>sudo<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;^[[:space:]]&quot;</span><span class=w> </span>/etc/grub2.cfg
</code></pre></div> <ul> <li>找出<code>netstat -tan</code>命令结果中以<code>LISTEN</code>后跟任意多个空白字符结尾的行。</li> </ul> <div class=highlight><pre><span></span><code>netstat<span class=w> </span>-tan<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;LISTEN[[:space:]]+&quot;</span>
</code></pre></div> <ul> <li>显示Rocky 9上所有UID小于1000以内的用户名和UID。</li> </ul> <div class=highlight><pre><span></span><code>cat<span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;:&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span>,3<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;\:[0-9]{1,3}</span>$<span class=s2>&quot;</span>
grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;\:[0-9]{1,3}\:[0-9]{1,}&quot;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;:&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span>,3
</code></pre></div> <ul> <li>在Rocky 9上显示文件<code>/etc/passwd</code>用户名和shell同名的行。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;^([[:alnum:]]+\b).*\1</span>$<span class=s2>&quot;</span><span class=w> </span>/etc/passwd
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
</code></pre></div> <ul> <li>利用<code>df</code>和<code>grep</code>，取出磁盘各分区利用率,并从大到小排序。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>df<span class=w> </span><span class=p>|</span><span class=w> </span>tr<span class=w> </span>-s<span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span>,5<span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-n<span class=w> </span>-t<span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span>-k<span class=w> </span><span class=m>2</span>
devtmpfs<span class=w> </span><span class=m>0</span>%
Filesystem<span class=w> </span>Use%
tmpfs<span class=w> </span><span class=m>0</span>%
tmpfs<span class=w> </span><span class=m>0</span>%
/dev/mapper/rl-home<span class=w> </span><span class=m>1</span>%
tmpfs<span class=w> </span><span class=m>2</span>%
/dev/mapper/rl-root<span class=w> </span><span class=m>5</span>%
/dev/nvme0n1p1<span class=w> </span><span class=m>23</span>%
</code></pre></div> <ul> <li>显示三个用户<code>root</code>，<code>sync</code>，<code>bin</code>的UID和默认shell。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>grep<span class=w> </span><span class=s2>&quot;^root:\|^sync:\|^bin:&quot;</span><span class=w> </span>/etc/passwd<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;:&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span>,7
root:/bin/bash
bin:/usr/sbin/nologin
</code></pre></div> <ul> <li>使用<code>egrep</code>取出<code>/etc/default-1/text_2/local.3/grub</code>中其基名和目录名。</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># 基名</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/default-1/text_2/local.3/grub&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-io<span class=w> </span><span class=s2>&quot;[[:alpha:]]+</span>$<span class=s2>&quot;</span>
grub

<span class=c1># 目录名</span>
$<span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/etc/default-1/text_2/local.3/grub&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>egrep<span class=w> </span>-io<span class=w> </span><span class=s2>&quot;/([[:alpha:]]+.|_?[[:alpha:]]|[[:alnum:]]+/){7}&quot;</span>
/etc/default-1/text_2/local.3/<span class=w> </span>
</code></pre></div> <ul> <li>统计<code>last</code>命令中以<code>vagrant</code>登录的每个主机IP地址登录次数。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>last<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>vagrant<span class=w> </span><span class=p>|</span><span class=w> </span>tr<span class=w> </span>-s<span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>3</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;([0-9]{1,3}\.){1,3}[0-9]{1,3}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-n<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=w> </span>-c
<span class=w>    </span><span class=m>24</span><span class=w> </span><span class=m>192</span>.168.10.107
<span class=w>    </span><span class=m>38</span><span class=w> </span><span class=m>192</span>.168.10.109
<span class=w>    </span><span class=m>17</span><span class=w> </span><span class=m>192</span>.168.10.201
<span class=w>     </span><span class=m>6</span><span class=w> </span><span class=m>192</span>.168.10.210
<span class=w>     </span><span class=m>2</span><span class=w> </span><span class=m>192</span>.168.10.220
</code></pre></div> <ul> <li>利用扩展正则表达式分别表示0-9、10-99、100-199、200-249、250-255。</li> </ul> <div class=highlight><pre><span></span><code><span class=o>[</span><span class=m>0</span>-9<span class=o>]</span><span class=p>|</span><span class=o>[</span><span class=m>0</span>-9<span class=o>]{</span><span class=m>2</span><span class=o>}</span><span class=p>|</span><span class=m>1</span><span class=o>[</span><span class=m>0</span>-9<span class=o>]{</span><span class=m>2</span><span class=o>}</span><span class=p>|</span><span class=m>2</span><span class=o>[</span><span class=m>0</span>-4<span class=o>][</span><span class=m>0</span>-9<span class=o>]</span><span class=p>|</span><span class=m>25</span><span class=o>[</span><span class=m>0</span>-5<span class=o>]</span>
</code></pre></div> <ul> <li>显示<code>ifconfig</code>命令结果中所有IPv4地址。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>ifconfig<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Eo<span class=w> </span><span class=s2>&quot;([0-9]{1,3}\.){3}[0-9]{1,3}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^255&quot;</span>
<span class=m>192</span>.168.10.210
<span class=m>192</span>.168.10.255
<span class=m>127</span>.0.0.1
</code></pre></div> <ul> <li>显示<code>ip addr</code>命令结果中所有IPv4地址。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>ip<span class=w> </span>addr<span class=w> </span>show<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>inet<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>eth0<span class=w> </span><span class=p>|</span><span class=w> </span>tr<span class=w> </span>-s<span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>3</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;/&quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span>
<span class=m>192</span>.168.10.210

$<span class=w> </span>ip<span class=w> </span>addr<span class=w> </span>show<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-Eo<span class=w> </span><span class=s2>&quot;([0-9]{1,3}\.){3}[0-9]{1,3}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;^255&quot;</span>
<span class=m>127</span>.0.0.1
<span class=m>192</span>.168.10.210
<span class=m>192</span>.168.10.255
</code></pre></div> <ul> <li>将此字符串Welcome to the linux world中的每个字符去重并排序，重复次数多的排到前面。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Welcome to the linux world&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-o<span class=w> </span><span class=o>[[</span>:alpha:<span class=o>]]</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=w> </span>-c<span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-nr
<span class=w>     </span><span class=m>3</span><span class=w> </span>o
<span class=w>     </span><span class=m>3</span><span class=w> </span>l
<span class=w>     </span><span class=m>3</span><span class=w> </span>e
<span class=w>     </span><span class=m>2</span><span class=w> </span>t
<span class=w>     </span><span class=m>1</span><span class=w> </span>x
<span class=w>     </span><span class=m>1</span><span class=w> </span>W
<span class=w>     </span><span class=m>1</span><span class=w> </span>w
<span class=w>     </span><span class=m>1</span><span class=w> </span>u
<span class=w>     </span><span class=m>1</span><span class=w> </span>r
<span class=w>     </span><span class=m>1</span><span class=w> </span>n
<span class=w>     </span><span class=m>1</span><span class=w> </span>m
<span class=w>     </span><span class=m>1</span><span class=w> </span>i
<span class=w>     </span><span class=m>1</span><span class=w> </span>h
<span class=w>     </span><span class=m>1</span><span class=w> </span>d
<span class=w>     </span><span class=m>1</span><span class=w> </span>c
</code></pre></div> <ul> <li>删除<code>/etc/default/grub</code>文件中所有以空白开头的行行首的空白字符。</li> </ul> <div class=highlight><pre><span></span><code>sed<span class=w> </span><span class=s1>&#39;/^$/d&#39;</span><span class=w> </span>/etc/default/grub
</code></pre></div> <ul> <li>删除<code>/etc/default/grub</code>文件中所有以<code>#</code>开头，后面至少跟一个空白字符的行的行首的<code>#</code>和空白字符。</li> </ul> <div class=highlight><pre><span></span><code>sed<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;/#[[:space:]]+/d;/#/d&#39;</span><span class=w> </span>/etc/default/grub
</code></pre></div> <p>上面输出结果中包含空白行。</p> <p>若输出中删除空白行，则：</p> <div class=highlight><pre><span></span><code>sed<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;/#[[:space:]]+/d;/#/d;/^$/d&#39;</span><span class=w> </span>/etc/default/grub
</code></pre></div> <ul> <li>在<code>/etc/fstab</code>每一行行首增加<code>#</code>号。</li> </ul> <div class=highlight><pre><span></span><code>sed<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;s/(.*)/#&amp;/&#39;</span><span class=w> </span>/etc/fstab
</code></pre></div> <ul> <li>在<code>/etc/fstab</code>文件中不以<code>#</code>开头的行的行首增加<code>#</code>号（包括空行）。</li> </ul> <div class=highlight><pre><span></span><code>sed<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;s/^[^#].*/#&amp;/&#39;</span><span class=w> </span>-r<span class=w> </span><span class=s1>&#39;s/^$/#/&#39;</span><span class=w> </span>/etc/default/grub
</code></pre></div> <ul> <li>通过命令<code>rpm -qa --last |awk -F ' ' '{print $1}'</code>得到最新安装的包列表。统计所有<code>x86_64</code>结尾的安装包名以<code>.</code>分隔倒数第二个字段的重复次数。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>rpm<span class=w> </span>-qa<span class=w> </span>--last<span class=w> </span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39; &#39;</span><span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span>-nr<span class=w> </span><span class=s1>&#39;/x86_64$/s@.*\.(.*)\.x86_64@\1@p&#39;</span><span class=w> </span><span class=p>|</span>sort<span class=w> </span>-r<span class=w> </span><span class=p>|</span>uniq<span class=w> </span>-c
<span class=w>     </span><span class=m>75</span><span class=w> </span>el9_0
<span class=w>    </span><span class=m>563</span><span class=w> </span>el9
<span class=w>      </span><span class=m>3</span><span class=w> </span><span class=m>7</span>
<span class=w>      </span><span class=m>1</span><span class=w> </span><span class=m>5</span>
<span class=w>      </span><span class=m>2</span><span class=w> </span><span class=m>4</span>
<span class=w>      </span><span class=m>2</span><span class=w> </span><span class=m>3</span>
<span class=w>     </span><span class=m>10</span><span class=w> </span><span class=m>2</span>
<span class=w>     </span><span class=m>29</span><span class=w> </span><span class=m>1</span>
</code></pre></div> <ul> <li>在openSUSE中统计<code>/etc/rc.status</code>文件中每个单词的出现次数，并排序（用grep和sed两种方法分别实现）。</li> </ul> <div class=highlight><pre><span></span><code>grep<span class=w> </span>-Eo<span class=w> </span><span class=s2>&quot;[a-zA-Z]+&quot;</span><span class=w> </span>/etc/rc.status<span class=w> </span><span class=p>|</span>sort<span class=w> </span><span class=p>|</span>uniq<span class=w> </span>-c

cat<span class=w> </span>/etc/rc.status<span class=w> </span><span class=p>|</span>sed<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;s/[^[:alpha:]]+/\n/g&#39;</span><span class=w> </span><span class=p>|</span>sed<span class=w> </span><span class=s1>&#39;/^$/d&#39;</span><span class=w> </span><span class=p>|</span>sort<span class=w> </span><span class=p>|</span>uniq<span class=w> </span>-c<span class=w> </span><span class=p>|</span>sort<span class=w> </span>-nr
</code></pre></div> <ul> <li>将文本文件的n和n+1行合并为一行，n为奇数行。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF &gt; sed.txt</span>
<span class=s>1aa</span>
<span class=s>2bb</span>
<span class=s>3cc</span>
<span class=s>4dd</span>
<span class=s>5ee</span>
<span class=s>6ff</span>
<span class=s>7gg</span>
<span class=s>EOF</span>

$<span class=w> </span>sed<span class=w> </span>-n<span class=w> </span><span class=s1>&#39;N;s/\n//p&#39;</span><span class=w> </span>sed.txt
1aa2bb
3cc4dd
5ee6ff

$<span class=w> </span>sed<span class=w> </span><span class=s1>&#39;N;s/\n//&#39;</span><span class=w> </span>sed.txt
1aa2bb
3cc4dd
5ee6ff
7gg
</code></pre></div> <ul> <li>对一串数字进行求和。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span><span class=s>&lt;&lt;EOF &gt; number.txt</span>
<span class=s>1 2 3 4 5 6</span>
<span class=s>EOF</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>tr<span class=w> </span><span class=s1>&#39; &#39;</span><span class=w> </span>+<span class=w> </span>&lt;<span class=w> </span>number.txt<span class=w> </span><span class=p>|</span><span class=w> </span>bc
<span class=m>21</span>
$<span class=w> </span><span class=nv>sum</span><span class=o>=</span><span class=m>0</span><span class=p>;</span><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=sb>`</span>cat<span class=w> </span>number.txt<span class=sb>`</span><span class=p>;</span><span class=k>do</span><span class=w> </span><span class=nb>let</span><span class=w> </span><span class=nv>sum</span><span class=o>+=</span>i<span class=p>;</span><span class=k>done</span><span class=p>;</span><span class=nb>echo</span><span class=w> </span><span class=nv>$sum</span>
<span class=m>21</span>
$<span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{sum=0;for(i=1;i&lt;=NF;i++){sum+=i};print sum}&#39;</span><span class=w> </span>number.txt
<span class=m>21</span>
</code></pre></div> <ul> <li>取出字符串中的数字。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;kdajl;3k8jd33la5kj23f90ld02sakjflakjdslf&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span><span class=s1>&#39;</span>
<span class=s1>{</span>
<span class=s1>  for(i=1;i&lt;=NF;i++)</span>
<span class=s1>  {</span>
<span class=s1>    if($i ~ /[0-9]/)</span>
<span class=s1>    {</span>
<span class=s1>      str=(str $i)</span>
<span class=s1>    }</span>
<span class=s1>  };</span>
<span class=s1>  print str</span>
<span class=s1>}&#39;</span>
<span class=m>38335239002</span>
</code></pre></div> <ul> <li><code>host.log</code>文件内容如下，提取<code>.edu.cn</code>前面的主机名，并回写到该文件中。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span>host.log<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<span class=s>1 www.edu.cn</span>
<span class=s>2 blog.edu.cn</span>
<span class=s>3 learning.edu.cn</span>
<span class=s>4 java.edu.cn</span>
<span class=s>5 nodejs.edu.cn</span>
<span class=s>6 k8s.eud.cn</span>
<span class=s>7 linux.edu.cn</span>
<span class=s>8 python.edu.cn</span>
<span class=s>9 learning.edu.cn</span>
<span class=s>10 java.edu.cn</span>
<span class=s>11 nodejs.edu.cn</span>
<span class=s>12 www.edu.cn</span>
<span class=s>EOF</span>

<span class=c1># 对比</span>
$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;[ .]&#39;</span><span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=w> </span>host.log
<span class=m>1</span>
<span class=m>2</span>
<span class=m>3</span>
<span class=m>4</span>
<span class=m>5</span>
<span class=m>6</span>
<span class=m>7</span>
<span class=m>8</span>
<span class=m>9</span>
<span class=m>10</span>
<span class=m>11</span>
<span class=m>12</span>
$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;[ .]&#39;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=w> </span>host.log
www
blog
learning
java
nodejs
k8s
linux
python
learning
java
nodejs
www

<span class=c1># 以空格或者.为分隔符，打印第二列（主机名），追加写入原文件</span>
$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;[ .]&#39;</span><span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=w> </span>host.log<span class=w> </span>&gt;&gt;<span class=w> </span>host.log
$<span class=w> </span>cat<span class=w> </span>host.log
<span class=m>1</span><span class=w> </span>www.edu.cn
<span class=m>2</span><span class=w> </span>blog.edu.cn
<span class=m>3</span><span class=w> </span>learning.edu.cn
<span class=m>4</span><span class=w> </span>java.edu.cn
<span class=m>5</span><span class=w> </span>nodejs.edu.cn
<span class=m>6</span><span class=w> </span>k8s.eud.cn
<span class=m>7</span><span class=w> </span>linux.edu.cn
<span class=m>8</span><span class=w> </span>python.edu.cn
<span class=m>9</span><span class=w> </span>learning.edu.cn
<span class=m>10</span><span class=w> </span>java.edu.cn
<span class=m>11</span><span class=w> </span>nodejs.edu.cn
<span class=m>12</span><span class=w> </span>www.edu.cn
www
blog
learning
java
nodejs
k8s
linux
python
learning
java
nodejs
www
</code></pre></div> <ul> <li>统计文件<code>/etc/fstab</code>中每个文件系统类型出现的次数。</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># 以UUID开头，一个或多个空格为分隔符，读取第三列（即文件系统类型）并计数。</span>
$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39; +&#39;</span><span class=w> </span><span class=s1>&#39;/^UUID/{fs[$3]++}END{for(i in fs){print i, fs[i]}}&#39;</span><span class=w> </span>/etc/fstab
swap<span class=w> </span><span class=m>1</span>
btrfs<span class=w> </span><span class=m>10</span>
vfat<span class=w> </span><span class=m>1</span>

<span class=c1># 方法2</span>
$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39; +&#39;</span><span class=w> </span><span class=s1>&#39;/^UUID/{print $3}&#39;</span><span class=w> </span>/etc/fstab<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=w> </span>-c
<span class=w>     </span><span class=m>10</span><span class=w> </span>btrfs
<span class=w>      </span><span class=m>1</span><span class=w> </span>swap
<span class=w>      </span><span class=m>1</span><span class=w> </span>vfat
</code></pre></div> <ul> <li>统计文件<code>/etc/fstab</code>中每个单词出现的次数。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>awk<span class=w> </span>-F<span class=s2>&quot;[^[:alpha:]]&quot;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++)word[$i]++}END{for(a in word)if(a!=&quot;&quot;)print a,word[a]}&#39;</span><span class=w> </span>/etc/fstab
swap<span class=w> </span><span class=m>2</span>
B<span class=w> </span><span class=m>1</span>
srv<span class=w> </span><span class=m>2</span>
btrfs<span class=w> </span><span class=m>10</span>
snapshots<span class=w> </span><span class=m>2</span>
vfat<span class=w> </span><span class=m>1</span>
opt<span class=w> </span><span class=m>2</span>
cbaef<span class=w> </span><span class=m>10</span>
UUID<span class=w> </span><span class=m>12</span>
E<span class=w> </span><span class=m>1</span>
ecf<span class=w> </span><span class=m>1</span>
CD<span class=w> </span><span class=m>1</span>
cf<span class=w> </span><span class=m>1</span>
arm<span class=w> </span><span class=m>2</span>
a<span class=w> </span><span class=m>11</span>
c<span class=w> </span><span class=m>2</span>
tmp<span class=w> </span><span class=m>2</span>
usr<span class=w> </span><span class=m>2</span>
var<span class=w> </span><span class=m>2</span>
afa<span class=w> </span><span class=m>20</span>
home<span class=w> </span><span class=m>2</span>
d<span class=w> </span><span class=m>10</span>
utf<span class=w> </span><span class=m>1</span>
e<span class=w> </span><span class=m>2</span>
efi<span class=w> </span><span class=m>3</span>
grub<span class=w> </span><span class=m>2</span>
boot<span class=w> </span><span class=m>3</span>
subvol<span class=w> </span><span class=m>9</span>
root<span class=w> </span><span class=m>2</span>
<span class=nb>local</span><span class=w> </span><span class=m>2</span>
defaults<span class=w> </span><span class=m>2</span>
f<span class=w> </span><span class=m>10</span>
</code></pre></div> <ul> <li>提取字符串<code>Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55</code>中所有的数字。</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># 对比单引号和双引号的区别。</span>
$<span class=w>  </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Yd</span><span class=nv>$@</span><span class=s2>C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&quot;</span>
<span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Yd</span><span class=nv>$@</span><span class=s2>C#M05MD9&amp;8923+Vip3wZcgcreate -g cpu:mygroup44&amp;55&quot;</span>
YdC#M05MD9<span class=p>&amp;</span><span class=m>8923</span>+Vip3wZcgcreate<span class=w> </span>-g<span class=w> </span>cpu:mygroup44<span class=p>&amp;</span><span class=m>55</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span>
Yd<span class=nv>$@</span>C#M05MD9<span class=p>&amp;</span><span class=m>8923</span>+Vip3wZ!33*44<span class=p>&amp;</span><span class=m>55</span>

$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span><span class=s1>&#39;{gsub(/[^0-9]/,&quot;&quot;);print $0}&#39;</span>
<span class=m>05989233334455</span>

$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=s1>&#39;[^0-9]&#39;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++){printf &quot;%s&quot;, $i}}&#39;</span>
<span class=m>05989233334455</span>

$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++){if($i ~ /[[:digit:]]/){str=$i;str1=(str1 str)}};print str1}&#39;</span>
<span class=m>05989233334455</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++){if($i ~ /[[:digit:]]/){str=$i;str1=(str1 str)}};print str1}&#39;</span>
<span class=c1># 注意，如果写成如下格式，则报错。</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=s1>&#39;&#39;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++){if($i ~ /[[:digit:]]/){str=$i;str1=(str1 str)}};print str1}&#39;</span>
<span class=c1># 注意，如果写成如下格式，则输出原字符串。</span>
$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;Yd$@C#M05MD9&amp;8923+Vip3wZ!33*44&amp;55&#39;</span><span class=p>|</span>awk<span class=w> </span>-F<span class=w> </span><span class=s1>&#39; &#39;</span><span class=w> </span><span class=s1>&#39;{for(i=1;i&lt;=NF;i++){if($i ~ /[[:digit:]]/){str=$i;str1=(str1 str)}};print str1}&#39;</span>
</code></pre></div> <ul> <li>生成500个随机数，保存到文件random.txt中，格式为<code>100,20,61,98...</code>，取出其中最大整数和最小整数。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nv>str</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>;</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=o>((</span><span class=nv>i</span><span class=o>=</span><span class=m>1</span><span class=p>;</span><span class=w> </span>i&lt;<span class=o>=</span><span class=m>500</span><span class=p>;</span><span class=w> </span>i++<span class=o>))</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$i</span><span class=w> </span>-ne<span class=w> </span><span class=m>500</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=nv>str</span><span class=o>+=</span><span class=s2>&quot;</span><span class=nv>$RANDOM</span><span class=s2>,&quot;</span><span class=p>;</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=nv>str</span><span class=o>+=</span><span class=s2>&quot;</span><span class=nv>$RANDOM</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=k>fi</span><span class=p>;</span><span class=w> </span><span class=k>done</span><span class=p>;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$str</span><span class=s2>&quot;</span><span class=w> </span>&gt;<span class=w> </span>random.txt
$<span class=w> </span>cat<span class=w> </span>random.txt
<span class=m>11308</span>,8764,2075,9411,......
$<span class=w> </span>awk<span class=w> </span>-F,<span class=w> </span><span class=s1>&#39;{max=$1;min=$1;for(i=1;i&lt;=NF;i++){if($i&gt;max){max=$i}else{if($i&lt;min){min=$i}}}}END{print &quot;The max:&quot; max, &quot;The min:&quot; min}&#39;</span><span class=w> </span>random.txt
The<span class=w> </span>max:32696<span class=w> </span>The<span class=w> </span>min:20
</code></pre></div> <ul> <li>监控某个IP并发连接超过200时，调用防火墙命令封掉该IP，每5分钟监控一次。防火墙命令<code>iptables -A INPUT -s IP -j REJECT</code>。</li> </ul> <div class=highlight><pre><span></span><code>ss<span class=w> </span>-nt<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=w> </span><span class=s2>&quot; +|:&quot;</span><span class=w> </span><span class=s1>&#39;NR!=1{ip[$(NF-2)]++}END{for(i in ip){if(ip[i]&gt;200){system(&quot;iptables -A INPUT -s &quot; i &quot; -j REJECT;&quot;)}}}&#39;</span>
</code></pre></div> <ul> <li>将下面内容中FQDN取出，并根据其进行计数，从高到低排序。</li> </ul> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span>fqdn.txt<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<span class=s>http://mail.edu.com/index.html</span>
<span class=s>http://www.edu.com/test.html</span>
<span class=s>http://study.edu.com/index.html</span>
<span class=s>http://blog.edu.com/index.html</span>
<span class=s>http://www.edu.com/images/logo.jpg</span>
<span class=s>http://blog.edu.com/20080102.html</span>
<span class=s>EOF</span>

$<span class=w> </span>awk<span class=w> </span>-F<span class=s2>&quot;/&quot;</span><span class=w> </span><span class=s1>&#39;{url[$3]++}END{for(i in url){print url[i], i}}&#39;</span><span class=w> </span>fqdn.txt<span class=p>|</span>sort<span class=w> </span>-nr
<span class=m>2</span><span class=w> </span>www.edu.com
<span class=m>2</span><span class=w> </span>blog.edu.com
<span class=m>1</span><span class=w> </span>study.edu.com
<span class=m>1</span><span class=w> </span>mail.edu.com
</code></pre></div> <ul> <li>将以下⽂本以inode为标记，对inode相同的counts进⾏累加，并且统计出同一inode中，beginnumber的最小值和endnumber的最大值。</li> </ul> <div class=highlight><pre><span></span><code>inode<span class=p>|</span>beginnumber<span class=p>|</span>endnumber<span class=p>|</span>counts<span class=p>|</span><span class=w> </span>
<span class=m>106</span><span class=p>|</span><span class=m>3363120000</span><span class=p>|</span><span class=m>3363129999</span><span class=p>|</span><span class=m>10000</span><span class=p>|</span><span class=w> </span>
<span class=m>106</span><span class=p>|</span><span class=m>3368560000</span><span class=p>|</span><span class=m>3368579999</span><span class=p>|</span><span class=m>20000</span><span class=p>|</span><span class=w> </span>
<span class=m>310</span><span class=p>|</span><span class=m>3337000000</span><span class=p>|</span><span class=m>3337000100</span><span class=p>|</span><span class=m>101</span><span class=p>|</span><span class=w> </span>
<span class=m>310</span><span class=p>|</span><span class=m>3342950000</span><span class=p>|</span><span class=m>3342959999</span><span class=p>|</span><span class=m>10000</span><span class=p>|</span><span class=w> </span>
<span class=m>310</span><span class=p>|</span><span class=m>3362120960</span><span class=p>|</span><span class=m>3362120961</span><span class=p>|</span><span class=m>2</span><span class=p>|</span><span class=w> </span>
<span class=m>311</span><span class=p>|</span><span class=m>3313460102</span><span class=p>|</span><span class=m>3313469999</span><span class=p>|</span><span class=m>9898</span><span class=p>|</span><span class=w> </span>
<span class=m>311</span><span class=p>|</span><span class=m>3313470000</span><span class=p>|</span><span class=m>3313499999</span><span class=p>|</span><span class=m>30000</span><span class=p>|</span><span class=w> </span>
<span class=m>311</span><span class=p>|</span><span class=m>3362120962</span><span class=p>|</span><span class=m>3362120963</span><span class=p>|</span><span class=m>2</span><span class=p>|</span><span class=w> </span>
</code></pre></div> <p>输出的结果格式为：</p> <div class=highlight><pre><span></span><code><span class=m>310</span><span class=p>|</span><span class=m>3337000000</span><span class=p>|</span><span class=m>3362120961</span><span class=p>|</span><span class=m>10103</span><span class=p>|</span><span class=w> </span>
<span class=m>311</span><span class=p>|</span><span class=m>3313460102</span><span class=p>|</span><span class=m>3362120963</span><span class=p>|</span><span class=m>39900</span><span class=p>|</span><span class=w> </span>
<span class=m>106</span><span class=p>|</span><span class=m>3363120000</span><span class=p>|</span><span class=m>3368579999</span><span class=p>|</span><span class=m>30000</span><span class=p>|</span>
</code></pre></div> <div class=highlight><pre><span></span><code>$<span class=w> </span>cat<span class=w> </span>&gt;<span class=w> </span>inode.text<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<span class=s>inode|beginnumber|endnumber|counts| </span>
<span class=s>106|3363120000|3363129999|10000| </span>
<span class=s>106|3368560000|3368579999|20000| </span>
<span class=s>310|3337000000|3337000100|101| </span>
<span class=s>310|3342950000|3342959999|10000| </span>
<span class=s>310|3362120960|3362120961|2| </span>
<span class=s>311|3313460102|3313469999|9898| </span>
<span class=s>311|3313470000|3313499999|30000| </span>
<span class=s>311|3362120962|3362120963|2| </span>
<span class=s>EOF</span>

$<span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;|&#39;</span><span class=w> </span>-v<span class=w> </span><span class=nv>OFS</span><span class=o>=</span><span class=s1>&#39;|&#39;</span><span class=w> </span><span class=s1>&#39;/^[0-9]/{inode[$1]++; if(!bn[$1]){bn[$1]=$2}else if(bn[$1]&gt;$2) {bn[$1]=$2}; if(en[$1]&lt;$3)en[$1]=$3;cnt[$1]+=$(NF-1)} END{for(i in inode)print i,bn[i],en[i],cnt[i]}&#39;</span><span class=w> </span>inode.text
<span class=m>106</span><span class=p>|</span><span class=m>3363120000</span><span class=p>|</span><span class=m>3368579999</span><span class=p>|</span><span class=m>30000</span>
<span class=m>310</span><span class=p>|</span><span class=m>3337000000</span><span class=p>|</span><span class=m>3362120961</span><span class=p>|</span><span class=m>10103</span>
<span class=m>311</span><span class=p>|</span><span class=m>3313460102</span><span class=p>|</span><span class=m>3362120963</span><span class=p>|</span><span class=m>39900</span>
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../04-TextTools/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 第四章 文本编辑" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> 第四章 文本编辑 </div> </div> </a> <a href=../06-FileLookup/ class="md-footer__link md-footer__link--next" aria-label="Next: 第六章 文件查找" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> 第六章 文件查找 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.top"], "search": "../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.b1047164.min.js></script> </body> </html>