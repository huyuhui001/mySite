<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://huyuhui001.github.io/mySite/linux/SRE/05-RegExpress/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.3"><title>Regular Expression - UPSkilling</title><link rel=stylesheet href=../../../assets/stylesheets/main.6b80c2a2.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#009485><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=teal data-md-color-accent=green> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=UPSkilling class="md-header__button md-logo" aria-label=UPSkilling data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> UPSkilling </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Regular Expression </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> UPSkilling </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> Linux </a> </li> <li class=md-tabs__item> <a href=../../../k8s/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../python/ class=md-tabs__link> Python </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=UPSkilling class="md-nav__button md-logo" aria-label=UPSkilling data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> UPSkilling </label> <div class=md-nav__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> UPSkilling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=UPSkilling data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> UPSkilling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Welcome </a> </li> <li class=md-nav__item> <a href=../../../about/ class=md-nav__link> About </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2 checked> <label class=md-nav__link for=__nav_2_2> Linux SRE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux SRE" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Linux SRE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-fundamentals/ class=md-nav__link> Linux Fundamentals </a> </li> <li class=md-nav__item> <a href=../02-filesystem/ class=md-nav__link> File System </a> </li> <li class=md-nav__item> <a href=../03-identity-security/ class=md-nav__link> Identity & Security </a> </li> <li class=md-nav__item> <a href=../04-TextTools/ class=md-nav__link> Text Tools </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Regular Expression <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Regular Expression </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 基本正则表达式符号 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 扩展正则表达式符号 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 字符匹配 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 位置标记 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 标识符 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 数量修饰符 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 分组 </a> </li> <li class=md-nav__item> <a href=#grep class=md-nav__link> 三剑客grep命令 </a> </li> <li class=md-nav__item> <a href=#sed class=md-nav__link> 三剑客sed命令 </a> </li> <li class=md-nav__item> <a href=#awk class=md-nav__link> 三剑客awk命令 </a> <nav class=md-nav aria-label=三剑客awk命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 命令格式 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 工作过程 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 分隔符、域和记录 </a> </li> <li class=md-nav__item> <a href=#action class=md-nav__link> 常用action分类 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 常用控制语句 </a> </li> <li class=md-nav__item> <a href=#pattern class=md-nav__link> 模式Pattern </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 截取片段 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 操作符 </a> <nav class=md-nav aria-label=操作符> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 算数操作符 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 字符串操作符 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 赋值操作符 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 比较操作符 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 逻辑操作符 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 三目条件表达式 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 模式匹配符 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 变量 </a> <nav class=md-nav aria-label=变量> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 内置变量 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 自定义变量 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../06-FileLookup/ class=md-nav__link> File Lookup </a> </li> <li class=md-nav__item> <a href=../07-FilePacking/ class=md-nav__link> FIle Packing & Unpacking </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> SUSE Linux Administration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Linux Administration" data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> SUSE Linux Administration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Administration/01/ class=md-nav__link> Linux File System Overview </a> </li> <li class=md-nav__item> <a href=../../Administration/02/ class=md-nav__link> Useful Commands </a> </li> <li class=md-nav__item> <a href=../../Administration/03/ class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4> SUSE Enterprise Storage Foundation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Enterprise Storage Foundation" data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> SUSE Enterprise Storage Foundation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../SES/linux_ses_memo/ class=md-nav__link> SUSE Enterprise Storage Foundation </a> </li> <li class=md-nav__item> <a href=../../SES/linux_ses_demo/ class=md-nav__link> SUSE Enterprise Storage Basic Operation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> Installation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Installation data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/installation/single-local/ class=md-nav__link> Single Node Installation </a> </li> <li class=md-nav__item> <a href=../../../k8s/installation/multiple-local/ class=md-nav__link> Multiple Nodes Installation </a> </li> <li class=md-nav__item> <a href=../../../k8s/installation/aliyun-ubuntu/ class=md-nav__link> Installation on Aliyun ECS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/foundamentals/docker/ class=md-nav__link> Fundamentals </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/foundamentals/memo/ class=md-nav__link> Memo </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/basics/ class=md-nav__link> kubectl basics </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5> Core Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Core Kubernetes" data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Core Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/foundamentals/pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6> Application Modeling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Application Modeling" data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Application Modeling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/foundamentals/namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/secrets/ class=md-nav__link> Secrets </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/rbac/ class=md-nav__link> Role Based Access Control (RBAC) </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/ingress/ class=md-nav__link> Ingress </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7 type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7> Advanced Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advanced Kubernetes" data-md-level=2> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Advanced Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/foundamentals/scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_8 type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8> Operating Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Operating Kubernetes" data-md-level=2> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Operating Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/foundamentals/troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/healthcheck/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/helming/ class=md-nav__link> Helming </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_9 type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9> Case Study <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Case Study" data-md-level=2> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Case Study </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/foundamentals/casestudy-operation-resources/ class=md-nav__link> Operations on Resources </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/casestudy-health-check/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/casestudy-calico/ class=md-nav__link> Calico Installation </a> </li> <li class=md-nav__item> <a href=../../../k8s/foundamentals/kyma/ class=md-nav__link> Kyma </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_10 type=checkbox id=__nav_3_10> <label class=md-nav__link for=__nav_3_10> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/demo/cap_on_kyma/ class=md-nav__link> Build CAP application on Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Python基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python基础 data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Python基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/Foundation/ch00/ class=md-nav__link> 安装 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch01/ class=md-nav__link> 语言基础 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch02/ class=md-nav__link> 打包和拆包 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch03/ class=md-nav__link> 函数及文件 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch04/ class=md-nav__link> 面向对象概念 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch05/ class=md-nav__link> 面向对象特性 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/Algorithms/ class=md-nav__link> 数据结构和算法 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Python数据分析基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python数据分析基础 data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Python数据分析基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch01/ class=md-nav__link> NumPy基础 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch10/ class=md-nav__link> NumPy进阶 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch02/ class=md-nav__link> Pandas入门 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch03/ class=md-nav__link> 数据载入、存储及文件格式 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch04/ class=md-nav__link> 数据清洗与准备 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch05/ class=md-nav__link> 数据规整：连接、联合与重塑 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch06/ class=md-nav__link> 绘图与可视化 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch07/ class=md-nav__link> 数据聚合与分组操作 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch08/ class=md-nav__link> 时间序列 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch09/ class=md-nav__link> 高阶pandas </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch11/ class=md-nav__link> Python建模库介绍 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/Demo/CourseSystem/ class=md-nav__link> 选课系统 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 基本正则表达式符号 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 扩展正则表达式符号 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 字符匹配 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 位置标记 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 标识符 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 数量修饰符 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 分组 </a> </li> <li class=md-nav__item> <a href=#grep class=md-nav__link> 三剑客grep命令 </a> </li> <li class=md-nav__item> <a href=#sed class=md-nav__link> 三剑客sed命令 </a> </li> <li class=md-nav__item> <a href=#awk class=md-nav__link> 三剑客awk命令 </a> <nav class=md-nav aria-label=三剑客awk命令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 命令格式 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 工作过程 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 分隔符、域和记录 </a> </li> <li class=md-nav__item> <a href=#action class=md-nav__link> 常用action分类 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 常用控制语句 </a> </li> <li class=md-nav__item> <a href=#pattern class=md-nav__link> 模式Pattern </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 截取片段 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 操作符 </a> <nav class=md-nav aria-label=操作符> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 算数操作符 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 字符串操作符 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 赋值操作符 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 比较操作符 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 逻辑操作符 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 三目条件表达式 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 模式匹配符 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 变量 </a> <nav class=md-nav aria-label=变量> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 内置变量 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 自定义变量 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/huyuhui001/mySite/edit/main/docs/linux/SRE/05-RegExpress.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=_1>正则表达式<a class=headerlink href=#_1 title="Permanent link"> ¶</a></h1> <p>正则表达式分两类：</p> <ul> <li>基本正则表达式（Basic Regular Expression， 又叫Basic RegEx，简称BREs）</li> <li>扩展正则表达式（Extended Regular Expression， 又叫Extended RegEx，简称EREs）</li> <li>Perl正则表达式（Perl Regular Expression， 又叫Perl RegEx 简称PREs</li> </ul> <p>基本的正则表达式和扩展正则表达式的区别就是元字符的不同。</p> <h2 id=_2>基本正则表达式符号<a class=headerlink href=#_2 title="Permanent link"> ¶</a></h2> <p><code>^</code>：表示以某个字符开始 <code>$</code>：表示以某个字符结尾 <code>.</code>：表示匹配一个且只匹配一个字符 <code>*</code>：表示匹配前边一个字符出现0次或者多次 <code>[]</code>：表示匹配括号内的多个字符信息,一个一个匹配 <code>.*</code>：表示匹配所有，空行也会进行匹配 <code>[^]</code>：表示不匹配括号内的每一个字符 <code>^$</code>：表示匹配空行信息 <code>\</code>：将有特殊含义的字符转义为通配符</p> <h2 id=_3>扩展正则表达式符号<a class=headerlink href=#_3 title="Permanent link"> ¶</a></h2> <p><code>+</code>：表示前一个字符出现一次或一次以上 <code>?</code>：表示前一个字符出现0次或者一次以上 <code>|</code>：表示或者的关系,匹配多个信息 <code>()</code>：匹配一个整体信息，也可以接后项引用 <code>{}</code>：定义前边字符出现几次</p> <div class="admonition tips"> <p class=admonition-title>Tips</p> <p><code>grep -E</code> 或者<code>egrep</code>只是表示扩展正则，不代表加了e就表示转义了。 当<code>grep</code>使用扩展正则的符号时候需要用<code>\</code>转义为通配符才能使用。</p> </div> <h2 id=_4>字符匹配<a class=headerlink href=#_4 title="Permanent link"> ¶</a></h2> <ul> <li><code>[:alpha:]</code>：表示所有的字母（不区分大小写），效果同<code>[a-z]</code></li> <li><code>[:digit:]</code>：表示任意单个数字，效果同<code>[0-9]</code></li> <li><code>[:xdigit:]</code>：表示十六进制数字</li> <li><code>[:lower:]</code>：表示任意单个小写字母</li> <li><code>[:upper:]</code>：表示任意单个大写字母</li> <li><code>[:alnum:]</code>：表示任意单个字母或数字</li> <li><code>[:blank:]</code>：表示空白字符（空格和制表符）</li> <li><code>[:space:]</code>：表示包括空格、制表符（水平和垂直）、换行符、回车符等各种类型的空白，比<code>[:blank:]</code>范围更广</li> <li><code>[:cntrl:]</code>：表示不可打印的控制字符（退格、删除、警铃等）</li> <li><code>[:graph:]</code>：表示可打印的非空白字符</li> <li><code>[:print:]</code>：表示可打印字符</li> <li><code>[:punct:]</code>：表示标点符号</li> </ul> <h2 id=_5>位置标记<a class=headerlink href=#_5 title="Permanent link"> ¶</a></h2> <p>位置标记锚点（position marker anchor）是标识字符串位置的正则表达式。默认情况下，正则表达式所匹配的字符可以出现在字符串中任何位置。</p> <ul> <li> <p><code>^</code>：行首锚定，指定了匹配正则表达式的文本必须起始于字符串的首部。</p> </li> <li> <p>例如：<code>^tux</code>能够匹配以<code>tux</code>起始的行</p> </li> <li> <p><code>$</code>：行尾锚定，指定了匹配正则表达式的文本必须结束于目标字符串的尾部。</p> </li> <li> <p><code>\&lt;</code>或<code>\b</code>：词首锚定，用于单词模式匹配左侧。（单词是有字母、数字、下划线组成）</p> </li> <li> <p><code>\&gt;</code>或<code>\b</code>：词尾锚定，用于单词模式匹配右侧。（单词是有字母、数字、下划线组成）</p> </li> <li> <p><code>^PATTERN$</code>：用模式PATTERN匹配整行。</p> </li> <li> <p><code>^$</code>：匹配空行。</p> </li> <li> <p><code>^[[:space:]]*$</code>：匹配空白行（整行）。</p> </li> <li> <p><code>\&lt;PATTERN\&gt;</code>：匹配整个单词。（单词是有字母、数字、下划线组成）</p> </li> </ul> <p>关于行首锚定和词首锚定，对比下面例子。词尾锚定也是类似情况。 <code>;</code>和<code>-</code>都被认定为单词分隔符。</p> <div class=highlight><pre><span></span><code># 符合词首匹配
$ echo &quot;tux_01-tux02&quot; | grep &#39;\&lt;tux&#39;
tux_01-tux02

# 符合词首匹配
$ echo &quot;xut_01-tux02&quot; | grep &#39;\&lt;tux&#39;
xut_01-tux02

# 符合行首匹配
$ echo &quot;xut_01;tux02&quot; | grep &#39;\&lt;tux&#39;
xut_01;tux02

# 符合行首匹配
$ echo &quot;tux_01-tux02&quot; | grep &#39;^tux&#39;
tux_01-tux02

# 不符合行首匹配
$ echo &quot;xut_01-tux02&quot; | grep &#39;^tux&#39;
</code></pre></div> <h2 id=_6>标识符<a class=headerlink href=#_6 title="Permanent link"> ¶</a></h2> <p>标识符是正则表达式的基础组成部分。它定义了那些为了匹配正则表达式，必须存在（或不存在）的字符。</p> <ul> <li> <p><code>A</code>字符：正则表达式必须匹配该字符。</p> </li> <li> <p>例如：<code>A</code>能够匹配字符<code>A</code>。</p> </li> <li> <p><code>.</code>：匹配任意一个字符。</p> </li> <li> <p>例如：<code>Hack.</code>能够匹配<code>Hackl</code>和<code>Hacki</code>，但是不能匹配<code>Hackl2</code>或<code>Hackil</code>，它只能匹配单个字符。</p> </li> <li> <p><code>[]</code>：匹配中括号内的任意一个字符。中括号内可以是一个字符组或字符范围 </p> </li> <li> <p>例如：<code>coo[kl]</code>能够匹配<code>cook</code>或<code>cool</code></p> </li> <li>例如：<code>[0-9]</code>匹配任意单个数字</li> <li> <p>例如：<code>[.0-9]</code>匹配<code>.</code>或任意单个数字（中括号内的<code>.</code>就代表字符<code>.</code>，不代表任意单个字符）</p> </li> <li> <p><code>[^]</code>：匹配不在中括号内的任意一个字符。中括号内可以是一个字符组或字符范围 </p> </li> <li> <p>例如：<code>9[^01]</code>能够匹配<code>92</code>和<code>93</code>，但是不匹配<code>91</code>和<code>90</code>。</p> </li> <li> <p>例如：<code>A[^0-9]</code>匹配A以及随后除数字外的任意单个字符</p> </li> <li> <p><code>\s</code>：匹配任何空白字符，包括空格、制表符、换页等。等价于<code>[\f\r\t\v]</code></p> </li> <li> <p><code>\S</code>：匹配任何非空白字符，等价于<code>[^\f\r\t\v]</code></p> </li> <li> <p><code>\w</code>：匹配一个字母、数字、下划线、汉字、其他国家文字字符，等价于<code>[_[:alnum:]字]</code></p> </li> <li> <p><code>\W</code>：匹配一个非字母、数字、下划线、汉字、其他国家文字字符，等价于<code>[^_[:alnum:]字]</code></p> </li> </ul> <h2 id=_7>数量修饰符<a class=headerlink href=#_7 title="Permanent link"> ¶</a></h2> <p>一个标识符可以出现一次、多次或是不出现。数量修饰符定义了模式可以出现的次数。</p> <ul> <li> <p><code>?</code>：匹配之前的项0次或1次。</p> </li> <li> <p>例如：<code>colou?r</code>能够匹配<code>color</code>或<code>colour</code>，但是不能匹配<code>colouur</code>。</p> </li> <li> <p><code>*</code>：匹配之前的项0次或多次。</p> </li> <li> <p>例如：<code>co*l</code>能够匹配<code>col</code>和<code>coool</code>。</p> </li> <li>例如：<code>goo*gle</code>能匹配0个或多个<code>o</code>，如：<code>gogle</code>、<code>google</code>、<code>gooogle</code>、<code>gooooooooogle</code>等。</li> <li> <p>例如：<code>gooo*gle</code>，则可以匹配<code>google</code>、<code>gooogle</code>、<code>gooooooooogle</code>等，对比上面等差别。</p> </li> <li> <p><code>+</code>：匹配之前的项1次或多次。</p> </li> <li> <p>例如：<code>Rollno-9+</code>能够匹配<code>Rollno-99</code>和<code>Rollno-9</code>，但是不能匹配<code>Rollno-</code>。</p> </li> <li>例如：<code>colou+r</code>能够匹配<code>colour</code>或<code>colouur</code>，不能匹配<code>color</code>。</li> <li> <p>例如：<code>goo\+gle</code>能够匹配1个或多个<code>o</code>，如：<code>google</code>，<code>gooogle</code>，<code>goooogle</code>等。</p> </li> <li> <p><code>.*</code>：匹配任意长度等任意字符。相当于通配符中的<code>*</code>。</p> </li> <li> <p><code>{n}</code>：匹配之前的项<code>n</code>次。</p> </li> <li> <p>例如：<code>[0-9]{3}</code>能够匹配任意的三位数。</p> </li> <li> <p>例如：<code>[0-9]{3}</code>可以扩展为<code>[0-9][0-9][0-9]</code>。</p> </li> <li> <p><code>{n}</code>：之前的项至少需要匹配<code>n</code>次。</p> </li> <li> <p>例如：<code>[0-9]{2,}</code>能够匹配任意一个两位或更多位的数字。</p> </li> <li> <p>例如：<code>go\{2,\}gle</code>能够匹配2个或者多个<code>o</code>，如<code>google</code>，<code>gooooogle</code>等，不能匹配<code>gogle</code>。</p> </li> <li> <p><code>{n,m}</code>：之前的项所必须匹配的最小<code>n</code>次数和最大<code>m</code>次数。</p> </li> <li> <p>例如：<code>[0-9]{2,5}</code>能够匹配两位数到五位数之间的任意一个数字。</p> </li> </ul> <h2 id=_8>分组<a class=headerlink href=#_8 title="Permanent link"> ¶</a></h2> <p>有一些特殊字符可以调整正则表达式的匹配方式。</p> <ul> <li> <p><code>\</code>：转义字符可以转义特殊字符。</p> </li> <li> <p>例如：<code>a\.b</code>能够匹配<code>a.b</code>，但不能匹配<code>ajb</code>。因为<code>\</code>忽略了<code>.</code>的特殊意义。</p> </li> <li> <p><code>()</code>：将括号中的内容视为一个整体。</p> </li> <li> <p>例如：<code>ma(tri)?x</code> 能够匹配<code>max</code>或<code>matrix</code></p> </li> <li> <p>例如：<code>\(root\)+</code></p> </li> <li> <p>后向引用：分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部变量中，这些变量名方式为：<code>\1</code>，<code>\2</code>，<code>\3</code>。</p> </li> <li> <p><code>\1</code>：表示从左侧起第一个左括号以及与之匹配的右括号之间的模式所匹配到的字符</p> <ul> <li>例如：<code>\(string1\(string2\)\)</code>，<code>\1</code>是<code>string1\(string2\)</code>，<code>\2</code>是<code>string2</code></li> </ul> </li> <li> <p><code>\0</code>：表示正则表达式匹配的所有字符</p> </li> <li> <p><code>|</code>：指定了一种选择结构，可以匹配<code>|</code>两边的任意一项。</p> </li> <li> <p>例如：<code>Oct (1st|2nd)</code>能够匹配<code>Oct 1st</code>或<code>Oct 2nd</code>。</p> </li> </ul> <p>举例：匹配正负数</p> <div class=highlight><pre><span></span><code>$ echo -1 -2 12 -125 23 | grep &#39;\-\?[0-9]\+&#39; 
-1 -2 12 -125 3log 23 it4u

$ echo -1 -2 12 -125 3log 23 it4u | grep &#39;\-\?[0-9]\+&#39;
-1 -2 12 -125 3log 23 it4u

$ echo -1 -2 12 -125 3log 23 it4u | grep &#39;\-\?[0-9]*&#39;
-1 -2 12 -125 3log 23 it4u

$ echo -1 -2 12 -125 3log 23 it4u | grep -E &#39;\-\?[0-9]\+&#39;


$ echo -1 -2 12 -125 3log 23 it4u | grep -E -- &#39;-?[0-9]+&#39;
-1 -2 12 -125 3log 23 it4u

$ echo -1 -2 12 -125 3log 23 it4u | grep -E &#39;(-)?[0-9]+&#39;
-1 -2 12 -125 3log 23 it4u
</code></pre></div> <p>举例：获取IP地址</p> <div class=highlight><pre><span></span><code>ifconfig eth0
eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.10.210  netmask 255.255.255.0  broadcast 192.168.10.255
        inet6 fe80::20c:29ff:fea4:e17a  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 00:0c:29:a4:e1:7a  txqueuelen 1000  (Ethernet)
        RX packets 7654  bytes 635932 (621.0 KiB)
        RX errors 0  dropped 1  overruns 0  frame 0
        TX packets 1934  bytes 279649 (273.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

$ ifconfig eth0 | grep netmask | grep -o &#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39;
192.168.10.210
255.255.255.0
192.168.10.255

$ ifconfig eth0 | grep netmask | grep -o &#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39; | head -n 1
192.168.10.210

$ ifconfig eth0 | grep -o &#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39;
192.168.10.210
255.255.255.0
192.168.10.255

ifconfig eth0 | grep -o &#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39; | head -n 1
192.168.10.210
</code></pre></div> <p>匹配空行和非空行：</p> <div class=highlight><pre><span></span><code>$ grep &#39;^$&#39; /etc/profile
$ grep -v &#39;^$&#39; /etc/profile
</code></pre></div> <p>匹配非空行和非#开头的行：（三种方法）</p> <div class=highlight><pre><span></span><code>$ grep -v &#39;^$&#39; /etc/profile | grep -v &#39;^#&#39;
$ grep -v &#39;^$\|#&#39; /etc/profile
$ grep &#39;^[^$#]&#39; /etc/profile
</code></pre></div> <p>注意，如果写成下面这样，则不会过滤掉空行，<code>[$]</code>会被视为<code>$</code>符号。 所以正则表达式的元字符放在中括号<code>[]</code>内就被视为普通字符。</p> <div class=highlight><pre><span></span><code>grep -v &#39;^[$#]&#39; /etc/profile
</code></pre></div> <h2 id=grep>三剑客<code>grep</code>命令<a class=headerlink href=#grep title="Permanent link"> ¶</a></h2> <p>格式：</p> <ul> <li>grep [OPTIONS] PATTERN [FILE...]</li> <li>grep [OPTIONS] -e PATTERN ... [FILE...]</li> <li>grep [OPTIONS] -f FILE ... [FILE...]</li> </ul> <p>参数：</p> <ul> <li><code>-n</code>：显示过滤出来的文件在文件当中的行号</li> <li><code>-c</code>：显示匹配到的行数</li> <li><code>-o</code>：只显示匹配到的内容</li> <li><code>-q</code>：静默输出（一般用在shell脚本当中，通过<code>echo $?</code>查看命令执行结果，0表示成功，非0表示失败））</li> <li><code>-i</code>：忽略大小写</li> <li><code>-v</code>：反向查找</li> <li><code>-w</code>：匹配某个词词：在Linux中，词为一连串字母、数字和下划线组成的字符串</li> <li><code>-E</code>：使用扩展正则</li> <li><code>-R</code>：递归查询</li> <li><code>-l</code>：只打印文件路径</li> </ul> <p>扩展参数：</p> <ul> <li><code>-A</code>：显示匹配到的数据的后几n行</li> <li><code>-B</code>：显示匹配到的数据的前几n行</li> <li><code>-C</code>：显示匹配到的数据的前后各几n行</li> </ul> <p>示例：</p> <p>匹配用户：</p> <div class=highlight><pre><span></span><code>grep root /etc/passwd
root:x:0:0:root:/root:/bin/bash

$ grep &quot;USER&quot; /etc/passwd

$ grep &quot;$USER&quot; /etc/passwd
vagrant:x:1000:478:vagrant:/home/vagrant:/bin/bash

$ grep &#39;$USER&#39; /etc/passwd
</code></pre></div> <p>匹配关键字：</p> <div class=highlight><pre><span></span><code>$ grep processor /proc/cpuinfo
processor       : 0
processor       : 1

$ grep -o processor /proc/cpuinfo
processor
processor

$ grep &quot;cpu family&quot; /proc/cpuinfo
cpu family      : 6
cpu family      : 6

$ grep -o &quot;cpu family&quot; /proc/cpuinfo
cpu family
cpu family
</code></pre></div> <p>通过grep进行文件比较。</p> <div class=highlight><pre><span></span><code># 最后一行是空行
$ cat f1
a
b
1
c


# 最后一行是空行
$ cat f2
b
e
f
c
1
2


# 高亮显示相同内容的行，包含最后一行空行
$ grep -f f1 f2
b
e
f
c
1
2


# 只显示相同内容的行，包含最后一行空行
$ grep -wf f1 f2
b
c
1


# 只显示不同内容的行
$ grep -wvf f1 f2
e
f
2
</code></pre></div> <div class="admonition tips"> <p class=admonition-title>Tips</p> <p><code>grep -wvf f1 f2</code> 或者<code>grep -w -v -f f1 f2</code>中，<code>-f</code>只能作为最后一个参数，否则会报错。</p> </div> <p>体会基本正则和扩展正则的差异。</p> <p>例1：转义。</p> <div class=highlight><pre><span></span><code># 下面几个命令返回的结果是一样的。
$ grep &quot;root\|bash&quot; /etc/passwd
$ grep -E &quot;root|bash&quot; /etc/passwd
$ grep -e &quot;root&quot; -e &quot;bash&quot; /etc/passwd

# 下面的命令没有匹配结果返回。
$ grep &quot;root|bash&quot; /etc/passwd
</code></pre></div> <p>例2：下面4个命令返回同样的结果。</p> <div class=highlight><pre><span></span><code>$ grep &quot;root&quot; /etc/passwd
$ grep -E &quot;root&quot; /etc/passwd
$ grep &quot;\&lt;root\&gt;&quot; /etc/passwd
$ grep -E &quot;\&lt;root\&gt;&quot; /etc/passwd
</code></pre></div> <p>例3：行首行尾锚定。</p> <div class=highlight><pre><span></span><code>$ grep &quot;^\(.*\)\&gt;.*\&lt;\1$&quot; /etc/passwd
$ grep -E &quot;^(.*)\&gt;.*\&lt;\1$&quot; /etc/passwd
$ egrep &quot;^(.*)\&gt;.*\&lt;\1$&quot; /etc/passwd
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
</code></pre></div> <p>例4：三种方法求和计算，运用<code>grep</code>，<code>cut</code>，<code>bc</code>和<code>paste</code>命令。</p> <div class=highlight><pre><span></span><code>$cat age
Jason=20
Tom=30
Jack=40

# 方法1
$ cat age | cut -d &quot;=&quot; -f 2 | tr &quot;\n&quot; + | grep -Eo &quot;.*[0-9]&quot; | bc
90

# 方法2
$ grep -Eo &quot;[0-9]+&quot; age | tr &quot;\n&quot; + | grep -Eo &quot;.*[0-9]&quot; | bc
90

# 方法3
$  grep -Eo &quot;[0-9]+&quot; age | paste -s -d &quot;+&quot; | bc
90
</code></pre></div> <h2 id=sed>三剑客<code>sed</code>命令<a class=headerlink href=#sed title="Permanent link"> ¶</a></h2> <p><code>sed</code>是stream editor的缩写，中文称之为“流编辑器”。 <code>sed</code>命令是一个面向行处理的工具，它以“行”为处理单位，针对每一行进行处理，处理后的结果会输出到标准输出<code>STDOUT</code>，不会对读取的文件做任何修改。</p> <p><code>sed</code>的工作原理：</p> <p><code>sed</code>命令是面向“行”进行处理的，每一次处理一行内容。 处理时，<code>sed</code>会把要处理的行存储在缓冲区中，接着用<code>sed</code>命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。这个缓冲区被称为“<strong>模式空间</strong>”（pattern space）。</p> <p>保持空间(hold space)</p> <p><code>sed</code>的保持空间像一个长期储存， 可以把获取的信息储存到其中，待后续调用。不能直接对保持空间进行操作， 而是将保持空间的内容复制或者添加到模式空间进行操作。</p> <p>非交互式批量修改文件。</p> <p><code>sed</code>命令格式：</p> <div class=highlight><pre><span></span><code>$ sed [option] command file
</code></pre></div> <p><code>option</code>常用选项：</p> <ul> <li><code>-n</code>：不输出模式pattern的内容到屏幕（即不自动打印）</li> <li><code>-e</code>：多点编辑</li> <li><code>-f filename</code>：从指定文件读取编辑脚本</li> <li><code>-r</code>，<code>-E</code>：使用扩展正则表达式</li> <li><code>-i .bak</code>：备份文件并原处编辑</li> <li><code>-s</code>：将多个文件视为独立文件，而不是单个连续的长文件流</li> <li><code>-ir</code>： 不支持</li> <li><code>-i -r</code>： 支持</li> <li><code>-ri</code>： 支持</li> <li><code>-ni</code>： 危险选项，会清空文件</li> </ul> <p><code>command</code>部分可以分为两部分：</p> <ul> <li> <p>范围设定，可以采用两种不同的方式来表达：</p> </li> <li> <p>指定行数：如：</p> <ul> <li><code>3,5</code>表示第3、4、5行</li> <li><code>5,$</code>表示第5行至文件最后一行</li> </ul> </li> <li> <p>模式匹配：如：</p> <ul> <li><code>/^[^dD]/</code>表示匹配行首不是以<code>d</code>或<code>D</code>开头的行</li> </ul> </li> <li> <p>动作处理，下面是常用的动作：</p> </li> <li> <p><code>a</code>：新增， <code>a</code>后面的字串会在新的一行出现（当前行的下一行）</p> </li> <li><code>i</code>：插入， <code>i</code>后面的字串会在新的一行出现（当前行的上一行）</li> <li><code>r filename</code>：读取指定文件<code>fllename</code>的内容，追加到当前行的下一行</li> <li><code>R filename</code>：读取指定文件<code>fllename</code>的一行，追加到当前行的下一行</li> <li><code>d</code>：删除该行</li> <li><code>p</code>：打印该行</li> <li><code>Ip</code>：忽略大小写输出</li> <li><code>w filename</code>：写入到指定文件filename中。</li> <li><code>s/regexp/replacement/</code>：取代，用replacement取代正则regexp匹配到的内容</li> <li><code>=</code>：为模式pattern中的匹配行打印行号</li> <li><code>!</code>：为模式pattern中的匹配行取反操作</li> <li><code>q</code>：结束或退出sed</li> </ul> <p>创建一个<code>testfile</code>文件。</p> <div class=highlight><pre><span></span><code>$ cat &lt;&lt;EOF &gt; testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
Taobao
Banbooob
Tesetfile
Wiki
EOF
</code></pre></div> <p>匹配定位文件<code>testfile</code>第二行，并输出（包含匹配第二行和输出第二行）。</p> <div class=highlight><pre><span></span><code># nl testfile | sed &#39;2p&#39;
     1    HELLO LINUX!
     2    Linux is a free unix-type opterating system.
     2    Linux is a free unix-type opterating system.
     3    This is a linux testfile!
     4    Linux test
     5    Google
     6    Taobao
     7    Banbooob
     8    Tesetfile
     9    Wiki
</code></pre></div> <p>匹配定位文件<code>testfile</code>第二行，不输出。</p> <div class=highlight><pre><span></span><code># nl testfile | sed -n &#39;2p&#39;
     2    Linux is a free unix-type opterating system.
</code></pre></div> <p>匹配定位文件<code>testfile</code>最后一行。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed -n &#39;$p&#39;
     9    Wiki
</code></pre></div> <p>匹配定位文件<code>testfile</code>倒数第二行。</p> <div class=highlight><pre><span></span><code># sed -n &quot;$(echo $[`cat testfile | wc -l`-1])p&quot; testfile
Tesetfile
</code></pre></div> <p>将<code>testfile</code>的内容列出第2～3行，并且打印行号。</p> <div class=highlight><pre><span></span><code>$  nl testfile | sed -n &#39;2,3p&#39;
     2  Linux is a free unix-type opterating system.
     3  This is a linux testfile!
</code></pre></div> <p>将<code>testfile</code>的内容从第2行开始，向后输出额外的3行，并且打印行号。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed -n &#39;2,+3p&#39;
     2  Linux is a free unix-type opterating system.
     3  This is a linux testfile!
     4  Linux test
     5  Google
</code></pre></div> <p>将<code>testfile</code>的内容从第2行开始，向后以2为步进单位输出所有匹配行，并且打印行号（即，从第2行开始输出偶数行）。</p> <div class=highlight><pre><span></span><code>nl testfile | sed -n &#39;2~2p&#39;
     2  Linux is a free unix-type opterating system.
     4  Linux test
     6  Taobao
     8  Tesetfile
</code></pre></div> <p>将<code>testfile</code>的内容从第2行开始，向后以2为步进单位删除所有匹配行，输出剩余行，并且打印行号（即，从第2行开始删除偶数行，输出奇数行）。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed &#39;2~2d&#39;
     1  HELLO LINUX!
     3  This is a linux testfile!
     5  Google
     7  Banbooob
     9  Wiki
</code></pre></div> <p>将<code>testfile</code>的内容输出，删除第2行和第5行，并打印行号。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed -e &#39;2d&#39; -e &#39;5d&#39;
$ nl testfile | sed -e &#39;2d;5d&#39;
$ nl testfile | sed &#39;2d;5d&#39;
     1  HELLO LINUX!
     3  This is a linux testfile!
     4  Linux test
     6  Taobao
     7  Banbooob
     8  Tesetfile
     9  Wiki
</code></pre></div> <p>将<code>testfile</code>的内容输出，输出区间是从行首<code>L</code>的行到行首<code>G</code>的行结束。不修改原文件。 如果行首匹配不到，则无结果输出；如果行尾匹配不到，则输出到文件结束。</p> <div class=highlight><pre><span></span><code>$ sed -n &#39;/^L/,/^G/p&#39; testfile
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
</code></pre></div> <p>将<code>testfile</code>的内容输出，且在第6行后加上<code>I love Linux</code>。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ sed -e &#39;6a I love Linux&#39; testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
Taobao
I love Linux
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且在第6行后添加<code>I love Linux</code>。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed &#39;6a I love Linux&#39;
$ nl testfile | sed &#39;6a\I love Linux&#39;
     1    HELLO LINUX!
     2    Linux is a free unix-type opterating system.
     3    This is a linux testfile!
     4    Linux test
     5    Google
     6    Taobao
I love Linux
     7    Banbooob
     8    Tesetfile
     9    Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且在第3行前添加<code>I am a journer learner</code>。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed &#39;3i\I am a journer learner&#39;
     1    HELLO LINUX!
     2    Linux is a free unix-type opterating system.
I am a journer learner
     3    This is a linux testfile!
     4    Linux test
     5    Google
     6    Taobao
     7    Banbooob
     8    Tesetfile
     9    Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且在第3行前添加三行内容<code>Add line 1</code>，<code>Add line 2</code>，<code>Add line 3</code>。用符合<code>\</code>进行换行。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed &#39;3i\Add line 1 \
Add line 2 \
Add line 3&#39;
     1    HELLO LINUX!
     2    Linux is a free unix-type opterating system.
Add line 1
Add line 2
Add line 3
     3    This is a linux testfile!
     4    Linux test
     5    Google
     6    Taobao
     7    Banbooob
     8    Tesetfile
     9    Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且将第2-5行的内容取代成为<code>replaced</code>。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed &#39;2,5c\replaced&#39;
$ nl testfile | sed &#39;2,5c replaced&#39;
$ nl testfile | sed &#39;2,5creplaced&#39;
     1    HELLO LINUX!
replaced
     6    Taobao
     7    Banbooob
     8    Tesetfile
     9    Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且删除第2~5行。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed &#39;2,5d&#39;
     1    HELLO LINUX!
     6    Taobao
     7    Banbooob
     8    Tesetfile
     9    Wiki
</code></pre></div> <p>将<code>testfile</code>的内容列出并且打印行号，且删除第5行到最后一行。</p> <div class=highlight><pre><span></span><code>$ nl testfile | sed &#39;5,$d&#39;
     1    HELLO LINUX!
     2    Linux is a free unix-type opterating system.
     3    This is a linux testfile!
     4    Linux test
</code></pre></div> <p>匹配定位文件<code>testfile</code>中包含关键字<code>linux</code>的行。</p> <div class=highlight><pre><span></span><code>$ sed -n &#39;/linux/p&#39; testfile
This is a linux testfile!
</code></pre></div> <p>匹配定位命令<code>df</code>输出中以<code>/dev/sd</code>关键字开头的行。（需要转义符<code>\</code>）</p> <div class=highlight><pre><span></span><code>$ df | sed -n &#39;/^\/dev\/sd/p&#39;
/dev/sda2      102750208 7077280  92055312   8% /
/dev/sda2      102750208 7077280  92055312   8% /.snapshots
/dev/sda2      102750208 7077280  92055312   8% /home
/dev/sda2      102750208 7077280  92055312   8% /opt
/dev/sda2      102750208 7077280  92055312   8% /root
/dev/sda2      102750208 7077280  92055312   8% /boot/grub2/x86_64-efi
/dev/sda2      102750208 7077280  92055312   8% /boot/grub2/i386-pc
/dev/sda2      102750208 7077280  92055312   8% /srv
/dev/sda2      102750208 7077280  92055312   8% /tmp
/dev/sda2      102750208 7077280  92055312   8% /usr/local
/dev/sda2      102750208 7077280  92055312   8% /var
</code></pre></div> <p>匹配定位命令<code>df</code>输出中不以<code>/dev/sd</code>关键字开头的行。通过<code>!p</code>进行求反输出。</p> <div class=highlight><pre><span></span><code>$ df | sed -n &#39;/^\/dev\/sd/!p&#39;
Filesystem     1K-blocks    Used Available Use% Mounted on
devtmpfs            4096       0      4096   0% /dev
tmpfs            1971208       0   1971208   0% /dev/shm
tmpfs             788484    9612    778872   2% /run
tmpfs               4096       0      4096   0% /sys/fs/cgroup
tmpfs             394240       0    394240   0% /run/user/1000
</code></pre></div> <p>匹配定位命令<code>df</code>输出中不以<code>/dev/sd</code>和<code>tmp</code>关键字开头的行。</p> <div class=highlight><pre><span></span><code>$ df | sed &#39;/^\/dev\/sd/d;/^tmp/d&#39;
Filesystem     1K-blocks    Used Available Use% Mounted on
devtmpfs            4096       0      4096   0% /dev

$ df | grep -Ev &#39;^\/dev\/sd|^tmp&#39;
Filesystem     1K-blocks    Used Available Use% Mounted on
devtmpfs            4096       0      4096   0% /dev
</code></pre></div> <p>搜索文件<code>testfile</code>所有包含<code>oo</code>关键字的行并匹配输出。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ sed -n &#39;/ooo/p&#39; testfile
Banbooob

$ sed -n &#39;/oo/p&#39; testfile
Google
Banbooob
</code></pre></div> <p>搜索文件<code>testfile</code>所有包含<code>oo</code>关键字的行并删除。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ sed &#39;/oo/d&#39; testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Taobao
Tesetfile
Wiki
</code></pre></div> <p>搜索文件<code>testfile</code>所有包含<code>oo</code>的行，把<code>oo</code>替换为<code>kk</code>，再输出这行。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ sed -n &#39;/oo/{s/oo/kk/;p;q}&#39; testfile
$ sed -ne &#39;/oo/{s/oo/kk/;p;q}&#39; testfile
Gkkgle
</code></pre></div> <p>将<code>testfile</code>的每行中第一次出现<code>ao</code>的替换成<code>HH</code>。</p> <div class=highlight><pre><span></span><code>$ sed &#39;s/ao/HH/&#39; testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
THHbao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>下面是把<code>testfile</code>的匹配到<code>ao</code>的行替换成<code>HH</code>。</p> <div class=highlight><pre><span></span><code>sed &#39;/ao/cHH&#39; testfile
HELLO LINUX!
SUSE
This is a linux testfile!
SUSE
Google
Taobao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>搜索文件<code>testfile</code>所有包含<code>ao</code>的全部替换成<code>HH</code>。<code>g</code>表示全局匹配。不修改原文件。</p> <div class=highlight><pre><span></span><code>$ sed -e &#39;s/ao/HH/g&#39; testfile
$ sed &#39;s/ao/HH/g&#39; testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
THHbHH
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>在文件<code>/etc/passwd</code>中查找匹配所有符合<code>r</code>开头<code>t</code>结尾且中间含任意两个字符的行，并在<code>t</code>字母后添加<code>er</code>。</p> <div class=highlight><pre><span></span><code>$ sed -nr &#39;s/r..t/&amp;er/gp&#39; /etc/passwd
rooter:x:0:0:rooter:/rooter:/bin/bash
lp:x:493:487:Printering daemon:/var/spool/lpd:/usr/sbin/nologin
tftp:x:487:474:TFTP account:/srv/terftpboot:/bin/false
vagranter:x:1000:478:vagranter:/home/vagranter:/bin/bash
tester1:x:600:1530:&quot;Test User1,terestuser1@abc.com&quot;:/home/tester1:/bin/bash
</code></pre></div> <p>将上述结果和原始内容进行对比，能更好的理解<code>s/r..t/&amp;er</code>的操作。</p> <div class=highlight><pre><span></span><code>rooter:x:0:0:rooter:/rooter:/bin/bash
root:x:0:0:root:/root:/bin/bash

lp:x:493:487:Printering daemon:/var/spool/lpd:/usr/sbin/nologin
lp:x:493:487:Printing daemon:/var/spool/lpd:/usr/sbin/nologin

tftp:x:487:474:TFTP account:/srv/terftpboot:/bin/false
tftp:x:487:474:TFTP account:/srv/tftpboot:/bin/false

vagranter:x:1000:478:vagranter:/home/vagranter:/bin/bash
vagrant:x:1000:478:vagrant:/home/vagrant:/bin/bash

tester1:x:600:1530:&quot;Test User1,terestuser1@abc.com&quot;:/home/tester1:/bin/bash
tester1:x:600:1530:&quot;Test User1,testuser1@abc.com&quot;:/home/tester1:/bin/bash
</code></pre></div> <p>体会<code>&amp;</code>的位置不同的不同含义。</p> <div class=highlight><pre><span></span><code># 附加在root单词后
$ sed -n &#39;s/root/&amp;superman/p&#39; /etc/passwd
rootsuperman:x:0:0:root:/root:/bin/bash

# 附加在root单词前
$ sed -n &#39;s/root/superman&amp;/p&#39; /etc/passwd
supermanroot:x:0:0:root:/root:/bin/bash
</code></pre></div> <p>使用参数<code>-i</code>进行源文件修改。</p> <div class=highlight><pre><span></span><code>$ sed -i &#39;s/ao/HH/&#39; testfile
$ cat testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
THHbao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>源文件修改前，备份在新文件<code>testfile.new</code>。</p> <div class=highlight><pre><span></span><code>$ sed -i.new &#39;s/ao/HH/&#39; testfile

$ cat testfile.new
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
Taobao
Banbooob
Tesetfile
Wiki

$ cat testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
THHbao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p>范例：除指定文件外，其余都删除。</p> <div class=highlight><pre><span></span><code>$ touch {1..9}file.txt

$ ls
1file.txt  2file.txt  3file.txt  4file.txt  5file.txt  6file.txt  7file.txt  8file.txt  9file.txt

$ ls | grep -E &#39;(3|5|7)file\.txt&#39;
3file.txt
5file.txt
7file.txt

$ ls | grep -Ev &#39;(3|5|7)file\.txt&#39;
1file.txt
2file.txt
4file.txt
6file.txt
8file.txt
9file.txt
</code></pre></div> <p>下面四种方法实现同样的功能</p> <div class=highlight><pre><span></span><code>$ rm `ls | grep -Ev &#39;(3|5|7)file\.txt&#39;`
$ ls | sed -n &#39;/^[357]file.txt/!p&#39; | xargs rm
$ ls | grep -Ev &#39;(3|5|7)file\.txt&#39; | sed -n &#39;s/.*/rm &amp;/p&#39; | bash
$ ls | grep -Ev &#39;(3|5|7)file\.txt&#39; | sed -En &#39;s/(.*)/rm &amp;/p&#39; | bash
$ ls | grep -Ev &#39;(3|5|7)file\.txt&#39; | sed -En &#39;s/(.*)/rm \1/p&#39; | bash

$ ls
3file.txt  5file.txt  7file.txt
</code></pre></div> <p>后向引用<code>\0</code> <code>\1</code> <code>\2</code>等。</p> <div class=highlight><pre><span></span><code>$ $echo 123456789 | sed -nE &#39;s/(123)(456)(789)/\1/p&#39;
123

$  echo 123456789 | sed -nE &#39;s/(123)(456)(789)/\2/p&#39;
456

$ echo 123456789 | sed -nE &#39;s/(123)(456)(789)/\3/p&#39;
789

$ echo 123456789 | sed -nE &#39;s/(123)(456)(789)/\3\1\2/p&#39;
789123456

$ echo 123456789 | sed -nE &#39;s/(123)(456)(789)/\1xyz\2/p&#39;
123xyz456
</code></pre></div> <p>范例：获取分区利用率</p> <div class=highlight><pre><span></span><code>$ df | sed -En &#39;/^\/dev\/sd/p&#39;
/dev/sda2      102750208 7079236  92053692   8% /
/dev/sda2      102750208 7079236  92053692   8% /.snapshots
/dev/sda2      102750208 7079236  92053692   8% /boot/grub2/i386-pc
/dev/sda2      102750208 7079236  92053692   8% /boot/grub2/x86_64-efi
/dev/sda2      102750208 7079236  92053692   8% /home
/dev/sda2      102750208 7079236  92053692   8% /opt
/dev/sda2      102750208 7079236  92053692   8% /root
/dev/sda2      102750208 7079236  92053692   8% /srv
/dev/sda2      102750208 7079236  92053692   8% /usr/local
/dev/sda2      102750208 7079236  92053692   8% /tmp
/dev/sda2      102750208 7079236  92053692   8% /var

$ df | sed -En &#39;/^\/dev\/sd/s@.*([0-9]+)%.*@\1@p&#39;
$ df | sed -En &#39;/^\/dev\/sd/s#.*([0-9]+)%.*#\1#p&#39;
# df | sed -En &#39;/^\/dev\/sd/s/.*([0-9]+)%.*/\1/p&#39;
8
8
8
8
8
8
8
8
8
8
8
</code></pre></div> <p>体会下面空格和括弧带来的不同。</p> <div class=highlight><pre><span></span><code>$ df | sed -En &#39;/^\/dev\/sd/s# .*([0-9]+)%.*# \1#p&#39;
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8

$ df | sed -En &#39;/^\/dev\/sd/s#( .*)([0-9]+)%.*# \1#p&#39;
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156
/dev/sda2       102750208 7079804  92053156

$ df | sed -En &#39;/^\/dev\/sd/s#( .*)([0-9]+)%.*# \2#p&#39;
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
</code></pre></div> <p>范例：取得当前IP地址。</p> <div class=highlight><pre><span></span><code>$ ifconfig eth0
eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.10.210  netmask 255.255.255.0  broadcast 192.168.10.255
        inet6 fe80::20c:29ff:fea4:e17a  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 00:0c:29:a4:e1:7a  txqueuelen 1000  (Ethernet)
        RX packets 22923  bytes 1658298 (1.5 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3763  bytes 442641 (432.2 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

$ ip addr show eth0
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:a4:e1:7a brd ff:ff:ff:ff:ff:ff
    altname enp2s1
    altname ens33
    inet 192.168.10.210/24 brd 192.168.10.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fea4:e17a/64 scope link
       valid_lft forever preferred_lft forever


$ ifconfig eth0 | sed -En &#39;2s/[^0-9]+([0-9.]+).*/\1/p&#39;
$ ifconfig eth0 | sed -En &#39;2s/^[^0-9]+([0-9.]{7,15}).*/\1/p&#39;
$ ifconfig eth0 | sed -En &#39;2s/^[^0-9]+([0-9.]{7,15}).*$/\1/p&#39;
$ ifconfig eth0 | sed -n &#39;2s/^.*inet //p&#39; | sed -n &#39;s/netmask.*//p&#39;
$ ifconfig eth0 | sed -n &#39;2s/^.*inet //;s/ netmask.*//p&#39;
$ ifconfig eth0 | sed -En &#39;2s/(.*inet )([0-9].*)(netmask.*)/\2/p&#39;
192.168.10.210
192.168.10.210
192.168.10.210
</code></pre></div> <p>使用<code>\0</code>输出全部变量。</p> <div class=highlight><pre><span></span><code>$ ifconfig eth0 | sed -En &#39;2s/(.*inet )([0-9].*)(netmask.*)/\0/p&#39;
        inet 192.168.10.210  netmask 255.255.255.0  broadcast 192.168.10.255

$ ifconfig eth0 | sed -En &#39;2s/(.*inet )([0-9].*)(netmask.*)/\1/p&#39;
        inet

$ ifconfig eth0 | sed -En &#39;2s/(.*inet )([0-9].*)(netmask.*)/\2/p&#39;
192.168.10.210

$ ifconfig eth0 | sed -En &#39;2s/(.*inet )([0-9].*)(netmask.*)/\3/p&#39;
netmask 255.255.255.0  broadcast 192.168.10.255
</code></pre></div> <p>对比下面两个指令的匹配差异。</p> <div class=highlight><pre><span></span><code>$ ifconfig eth0 | sed -n &#39;2s/^.*inet //p&#39; | sed -n &#39;s/ netmask.*//p&#39;
192.168.10.210

$ ifconfig eth0 | sed -n &#39;2s/^.*inet //p&#39; | sed -n &#39;s/netmask.* //p&#39;
192.168.10.210  192.168.10.255

$ ifconfig eth0 | sed -n &#39;2s/^.*inet //p&#39; | sed -n &#39;s/netmask .*//p&#39;
192.168.10.210

$ ifconfig eth0 | sed -n &#39;2s/^.*inet //p&#39; | sed -n &#39;s/netmask.*//p&#39;
192.168.10.210
</code></pre></div> <p>范例：取基名和目录名。 （<code>/etc/sysconfig/network-scripts/</code>目录在Rocky9中默认已创建，在openSUSE和Ubuntu中没有）</p> <div class=highlight><pre><span></span><code># 取目录名
$ echo &quot;/etc/sysconfig/network-scripts/&quot; | sed -E &#39;s#(^/.*/)([^/]+/?)#\1#&#39;
$ echo &quot;/etc/sysconfig/network-scripts/&quot; | sed -E &#39;s/(^\/.*\/)([^\/]+\/?)/\1/&#39;
/etc/sysconfig/
# 取基名
$ echo &quot;/etc/sysconfig/network-scripts/&quot; | sed -E &#39;s#(^/.*/)([^/]+/?)#\2#&#39;
$ echo &quot;/etc/sysconfig/network-scripts/&quot; | sed -E &#39;s/(^\/.*\/)([^\/]+\/?)/\2/&#39;
network-scripts/

# 取目录名
$ echo &quot;/etc/sysconfig/network-scripts/dummyfile&quot; | sed -E &#39;s#(^/.*/)([^/]+/?)#\1#&#39;
$ echo &quot;/etc/sysconfig/network-scripts/dummyfille&quot; | sed -E &#39;s/(^\/.*\/)([^\/]+\/?)/\1/&#39;
/etc/sysconfig/network-scripts/
# 取基名
$ echo &quot;/etc/sysconfig/network-scripts/dummyfile&quot; | sed -E &#39;s#(^/.*/)([^/]+/?)#\2#&#39;
$ echo &quot;/etc/sysconfig/network-scripts/dummyfille&quot; | sed -E &#39;s/(^\/.*\/)([^\/]+\/?)/\2/&#39;
dummyfille
</code></pre></div> <p>范例：取文件名和文件扩展名</p> <div class=highlight><pre><span></span><code>$ echo 1_.file.tar.gz | sed -En &#39;s/(.*)\.([^.]+)$/\1/p&#39;
$ echo 1_.file.tar.gz | sed -En &#39;s@(.*)\.([^.]+)$@\1@p&#39;
1_.file.tar

$ echo 1_.file.tar.gz | sed -En &#39;s/(.*)\.([^.]+)$/\2/p&#39;
$ echo 1_.file.tar.gz | sed -En &#39;s@(.*)\.([^.]+)$@\2@p&#39;
gz
</code></pre></div> <div class=highlight><pre><span></span><code>$ echo 1_.file.tar.gz | grep -Eo &#39;.*\.&#39;
1_.file.tar.

$ echo 1_.file.tar.gz | grep -Eo &#39;[^.]+$&#39;
gz
</code></pre></div> <p>范例：将非<code>#</code>开头的行添加<code>#</code></p> <div class=highlight><pre><span></span><code>$ cat &lt;&lt;EOF &gt; testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
Taobao
Banbooob
#Tesetfile
#Wiki
EOF

$ sed -En &#39;s/^[^#]/#&amp;/p&#39; testfile
$ sed -En &#39;s/^[^#](.*)/#\1/p&#39; testfile
#HELLO LINUX!
#Linux is a free unix-type opterating system.
#This is a linux testfile!
#Linux test
#Google
#Taobao
#Banbooob
</code></pre></div> <p>范例：将<code>#</code>开头的行删除<code>#</code></p> <div class=highlight><pre><span></span><code>$ cat &lt;&lt;EOF &gt; testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
Taobao
Banbooob
#Tesetfile
#Wiki
EOF

$ sed -Ei.bak &#39;/^#/s/^#//&#39; testfile

$ cat testfile
HELLO LINUX!
Linux is a free unix-type opterating system.
This is a linux testfile!
Linux test
Google
Taobao
Banbooob
Tesetfile
Wiki
</code></pre></div> <p><code>sed</code>保持空间（hold space）的例子：</p> <ul> <li> <p><code>d</code>：删除pattern space的内容，开始下一个循环。</p> </li> <li> <p><code>D</code>：如果模式空间保护换行符，则删除直到第一个换行符到模式空间中的文本，并不读取新的输入行，而使用合成的模式空间重新启动循环。如果模式空间不包含换行符，则类似<code>d</code>命令启动正常的新循环。</p> </li> <li> <p><code>h</code>、 <code>H</code>：复制/追加模式空间的内容到保持空间。</p> </li> <li> <p><code>g</code>、 <code>G</code>：复制/追加保持空间的内容到模式空间。</p> </li> <li> <p><code>n</code>、<code>N</code>：复制/追加匹配到的下一行到模式空间。</p> </li> <li> <p>p：打印当前模式空间内容。</p> </li> <li> <p>P：打印模式空间开头至<code>\n</code>的内容，并追加到默认输出之前。</p> </li> <li> <p><code>x</code>：交换保持空间和模式空间的内容.</p> </li> </ul> <p>举例解读1：</p> <ol> <li> <p><code>seq 10</code>命令输出1～10个数字，每个数字一行。</p> </li> <li> <p><code>sed</code>命令读取第一行<code>1</code>到模式空间。因为参数<code>-n</code>，所以读取到的<code>1</code>不打印到屏幕。</p> </li> <li> <p>执行<code>n</code>命令，即读取匹配到的下一行到模式空间，即把第二行的<code>2</code>读取并覆盖到模式空间。</p> </li> <li> <p>执行<code>p</code>命令，把<code>2</code>输出到屏幕。</p> </li> <li> <p>以此类推，读取第三行的<code>3</code>到模式空间，执行<code>n</code>命令，将第四行的<code>4</code>读取并覆盖到模式空间。执行<code>p</code>命令，输出<code>4</code>到屏幕。</p> </li> <li> <p>以此类推。</p> </li> </ol> <div class=highlight><pre><span></span><code>$ seq 10 | sed -n &#39;n;p&#39;
2
4
6
8
10

seq 10 | sed &#39;n;p&#39;
1
2
2
3
4
4
5
6
6
7
8
8
9
10
10
</code></pre></div> <p>举例解读2：</p> <ul> <li> <p><code>seq 10</code>命令输出1～10个数字，每个数字一行。</p> </li> <li> <p><code>sed</code>命令读取第一行到<code>1</code>到模式空间（覆盖）。</p> </li> <li> <p>执行命令<code>N</code>，即读取下一行，即第二行的<code>2</code>，追加到模式空间。所以当前模式空间有<code>1</code>和<code>2</code>这2行记录。</p> </li> <li> <p>执行<code>s/\n//</code>，把模式空间中的第一行的<code>1</code>后面的<code>\n</code>替换为空，即，原来模式空间的两行<code>1</code>和<code>2</code>现在合并为一行，即<code>12</code>。</p> </li> <li> <p>读取第三行的<code>3</code>到模式空间（覆盖）。</p> </li> <li> <p>执行命令<code>N</code>，即读取下一行，即第四行的<code>4</code>，追加到模式空间。所以当前模式空间有<code>3</code>和<code>4</code>这2行记录。</p> </li> <li> <p>执行<code>s/\n//</code>，把模式空间中的第一行<code>3</code>后面的<code>\n</code>替换为空，即，原来模式空间的两行<code>3</code>和<code>4</code>现在合并为一行，即<code>34</code>。</p> </li> <li> <p>以此类推。</p> </li> </ul> <div class=highlight><pre><span></span><code>$ seq 10 | sed &#39;N;s/\n//&#39;
12
34
56
78
910
</code></pre></div> <p>举例解读3：</p> <ul> <li> <p><code>seq 10</code>命令输出1～10个数字，每个数字一行。</p> </li> <li> <p><code>sed</code>命令读取第一行到<code>1</code>到模式空间（覆盖）。</p> </li> <li> <p>执行<code>!G</code>，即对第一行的<code>1</code>不执行<code>G</code>命令。</p> </li> <li> <p>执行<code>h</code>命令，即把<code>1</code>从模式空间覆盖至保持空间。至此，保持空间和模式空间都存有<code>1</code>。</p> </li> <li> <p>执行<code>$!d</code>，即不是最后一行就从模式空间删除，所以把<code>1</code>从模式空间中删除。</p> </li> <li> <p><code>sed</code>命令读取第二行到<code>2</code>到模式空间（覆盖）。</p> </li> <li> <p>执行<code>!G</code>，即对第二行的<code>2</code>执行<code>G</code>命令，把<code>1</code>从保持空间追加到模式空间。至此，保持空间存有<code>1</code>，模式空间存有<code>2</code>和<code>1</code>。</p> </li> <li> <p>执行<code>h</code>命令，即把<code>2</code>和<code>1</code>从模式空间覆盖至保持空间。至此，保持空间和模式空间都存有<code>2</code>和<code>1</code>。</p> </li> <li> <p>执行<code>$!d</code>，即不是最后一行就从模式空间删除，所以把<code>2</code>和<code>1</code>从模式空间中删除。</p> </li> <li> <p>以此类推，直至读取最后一行10。此时，模式空间是<code>10</code>，保持空间存有<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>。</p> </li> <li> <p>执行<code>!G</code>，即对最后一行的<code>10</code>执行<code>G</code>命令，把<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>从保持空间追加到模式空间。至此，保持空间存有<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>。，模式空间存有<code>10</code>、<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>。</p> </li> <li> <p>执行<code>h</code>命令，即把<code>10</code>、<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>从模式空间覆盖至保持空间。至此，保持空间和模式空间都存有<code>10</code>、<code>9</code>、<code>8</code>、<code>7</code>、<code>6</code>、<code>5</code>、<code>4</code>、<code>3</code>、<code>2</code>、<code>1</code>。</p> </li> <li> <p>执行<code>$!d</code>，当前是最后一行，所以不从模式空间删除当前内容。</p> </li> <li> <p>输出模式空间内容至屏幕。即10～1。</p> </li> </ul> <div class=highlight><pre><span></span><code>$ seq 10 | sed &#39;1!G;h;$!d&#39;
10
9
8
7
6
5
4
3
2
1
</code></pre></div> <p>其他一些例子：</p> <div class=highlight><pre><span></span><code>$ seq 10 | sed -n &#39;/3/{g;1!p;};h&#39;
2
$ seq 10 | sed -nr &#39;/3/{n;p}&#39;
4
$ seq 10 | sed &#39;N;D&#39;
10
$ seq 10 | sed &#39;3h;9G;9!d&#39;
9
3
$ seq 10 | sed &#39;$!N;$!D&#39;
9
10
$ seq 10 | sed &#39;$!d&#39;
10
$ seq 10 | sed &#39;G&#39;
1

2

3

4

5

6

7

8

9

10

$ seq 10 | sed &#39;g&#39;










$ seq 10 | sed &#39;/^$/d;G&#39;
1

2

3

4

5

6

7

8

9

10

$ seq 10 | sed &#39;n;d&#39;
1
3
5
7
9
$ seq 10 | sed -n &#39;1!G;h;$p&#39;
10
9
8
7
6
5
4
3
2
1
</code></pre></div> <h2 id=awk>三剑客<code>awk</code>命令<a class=headerlink href=#awk title="Permanent link"> ¶</a></h2> <p><code>awk</code>是一个文本分析工具。<code>grep</code>擅长查找，<code>sed</code>擅长编辑，<code>awk</code>擅长数据分析并生成报告。</p> <p><code>awk</code>的名称得自于它的创始人Alfred Aho 、Peter Weinberger 和 Brian Kernighan 姓氏的首个字母。</p> <p><code>awk</code>有3个不同版本: <code>awk</code>、<code>nawk</code>和<code>gawk</code>。我们说的<code>awk</code>一般指<code>gawk</code>。<code>gawk</code> 是<code>awk</code>的GNU版本。</p> <p><code>awk</code>把文件逐行读入，以空格为默认分隔符将每行切片，再对切片进行分析处理。</p> <h3 id=_9>命令格式<a class=headerlink href=#_9 title="Permanent link"> ¶</a></h3> <p><code>awk 'pattern{action statements;...}' {filenames}</code></p> <ul> <li> <p><code>pattern</code>表示<code>awk</code>在数据中查找的内容。是要表示的正则表达式，用斜杠括起来。</p> </li> <li> <p><code>action</code>是在找到匹配内容时所执行的一系列命令。 </p> </li> <li> <p><code>-F</code>：指定分隔符，后面紧跟单引号，单引号内是分隔符。如不加<code>-F</code>选项，则以空格或者tab作为分隔符。</p> </li> <li> <p><code>-v</code>：var=value，变量赋值。</p> </li> </ul> <h3 id=_10>工作过程<a class=headerlink href=#_10 title="Permanent link"> ¶</a></h3> <ol> <li> <p>执行BEGIN{action;...}语句块中的语句。</p> </li> <li> <p>BEGIN语句块再awk读入输入流之前被执行。</p> </li> <li> <p>是可选语句块。</p> </li> <li> <p>包含初始化变量，打印输出表格的表头等语句。</p> </li> <li> <p>从文件或者标准输入stdin读取一行，然后执行pattern{action;...}语句块。从第一行开始到最后一行，逐行扫描文件，重复这个动作，直到文件或者输入流全部被读取完毕。</p> </li> <li> <p>可选语句块。</p> </li> <li> <p>如果没有提供pattern语句块，则默认执行{print}。</p> </li> <li> <p>当读至文件或者输入流末尾时，执行END{action;...}语句块，比如打印所有行的分析结果这类汇总信息。也是一个可选语句块。</p> </li> </ol> <h3 id=_11>分隔符、域和记录<a class=headerlink href=#_11 title="Permanent link"> ¶</a></h3> <ul> <li> <p>有分隔符分隔的字段（列column，域field），标记<code>$1</code>、<code>$2</code>、<code>$3</code>、...、<code>$n</code>称为域标识，<code>$0</code>为所有域。注意，和shell变量中的<code>$</code>不同。</p> </li> <li> <p>每一行成为记录（record）。</p> </li> <li> <p>如果省略action，则默认执行<code>print $0</code>操作。 </p> </li> </ul> <h3 id=action>常用action分类<a class=headerlink href=#action title="Permanent link"> ¶</a></h3> <ul> <li> <p>Output statements: <code>print</code>, <code>printf</code></p> </li> <li> <p>Expressions: 算术、比较表达式</p> </li> <li> <p>Compund statements: 组合语句</p> </li> <li> <p>Control statements: <code>if</code>, <code>while</code>语句</p> </li> <li> <p>Input statements: </p> </li> </ul> <p>动作<code>print</code></p> <p>格式：<code>print item1, item2, ...</code></p> <p>说明：</p> <ul> <li> <p>逗号分隔符</p> </li> <li> <p>输出item可以是字符串，也可以是数值，是当前记录的字段、变量或<code>awk</code>表达式。</p> </li> <li> <p>如果省略item，相当于<code>print $0</code></p> </li> <li> <p>固定字符需要用双引号，而变量和数字不需要。</p> </li> </ul> <p>示例：</p> <div class=highlight><pre><span></span><code>$ seq 5 |awk &#39;{print &quot;hello awk&quot;}&#39;
hello awk
hello awk
hello awk
hello awk
hello awk

$ seq 5 |awk &#39;{print 3*5}&#39;
15
15
15
15
15

$ awk -F&#39;:&#39; &#39;{print &quot;hello&quot;}&#39; /etc/passwd |head -5
hello
hello
hello
hello
hello

$ awk -F&#39;:&#39; &#39;{print}&#39; /etc/passwd |head -5
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User for D-Bus:/run/dbus:/usr/bin/false
systemd-network:x:497:497:systemd Network Management:/:/usr/sbin/nologin
systemd-timesync:x:496:496:systemd Time Synchronization:/:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/var/lib/nobody:/bin/bash

$ awk -F&#39;:&#39; &#39;{print $0}&#39; /etc/passwd |head -5
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User for D-Bus:/run/dbus:/usr/bin/false
systemd-network:x:497:497:systemd Network Management:/:/usr/sbin/nologin
systemd-timesync:x:496:496:systemd Time Synchronization:/:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/var/lib/nobody:/bin/bash

$ awk -F&#39;:&#39; &#39;{print $1,$3}&#39; /etc/passwd |head -5
root 0
messagebus 499
systemd-network 497
systemd-timesync 496
nobody 65534

$ awk -F&#39;:&#39; &#39;{print $1&quot;\t&quot;$3}&#39; /etc/passwd |head -5
root    0
messagebus    499
systemd-network    497
systemd-timesync    496
nobody    65534


$ grep &quot;^UUID&quot; /etc/fstab |awk &#39;{print $2,$3}&#39;
/ btrfs
/var btrfs
/usr/local btrfs
/tmp btrfs
/srv btrfs
/root btrfs
/opt btrfs
/home btrfs
/boot/grub2/x86_64-efi btrfs
/boot/grub2/i386-pc btrfs
/.snapshots btrfs
swap swap
</code></pre></div> <p>示例：读取分区利用率。</p> <p>分隔符中的定义<code>[[:space:]]+|%</code>的含义，一个或多个空格或者<code>%</code>作为分隔符。</p> <div class=highlight><pre><span></span><code>$ df |awk &#39;{print $1,$5}&#39;
Filesystem Use%
devtmpfs 0%
tmpfs 0%
tmpfs 2%
tmpfs 0%
/dev/sda2 8%
/dev/sda2 8%
/dev/sda2 8%
/dev/sda2 8%
/dev/sda2 8%
/dev/sda2 8%
/dev/sda2 8%
/dev/sda2 8%
/dev/sda2 8%
/dev/sda2 8%
/dev/sda2 8%
tmpfs 0%

$ df |grep &#39;^/dev/sd&#39; |awk -F&#39;[[:space:]]+|%&#39; &#39;{print $1,$5}&#39;
$ df |grep &#39;^/dev/sd&#39; |awk -F&#39; +|%&#39; &#39;{print $1,$5}&#39;
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
/dev/sda2 8
</code></pre></div> <p>示例：读取ifconfig输出结果中的ip地址。</p> <div class=highlight><pre><span></span><code>$ ifconfig eth0 | sed -n &#39;2p&#39; |awk &#39;/netmask/{print $2}&#39;
192.168.10.210

$ ifconfig eth0 | sed -n &#39;2p&#39; |awk &#39;{print $2}&#39;
192.168.10.210
</code></pre></div> <h3 id=_12>常用控制语句<a class=headerlink href=#_12 title="Permanent link"> ¶</a></h3> <ul> <li> <p>{statements;...} 组合语句</p> </li> <li> <p>if(condition){statements;...}</p> </li> <li> <p>if(condition){statements;...} else(statements;...)</p> </li> <li> <p>while(condition){statements;...}</p> </li> <li> <p>do(statements;...) while{condition}</p> </li> <li> <p>for(expr1;expr2;expr3) {statements;...}</p> </li> <li> <p>break</p> </li> <li> <p>continue</p> </li> <li> <p>exit</p> </li> </ul> <h3 id=pattern>模式Pattern<a class=headerlink href=#pattern title="Permanent link"> ¶</a></h3> <p>根据pattern条件，过滤匹配的行，再做处理。</p> <ul> <li> <p>如果未指定，即空模式，则匹配每一行。</p> </li> <li> <p><code>/regular expression/</code>，仅处理能够模式匹配到的行（即结果为真），需要用<code>/</code>进行括起来。</p> </li> <li> <p>结果为真，即非0值、非空字符串</p> </li> <li> <p>结果为假，即0值、空字符串</p> </li> </ul> <p>示例：空模式</p> <div class=highlight><pre><span></span><code>awk -F&quot;:&quot; &#39;{print $1, $3}&#39; /etc/passwd |head -n5
root 0
messagebus 499
systemd-network 497
systemd-timesync 496
nobody 65534
</code></pre></div> <p>示例：非空模式</p> <div class=highlight><pre><span></span><code>$ seq 5 | awk &#39;0&#39;
$ seq 5 | awk &#39;1&#39;
1
2
3
4
5
$ seq 5 | awk &#39;2&#39;
1
2
3
4
5
$ seq 5 | awk &#39;&quot;true&quot;&#39;
1
2
3
4
5
$ seq 5 | awk &#39;&quot;false&quot;&#39;
1
2
3
4
5
$ seq 5 | awk &#39;true&#39;
$ seq 5 | awk &#39;false&#39;
$ seq 5 | awk &#39;&#39;
$ seq 5 | awk &#39;&quot;&quot;&#39;
$ seq 5 | awk &#39;&quot;0&quot;&#39;
1
2
3
4
5
</code></pre></div> <p>体会下面变量的值和正确使用变量（字符串还是变量？）</p> <div class=highlight><pre><span></span><code>$ seq 5 | awk &#39;&quot;test&quot;&#39;
1
2
3
4
5
$ seq 5 | awk &#39;test&#39;
$ seq 5 | awk -v test=0 &#39;&quot;test&quot;&#39;
$ seq 5 | awk -v test=0 &#39;test&#39;
$ seq 5 | awk -v test=&quot;0&quot; &#39;test&#39;
$ seq 5 | awk -v test=&quot;0&quot; &#39;&quot;test&quot;&#39;
1
2
3
4
5
$ seq 5 | awk -v test=1 &#39;test&#39;
1
2
3
4
5
</code></pre></div> <p>体会下面的与非判断。</p> <div class=highlight><pre><span></span><code>$ awk &#39;1&#39; /etc/passwd |head -n3
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User for D-Bus:/run/dbus:/usr/bin/false
systemd-network:x:497:497:systemd Network Management:/:/usr/sbin/nologin
$ awk &#39;0&#39; /etc/passwd |head -n3
$ awk &#39;!1&#39; /etc/passwd |head -n3
$ awk &#39;!0&#39; /etc/passwd |head -n3
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User for D-Bus:/run/dbus:/usr/bin/false
systemd-network:x:497:497:systemd Network Management:/:/usr/sbin/nologin
</code></pre></div> <div class=highlight><pre><span></span><code># i没有赋值，为假，没有输出
$ seq 5 |awk &#39;i&#39;
# i赋值为0，为假，没有输出
$ seq 5 |awk &#39;i=0&#39;
# i赋值为1，为真，输出第一行结果，以此类推，每行都为真，输出全部seq的结果
$ seq 5 |awk &#39;i=1&#39;
1
2
3
4
5
# 第一次初始i未赋值，为假，!i则为真，赋值给i，所以i为真,输出seq第1行结果
# 第二次初始i为真，!i则为假，赋值给i，所以i为假，不输出seq第2行结果
# 第三次初始i为假，!i则为真，赋值给i，所以i为真，输出seq第3行结果
# 以此类推，输出seq结果的奇数行
$ seq 5 |awk &#39;i=!i&#39;
1
3
5
# 与上例的区别在于i初始值未真，第一次的i值为假，不输出seq第1行结果
# 第二次i的初始值为假，通过i=!i变为真，所以输出seq的第2行结果
# 以此类推，输出seq结果的偶数行
$ seq 5 |awk -v i=1 &#39;i=!i&#39;
2
4
# 输出计数行
$ seq 5 |awk -v i=0 &#39;i=!i&#39;
1
3
5
# 只输出i的值，不输出seq的值
$ seq 5 |awk &#39;{i=!i;print i}&#39;
1
0
1
0
1
$ seq 5 |awk &#39;{i=!i}&#39;
$ seq 5 |awk &#39;(i=!i)&#39;
1
3
5
$ seq 5 |awk &#39;!(i=!i)&#39;
2
4
</code></pre></div> <h3 id=_13>截取片段<a class=headerlink href=#_13 title="Permanent link"> ¶</a></h3> <p>示例：</p> <div class=highlight><pre><span></span><code>$ head -n2 /etc/passwd |awk -F &#39;:&#39; &#39;{print $0}&#39;
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User for D-Bus:/run/dbus:/usr/bin/false

$ head -n2 /etc/passwd |awk -F &#39;:&#39; &#39;{print $2}&#39;
x
x

$ head -n2 /etc/passwd |awk -F &#39;:&#39; &#39;{print $1}&#39;
root
messagebus
</code></pre></div> <div class=highlight><pre><span></span><code>$ head -n2 /etc/passwd |awk -F &#39;:&#39; &#39;{print $1&quot;#&quot;$2&quot;#&quot;$3&quot;#&quot;$4}&#39;
root#x#0#0
messagebus#x#499#499
</code></pre></div> <h3 id=_14>操作符<a class=headerlink href=#_14 title="Permanent link"> ¶</a></h3> <h4 id=_15>算数操作符<a class=headerlink href=#_15 title="Permanent link"> ¶</a></h4> <p><code>x+y</code>，<code>x-y</code>，<code>x*y</code>，<code>x/y</code>，<code>x^y</code>，<code>x%y</code>。</p> <p><code>-x</code>：转换为负数</p> <p><code>+x</code>：将字符串转换为数值</p> <p>列值之间进行算术运算。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;{$7=$3+$4;print $1,$3,$4,$7}&#39; /etc/passwd |head -n5
root 0 0 0
messagebus 499 499 998
systemd-network 497 497 994
systemd-timesync 496 496 992
nobody 65534 65534 131068
</code></pre></div> <p>计算某个列的总和。 <code>END</code>表示所有的行都已经执行。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;{(total=total+$3)}; END {print total}&#39; /etc/passwd
103011
</code></pre></div> <h4 id=_16>字符串操作符<a class=headerlink href=#_16 title="Permanent link"> ¶</a></h4> <p>没有操作符号，字符串连接。</p> <h4 id=_17>赋值操作符<a class=headerlink href=#_17 title="Permanent link"> ¶</a></h4> <p><code>=</code>，<code>+=</code>，<code>-=</code>，<code>*=</code>，<code>/=</code>，<code>%=</code>，<code>^=</code>，<code>++</code>，<code>--</code>。</p> <p>示例：</p> <div class=highlight><pre><span></span><code>$ awk &#39;BEGIN{print i}&#39;

$ awk &#39;BEGIN{print i++}&#39; #从0开始
0
$ awk &#39;BEGIN{print ++i}&#39;
1

$ awk &#39;BEGIN{print i++, i}&#39;
0 1
$ awk &#39;BEGIN{i=0;print i++, i}&#39;
0 1

$ awk &#39;BEGIN{print ++i, i}&#39;
1 1
$ awk &#39;BEGIN{i=0;print ++i, i}&#39;
1 1

$ awk &#39;BEGIN{i=0;print i, i++}&#39;
0 0
$ awk &#39;BEGIN{i=0;print i, ++i}&#39;
0 1
</code></pre></div> <div class=highlight><pre><span></span><code>$ seq 10
1
2
3
4
5
6
7
8
9
10
# n从0开始计数，输出的是n值，不是seq的输出结果
$ seq 10 |awk &#39;{print n++}&#39;
0
1
2
3
4
5
6
7
8
9
# seq=1时，初始n未赋值，为假，不输出seq结果，n++为真
# seq=2时，n为真，输出seq结果，n++为真
# 后续n++都为真，所以seq的结果出了第一行由于n为假没有输出，其他行都输出
$ seq 10 |awk &#39;n++&#39;
2
3
4
5
6
7
8
9
10
# 参考上例，n初始未赋值，但执行++n后为真，所以输出第一行，后续行都输出因为n一直为真
$ seq 10 |awk &#39;++n&#39;
1
2
3
4
5
6
7
8
9
10
</code></pre></div> <div class=highlight><pre><span></span><code># n=0时++n=1，!++n=0，输出第0行
$ awk -v n=0 &#39;!++n&#39; /etc/passwd

# n=0时n++=1，!n++=1，输出第1行
$ awk -v n=0 &#39;!n++&#39; /etc/passwd
root:x:0:0:root:/root:/bin/bash

$ awk -v n=0 &#39;!n++{print n}&#39; /etc/passwd
1
# 无结果输出
$ awk -v n=0 &#39;!++n{print n}&#39; /etc/passwd
$ awk -v n=1 &#39;!n++{print n}&#39; /etc/passwd

$ awk -v n=0 &#39;!n++&#39; /etc/passwd
root:x:0:0:root:/root:/bin/bash
# 无结果输出
$ awk -v n=1 &#39;!n++&#39; /etc/passwd
$ awk -v n=2 &#39;!n++&#39; /etc/passwd
</code></pre></div> <h4 id=_18>比较操作符<a class=headerlink href=#_18 title="Permanent link"> ¶</a></h4> <p>使用 <code>==</code> 代表等于，即精确匹配。类似还有 <code>&gt;</code>、<code>&gt;=</code>、<code>&lt;</code>、<code>&lt;=</code>、<code>!=</code>符号。</p> <p>以<code>:</code>为分隔符，匹配第三列的值为<code>1000</code>的行。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;$3==&quot;100&quot;&#39; /etc/passwd
vagrant:x:1000:478:vagrant:/home/vagrant:/bin/bash
</code></pre></div> <p>在和数字比较时，若把要比较的数字用双引号引起来，<code>awk</code>会按字符处理，不加双引号，则会按数字处理。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;$3&lt;=&quot;100&quot;&#39; /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/usr/sbin/nologin

$ awk -F &#39;:&#39; &#39;$3&lt;=100&#39; /etc/passwd
root:x:0:0:root:/root:/bin/bash
postfix:x:51:51:Postfix Daemon:/var/spool/postfix:/usr/sbin/nologin
man:x:13:62:Manual pages viewer:/var/lib/empty:/usr/sbin/nologin
daemon:x:2:2:Daemon:/sbin:/usr/sbin/nologin
at:x:25:25:Batch jobs daemon:/var/spool/atjobs:/usr/sbin/nologin
bin:x:1:1:bin:/bin:/usr/sbin/nologin
</code></pre></div> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;{if ($1==&quot;root&quot;) {print $0}}&#39; /etc/passwd
</code></pre></div> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;$7!=&quot;/bin/false&quot;&#39; /etc/passwd
$ awk -F &#39;:&#39; &#39;$3&lt;$2&#39; /etc/passwd
</code></pre></div> <h4 id=_19>逻辑操作符<a class=headerlink href=#_19 title="Permanent link"> ¶</a></h4> <p><code>&amp;&amp;</code> 表示“并且”</p> <p><code>||</code>表示“或者”</p> <p><code>!</code>表示“非”（取反）</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;$3&gt;10 &amp;&amp; $3&lt;100&#39; /etc/passwd
$ awk -F &#39;:&#39; &#39;$3&gt;10 || $3&lt;100&#39; /etc/passwd
$ awk -F &#39;:&#39; &#39;($3==0)&#39; /etc/passwd
$ awk -F &#39;:&#39; &#39;!($3==0)&#39; /etc/passwd
</code></pre></div> <p>注意下面对字符和数值进行取反操作的结果。</p> <div class=highlight><pre><span></span><code>$ awk &#39;BEGIN{print i}&#39;

$ awk &#39;BEGIN{print !i}&#39;
1
$ awk -v i=10 &#39;BEGIN{print i}&#39;
10
$ awk -v i=10 &#39;BEGIN{print !i}&#39;
0
$ awk -v i=-5 &#39;BEGIN{print i}&#39;
-5
$ awk -v i=-5 &#39;BEGIN{print !i}&#39;
0
$ awk -v i=&quot;abc&quot; &#39;BEGIN{print i}&#39;
abc
$ awk -v i=&quot;abc&quot; &#39;BEGIN{print !i}&#39;
0
$ awk -v i=abc &#39;BEGIN{print i}&#39;
abc
$ awk -v i=abc &#39;BEGIN{print !i}&#39;
0
$ awk -v i=&quot;&quot; &#39;BEGIN{print i}&#39;

$ awk -v i=&quot;&quot; &#39;BEGIN{print !i}&#39;
1
</code></pre></div> <p>在分隔符定义中使用正则表达式。</p> <div class=highlight><pre><span></span><code>$ df |awk -F&quot; +|%&quot; &#39;{print $5}&#39;
Use
0
0
2
0
8
8
8
8
8
8
8
8
8
8
8
0
$ df |awk -F&quot;[[:space:]]+|%&quot; &#39;{print $5}&#39;
Use
0
0
2
0
8
8
8
8
8
8
8
8
8
8
8
0
</code></pre></div> <h4 id=_20>三目条件表达式<a class=headerlink href=#_20 title="Permanent link"> ¶</a></h4> <p>格式：<code>selector?if-true-expression:if-false-expression</code></p> <div class=highlight><pre><span></span><code>$ awk -F&#39;:&#39; &#39;{$3&gt;1000?usertype=&quot;Common User&quot;:usertype=&quot;Superuser&quot;;printf&quot;%-20s:%12s\n&quot;, $1, usertype}&#39; /etc/passwd |head -n5
root                :   Superuser
messagebus          :   Superuser
systemd-network     :   Superuser
systemd-timesync    :   Superuser
nobody              : Common User
</code></pre></div> <h4 id=_21>模式匹配符<a class=headerlink href=#_21 title="Permanent link"> ¶</a></h4> <p><code>~</code>：左右是否匹配</p> <p><code>!~</code>：左右是否不匹配</p> <p>示例：</p> <p>匹配文件中指定字符串<code>root</code>的所有行，类似grep命令，但没有高亮显示。</p> <div class=highlight><pre><span></span><code>$ awk &#39;/root/&#39; /etc/passwd
root:x:0:0:root:/root:/bin/bash
</code></pre></div> <p>以<code>:</code>为分隔符，匹配第一列<code>$1</code>中包含指定字符串<code>oo</code>的行。<code>~</code>是代表左右匹配。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;$1 ~/oo/&#39; /etc/passwd
root:x:0:0:root:/root:/bin/bash
gentoo:x:1014:100:Gentoo Distribution:/home/gentoo:/bin/csh
</code></pre></div> <p>以<code>:</code>为分隔符，匹配所有列<code>$0</code>（整行）中包含<code>root</code>行的第一列<code>$1</code>。</p> <div class=highlight><pre><span></span><code>$ awk -F: &#39;$0 ~/root/{print $1}&#39; /etc/passwd
$ awk -F: &#39;$0 ~&quot;root&quot;{print $1}&#39; /etc/passwd
root
daemon
_cvmsroot
</code></pre></div> <p>以<code>:</code>为分隔符，匹配所有列<code>$0</code>（整行）中以<code>root</code>开头行的第一列<code>$1</code>。</p> <div class=highlight><pre><span></span><code>$ awk -F: &#39;$0 ~&quot;^root&quot;{print $1}&#39; /etc/passwd
$ awk -F: &#39;$0 ~/^root/{print $1}&#39; /etc/passwd
root
</code></pre></div> <p>以<code>:</code>为分隔符，匹配所有列<code>$0</code>（整行）中不以<code>root</code>开头行的第一列<code>$1</code>。</p> <div class=highlight><pre><span></span><code>$ awk -F: &#39;$0 !~/^root/{print $1}&#39; /etc/passwd
$ awk -F: &#39;$0 ~/^[^root]/{print $1}&#39; /etc/passwd
</code></pre></div> <p>多条件匹配，以<code>:</code>为分隔符，匹配所有含有<code>root</code>或<code>ftp</code>的行，并打印第1、3列。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;/root/ {print $1,$3} /bin/ {print $1,$3}&#39; /etc/passwd
</code></pre></div> <p>多条件匹配，以<code>:</code>为分隔符，匹配第一列中含有<code>root</code>或<code>bin</code>的行，并打印第1、3列。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;$1 ~/root/ {print $1,$3} $1 ~/bin/ {print $1,$3}&#39; /etc/passwd
root 0
bin 1
</code></pre></div> <p>以<code>:</code>为分隔符，匹配第三列<code>$3</code>中值为<code>0</code>的行。</p> <div class=highlight><pre><span></span><code>$ awk -F&quot;:&quot; &#39;$3==0&#39; /etc/passwd
root:x:0:0:root:/root:/bin/bash
</code></pre></div> <p>以至少一个空格或%为分隔符，匹配以<code>/dev/sd</code>开头的行，打印第五列。</p> <div class=highlight><pre><span></span><code>$ df |awk -F&quot;[[:space:]]+|%&quot; &#39;$0 ~ /^\/dev\/sd/{print $5}&#39;
8
8
8
8
8
8
8
8
8
8
8
</code></pre></div> <p>读取<code>ifconfig eth0</code>输出结果的第二行<code>NR==2</code>的第二列<code>$2</code>。</p> <div class=highlight><pre><span></span><code>$ ifconfig eth0 |awk &#39;NR==2{print $2}&#39;
192.168.10.210
</code></pre></div> <h3 id=_22>变量<a class=headerlink href=#_22 title="Permanent link"> ¶</a></h3> <h4 id=_23>内置变量<a class=headerlink href=#_23 title="Permanent link"> ¶</a></h4> <p><code>awk</code>常用的变量有<code>FS</code>、<code>OFS</code>、<code>NF</code> 和 <code>NR</code>。</p> <p><code>FS</code>用来定义输入字段分隔符，默认为空白字符。与<code>-F</code> 选项功能类似，同时使用会报错。</p> <p><code>OFS</code>用来定义输出字段分隔符，默认为空白字符。</p> <p><code>RS</code>指定输入时的换行符。</p> <p><code>ORS</code>指定符号在输出时替换换行符。</p> <p><code>NF</code> 表示用分隔符分隔后一共有多少列。</p> <p><code>NR</code> 表示行号。</p> <p><code>FNR</code>表示个文件分别计数各自记录的编号。</p> <p><code>FILENAME</code>表示当前文件名。</p> <p><code>ARGC</code>表示命令行参数的个数。</p> <p><code>ARVC</code>以数组形式保存命令行所给定的各参数，每个参数：<code>ARGV[0]</code>，......。</p> <p><code>FS</code>的用法：</p> <div class=highlight><pre><span></span><code>$ awk -v FS=&#39;:&#39; &#39;{print $1, FS, $3}&#39; /etc/passwd | head -n5
root : 0
messagebus : 499
systemd-network : 497

$ awk -F: &#39;{print $1FS$3}&#39; /etc/passwd | head -n3
root:0
messagebus:499
systemd-network:497
</code></pre></div> <div class=highlight><pre><span></span><code>$ S=:;awk -v FS=$S &#39;{print $1FS$3}&#39; /etc/passwd | head -n3
root:0
messagebus:499
systemd-network:497
systemd-timesync:496
nobody:65534

$ S=:;awk -F$S &#39;{print $1FS$3}&#39; /etc/passwd | head -n3
root:0
messagebus:499
systemd-network:497
</code></pre></div> <p><code>FS</code>和 <code>-F</code> 选项功同时使用会冲突，<code>-F</code>的优先级更高。</p> <div class=highlight><pre><span></span><code>$ awk -v FS=&#39;:&#39; -F&#39;;&#39; &#39;{print $1FS$3}&#39; /etc/passwd | head -n3
root:x:0:0:root:/root:/bin/bash;
messagebus:x:499:499:User for D-Bus:/run/dbus:/usr/bin/false;
systemd-network:x:497:497:systemd Network Management:/:/usr/sbin/nologin;

$ awk -v FS=&#39;;&#39; -F&#39;:&#39; &#39;{print $1FS$3}&#39; /etc/passwd | head -n3
root:0
messagebus:499
systemd-network:497
</code></pre></div> <p><code>OFS</code>的用法：</p> <p>以<code>:</code>为分隔符，打印第1、3、4列第内容，并以<code>#</code>为分隔符。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;{OFS=&quot;#&quot;} {print $1,$3,$4}&#39; /etc/passwd | head -n5
root#0#0
messagebus#499#499
systemd-network#497#497
systemd-timesync#496#496
nobody#65534#65534

$ awk -v FS=&#39;:&#39; -v OFS=&#39;#&#39; &#39;{print $1,$3,$4}&#39; /etc/passwd | head -n5
root#0#0
messagebus#499#499
systemd-network#497#497
systemd-timesync#496#496
nobody#65534#65534
</code></pre></div> <p>以<code>:</code>为分隔符，当第三列大于等于5000时，打印第1、2、3、4列第内容，并以<code>#</code>为分隔符。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;{OFS=&quot;#&quot;} {if ($3&gt;=5000) {print $1,$2,$3,$4}}&#39; /etc/passwd
nobody#x#65534#65534
</code></pre></div> <p><code>RS</code>的用法：</p> <div class=highlight><pre><span></span><code># 以空格为换行标志
$ awk -v RS=&#39; &#39; &#39;{print $0}&#39; /etc/passwd |head -n3
root:x:0:0:root:/root:/bin/bash
messagebus:x:499:499:User
for

# 以冒号为换行标志
$ awk -v RS=&#39;:&#39; &#39;{print $0}&#39; /etc/passwd |head -n3
root
x
0
</code></pre></div> <p><code>ORS</code>的用法：</p> <div class=highlight><pre><span></span><code># 以冒号为换行标志，替换成###
$ awk -v RS=&#39;:&#39; -v ORS=&#39;###&#39; &#39;{print $0}&#39; /etc/passwd |head -n3
root###x###0###0###root###/root###/bin/bash
messagebus###x###499###499###User for D-Bus###/run/dbus###/usr/bin/false
systemd-network###x###497###497###systemd Network Management###/###/usr/sbin/nologin
</code></pre></div> <p><code>NF</code> 的用法：</p> <p>其中 <code>NF</code> 是多少列，<code>$NF</code> 是最后一列的值。</p> <p>下例中以<code>:</code>为分隔符一共分为7列，最后一列的值是<code>$NF</code>。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;{print $NF}&#39; /etc/passwd | head -n2
/bin/bash
/usr/bin/false

$ awk -F &#39;:&#39; &#39;{print NF}&#39; /etc/passwd | head -n2
7
7
</code></pre></div> <div class=highlight><pre><span></span><code>$ ss -nt |grep &quot;^ESTAB&quot; |awk -F&quot;[[:space:]]+|:&quot; &#39;{print $(NF-2)}&#39;
192.168.10.103

$ ss -nt |awk -F&quot;[[:space:]]+|:&quot; &#39;/^ESTAB/{print $(NF-2)}&#39;
192.168.10.103
</code></pre></div> <p><code>NR</code> 的用法：</p> <p>通过<code>NR</code>输出行号。以<code>:</code>为分隔符，打印前三行的行号。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;{print NR}&#39; /etc/passwd |head -n3
1
2
3
</code></pre></div> <p>取奇、偶数行。</p> <div class=highlight><pre><span></span><code>$ seq 10 |awk &#39;NR%2==0&#39;
2
4
6
8
10
$ seq 10 |awk &#39;NR%2==1&#39;
1
3
5
7
9
</code></pre></div> <p>通过<code>NR</code>设定行号条件。以<code>:</code>为分隔符，打印第40行以后的行内容。</p> <div class=highlight><pre><span></span><code>$ awk &#39;NR&gt;45&#39; /etc/passwd
admin3:x:1020:100::/home/admin3:/bin/bash
smith:x:2002:0:,,,:/home/admin2:/bin/bash
pm1:x:2003:1535::/home/pm1:/bin/bash
tm1:x:2004:1535::/home/tm1:/bin/bash
tm2:x:2005:1536::/home/tm2:/bin/bash

$ awk -F &#39;:&#39; &#39;NR&gt;45&#39; /etc/passwd
admin3:x:1020:100::/home/admin3:/bin/bash
smith:x:2002:0:,,,:/home/admin2:/bin/bash
pm1:x:2003:1535::/home/pm1:/bin/bash
tm1:x:2004:1535::/home/tm1:/bin/bash
tm2:x:2005:1536::/home/tm2:/bin/bash

$ awk -F &#39;:&#39; &#39;NR&gt;45 {print NR,$1,$3}&#39; /etc/passwd
46 admin3 1020
47 smith 2002
48 pm1 2003
49 tm1 2004
50 tm2 2005

$ awk -F &#39;:&#39; &#39;BEGIN{print NR}&#39; /etc/passwd
0

$ awk -F &#39;:&#39; &#39;END{print NR}&#39; /etc/passwd
50
</code></pre></div> <div class=highlight><pre><span></span><code>$ ifconfig eth0 |awk &#39;/netmask/{print $0}&#39;
        inet 192.168.10.210  netmask 255.255.255.0  broadcast 192.168.10.255

$ ifconfig eth0 |awk &#39;/netmask/{print $1}&#39;
inet

$ ifconfig eth0 |awk &#39;/netmask/{print $2}&#39;
192.168.10.210

$ ifconfig eth0 |awk &#39;NR==2{print $0}&#39;
        inet 192.168.10.210  netmask 255.255.255.0  broadcast 192.168.10.255

$ ifconfig eth0 |awk &#39;NR==2{print $1}&#39;
inet

$ ifconfig eth0 |awk &#39;NR==2{print $2}&#39;
192.168.10.210
</code></pre></div> <p>通过<code>NR</code> 与列匹配一起使用。</p> <div class=highlight><pre><span></span><code>$ awk -F &#39;:&#39; &#39;NR&lt;5 &amp;&amp; $1 ~/roo/&#39; /etc/passwd
root:x:0:0:root:/root:/bin/bash
</code></pre></div> <p><code>FNR</code>的用法：</p> <div class=highlight><pre><span></span><code>$ awk &#39;{print FNR}&#39; /etc/fstab /etc/networks
1
2
3
4
5
6
7
8
9
10
11
12
1
2
3
4
5
6
7
8
9
10
</code></pre></div> <div class=highlight><pre><span></span><code>$ awk &#39;{print NR, $0}&#39; /etc/fstab /etc/networks
1 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /                       btrfs  defaults                      0  0
2 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /var                    btrfs  subvol=/@/var                 0  0
3 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /usr/local              btrfs  subvol=/@/usr/local           0  0
4 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /tmp                    btrfs  subvol=/@/tmp                 0  0
5 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /srv                    btrfs  subvol=/@/srv                 0  0
6 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /root                   btrfs  subvol=/@/root                0  0
7 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /opt                    btrfs  subvol=/@/opt                 0  0
8 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /home                   btrfs  subvol=/@/home                0  0
9 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /boot/grub2/x86_64-efi  btrfs  subvol=/@/boot/grub2/x86_64-efi  0  0
10 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /boot/grub2/i386-pc     btrfs  subvol=/@/boot/grub2/i386-pc  0  0
11 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /.snapshots             btrfs  subvol=/@/.snapshots          0  0
12 UUID=47c36ad7-f49f-4ecd-9b72-4801c5bb3a04  swap                    swap   defaults                      0  0
13 #
14 # networks    This file describes a number of netname-to-address
15 #        mappings for the TCP/IP subsystem.  It is mostly
16 #        used at boot time, when no name servers are running.
17 #
18
19 loopback    127.0.0.0
20 link-local    169.254.0.0
21
22 # End.

$ awk &#39;{print FNR, $0}&#39; /etc/fstab /etc/networks
1 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /                       btrfs  defaults                      0  0
2 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /var                    btrfs  subvol=/@/var                 0  0
3 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /usr/local              btrfs  subvol=/@/usr/local           0  0
4 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /tmp                    btrfs  subvol=/@/tmp                 0  0
5 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /srv                    btrfs  subvol=/@/srv                 0  0
6 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /root                   btrfs  subvol=/@/root                0  0
7 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /opt                    btrfs  subvol=/@/opt                 0  0
8 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /home                   btrfs  subvol=/@/home                0  0
9 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /boot/grub2/x86_64-efi  btrfs  subvol=/@/boot/grub2/x86_64-efi  0  0
10 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /boot/grub2/i386-pc     btrfs  subvol=/@/boot/grub2/i386-pc  0  0
11 UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /.snapshots             btrfs  subvol=/@/.snapshots          0  0
12 UUID=47c36ad7-f49f-4ecd-9b72-4801c5bb3a04  swap                    swap   defaults                      0  0
1 #
2 # networks    This file describes a number of netname-to-address
3 #        mappings for the TCP/IP subsystem.  It is mostly
4 #        used at boot time, when no name servers are running.
5 #
6
7 loopback    127.0.0.0
8 link-local    169.254.0.0
9
10 # End.
</code></pre></div> <p><code>FILENAME</code>的用法：</p> <div class=highlight><pre><span></span><code>$ awk &#39;{print FILENAME}&#39; /etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab
/etc/fstab

$ awk &#39;{print FNR, FILENAME, $0}&#39; /etc/fstab /etc/networks
1 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /                       btrfs  defaults                      0  0
2 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /var                    btrfs  subvol=/@/var                 0  0
3 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /usr/local              btrfs  subvol=/@/usr/local           0  0
4 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /tmp                    btrfs  subvol=/@/tmp                 0  0
5 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /srv                    btrfs  subvol=/@/srv                 0  0
6 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /root                   btrfs  subvol=/@/root                0  0
7 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /opt                    btrfs  subvol=/@/opt                 0  0
8 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /home                   btrfs  subvol=/@/home                0  0
9 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /boot/grub2/x86_64-efi  btrfs  subvol=/@/boot/grub2/x86_64-efi  0  0
10 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /boot/grub2/i386-pc     btrfs  subvol=/@/boot/grub2/i386-pc  0  0
11 /etc/fstab UUID=5ffa8dbd-473e-4308-804a-0033c3b5f7af  /.snapshots             btrfs  subvol=/@/.snapshots          0  0
12 /etc/fstab UUID=47c36ad7-f49f-4ecd-9b72-4801c5bb3a04  swap                    swap   defaults                      0  0
1 /etc/networks #
2 /etc/networks # networks    This file describes a number of netname-to-address
3 /etc/networks #        mappings for the TCP/IP subsystem.  It is mostly
4 /etc/networks #        used at boot time, when no name servers are running.
5 /etc/networks #
6 /etc/networks
7 /etc/networks loopback    127.0.0.0
8 /etc/networks link-local    169.254.0.0
9 /etc/networks
10 /etc/networks # End.
</code></pre></div> <p><code>ARGC</code>的用法：</p> <p>每个变量的名字通过<code>ARGV</code>获取。</p> <div class=highlight><pre><span></span><code>$ awk &#39;{print ARGC}&#39; /etc/fstab /etc/issue
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3

$ awk &#39;BEGIN{print ARGC}&#39; /etc/fstab /etc/issue
3
</code></pre></div> <p><code>ARGV</code>的用法：</p> <div class=highlight><pre><span></span><code>$ awk &#39;BEGIN{print ARGV[0]}&#39; /etc/fstab /etc/issue
awk
$ awk &#39;BEGIN{print ARGV[1]}&#39; /etc/fstab /etc/issue
/etc/fstab
$ awk &#39;BEGIN{print ARGV[2]}&#39; /etc/fstab /etc/issue
/etc/issue
$ awk &#39;BEGIN{print ARGV[3]}&#39; /etc/fstab /etc/issue
</code></pre></div> <h4 id=_24>自定义变量<a class=headerlink href=#_24 title="Permanent link"> ¶</a></h4> <p>自定义变量是区分字符大小写的，使用下面的方式进行赋值。</p> <ul> <li> <p>-v var=value</p> </li> <li> <p>在program中直接定义</p> </li> </ul> <p>举例：</p> <div class=highlight><pre><span></span><code>$ awk -v t1=t2=&quot;hello awk&quot; &#39;BEGIN{print t1, t2}&#39;
t2=hello awk
$ awk -v t1=t2=&quot;hello awk&quot; &#39;BEGIN{t1=t2=&quot;gawk&quot;; print t1, t2}&#39;
gawk gawk
$ awk &#39;BEGIN{t1=t2=&quot;hello awk&quot;; print t1, t2}&#39;
hello awk hello awk
</code></pre></div> <div class=highlight><pre><span></span><code>$ awk -v t1=&quot;hello awk&quot; &#39;{print t1}&#39; /etc/issue
hello awk
hello awk
hello awk
hello awk
hello awk
$ awk -v t1=&quot;hello awk&quot; &#39;BEGIN{print t1}&#39; /etc/issue
hello awk
$ awk -v t1=&quot;hello awk&quot; &#39;BEGIN{print t1}&#39;
hello awk
</code></pre></div> <div class=highlight><pre><span></span><code>$ awk -F: &#39;{sex=&quot;male&quot;; print $1, sex, age; age=28}&#39; /etc/passwd |head -n3
root male
messagebus male 28
systemd-network male 28
</code></pre></div> <div class=highlight><pre><span></span><code>$ cat &lt;&lt;EOF &gt; awkscript
{print script,$1,$2}
EOF

$ awk -F: -f awkscript script=&quot;awk&quot; /etc/passwd |head -n2
awk root x
awk messagebus x
</code></pre></div> <p>动作<code>printf</code>。</p> <p>动作printf可以实现格式化输出。</p> <p>格式：<code>printf "FORMAT", item1, item2, ......</code></p> <p>说明：</p> <ul> <li> <p>必须指定FORMAT</p> </li> <li> <p>不会自动换行，需要显式给出换行控制符<code>\n</code>。</p> </li> <li> <p>FORMAT中需要分别为后面每个item指定格式符。</p> </li> </ul> <p>格式符：与item是一一对应的</p> <ul> <li> <p><code>%s</code>：显示字符串</p> </li> <li> <p><code>%d</code>, <code>%i</code>：显示十进制整数</p> </li> <li> <p><code>%f</code>：显示为浮点数</p> </li> <li> <p><code>%e</code>, <code>%E</code>：显示科学计数法数值</p> </li> <li> <p><code>%c</code>：显示字符的ASCII码</p> </li> <li> <p><code>%g</code>, <code>%G</code>：以科学计数法或浮点形式显示数值</p> </li> <li> <p><code>%u</code>：无符号整数</p> </li> <li> <p><code>%%</code>：显示<code>%</code>自身</p> </li> </ul> <p>修饰符：</p> <ul> <li> <h1 id=31f>[.#]：第一个数字控制显示的宽度，第二个#表示小数点后精度，如<code>%3.1f</code><a class=headerlink href=#31f title="Permanent link"> ¶</a></h1> </li> <li> <p>-：左对齐（默认右对齐），如<code>%-15s</code></p> </li> <li> <p>+：显示数值的正负符号，如<code>%+d</code></p> </li> </ul> <p>示例：</p> <div class=highlight><pre><span></span><code>$ awk -F: &#39;{printf &quot;%s&quot;, $1}&#39; /etc/passwd |head -n3
rootmessagebussystemd-networksystemd-timesyncnobodymailchronypostfixmanlpgamesftpdaemonrpcnscdpolkitdattftpftpsecurebinstatdsshdvagrantpesignsvntester1tester2tester3tester4tester5user0user1user2user3user4user5user6user7user8user9gentoonginxvarnishmysqlwebuseradmin3smithpm1tm1tm2

$ awk -F: &#39;{printf &quot;%s\n&quot;, $1}&#39; /etc/passwd |head -n3
root
messagebus
systemd-network

$ awk -F: &#39;{printf &quot;%20s\n&quot;, $1}&#39; /etc/passwd |head -n3
                root
          messagebus
     systemd-network

$ awk -F: &#39;{printf &quot;%-20s\n&quot;, $1}&#39; /etc/passwd |head -n3
root
messagebus
systemd-network

$ awk -F: &#39;{printf &quot;%-20s %10d\n&quot;, $1, $3}&#39; /etc/passwd |head -n3
root                          0
messagebus                  499
systemd-network             497
</code></pre></div> <div class=highlight><pre><span></span><code>$ awk -F: &#39;{printf &quot;Username: %s\n&quot;, $1}&#39; /etc/passwd |head -n3
Username: root
Username: messagebus
Username: systemd-network

$ awk -F: &#39;{printf &quot;Username: %s UID:%d\n&quot;, $1, $3}&#39; /etc/passwd |head -n3
Username: root UID:0
Username: messagebus UID:499
Username: systemd-network UID:497

$ awk -F: &#39;{printf &quot;Username: %25s UID:%d\n&quot;, $1, $3}&#39; /etc/passwd |head -n3
Username:                      root UID:0
Username:                messagebus UID:499
Username:           systemd-network UID:497

$ awk -F: &#39;{printf &quot;Username: %-25s UID:%d\n&quot;, $1, $3}&#39; /etc/passwd |head -n3
Username: root                      UID:0
Username: messagebus                UID:499
Username: systemd-network           UID:497
</code></pre></div> <h3 id=_25><a class=headerlink href=#_25 title="Permanent link"> ¶</a></h3> <h2 id=_26>小练习<a class=headerlink href=#_26 title="Permanent link"> ¶</a></h2> <ul> <li>显示<code>/proc/meminfo</code>文件中以大小s开头的行，要求使用两种方法。</li> </ul> <div class=highlight><pre><span></span><code>$ cat /proc/meminfo | grep -i &quot;^s&quot;
$ cat /proc/meminfo | grep &quot;^[sS]&quot;
</code></pre></div> <ul> <li>显示<code>/etc/passwd</code>文件中不以<code>/bin/bash</code>结尾的行。</li> </ul> <div class=highlight><pre><span></span><code>$ grep -v &quot;/bin/bash$&quot; /etc/passwd
</code></pre></div> <ul> <li>显示用户<code>rpc</code>默认的shell程序。</li> </ul> <div class=highlight><pre><span></span><code>$ grep &quot;rpc&quot; /etc/passwd | cut -d &quot;:&quot; -f 7
/sbin/nologin
</code></pre></div> <ul> <li>找出<code>/etc/passwd</code>中的两位或三位数。</li> </ul> <div class=highlight><pre><span></span><code>$ grep -Eo &quot;[:digit:]{2,3}&quot; /etc/passwd
$ grep -Eo &quot;[0-9]{2,3}&quot; /etc/passwd
</code></pre></div> <p>这里用到了<code>{}</code>，属于扩展正则符号，所以要用<code>-E</code>。</p> <ul> <li>显示Rocky 9的<code>/etc/grub2.cfg</code>文件中，至少以一个空白字符开头的且后面有非空白字符的行。（注：<code>/etc/grub2.cfg</code>在openSUSE和Ubuntu中没有）</li> </ul> <div class=highlight><pre><span></span><code># 不含首字符为tab
$ sudo grep &quot;^ &quot; /etc/grub2.cfg

# 包含首字符为tab
$ sudo grep &quot;^[[:space:]]&quot; /etc/grub2.cfg
</code></pre></div> <ul> <li>找出<code>netstat -tan</code>命令结果中以<code>LISTEN</code>后跟任意多个空白字符结尾的行。</li> </ul> <div class=highlight><pre><span></span><code>$ netstat -tan | grep -E &quot;LISTEN[[:space:]]+&quot;
</code></pre></div> <ul> <li>显示Rocky 9上所有UID小于1000以内的用户名和UID。</li> </ul> <div class=highlight><pre><span></span><code>$ cat /etc/passwd | cut -d &quot;:&quot; -f 1,3 | grep -E &quot;\:[0-9]{1,3}$&quot;
$ grep -E &quot;\:[0-9]{1,3}\:[0-9]{1,}&quot; /etc/passwd | cut -d &quot;:&quot; -f 1,3
</code></pre></div> <ul> <li>在Rocky 9上显示文件<code>/etc/passwd</code>用户名和shell同名的行。</li> </ul> <div class=highlight><pre><span></span><code>$ grep -E &quot;^([[:alnum:]]+\b).*\1$&quot; /etc/passwd
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
</code></pre></div> <ul> <li>利用<code>df</code>和<code>grep</code>，取出磁盘各分区利用率,并从大到小排序。</li> </ul> <div class=highlight><pre><span></span><code>$ df | tr -s &quot; &quot; | cut -d &quot; &quot; -f 1,5 | sort -n -t &quot; &quot; -k 2
devtmpfs 0%
Filesystem Use%
tmpfs 0%
tmpfs 0%
/dev/mapper/rl-home 1%
tmpfs 2%
/dev/mapper/rl-root 5%
/dev/nvme0n1p1 23%
</code></pre></div> <ul> <li>显示三个用户<code>root</code>，<code>sync</code>，<code>bin</code>的UID和默认shell。</li> </ul> <div class=highlight><pre><span></span><code>$ grep &quot;^root:\|^sync:\|^bin:&quot; /etc/passwd | cut -d &quot;:&quot; -f 1,7
root:/bin/bash
bin:/usr/sbin/nologin
</code></pre></div> <ul> <li>使用<code>egrep</code>取出<code>/etc/default-1/text_2/local.3/grub</code>中其基名和目录名。</li> </ul> <div class=highlight><pre><span></span><code># 基名
$ echo &quot;/etc/default-1/text_2/local.3/grub&quot; | egrep -io &quot;[[:alpha:]]+$&quot;
grub

# 目录名
$  echo &quot;/etc/default-1/text_2/local.3/grub&quot; | egrep -io &quot;/([[:alpha:]]+.|_?[[:alpha:]]|[[:alnum:]]+/){7}&quot;
/etc/default-1/text_2/local.3/ 
</code></pre></div> <ul> <li>统计<code>last</code>命令中以<code>vagrant</code>登录的每个主机IP地址登录次数。</li> </ul> <div class=highlight><pre><span></span><code>$ last | grep vagrant | tr -s &quot; &quot; | cut -d &quot; &quot; -f 3 | grep -E &quot;([0-9]{1,3}\.){1,3}[0-9]{1,3}&quot; | sort -n | uniq -c
    24 192.168.10.107
    38 192.168.10.109
    17 192.168.10.201
     6 192.168.10.210
     2 192.168.10.220
</code></pre></div> <ul> <li>利用扩展正则表达式分别表示0-9、10-99、100-199、200-249、250-255。</li> </ul> <div class=highlight><pre><span></span><code>[0-9]|[0-9]{2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]
</code></pre></div> <ul> <li>显示<code>ifconfig</code>命令结果中所有IPv4地址。</li> </ul> <div class=highlight><pre><span></span><code>$ ifconfig | grep -Eo &quot;([0-9]{1,3}\.){3}[0-9]{1,3}&quot; | grep -v &quot;^255&quot;
192.168.10.210
192.168.10.255
127.0.0.1
</code></pre></div> <ul> <li>显示<code>ip addr</code>命令结果中所有IPv4地址。</li> </ul> <div class=highlight><pre><span></span><code>$ ip addr show eth0 | grep inet | grep eth0 | tr -s &quot; &quot; | cut -d &quot; &quot; -f 3 | cut -d &quot;/&quot; -f 1
192.168.10.210

$ ip addr show | grep -Eo &quot;([0-9]{1,3}\.){3}[0-9]{1,3}&quot; | grep -v &quot;^255&quot;
127.0.0.1
192.168.10.210
192.168.10.255
</code></pre></div> <ul> <li>将此字符串Welcome to the linux world中的每个字符去重并排序，重复次数多的排到前面。</li> </ul> <div class=highlight><pre><span></span><code>$ echo &quot;Welcome to the linux world&quot; | grep -o [[:alpha:]] | sort | uniq -c | sort -nr
     3 o
     3 l
     3 e
     2 t
     1 x
     1 W
     1 w
     1 u
     1 r
     1 n
     1 m
     1 i
     1 h
     1 d
     1 c
</code></pre></div> <ul> <li>删除<code>/etc/default/grub</code>文件中所有以空白开头的行行首的空白字符。</li> </ul> <div class=highlight><pre><span></span><code>$ sed &#39;/^$/d&#39; /etc/default/grub
</code></pre></div> <ul> <li>删除<code>/etc/default/grub</code>文件中所有以<code>#</code>开头，后面至少跟一个空白字符的行的行首的<code>#</code>和空白字符。</li> </ul> <div class=highlight><pre><span></span><code>$ sed -r &#39;/#[[:space:]]+/d;/#/d&#39; /etc/default/grub
</code></pre></div> <p>上面输出结果中包含空白行。</p> <p>若输出中删除空白行，则：</p> <div class=highlight><pre><span></span><code>$ sed -r &#39;/#[[:space:]]+/d;/#/d;/^$/d&#39; /etc/default/grub
</code></pre></div> <ul> <li>在<code>/etc/fstab</code>每一行行首增加<code>#</code>号。</li> </ul> <div class=highlight><pre><span></span><code>$ sed -r &#39;s/(.*)/#&amp;/&#39; /etc/fstab
</code></pre></div> <ul> <li>在<code>/etc/fstab</code>文件中不以<code>#</code>开头的行的行首增加<code>#</code>号（包括空行）。</li> </ul> <div class=highlight><pre><span></span><code>$ sed -r &#39;s/^[^#].*/#&amp;/&#39; -r &#39;s/^$/#/&#39; /etc/default/grub
</code></pre></div> <ul> <li>通过命令<code>rpm -qa --last |awk -F ' ' '{print $1}'</code>得到最新安装的包列表。统计所有<code>x86_64</code>结尾的安装包名以<code>.</code>分隔倒数第二个字段的重复次数。</li> </ul> <div class=highlight><pre><span></span><code>$ rpm -qa --last |awk -F &#39; &#39; &#39;{print $1}&#39; |sed -nr &#39;/x86_64$/s@.*\.(.*)\.x86_64@\1@p&#39; |sort -r |uniq -c
     75 el9_0
    563 el9
      3 7
      1 5
      2 4
      2 3
     10 2
     29 1
</code></pre></div> <ul> <li>在openSUSE中统计<code>/etc/rc.status</code>文件中每个单词的出现次数，并排序（用grep和sed两种方法分别实现）。</li> </ul> <div class=highlight><pre><span></span><code>$ grep -Eo &quot;[a-zA-Z]+&quot; /etc/rc.status |sort |uniq -c

$ cat /etc/rc.status |sed -r &#39;s/[^[:alpha:]]+/\n/g&#39; |sed &#39;/^$/d&#39; |sort |uniq -c |sort -nr
</code></pre></div> <ul> <li>将文本文件的n和n+1行合并为一行，n为奇数行。</li> </ul> <div class=highlight><pre><span></span><code>$ cat &lt;&lt;EOF &gt; sed.txt
1aa
2bb
3cc
4dd
5ee
6ff
7gg
EOF

$ sed -n &#39;N;s/\n//p&#39; sed.txt
1aa2bb
3cc4dd
5ee6ff

$ sed &#39;N;s/\n//&#39; sed.txt
1aa2bb
3cc4dd
5ee6ff
7gg
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../04-TextTools/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Text Tools" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Text Tools </div> </div> </a> <a href=../06-FileLookup/ class="md-footer__link md-footer__link--next" aria-label="Next: File Lookup" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> File Lookup </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.top"], "search": "../../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.2ab50757.min.js></script> </body> </html>