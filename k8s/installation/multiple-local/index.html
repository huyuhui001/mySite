<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://huyuhui001.github.io/mySite/k8s/installation/multiple-local/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-7.3.6"><title>Multiple Nodes Installation - MEMO</title><link rel=stylesheet href=../../../assets/stylesheets/main.a57b2b03.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.3f5d1f46.min.css><meta name=theme-color content=#009485><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../extra.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=teal data-md-color-accent=green> <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#multiple-nodes-installation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=MEMO class="md-header__button md-logo" aria-label=MEMO data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MEMO </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Multiple Nodes Installation </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Welcome </a> </li> <li class=md-tabs__item> <a href=../single-local/ class="md-tabs__link md-tabs__link--active"> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../linux/Administration/01/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../python/Foundation/ch00/ class=md-tabs__link> Python </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=MEMO class="md-nav__button md-logo" aria-label=MEMO data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> MEMO </label> <div class=md-nav__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Welcome <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Welcome data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Welcome </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Content </a> </li> <li class=md-nav__item> <a href=../../../about/ class=md-nav__link> About </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1 type=checkbox id=__nav_2_1 checked> <label class=md-nav__link for=__nav_2_1> Installation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Installation data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../single-local/ class=md-nav__link> Single Node Installation </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Multiple Nodes Installation <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Multiple Nodes Installation </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#local-vm-setting class=md-nav__link> Local VM setting </a> </li> <li class=md-nav__item> <a href=#ubuntu-post-installation class=md-nav__link> Ubuntu Post Installation </a> </li> <li class=md-nav__item> <a href=#install-containerd class=md-nav__link> Install Containerd </a> </li> <li class=md-nav__item> <a href=#install-nerdctl class=md-nav__link> Install nerdctl </a> </li> <li class=md-nav__item> <a href=#install-kubernetes class=md-nav__link> Install Kubernetes </a> </li> <li class=md-nav__item> <a href=#setup-master-node class=md-nav__link> Setup Master Node </a> <nav class=md-nav aria-label="Setup Master Node"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubeadm-init class=md-nav__link> kubeadm init </a> </li> <li class=md-nav__item> <a href=#kubeconfig-file class=md-nav__link> kubeconfig file </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#install-calico class=md-nav__link> Install Calico </a> </li> <li class=md-nav__item> <a href=#setup-work-nodes class=md-nav__link> Setup Work Nodes </a> </li> <li class=md-nav__item> <a href=#check-cluster-status class=md-nav__link> Check Cluster Status </a> </li> <li class=md-nav__item> <a href=#post-installation class=md-nav__link> Post Installation </a> <nav class=md-nav aria-label="Post Installation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bash-autocomplete class=md-nav__link> Bash Autocomplete </a> </li> <li class=md-nav__item> <a href=#alias class=md-nav__link> Alias </a> </li> <li class=md-nav__item> <a href=#update-default-context class=md-nav__link> Update Default Context </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#install-helm class=md-nav__link> Install Helm </a> </li> <li class=md-nav__item> <a href=#reset-cluster class=md-nav__link> Reset cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../aliyun-ubuntu/ class=md-nav__link> Installation on Aliyun ECS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundamentals/docker/ class=md-nav__link> Fundamentals </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundamentals/memo/ class=md-nav__link> Memo </a> </li> <li class=md-nav__item> <a href=../../foundamentals/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../foundamentals/basics/ class=md-nav__link> kubectl basics </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4> Core Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Core Kubernetes" data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Core Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundamentals/pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../../foundamentals/deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../../foundamentals/service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_5 type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5> Application Modelling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Application Modelling" data-md-level=2> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> Application Modelling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundamentals/namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../../foundamentals/statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../../foundamentals/daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../../foundamentals/job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../../foundamentals/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../foundamentals/secrets/ class=md-nav__link> Secrets </a> </li> <li class=md-nav__item> <a href=../../foundamentals/persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../../foundamentals/rbac/ class=md-nav__link> Role Based Access Control (RBAC) </a> </li> <li class=md-nav__item> <a href=../../foundamentals/ingress/ class=md-nav__link> Ingress </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6 type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6> Advanced Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advanced Kubernetes" data-md-level=2> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Advanced Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundamentals/scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../../foundamentals/hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../../foundamentals/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../foundamentals/networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../../foundamentals/clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_7 type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7> Operating Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Operating Kubernetes" data-md-level=2> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> Operating Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundamentals/troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../../foundamentals/healthcheck/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../foundamentals/helming/ class=md-nav__link> Helming </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_8 type=checkbox id=__nav_2_8> <label class=md-nav__link for=__nav_2_8> Case Study <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Case Study" data-md-level=2> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> Case Study </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundamentals/casestudy-operation-resources/ class=md-nav__link> Operations on Resources </a> </li> <li class=md-nav__item> <a href=../../foundamentals/casestudy-health-check/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../foundamentals/casestudy-calico/ class=md-nav__link> Calico Installation </a> </li> <li class=md-nav__item> <a href=../../foundamentals/kyma/ class=md-nav__link> Kyma </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_9 type=checkbox id=__nav_2_9> <label class=md-nav__link for=__nav_2_9> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../demo/cap_on_kyma/ class=md-nav__link> Build CAP application on Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1> SUSE Linux Administration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Linux Administration" data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> SUSE Linux Administration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/Administration/01/ class=md-nav__link> Linux File System Overview </a> </li> <li class=md-nav__item> <a href=../../../linux/Administration/02/ class=md-nav__link> Useful Commands </a> </li> <li class=md-nav__item> <a href=../../../linux/Administration/03/ class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> SUSE Enterprise Storage Foundation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Enterprise Storage Foundation" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> SUSE Enterprise Storage Foundation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/SES/linux_ses_memo/ class=md-nav__link> SUSE Enterprise Storage Foundation </a> </li> <li class=md-nav__item> <a href=../../../linux/SES/linux_ses_demo/ class=md-nav__link> SUSE Enterprise Storage Basic Operation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1 type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1> Python基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python基础 data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Python基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/Foundation/ch00/ class=md-nav__link> 安装 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch01/ class=md-nav__link> 语言基础 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch02/ class=md-nav__link> 打包Packing和拆包Unpacking </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch03/ class=md-nav__link> 函数及文件 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch04/ class=md-nav__link> 面向对象概念 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/ch05/ class=md-nav__link> 面向对象特性 </a> </li> <li class=md-nav__item> <a href=../../../python/Foundation/Algorithms/ class=md-nav__link> 数据结构和算法 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Python数据分析基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python数据分析基础 data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Python数据分析基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch01/ class=md-nav__link> NumPy基础 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch10/ class=md-nav__link> NumPy进阶 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch02/ class=md-nav__link> Pandas入门 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch03/ class=md-nav__link> 数据载入、存储及文件格式 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch04/ class=md-nav__link> 数据清洗与准备 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch05/ class=md-nav__link> 数据规整：连接、联合与重塑 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch06/ class=md-nav__link> 绘图与可视化 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch07/ class=md-nav__link> 数据聚合与分组操作 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch08/ class=md-nav__link> 时间序列 </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch09/ class=md-nav__link> 高阶pandas </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/ch11/ class=md-nav__link> Python建模库介绍 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/Demo/CourseSystem/ class=md-nav__link> 选课系统 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#local-vm-setting class=md-nav__link> Local VM setting </a> </li> <li class=md-nav__item> <a href=#ubuntu-post-installation class=md-nav__link> Ubuntu Post Installation </a> </li> <li class=md-nav__item> <a href=#install-containerd class=md-nav__link> Install Containerd </a> </li> <li class=md-nav__item> <a href=#install-nerdctl class=md-nav__link> Install nerdctl </a> </li> <li class=md-nav__item> <a href=#install-kubernetes class=md-nav__link> Install Kubernetes </a> </li> <li class=md-nav__item> <a href=#setup-master-node class=md-nav__link> Setup Master Node </a> <nav class=md-nav aria-label="Setup Master Node"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubeadm-init class=md-nav__link> kubeadm init </a> </li> <li class=md-nav__item> <a href=#kubeconfig-file class=md-nav__link> kubeconfig file </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#install-calico class=md-nav__link> Install Calico </a> </li> <li class=md-nav__item> <a href=#setup-work-nodes class=md-nav__link> Setup Work Nodes </a> </li> <li class=md-nav__item> <a href=#check-cluster-status class=md-nav__link> Check Cluster Status </a> </li> <li class=md-nav__item> <a href=#post-installation class=md-nav__link> Post Installation </a> <nav class=md-nav aria-label="Post Installation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bash-autocomplete class=md-nav__link> Bash Autocomplete </a> </li> <li class=md-nav__item> <a href=#alias class=md-nav__link> Alias </a> </li> <li class=md-nav__item> <a href=#update-default-context class=md-nav__link> Update Default Context </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#install-helm class=md-nav__link> Install Helm </a> </li> <li class=md-nav__item> <a href=#reset-cluster class=md-nav__link> Reset cluster </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/huyuhui001/mySite/edit/main/docs/k8s/installation/multiple-local.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=multiple-nodes-installation>Multiple Nodes Installation<a class=headerlink href=#multiple-nodes-installation title="Permanent link"> ¶</a></h1> <h2 id=local-vm-setting>Local VM setting<a class=headerlink href=#local-vm-setting title="Permanent link"> ¶</a></h2> <p>VMWare Setting.</p> <ul> <li>VMnet1: host-only, subnet: 192.168.150.0/24</li> <li>VMnet8: NAT, subnet: 11.0.1.0/24</li> </ul> <p>Create guest machine with VMWare Player.</p> <ul> <li>4 GB RAM</li> <li>1 CPUs with 2 Cores</li> <li>Ubuntu Server 22.04</li> <li>NAT</li> </ul> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Kubernetes running on Containerd.</p> </div> <h2 id=ubuntu-post-installation>Ubuntu Post Installation<a class=headerlink href=#ubuntu-post-installation title="Permanent link"> ¶</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Log onto each VM with the account created during Ubuntu installation, and perform below tasks on every VM. </p> </div> <p>Create user <code>vagrant</code> on all guests. <div class=highlight><pre><span></span><code><span class=go>sudo adduser vagrant</span>
<span class=go>sudo usermod -aG adm,sudo,syslog,cdrom,dip,plugdev,lxd,root vagrant</span>
<span class=go>sudo passwd vagrant</span>
</code></pre></div></p> <p>Set password for <code>root</code> on all guests. <div class=highlight><pre><span></span><code><span class=go>sudo passwd root</span>
</code></pre></div></p> <p>Enable root ssh logon. <div class=highlight><pre><span></span><code><span class=go>sudo vi /etc/ssh/sshd_config</span>
</code></pre></div></p> <p>Update parameter <code>PermitRootLogin</code> from <code>prohibit-password</code> to <code>yes</code>. <div class=highlight><pre><span></span><code>PermitRootLogin yes
#PermitRootLogin prohibit-password
</code></pre></div></p> <p>Restart the sshd service. <div class=highlight><pre><span></span><code><span class=go>sudo systemctl restart sshd</span>
</code></pre></div></p> <p>Change host name, e.g., <code>ubu1</code>. <div class=highlight><pre><span></span><code><span class=go>sudo hostnamectl set-hostname ubu1</span>
<span class=go>sudo hostnamectl set-hostname ubu1 --pretty</span>
</code></pre></div></p> <p>Verify if the hostname is set to expected name, e.g., <code>ubu1</code>. <div class=highlight><pre><span></span><code><span class=go>cat /etc/machine-info</span>
</code></pre></div></p> <p>Verify if the hostname is set to expected name, e.g., <code>ubu1</code>. <div class=highlight><pre><span></span><code><span class=go>cat /etc/hostname</span>
</code></pre></div></p> <p>Verify if the hostname of <code>127.0.1.1</code> is set to expected name, e.g., <code>ubu1</code>. And add all nodes into the file <code>/etc/hosts</code>. <div class=highlight><pre><span></span><code><span class=go>sudo vi /etc/hosts</span>
</code></pre></div> Related setting looks like below. <div class=highlight><pre><span></span><code>127.0.1.1 ubu1
11.0.1.129 ubu1
11.0.1.130 ubu2
11.0.1.131 ubu3
11.0.1.132 ubu4
</code></pre></div></p> <p>Create file <code>/etc/netplan/00-installer-config.yaml</code>. <div class=highlight><pre><span></span><code><span class=go>sudo vi /etc/netplan/00-installer-config.yaml</span>
</code></pre></div></p> <p>Update it with information below to set VM with fixed IP with actual IP address, e.g, <code>11.0.1.129</code>. <div class=highlight><pre><span></span><code>network:
  ethernets:
    ens33:
      dhcp4: false
      addresses:
      - 11.0.1.129/24
      nameservers:
        addresses:
        - 11.0.1.2
      routes:
      - to: default
        via: 11.0.1.2
  version: 2
</code></pre></div></p> <p>Effect above change. <div class=highlight><pre><span></span><code><span class=go>sudo netplan apply</span>
</code></pre></div></p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>The current ssh connection will be broken due to network setting change.</p> </div> <p>Disable swap and firewall on all nodes. <div class=highlight><pre><span></span><code><span class=go>sudo swapoff -a</span>
<span class=go>sudo ufw disable</span>
<span class=go>sudo ufw status verbose</span>
</code></pre></div> And comment the last line of swap setting in file <code>/etc/fstab</code>. Need <em>reboot</em> guest here. <div class=highlight><pre><span></span><code><span class=go>sudo vi /etc/fstab</span>
</code></pre></div> Result likes below. <div class=highlight><pre><span></span><code>/dev/disk/by-uuid/df370d2a-83e5-4895-8c7f-633f2545e3fe / ext4 defaults 0 1
# /swap.img     none    swap    sw      0       0
</code></pre></div></p> <p>Setup timezone on all nodes <div class=highlight><pre><span></span><code><span class=go>sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>

<span class=go>sudo cp /etc/profile /etc/profile.bak</span>
<span class=go>echo &#39;LANG=&quot;en_US.UTF-8&quot;&#39; | sudo tee -a /etc/profile</span>

<span class=go>source /etc/profile</span>
</code></pre></div></p> <p>Something like this after execute command <code>ll /etc/localtime</code> <div class=highlight><pre><span></span><code>lrwxrwxrwx 1 root root 33 Jul 15 22:00 /etc/localtime -&gt; /usr/share/zoneinfo/Asia/Shanghai
</code></pre></div></p> <p>Kernel setting. <div class=highlight><pre><span></span><code><span class=go>cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf</span>
<span class=go>overlay</span>
<span class=go>br_netfilter</span>
<span class=go>EOF</span>
</code></pre></div></p> <p>Load to kernel. <div class=highlight><pre><span></span><code><span class=go>sudo modprobe overlay</span>
<span class=go>sudo modprobe br_netfilter</span>
</code></pre></div></p> <p>Network setting. <div class=highlight><pre><span></span><code><span class=go>cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span>
<span class=go>net.bridge.bridge-nf-call-iptables  = 1</span>
<span class=go>net.ipv4.ip_forward                 = 1</span>
<span class=go>net.bridge.bridge-nf-call-ip6tables = 1</span>
<span class=go>EOF</span>
</code></pre></div></p> <p>Effect changes above. <div class=highlight><pre><span></span><code><span class=go>sudo sysctl --system</span>
</code></pre></div></p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>Reboot the VM.</p> </div> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>Log onto the VM with account <code>vagrant</code> to verify if above changes were updated as expected.</p> <ul> <li>IP address. <div class=highlight><pre><span></span><code><span class=go>ip addr list</span>
</code></pre></div></li> <li>Hostname. <div class=highlight><pre><span></span><code><span class=go>cat /etc/machine-info</span>
<span class=go>cat /etc/hostname</span>
<span class=go>hostname</span>
</code></pre></div></li> <li>Firewall. <div class=highlight><pre><span></span><code><span class=go>sudo ufw status verbose</span>
</code></pre></div></li> <li>Kernel setting. <div class=highlight><pre><span></span><code><span class=go>lsmod | grep -i overlay</span>
<span class=go>lsmod | grep -i br_netfilter</span>
</code></pre></div></li> <li>Network setting. <div class=highlight><pre><span></span><code><span class=go>sudo sysctl -a | grep -i net.bridge.bridge-nf-call-ip*</span>
<span class=go>sudo sysctl -a | grep -i net.ipv4.ip_forward</span>
</code></pre></div></li> </ul> </div> <h2 id=install-containerd>Install Containerd<a class=headerlink href=#install-containerd title="Permanent link"> ¶</a></h2> <p>Install Containerd sevice on all nodes.</p> <p>Backup source file. <div class=highlight><pre><span></span><code><span class=go>sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</span>
</code></pre></div></p> <p>Install Containered. <div class=highlight><pre><span></span><code><span class=go>sudo apt-get update &amp;&amp; sudo apt-get install -y containerd</span>
</code></pre></div></p> <p>Configure Containerd. Modify file <code>/etc/containerd/config.toml</code>. <div class=highlight><pre><span></span><code><span class=go>sudo mkdir -p /etc/containerd</span>
<span class=go>containerd config default | sudo tee /etc/containerd/config.toml</span>
<span class=go>sudo vi /etc/containerd/config.toml</span>
</code></pre></div></p> <p>Update <code>sandbox_image</code> with new value <code>"registry.aliyuncs.com/google_containers/pause:3.6"</code>. Update <code>SystemdCgroup</code> with new value <code>true</code>. <div class=highlight><pre><span></span><code>[plugins]
  [plugins.&quot;io.containerd.gc.v1.scheduler&quot;]

  [plugins.&quot;io.containerd.grpc.v1.cri&quot;]
    sandbox_image = &quot;registry.aliyuncs.com/google_containers/pause:3.6&quot;

    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]
    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]
      [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime]
        [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime.options]
      [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]
        [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]

          [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]
            SystemdCgroup = true
</code></pre></div></p> <p>Restart Containerd service. <div class=highlight><pre><span></span><code><span class=go>sudo systemctl restart containerd</span>
<span class=go>sudo systemctl status containerd</span>
</code></pre></div></p> <h2 id=install-nerdctl>Install nerdctl<a class=headerlink href=#install-nerdctl title="Permanent link"> ¶</a></h2> <p>Install nerdctl sevice on all nodes.</p> <p>The goal of <a href=https://github.com/containerd/nerdctl><code>nerdctl</code></a> is to facilitate experimenting the cutting-edge features of containerd that are not present in Docker.</p> <p>Binaries are available here: https://github.com/containerd/nerdctl/releases</p> <div class=highlight><pre><span></span><code><span class=go>wget https://github.com/containerd/nerdctl/releases/download/v0.22.2/nerdctl-0.22.2-linux-amd64.tar.gz</span>
<span class=go>tar -zxvf nerdctl-0.22.2-linux-amd64.tar.gz</span>
<span class=go>sudo cp nerdctl /usr/bin/</span>
</code></pre></div> <p>Verify nerdctl. <div class=highlight><pre><span></span><code><span class=go>sudo nerdctl --help</span>
</code></pre></div></p> <p>To list local Kubernetes containers. <div class=highlight><pre><span></span><code><span class=go>sudo nerdctl -n k8s.io ps</span>
</code></pre></div></p> <h2 id=install-kubernetes>Install Kubernetes<a class=headerlink href=#install-kubernetes title="Permanent link"> ¶</a></h2> <p>Install Kubernetes on all nodes.</p> <p>Install dependencied packages. <div class=highlight><pre><span></span><code><span class=go>sudo apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https ca-certificates curl</span>
</code></pre></div></p> <p>Install gpg certificate. <div class=highlight><pre><span></span><code><span class=go>sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg</span>
</code></pre></div> Add Kubernetes repo. <div class=highlight><pre><span></span><code><span class=go>echo &quot;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main&quot; | sudo tee /etc/apt/sources.list.d/kubernetes.list</span>
</code></pre></div></p> <p>Update and install dependencied packages. <div class=highlight><pre><span></span><code><span class=go>sudo apt-get update</span>
<span class=go>sudo apt-get install ebtables</span>
<span class=go>sudo apt-get install libxtables12</span>
<span class=go>sudo apt-get upgrade iptables</span>
</code></pre></div></p> <p>Check available versions of kubeadm. <div class=highlight><pre><span></span><code><span class=go>apt policy kubeadm</span>
</code></pre></div></p> <p>Install <code>1.24.1-00</code> version. <div class=highlight><pre><span></span><code><span class=go>sudo apt-get -y install kubelet=1.24.1-00 kubeadm=1.24.1-00 kubectl=1.24.1-00 --allow-downgrades</span>
</code></pre></div></p> <h2 id=setup-master-node>Setup Master Node<a class=headerlink href=#setup-master-node title="Permanent link"> ¶</a></h2> <h3 id=kubeadm-init>kubeadm init<a class=headerlink href=#kubeadm-init title="Permanent link"> ¶</a></h3> <p>Set up Control Plane on VM playing master node.</p> <p>Check kubeadm default parameters for initialization. <div class=highlight><pre><span></span><code><span class=go>kubeadm config print init-defaults</span>
</code></pre></div> Reuslt: <div class=highlight><pre><span></span><code>apiVersion: kubeadm.k8s.io/v1beta3
bootstrapTokens:
- groups:
  - system:bootstrappers:kubeadm:default-node-token
  token: abcdef.0123456789abcdef
  ttl: 24h0m0s
  usages:
  - signing
  - authentication
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: 1.2.3.4
  bindPort: 6443
nodeRegistration:
  criSocket: unix:///var/run/containerd/containerd.sock
  imagePullPolicy: IfNotPresent
  name: node
  taints: null
---
apiServer:
  timeoutForControlPlane: 4m0s
apiVersion: kubeadm.k8s.io/v1beta3
certificatesDir: /etc/kubernetes/pki
clusterName: kubernetes
controllerManager: {}
dns: {}
etcd:
  local:
    dataDir: /var/lib/etcd
imageRepository: k8s.gcr.io
kind: ClusterConfiguration
kubernetesVersion: 1.24.0
networking:
  dnsDomain: cluster.local
  serviceSubnet: 10.96.0.0/12
scheduler: {}
</code></pre></div></p> <p>Dry rune and run. Save the output, which will be used later on work nodes.</p> <p>With <code>kubeadm init</code> to initiate cluster, we need understand below three options about network.</p> <ul> <li><code>--pod-network-cidr</code>: <ul> <li>Specify range of IP addresses for the pod network. If set, the control plane will automatically allocate CIDRs for every node.</li> <li>Be noted that <code>10.244.0.0/16</code> is default range of flannel. If it's changed here, please do change the same when deploy <code>Flannel</code>.</li> </ul> </li> <li><code>--apiserver-bind-port</code>: <ul> <li>Port for the API Server to bind to. (default 6443)</li> </ul> </li> <li><code>--service-cidr</code>: <ul> <li>Use alternative range of IP address for service VIPs. (default "10.96.0.0/12")</li> </ul> </li> </ul> <p>Note: </p> <ul> <li>service VIPs (a.k.a. Cluster IP), specified by option <code>--service-cidr</code>.</li> <li>podCIDR (a.k.a. endpoint IP)，specified by option <code>--pod-network-cidr</code>.</li> </ul> <p>There are 4 distinct networking problems to address:</p> <ul> <li>Highly-coupled container-to-container communications: this is solved by Pods (podCIDR) and localhost communications.</li> <li>Pod-to-Pod communications: <ul> <li>a.k.a. container-to-container. </li> <li>Example with Flannel, the flow is: Pod &rarr; veth pair &rarr; cni0 &rarr; flannel.1 &rarr; host eth0 &rarr; host eth0 &rarr; flannel.1 &rarr; cni0 &rarr; veth pair &rarr; Pod.</li> </ul> </li> <li>Pod-to-Service communications:<ul> <li>Flow: Pod &rarr; Kernel &rarr; Servive iptables &rarr; service &rarr; Pod iptables &rarr; Pod</li> </ul> </li> <li>External-to-Service communications: <ul> <li>LoadBalancer: SLB &rarr; NodePort &rarr; Service &rarr; Pod</li> </ul> </li> </ul> <p><code>kube-proxy</code> is responsible for iptables, not traffic. </p> <div class=highlight><pre><span></span><code><span class=go>sudo kubeadm init \</span>
<span class=go>  --dry-run \</span>
<span class=go>  --pod-network-cidr=10.244.0.0/16 \</span>
<span class=go>  --service-cidr=192.244.0.0/16 \</span>
<span class=go>  --image-repository=registry.aliyuncs.com/google_containers \</span>
<span class=go>  --kubernetes-version=v1.24.1</span>

<span class=go>sudo kubeadm init \</span>
<span class=go>  --pod-network-cidr=10.244.0.0/16 \</span>
<span class=go>  --service-cidr=192.244.0.0/16 \</span>
<span class=go>  --image-repository=registry.aliyuncs.com/google_containers \</span>
<span class=go>  --kubernetes-version=v1.24.1</span>
</code></pre></div> <h3 id=kubeconfig-file>kubeconfig file<a class=headerlink href=#kubeconfig-file title="Permanent link"> ¶</a></h3> <p>Set <code>kubeconfig</code> file for current user (here it's <code>vagrant</code>). <div class=highlight><pre><span></span><code><span class=go>mkdir -p $HOME/.kube</span>
<span class=go>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span>
<span class=go>sudo chown $(id -u):$(id -g) $HOME/.kube/config</span>
</code></pre></div></p> <p>Kubernetes provides a command line tool <code>kubectl</code> for communicating with a Kubernetes cluster's control plane, using the Kubernetes API.</p> <p>kubectl controls the Kubernetes <em>cluster manager</em>.</p> <p>For configuration, kubectl looks for a file named config in the <code>$HOME/.kube</code> directory, which is a copy of file <code>/etc/kubernetes/admin.conf</code> generated by <code>kubeadm init</code>. </p> <p>We can specify other kubeconfig files by setting the <code>KUBECONFIG</code> environment variable or by setting the <code>--kubeconfig flag</code>. If the <code>KUBECONFIG</code> environment variable doesn't exist, kubectl uses the default kubeconfig file, <code>$HOME/.kube/config</code>.</p> <p>A <em>context</em> element in a kubeconfig file is used to group access parameters under a convenient name. Each context has three parameters: cluster, namespace, and user. By default, the kubectl command-line tool uses parameters from the current context to communicate with the cluster.</p> <p>A sample of <code>.kube/config</code>. <div class=highlight><pre><span></span><code>apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: &lt;certificate string&gt;
    server: https://&lt;eth0 ip&gt;:6443
  name: &lt;cluster name&gt;
contexts:
- context:
    cluster: &lt;cluster name&gt;
    namespace: &lt;namespace name&gt;
    user: &lt;user name&gt;
  name: &lt;context user&gt;@&lt;context name&gt;
current-context: &lt;context name&gt;
kind: Config
preferences: {}
users:
- name: &lt;user name&gt;
  user:
    client-certificate-data: &lt;certificate string&gt;
    client-key-data: &lt;certificate string&gt;
</code></pre></div></p> <p>To get the current context: <div class=highlight><pre><span></span><code><span class=go>kubectl config get-contexts</span>
</code></pre></div> Result <div class=highlight><pre><span></span><code>CURRENT   NAME                          CLUSTER      AUTHINFO           NAMESPACE
*         kubernetes-admin@kubernetes   kubernetes   kubernetes-admin   
</code></pre></div></p> <h2 id=install-calico>Install Calico<a class=headerlink href=#install-calico title="Permanent link"> ¶</a></h2> <p>Here is guidance of <a href=https://projectcalico.docs.tigera.io/getting-started/kubernetes/hardway/ >End-to-end Calico installation</a>. Detail practice demo, can be found in section "Install Calico" of "A1.Discussion" below. </p> <p>Install Calico <div class=highlight><pre><span></span><code><span class=go>curl https://docs.projectcalico.org/manifests/calico.yaml -O</span>
<span class=go>kubectl apply -f calico.yaml</span>
</code></pre></div> Result <div class=highlight><pre><span></span><code>configmap/calico-config created
customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/caliconodestatuses.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipreservations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/kubecontrollersconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created
clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrole.rbac.authorization.k8s.io/calico-node created
clusterrolebinding.rbac.authorization.k8s.io/calico-node created
daemonset.apps/calico-node created
serviceaccount/calico-node created
deployment.apps/calico-kube-controllers created
serviceaccount/calico-kube-controllers created
poddisruptionbudget.policy/calico-kube-controllers created
</code></pre></div></p> <p>Verify status of Calico. It may take minutes to complete initialization. <div class=highlight><pre><span></span><code><span class=go>kubectl get pod -n kube-system | grep calico</span>
</code></pre></div> Result <div class=highlight><pre><span></span><code>calico-kube-controllers-555bc4b957-l8bn2   0/1     Pending    0          28s
calico-node-255pc                          0/1     Init:1/3   0          29s
calico-node-7tmnb                          0/1     Init:1/3   0          29s
calico-node-w8nvl                          0/1     Init:1/3   0          29s
</code></pre></div></p> <p>Verify network status. <div class=highlight><pre><span></span><code><span class=go>sudo nerdctl network ls</span>
</code></pre></div> Result <div class=highlight><pre><span></span><code>NETWORK ID      NAME               FILE
                k8s-pod-network    /etc/cni/net.d/10-calico.conflist
17f29b073143    bridge             /etc/cni/net.d/nerdctl-bridge.conflist
                host               
                none 
</code></pre></div></p> <h2 id=setup-work-nodes>Setup Work Nodes<a class=headerlink href=#setup-work-nodes title="Permanent link"> ¶</a></h2> <p>Use <code>kubeadm token</code> to generate the join token and hash value. <div class=highlight><pre><span></span><code><span class=go>kubeadm token create --print-join-command</span>
</code></pre></div></p> <p>Command usage: <div class=highlight><pre><span></span><code><span class=go>sudo kubeadm join &lt;your master node eth0 ip&gt;:6443 --token &lt;token generated by kubeadm init&gt; --discovery-token-ca-cert-hash &lt;hash key generated by kubeadm init&gt;</span>
</code></pre></div></p> <p>Result looks like below. <div class=highlight><pre><span></span><code>[preflight] Running pre-flight checks
        [WARNING SystemVerification]: missing optional cgroups: blkio
[preflight] Reading configuration from the cluster...
[preflight] FYI: You can look at this config file with &#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Starting the kubelet
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run &#39;kubectl get nodes&#39; on the control-plane to see this node join the cluster.
</code></pre></div></p> <h2 id=check-cluster-status>Check Cluster Status<a class=headerlink href=#check-cluster-status title="Permanent link"> ¶</a></h2> <p>Cluster info: <div class=highlight><pre><span></span><code><span class=go>kubectl cluster-info</span>
</code></pre></div> Output <div class=highlight><pre><span></span><code>Kubernetes control plane is running at https://11.0.1.129:6443
CoreDNS is running at https://11.0.1.129:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
To further debug and diagnose cluster problems, use &#39;kubectl cluster-info dump&#39;.
</code></pre></div></p> <p>Node info: <div class=highlight><pre><span></span><code>kubectl get nodes -owide
</code></pre></div></p> <p>Pod info: <div class=highlight><pre><span></span><code>kubectl get pod -A
</code></pre></div></p> <h2 id=post-installation>Post Installation<a class=headerlink href=#post-installation title="Permanent link"> ¶</a></h2> <h3 id=bash-autocomplete>Bash Autocomplete<a class=headerlink href=#bash-autocomplete title="Permanent link"> ¶</a></h3> <p>On each node.</p> <p>Set <code>kubectl</code> <a href=https://github.com/scop/bash-completion>auto-completion</a> following the <a href=https://kubernetes.io/docs/tasks/tools/included/optional-kubectl-configs-bash-linux/ >guideline</a>. <div class=highlight><pre><span></span><code>apt install -y bash-completion

source /usr/share/bash-completion/bash_completion
source &lt;(kubectl completion bash)

echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre></div></p> <h3 id=alias>Alias<a class=headerlink href=#alias title="Permanent link"> ¶</a></h3> <p>If we set an alias for kubectl, we can extend shell completion to work with that alias: <div class=highlight><pre><span></span><code>echo &#39;alias k=kubectl&#39; &gt;&gt;~/.bashrc
echo &#39;complete -o default -F __start_kubectl k&#39; &gt;&gt;~/.bashrc
</code></pre></div></p> <h3 id=update-default-context>Update Default Context<a class=headerlink href=#update-default-context title="Permanent link"> ¶</a></h3> <p>Get current context. <div class=highlight><pre><span></span><code><span class=go>kubectl config get-contexts </span>
</code></pre></div></p> <p>In below result, we know:</p> <ul> <li>Contenxt name is <code>kubernetes-admin@kubernetes</code>.</li> <li>Cluster name is <code>kubernetes</code>.</li> <li>User is <code>kubernetes-admin</code>.</li> <li>No namespace explicitly defined.</li> </ul> <div class=highlight><pre><span></span><code>CURRENT   NAME                          CLUSTER      AUTHINFO           NAMESPACE
*         kubernetes-admin@kubernetes   kubernetes   kubernetes-admin 
</code></pre></div> <p>To set a context with new update, e.g, update default namespace, etc.. <div class=highlight><pre><span></span><code><span class=gp># </span>Usage:
<span class=go>kubectl config set-context &lt;context name&gt; --cluster=&lt;cluster name&gt; --namespace=&lt;namespace name&gt; --user=&lt;user name&gt; </span>

<span class=gp># </span>Set default namespace
<span class=go>kubectl config set-context kubernetes-admin@kubernetes --cluster=kubernetes --namespace=default --user=kubernetes-admin</span>
</code></pre></div></p> <p>To switch to a new context. <div class=highlight><pre><span></span><code><span class=go>kubectl config use-context &lt;context name&gt;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=go>kubectl config use-context kubernetes-admin@kubernetes</span>
</code></pre></div></p> <div class="admonition reference"> <p class=admonition-title>Reference</p> <ul> <li><a href=https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/ >kubectl</a></li> <li><a href=https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands>commandline</a></li> </ul> </div> <h2 id=install-helm>Install Helm<a class=headerlink href=#install-helm title="Permanent link"> ¶</a></h2> <p>Helm is the Kubernetes package manager. It doesn't come with Kubernetes. </p> <p>Three concepts of helm:</p> <ul> <li>A <em>Chart</em> is a Helm package. <ul> <li>It contains all of the resource definitions necessary to run an application, tool, or service inside of a Kubernetes cluster. </li> <li>Think of it like the Kubernetes equivalent of a Homebrew formula, an Apt dpkg, or a Yum RPM file.</li> </ul> </li> <li>A <em>Repository</em> is the place where charts can be collected and shared. <ul> <li>It's like Perl's CPAN archive or the Fedora Package Database, but for Kubernetes packages.</li> </ul> </li> <li>A <em>Release</em> is an instance of a chart running in a Kubernetes cluster. <ul> <li>One chart can often be installed many times into the same cluster. And each time it is installed, a new release is created. </li> <li>Consider a MySQL chart. If you want two databases running in your cluster, you can install that chart twice. Each one will have its own release, which will in turn have its own release name.</li> </ul> </li> </ul> <p>Reference:</p> <ul> <li><a href=https://helm.sh/docs/intro/install/ >installation guide</a></li> <li><a href=https://github.com/helm/helm/releases>binary release</a></li> <li><a href=https://github.com/helm/helm>source code</a>.</li> </ul> <p>Helm Client Installation: <div class=highlight><pre><span></span><code><span class=go>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3</span>
<span class=go>chmod 700 get_helm.sh</span>
<span class=go>./get_helm.sh</span>
</code></pre></div> Output: <div class=highlight><pre><span></span><code>Downloading https://get.helm.sh/helm-v3.9.1-linux-amd64.tar.gz
Verifying checksum... Done.
Preparing to install helm into /usr/local/bin
helm installed into /usr/local/bin/helm
</code></pre></div></p> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li><a href=https://helm.sh/docs/helm/helm_init/ ><code>helm init</code></a> does not exist in Helm 3, following the removal of Tiller. You no longer need to install Tiller in your cluster in order to use Helm.</li> <li><code>helm search</code> can be used to search two different types of source:<ul> <li><code>helm search hub</code> searches the <a href=https://artifacthub.io/ >Artifact Hub</a>, which lists helm charts from dozens of different repositories.</li> <li><code>helm search repo</code> searches the repositories that you have added to your local helm client (with helm repo add). This search is done over local data, and no public network connection is needed.</li> </ul> </li> </ul> </div> <div class="admonition reference"> <p class=admonition-title>Reference</p> <p><a href=../../foundamentals/helming/ >Helming development</a></p> </div> <h2 id=reset-cluster>Reset cluster<a class=headerlink href=#reset-cluster title="Permanent link"> ¶</a></h2> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>Below steps will destroy current cluster. </p> </div> <p>Delete all nodes in the cluster. <div class=highlight><pre><span></span><code><span class=go>kubeadm reset</span>
</code></pre></div></p> <p>Clean up rule of <code>iptables</code>. <div class=highlight><pre><span></span><code><span class=go>iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X</span>
</code></pre></div></p> <p>Clean up rule of <code>IPVS</code> if using <code>IPVS</code>. <div class=highlight><pre><span></span><code><span class=go>ipvsadm --clear</span>
</code></pre></div></p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../single-local/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Single Node Installation" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Single Node Installation </div> </div> </a> <a href=../aliyun-ubuntu/ class="md-footer__link md-footer__link--next" aria-label="Next: Installation on Aliyun ECS" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Installation on Aliyun ECS </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.top"], "search": "../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.b1047164.min.js></script> </body> </html>