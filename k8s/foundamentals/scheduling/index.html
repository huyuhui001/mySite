<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://huyuhui001.github.io/mySite/k8s/foundamentals/scheduling/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-7.3.6"><title>Scheduling - MEMO</title><link rel=stylesheet href=../../../assets/stylesheets/main.a57b2b03.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.3f5d1f46.min.css><meta name=theme-color content=#009485><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../extra.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=teal data-md-color-accent=green> <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#scheduling class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=MEMO class="md-header__button md-logo" aria-label=MEMO data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MEMO </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Scheduling </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../linux/Administration/linux_admin/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../installation/single-local/ class="md-tabs__link md-tabs__link--active"> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../python/Foundation/python_foundation_index/ class=md-tabs__link> Python </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=MEMO class="md-nav__button md-logo" aria-label=MEMO data-md-component=logo> <img src=../../../assets/logo.jpg alt=logo> </a> MEMO </label> <div class=md-nav__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/Administration/linux_admin/ class=md-nav__link> SUSE Linux Administration </a> </li> <li class=md-nav__item> <a href=../../../linux/SES/linux_ses/ class=md-nav__link> SUSE Enterprise Storage Foundation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1 type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1> Installation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Installation data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../installation/single-local/ class=md-nav__link> Single Node Installation </a> </li> <li class=md-nav__item> <a href=../../installation/multiple-local/ class=md-nav__link> Multiple Nodes Installation </a> </li> <li class=md-nav__item> <a href=../../installation/aliyun-opensuse/ class=md-nav__link> Installation on Aliyun openSUSE </a> </li> <li class=md-nav__item> <a href=../../installation/aliyun-ubuntu/ class=md-nav__link> Installation on Aliyun Ubuntu </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2 checked> <label class=md-nav__link for=__nav_2_2> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../memo/ class=md-nav__link> Memo </a> </li> <li class=md-nav__item> <a href=../docker/ class=md-nav__link> Docker Fundamentals </a> </li> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../basics/ class=md-nav__link> kubectl basics </a> </li> <li class=md-nav__item> <a href=../namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../pod/ class=md-nav__link> Work on pod </a> </li> <li class=md-nav__item> <a href=../deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../service/ class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../ingress/ class=md-nav__link> Ingress </a> </li> <li class=md-nav__item> <a href=../persistence/ class=md-nav__link> Persistence </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Scheduling <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Scheduling </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#nodeselector class=md-nav__link> nodeSelector </a> </li> <li class=md-nav__item> <a href=#nodename class=md-nav__link> nodeName </a> </li> <li class=md-nav__item> <a href=#affinity class=md-nav__link> Affinity </a> </li> <li class=md-nav__item> <a href=#taints-tolerations class=md-nav__link> Taints &amp; Tolerations </a> <nav class=md-nav aria-label="Taints & Tolerations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#concept class=md-nav__link> Concept </a> </li> <li class=md-nav__item> <a href=#set-taints class=md-nav__link> Set Taints </a> </li> <li class=md-nav__item> <a href=#set-tolerations class=md-nav__link> Set Tolerations </a> </li> <li class=md-nav__item> <a href=#remove-taints class=md-nav__link> Remove Taints </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../rbac/ class=md-nav__link> Role Based Access Control (RBAC) </a> </li> <li class=md-nav__item> <a href=../networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../clustermgt/ class=md-nav__link> Cluster Management </a> </li> <li class=md-nav__item> <a href=../helming/ class=md-nav__link> Helming </a> </li> <li class=md-nav__item> <a href=../troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../healthcheck/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../casestudy/ class=md-nav__link> Case Study </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../python/Foundation/python_foundation_index/ class=md-nav__link> Python Foundamentals </a> </li> <li class=md-nav__item> <a href=../../../python/DataAnalysis/python_data_analysis_index/ class=md-nav__link> Data Analysis </a> </li> <li class=md-nav__item> <a href=../../../python/Demo/python_demo_index/ class=md-nav__link> Demos </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#nodeselector class=md-nav__link> nodeSelector </a> </li> <li class=md-nav__item> <a href=#nodename class=md-nav__link> nodeName </a> </li> <li class=md-nav__item> <a href=#affinity class=md-nav__link> Affinity </a> </li> <li class=md-nav__item> <a href=#taints-tolerations class=md-nav__link> Taints &amp; Tolerations </a> <nav class=md-nav aria-label="Taints & Tolerations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#concept class=md-nav__link> Concept </a> </li> <li class=md-nav__item> <a href=#set-taints class=md-nav__link> Set Taints </a> </li> <li class=md-nav__item> <a href=#set-tolerations class=md-nav__link> Set Tolerations </a> </li> <li class=md-nav__item> <a href=#remove-taints class=md-nav__link> Remove Taints </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/huyuhui001/mySite/edit/main/docs/k8s/foundamentals/scheduling.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=scheduling>Scheduling<a class=headerlink href=#scheduling title="Permanent link"> ¶</a></h1> <div class="admonition scenario"> <p class=admonition-title>Scenario</p> <ul> <li>Configure nodeSelector for Pod.</li> <li>Configure nodeName for Node.</li> <li> <p>Use <code>podAffinity</code> to group Pods.</p> </li> <li> <p>Taints &amp; Tolerations</p> <ul> <li>Set Taints</li> <li>Set Tolerations</li> <li>Remove Taints</li> </ul> </li> </ul> </div> <h2 id=nodeselector>nodeSelector<a class=headerlink href=#nodeselector title="Permanent link"> ¶</a></h2> <p>Let's assume the scenario below.</p> <ul> <li>We have a group of high performance servers.</li> <li>Some applications require high performance computing.</li> <li>These applicaiton need to be scheduled and running on those high performance servers.</li> </ul> <p>We can leverage Kubernetes attributes node <code>label</code> and <code>nodeSelector</code> to group resources as a whole for scheduling to meet above requirement.</p> <ol> <li>Label Node</li> </ol> <p>Let's label <code>cka002</code> with <code>Configuration=hight</code>. <div class=highlight><pre><span></span><code><span class=go>kubectl label node cka002 configuration=hight</span>
</code></pre></div></p> <p>Verify. We wil see the label <code>configuration=hight</code> on <code>cka002</code>. <div class=highlight><pre><span></span><code><span class=go>kubectl get node --show-labels</span>
</code></pre></div></p> <ol> <li>Configure nodeSelector for Pod</li> </ol> <p>Create a Pod and use <code>nodeSelector</code> to schedule the Pod running on specified node. <div class=highlight><pre><span></span><code><span class=go>kubectl apply -f - &lt;&lt;EOF</span>
<span class=go>apiVersion: apps/v1</span>
<span class=go>kind: Deployment</span>
<span class=go>metadata:</span>
<span class=go> name: mysql-nodeselector</span>
<span class=go>spec:</span>
<span class=go> selector:</span>
<span class=go>   matchLabels:</span>
<span class=go>     app: mysql</span>
<span class=go> template:</span>
<span class=go>   metadata:</span>
<span class=go>     labels:</span>
<span class=go>       app: mysql</span>
<span class=go>   spec:</span>
<span class=go>     containers:</span>
<span class=go>     - image: mysql:8.0</span>
<span class=go>       name: mysql</span>
<span class=go>       env:</span>
<span class=go>       - name: MYSQL_ROOT_PASSWORD</span>
<span class=go>         value: password</span>
<span class=go>       ports:</span>
<span class=go>       - containerPort: 3306</span>
<span class=go>         name: mysql</span>
<span class=go>     nodeSelector:</span>
<span class=go>       configuration: hight</span>
<span class=go>EOF</span>
</code></pre></div></p> <p>Let's check with node the Pod <code>mysql-nodeselector</code> is running. <div class=highlight><pre><span></span><code><span class=go>kubectl get pod -l app=mysql -o wide |  grep mysql-nodeselector</span>
</code></pre></div></p> <p>With below result, Pod <code>mysql-nodeselector</code> is running on <code>cka002</code> node. <div class=highlight><pre><span></span><code>NAME                                  READY   STATUS    RESTARTS   AGE     IP             NODE     NOMINATED NODE   READINESS GATES
mysql-nodeselector-6b7d9c875d-vs8mk   1/1     Running   0          7s     10.244.112.29   cka002   &lt;none&gt;           &lt;none&gt;
</code></pre></div></p> <h2 id=nodename>nodeName<a class=headerlink href=#nodename title="Permanent link"> ¶</a></h2> <p>Be noted, <code>nodeName</code> has hightest priority as it's not scheduled by <code>Scheduler</code>.</p> <p>Create a Pod <code>nginx-nodename</code> with <code>nodeName=cka003</code>. <div class=highlight><pre><span></span><code><span class=go>kubectl apply -f - &lt;&lt;EOF</span>
<span class=go>apiVersion: v1</span>
<span class=go>kind: Pod</span>
<span class=go>metadata:</span>
<span class=go>  name: nginx-nodename</span>
<span class=go>spec:</span>
<span class=go>  containers:</span>
<span class=go>  - name: nginx</span>
<span class=go>    image: nginx</span>
<span class=go>  nodeName: cka003</span>
<span class=go>EOF</span>
</code></pre></div></p> <p>Verify if Pod <code>nginx-nodename</code> is running on `ckc003 node. <div class=highlight><pre><span></span><code><span class=go>kubectl get pod -owide |grep nginx-nodename</span>
</code></pre></div> Result <div class=highlight><pre><span></span><code>NAME                                      READY   STATUS    RESTARTS   AGE     IP             NODE     NOMINATED NODE   READINESS GATES
nginx-nodename                            1/1     Running   0          8s     10.244.102.29   cka003   &lt;none&gt;           &lt;none&gt;
</code></pre></div></p> <h2 id=affinity>Affinity<a class=headerlink href=#affinity title="Permanent link"> ¶</a></h2> <p>In Kubernetes cluster, some Pods have frequent interaction with other Pods. With that situation, it's suggested to schedule these Pods running on same node. For example, Two Pods Nginx and Mysql, we need deploy them on one node if they frequently communicate.</p> <p>We can use <code>podAffinity</code> to select Pods based on their relationship. </p> <p>There are two scheduling type of <code>podAffinity</code>.</p> <ul> <li><code>requiredDuringSchedulingIgnoredDuringExecution</code>(硬亲和)</li> <li><code>preferredDuringSchedulingIgnoredDuringExecution</code>(软亲和)</li> </ul> <p><code>topologyKey</code> could be set by below types:</p> <ul> <li><code>kubernetes.io/hostname</code> ＃NodeName</li> <li><code>failure-domain.beta.kubernetes.io/zone</code> ＃Zone </li> <li><code>failure-domain.beta.kubernetes.io/region</code> # Region </li> </ul> <p>We can set node Label to classify Name/Zone/Region of node, which can be used by <code>podAffinity</code>.</p> <p>Create a Pod Nginx. <div class=highlight><pre><span></span><code><span class=go>kubectl apply -f - &lt;&lt;EOF</span>
<span class=go>apiVersion: v1</span>
<span class=go>kind: Pod</span>
<span class=go>metadata:</span>
<span class=go>  name: nginx</span>
<span class=go>  labels:</span>
<span class=go>    app: nginx</span>
<span class=go>spec:</span>
<span class=go>  containers:</span>
<span class=go>  - name: nginx</span>
<span class=go>    image: nginx</span>
<span class=go>EOF</span>
</code></pre></div></p> <p>Create a Pod MySql. <div class=highlight><pre><span></span><code><span class=go>kubectl apply -f - &lt;&lt;EOF</span>
<span class=go>apiVersion: v1</span>
<span class=go>kind: Pod</span>
<span class=go>metadata:</span>
<span class=go>  name: mysql</span>
<span class=go>  labels:</span>
<span class=go>    app: mysql</span>
<span class=go>spec:</span>
<span class=go>  containers:</span>
<span class=go>  - name: mysql</span>
<span class=go>    image: mysql</span>
<span class=go>    env:</span>
<span class=go>     - name: &quot;MYSQL_ROOT_PASSWORD&quot;</span>
<span class=go>       value: &quot;123456&quot;</span>
<span class=go>  affinity:</span>
<span class=go>    podAffinity:</span>
<span class=go>      requiredDuringSchedulingIgnoredDuringExecution:</span>
<span class=go>      - labelSelector:</span>
<span class=go>          matchExpressions:</span>
<span class=go>          - key: app</span>
<span class=go>            operator: In</span>
<span class=go>            values:</span>
<span class=go>            - nginx</span>
<span class=go>        topologyKey: kubernetes.io/hostname</span>
<span class=go>EOF</span>
</code></pre></div></p> <p>As we configured <code>podAffinity</code>, so Pod <code>mysql</code> will be scheduled to the same node with Pod <code>nginx</code> by Label <code>app:nginx</code>.</p> <p>Via the command <code>kubectl get pod -o wide</code> we can get two Pods are running on node <code>cka002</code>.</p> <h2 id=taints-tolerations>Taints &amp; Tolerations<a class=headerlink href=#taints-tolerations title="Permanent link"> ¶</a></h2> <h3 id=concept>Concept<a class=headerlink href=#concept title="Permanent link"> ¶</a></h3> <p>Node affinity is a property of Pods that attracts them to a set of nodes (either as a preference or a hard requirement). Taints are the opposite -- they allow a node to repel a set of pods.</p> <p>Tolerations are applied to pods. Tolerations allow the scheduler to schedule pods with matching taints. Tolerations allow scheduling but don't guarantee scheduling: the scheduler also evaluates other parameters as part of its function.</p> <p>Taints and tolerations work together to ensure that pods are not scheduled onto inappropriate nodes. One or more taints are applied to a node; this marks that the node should not accept any pods that do not tolerate the taints.</p> <p>In the production environment, we generally configure Taints for Control Plane nodes (in fact, most K8s installation tools automatically add Taints to Control Plane nodes), because Control Plane only runs Kubernetes system components. If it is used to run application Pods, it is easy to consume resources. In the end, the Control Plane node will crash. If we need to add additional system components to the Control Plane node later, we can configure Tolerations for the corresponding system component Pod to tolerate taints.</p> <h3 id=set-taints>Set Taints<a class=headerlink href=#set-taints title="Permanent link"> ¶</a></h3> <p>Set <code>cka003</code> node to taint node. Set status to <code>NoSchedule</code>, which won't impact existing Pods running on <code>cka003</code>. <div class=highlight><pre><span></span><code><span class=go>kubectl taint nodes cka003 key=value:NoSchedule</span>
</code></pre></div></p> <h3 id=set-tolerations>Set Tolerations<a class=headerlink href=#set-tolerations title="Permanent link"> ¶</a></h3> <p>We can use Tolerations to let Pods schedule to a taint node. <div class=highlight><pre><span></span><code><span class=go>kubectl apply -f - &lt;&lt;EOF</span>
<span class=go>apiVersion: apps/v1</span>
<span class=go>kind: Deployment</span>
<span class=go>metadata:</span>
<span class=go> name: mysql-tolerations</span>
<span class=go>spec:</span>
<span class=go>  selector:</span>
<span class=go>    matchLabels:</span>
<span class=go>      app: mysql</span>
<span class=go>  template:</span>
<span class=go>    metadata:</span>
<span class=go>      labels:</span>
<span class=go>        app: mysql</span>
<span class=go>    spec:</span>
<span class=go>      containers:</span>
<span class=go>      - image: mysql:8.0</span>
<span class=go>        name: mysql</span>
<span class=go>        env:</span>
<span class=go>        - name: MYSQL_ROOT_PASSWORD</span>
<span class=go>          value: password</span>
<span class=go>        ports:</span>
<span class=go>        - containerPort: 3306</span>
<span class=go>          name: mysql</span>
<span class=go>      tolerations:</span>
<span class=go>      - key: &quot;key&quot;</span>
<span class=go>        operator: &quot;Equal&quot;</span>
<span class=go>        value: &quot;value&quot;</span>
<span class=go>        effect: &quot;NoSchedule&quot;</span>
<span class=go>EOF</span>
</code></pre></div></p> <p>The Pod of Deployment <code>mysql-tolerations</code> is scheduled and running on node <code>cka003</code> with <code>tolerations</code> setting, which is a taint node. <div class=highlight><pre><span></span><code><span class=go>kubectl get pod -o wide | grep mysql-tolerations</span>
</code></pre></div></p> <h3 id=remove-taints>Remove Taints<a class=headerlink href=#remove-taints title="Permanent link"> ¶</a></h3> <div class=highlight><pre><span></span><code><span class=go>kubectl taint nodes cka003 key-</span>
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../persistence/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Persistence" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Persistence </div> </div> </a> <a href=../policy/ class="md-footer__link md-footer__link--next" aria-label="Next: Policy" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Policy </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.sections"], "search": "../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.b1047164.min.js></script> </body> </html>