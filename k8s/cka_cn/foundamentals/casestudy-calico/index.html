<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://huyuhui001.github.io/mySite/k8s/cka_cn/foundamentals/casestudy-calico/ rel=canonical><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-7.3.6"><title>安装Calico - UPSkilling</title><link rel=stylesheet href=../../../../assets/stylesheets/main.a57b2b03.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.3f5d1f46.min.css><meta name=theme-color content=#009485><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../../extra.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=teal data-md-color-accent=green> <script>function __prefix(e){return new URL("../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#calico class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=UPSkilling class="md-header__button md-logo" aria-label=UPSkilling data-md-component=logo> <img src=../../../../assets/logo.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> UPSkilling </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 安装Calico </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> UPSkilling </a> </li> <li class=md-tabs__item> <a href=../../../../linux/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../ class="md-tabs__link md-tabs__link--active"> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../../python/ class=md-tabs__link> Python </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=UPSkilling class="md-nav__button md-logo" aria-label=UPSkilling data-md-component=logo> <img src=../../../../assets/logo.jpg alt=logo> </a> UPSkilling </label> <div class=md-nav__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> UPSkilling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=UPSkilling data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> UPSkilling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. class=md-nav__link> Welcome </a> </li> <li class=md-nav__item> <a href=../../../../about/ class=md-nav__link> About </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Linux SRE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux SRE" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Linux SRE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/SRE/01-fundamentals/ class=md-nav__link> 第一章 Linux基础 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/02-filesystem/ class=md-nav__link> 第二章 文件系统 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/03-identity-security/ class=md-nav__link> 第三章 身份与安全 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/04-TextTools/ class=md-nav__link> 第四章 文本编辑 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/05-RegExpress/ class=md-nav__link> 第五章 正则表达式 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/06-FileLookup/ class=md-nav__link> 第六章 文件查找 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/07-FilePacking/ class=md-nav__link> 第七章 文件打包和解包 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> SUSE Linux Administration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Linux Administration" data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> SUSE Linux Administration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/Administration/01/ class=md-nav__link> Linux File System Overview </a> </li> <li class=md-nav__item> <a href=../../../../linux/Administration/02/ class=md-nav__link> Useful Commands </a> </li> <li class=md-nav__item> <a href=../../../../linux/Administration/03/ class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4> SUSE Enterprise Storage Foundation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Enterprise Storage Foundation" data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> SUSE Enterprise Storage Foundation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/SES/linux_ses_memo/ class=md-nav__link> SUSE Enterprise Storage Foundation </a> </li> <li class=md-nav__item> <a href=../../../../linux/SES/linux_ses_demo/ class=md-nav__link> SUSE Enterprise Storage Basic Operation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> CKA Learning Memo <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CKA Learning Memo" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> CKA Learning Memo </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_1 type=checkbox id=__nav_3_2_1> <label class=md-nav__link for=__nav_3_2_1> Installation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Installation data-md-level=3> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/installation/single-local/ class=md-nav__link> Single Node Installation </a> </li> <li class=md-nav__item> <a href=../../../cka_en/installation/multiple-local/ class=md-nav__link> Multiple Nodes Installation </a> </li> <li class=md-nav__item> <a href=../../../cka_en/installation/aliyun-ubuntu/ class=md-nav__link> Installation on Aliyun ECS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_2 type=checkbox id=__nav_3_2_2> <label class=md-nav__link for=__nav_3_2_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=3> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/docker/ class=md-nav__link> Fundamentals </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_3 type=checkbox id=__nav_3_2_3> <label class=md-nav__link for=__nav_3_2_3> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=3> <label class=md-nav__title for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/memo/ class=md-nav__link> Memo </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/basics/ class=md-nav__link> kubectl basics </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_4 type=checkbox id=__nav_3_2_4> <label class=md-nav__link for=__nav_3_2_4> Core Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Core Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_4> <span class="md-nav__icon md-icon"></span> Core Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_5 type=checkbox id=__nav_3_2_5> <label class=md-nav__link for=__nav_3_2_5> Application Modeling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Application Modeling" data-md-level=3> <label class=md-nav__title for=__nav_3_2_5> <span class="md-nav__icon md-icon"></span> Application Modeling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/secrets/ class=md-nav__link> Secrets </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/rbac/ class=md-nav__link> Role Based Access Control (RBAC) </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/ingress/ class=md-nav__link> Ingress </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_6 type=checkbox id=__nav_3_2_6> <label class=md-nav__link for=__nav_3_2_6> Advanced Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advanced Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_6> <span class="md-nav__icon md-icon"></span> Advanced Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_7 type=checkbox id=__nav_3_2_7> <label class=md-nav__link for=__nav_3_2_7> Operating Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Operating Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_7> <span class="md-nav__icon md-icon"></span> Operating Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/healthcheck/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/helming/ class=md-nav__link> Helming </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_8 type=checkbox id=__nav_3_2_8> <label class=md-nav__link for=__nav_3_2_8> Topics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Topics data-md-level=3> <label class=md-nav__title for=__nav_3_2_8> <span class="md-nav__icon md-icon"></span> Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/casestudy-operation-resources/ class=md-nav__link> Operations on Resources </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/casestudy-health-check/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/casestudy-calico/ class=md-nav__link> Calico Installation </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/kyma/ class=md-nav__link> Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3> CKA学习笔记 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CKA学习笔记 data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> CKA学习笔记 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_1 type=checkbox id=__nav_3_3_1> <label class=md-nav__link for=__nav_3_3_1> 安装 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=安装 data-md-level=3> <label class=md-nav__title for=__nav_3_3_1> <span class="md-nav__icon md-icon"></span> 安装 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../installation/single-local/ class=md-nav__link> 单节点虚拟机安装Kubernetes </a> </li> <li class=md-nav__item> <a href=../../installation/multiple-local/ class=md-nav__link> 多节点虚拟机安装Kubernetes </a> </li> <li class=md-nav__item> <a href=../../installation/aliyun-ubuntu/ class=md-nav__link> 阿里云ECS安装Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_2 type=checkbox id=__nav_3_3_2> <label class=md-nav__link for=__nav_3_3_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=3> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../docker/ class=md-nav__link> Docker基础 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_3 type=checkbox id=__nav_3_3_3> <label class=md-nav__link for=__nav_3_3_3> 基础知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础知识 data-md-level=3> <label class=md-nav__title for=__nav_3_3_3> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../memo/ class=md-nav__link> Kubernetes随笔 </a> </li> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> Kubernetes集群概览 </a> </li> <li class=md-nav__item> <a href=../basics/ class=md-nav__link> kubectl基础 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_4 type=checkbox id=__nav_3_3_4> <label class=md-nav__link for=__nav_3_3_4> 核心概念 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=核心概念 data-md-level=3> <label class=md-nav__title for=__nav_3_3_4> <span class="md-nav__icon md-icon"></span> 核心概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_5 type=checkbox id=__nav_3_3_5> <label class=md-nav__link for=__nav_3_3_5> 应用体系 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=应用体系 data-md-level=3> <label class=md-nav__title for=__nav_3_3_5> <span class="md-nav__icon md-icon"></span> 应用体系 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../secrets/ class=md-nav__link> secrets </a> </li> <li class=md-nav__item> <a href=../persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../rbac/ class=md-nav__link> RBAC鉴权 </a> </li> <li class=md-nav__item> <a href=../ingress/ class=md-nav__link> Ingress-nginx </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_6 type=checkbox id=__nav_3_3_6> <label class=md-nav__link for=__nav_3_3_6> 进阶概念 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=进阶概念 data-md-level=3> <label class=md-nav__title for=__nav_3_3_6> <span class="md-nav__icon md-icon"></span> 进阶概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../hpa/ class=md-nav__link> Horizontal Pod Autoscaling (HPA) </a> </li> <li class=md-nav__item> <a href=../policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_7 type=checkbox id=__nav_3_3_7> <label class=md-nav__link for=__nav_3_3_7> 日常维护 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=日常维护 data-md-level=3> <label class=md-nav__title for=__nav_3_3_7> <span class="md-nav__icon md-icon"></span> 日常维护 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../healthcheck/ class=md-nav__link> 健康检查 </a> </li> <li class=md-nav__item> <a href=../helming/ class=md-nav__link> Helm Chart </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_8 type=checkbox id=__nav_3_3_8 checked> <label class=md-nav__link for=__nav_3_3_8> 主题讨论 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=主题讨论 data-md-level=3> <label class=md-nav__title for=__nav_3_3_8> <span class="md-nav__icon md-icon"></span> 主题讨论 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../casestudy-operation-resources/ class=md-nav__link> Kubernetes资源常见操作 </a> </li> <li class=md-nav__item> <a href=../casestudy-health-check/ class=md-nav__link> 健康检查 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 安装Calico <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 安装Calico </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#calico_1 class=md-nav__link> Calico数据库 </a> </li> <li class=md-nav__item> <a href=#ip class=md-nav__link> 配置IP池 </a> </li> <li class=md-nav__item> <a href=#cni class=md-nav__link> 安装CNI插件 </a> </li> <li class=md-nav__item> <a href=#typha class=md-nav__link> 安装Typha </a> </li> <li class=md-nav__item> <a href=#caliconode class=md-nav__link> 安装calico/node </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 测试网络 </a> <nav class=md-nav aria-label=测试网络> <ul class=md-nav__list> <li class=md-nav__item> <a href=#podping class=md-nav__link> pod之间的ping </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 路由检查 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../demo/cap_on_kyma/ class=md-nav__link> Build CAP Application on Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Python基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python基础 data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Python基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/Foundation/ch00/ class=md-nav__link> Python安装 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch01/ class=md-nav__link> Python语言基础 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch02/ class=md-nav__link> Python打包和解包 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch03/ class=md-nav__link> Python内置函数及文件 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch04/ class=md-nav__link> Python面向对象概念 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch05/ class=md-nav__link> Python面向对象三大特性 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/Algorithms/ class=md-nav__link> Python数据结构和算法 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Python数据分析基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python数据分析基础 data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Python数据分析基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch01/ class=md-nav__link> NumPy基础 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch10/ class=md-nav__link> NumPy进阶 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch02/ class=md-nav__link> Pandas入门 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch03/ class=md-nav__link> 数据载入、存储及文件格式 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch04/ class=md-nav__link> 数据清洗与准备 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch05/ class=md-nav__link> 数据规整：连接、联合与重塑 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch06/ class=md-nav__link> 绘图与可视化 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch07/ class=md-nav__link> 数据聚合与分组操作 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch08/ class=md-nav__link> 时间序列 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch09/ class=md-nav__link> 高阶pandas </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch11/ class=md-nav__link> Python建模库介绍 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4> 数据结构和算法 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=数据结构和算法 data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 数据结构和算法 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/DataStructure/01_PythonFundmantal/ class=md-nav__link> 基础知识回顾 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataStructure/02_CollectionsOverview/ class=md-nav__link> 多项集的概述 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataStructure/03_TimeComplexity/ class=md-nav__link> 搜索、排序以及复杂度分析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_5 type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/Demo/CourseSystem/ class=md-nav__link> 选课系统 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#calico_1 class=md-nav__link> Calico数据库 </a> </li> <li class=md-nav__item> <a href=#ip class=md-nav__link> 配置IP池 </a> </li> <li class=md-nav__item> <a href=#cni class=md-nav__link> 安装CNI插件 </a> </li> <li class=md-nav__item> <a href=#typha class=md-nav__link> 安装Typha </a> </li> <li class=md-nav__item> <a href=#caliconode class=md-nav__link> 安装calico/node </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 测试网络 </a> <nav class=md-nav aria-label=测试网络> <ul class=md-nav__list> <li class=md-nav__item> <a href=#podping class=md-nav__link> pod之间的ping </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 路由检查 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/huyuhui001/mySite/edit/main/docs/k8s/cka_cn/foundamentals/casestudy-calico.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=calico>主题讨论:安装Calico<a class=headerlink href=#calico title="Permanent link"> ¶</a></h1> <p>演示场景：安装Calico</p> <p>这是一个关于如何配置和测试Calico网络的简要步骤：</p> <ul> <li>Calico数据库（Datastore）：Calico支持使用etcd或Kubernetes API server作为数据存储后端。选择并部署其中一个数据存储后端。</li> <li>配置IP池：为了为Kubernetes集群中的节点分配IP地址，需要配置IP池。可以通过Calico自定义资源（CRD）来定义IP池。</li> <li>安装CNI插件：CNI插件负责在节点上创建和删除网络接口，它们是应用程序容器和物理网络之间的桥梁。需要在Kubernetes节点上安装Calico CNI插件。</li> <li>安装Typha：Typha是Calico中央控制平面的一个组件。它从Kubernetes API server中获取网络策略和其他信息，并将它们分发给所有节点上的calico/node。</li> <li>安装calico/node：calico/node是一个运行在Kubernetes节点上的守护进程。它管理节点上的网络接口，并为容器分配和释放IP地址。</li> <li>测试网络：在完成上述步骤后，可以通过在Pod之间进行网络通信来测试Calico网络是否正常工作。可以创建两个运行在不同节点上的Pod，并尝试从一个Pod ping另一个Pod。如果ping成功，则表示Calico网络已成功配置和运行。</li> </ul> <h2 id=calico_1>Calico数据库<a class=headerlink href=#calico_1 title="Permanent link"> ¶</a></h2> <p>为了将Kubernetes用作Calico数据存储库，我们需要定义Calico使用的自定义资源。</p> <p>下载并检查Calico自定义资源定义列表，并在文件编辑器中打开它。</p> <div class=highlight><pre><span></span><code>wget<span class=w> </span>https://projectcalico.docs.tigera.io/manifests/crds.yaml
</code></pre></div> <p>在 Kubernetes 中创建 Calico 的自定义资源。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>crds.yaml
</code></pre></div> <p>安装<code>calicoctl</code>。</p> <p>下载 <code>calicoctl</code> 二进制文件到一个可以访问 Kubernetes 的 Linux 主机上，以直接与 Calico 数据存储交互。</p> <p>最新版的calicoctl可以通过<a href=https://github.com/projectcalico/calico/releases>git page</a>进行下载，需要用实际版本号替换下面的<code>v3.23.2</code>的版本号。</p> <div class=highlight><pre><span></span><code>wget<span class=w> </span>https://github.com/projectcalico/calico/releases/download/v3.23.3/calicoctl-linux-amd64
chmod<span class=w> </span>+x<span class=w> </span>calicoctl-linux-amd64
sudo<span class=w> </span>cp<span class=w> </span>calicoctl-linux-amd64<span class=w> </span>/usr/local/bin/calicoctl
</code></pre></div> <p>配置 <code>calicoctl</code> 以访问 Kubernetes。</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;export KUBECONFIG=/root/.kube/config&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bashrc
<span class=nb>echo</span><span class=w> </span><span class=s2>&quot;export DATASTORE_TYPE=kubernetes&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>~/.bashrc

<span class=nb>echo</span><span class=w> </span><span class=nv>$KUBECONFIG</span>
<span class=nb>echo</span><span class=w> </span><span class=nv>$DATASTORE_TYPE</span>
</code></pre></div> <p>执行下面的命令，验证<code>calicoctl</code>能够访问数据库。</p> <div class=highlight><pre><span></span><code>calicoctl<span class=w> </span>get<span class=w> </span>nodes<span class=w> </span>-o<span class=w> </span>wide
</code></pre></div> <p>运行结果类似如下：</p> <div class=highlight><pre><span></span><code><span class=go>NAME     ASN   IPV4   IPV6   </span>
<span class=go>cka001                       </span>
<span class=go>cka002                       </span>
<span class=go>cka003  </span>
</code></pre></div> <p>节点是由 Kubernetes 节点对象支持的，因此我们应该看到与 <code>kubectl get nodes</code> 匹配的名称。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>get<span class=w> </span>nodes<span class=w> </span>-o<span class=w> </span>wide
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME     STATUS     ROLES                  AGE   VERSION   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME</span>
<span class=go>cka001   NotReady   control-plane,master   23m   v1.24.0   Ubuntu 20.04.4 LTS   5.4.0-113-generic   containerd://1.5.9</span>
<span class=go>cka002   NotReady   &lt;none&gt;                 22m   v1.24.0   Ubuntu 20.04.4 LTS   5.4.0-113-generic   containerd://1.5.9</span>
<span class=go>cka003   NotReady   &lt;none&gt;                 21m   v1.24.0   Ubuntu 20.04.4 LTS   5.4.0-113-generic   containerd://1.5.9</span>
</code></pre></div> <h2 id=ip>配置IP池<a class=headerlink href=#ip title="Permanent link"> ¶</a></h2> <p>一个工作负载（workload）是容器或虚拟机，基于Calico的虚拟网络。 在Kubernetes中，工作负载是Pod。一个工作负载端点（endpoint）是工作负载用来连接Calico网络的虚拟网络接口。</p> <p>IP池是Calico为工作负载端点使用的IP地址范围。</p> <p>获取集群中当前的IP池。目前，在刚刚安装完之后，它是空的。</p> <div class=highlight><pre><span></span><code>calicoctl<span class=w> </span>get<span class=w> </span>ippools
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME   CIDR   SELECTOR </span>
</code></pre></div> <p>我们通过 <code>kubeadm init</code> 命令指定了 Pod CIDR 为 <code>10.244.0.0/16</code>。</p> <p>现在，我们为集群创建两个 IP 池（IP pool），每个池之间不能重叠。</p> <p>创建IP池<code>ipv4-ippool-1</code>: <code>10.244.0.0/18</code></p> <div class=highlight><pre><span></span><code>calicoctl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>apiVersion: projectcalico.org/v3</span>
<span class=s>kind: IPPool</span>
<span class=s>metadata:</span>
<span class=s>  name: ipv4-ippool-1</span>
<span class=s>spec:</span>
<span class=s>  cidr: 10.244.0.0/18</span>
<span class=s>  ipipMode: Never</span>
<span class=s>  natOutgoing: true</span>
<span class=s>  disabled: false</span>
<span class=s>  nodeSelector: all()</span>
<span class=s>EOF</span>
</code></pre></div> <p>创建IP池<code>ipv4-ippool-2</code>: <code>10.244.192.0/19</code></p> <div class=highlight><pre><span></span><code>calicoctl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>apiVersion: projectcalico.org/v3</span>
<span class=s>kind: IPPool</span>
<span class=s>metadata:</span>
<span class=s>  name: ipv4-ippool-2</span>
<span class=s>spec:</span>
<span class=s>  cidr: 10.244.192.0/19</span>
<span class=s>  ipipMode: Never</span>
<span class=s>  natOutgoing: true</span>
<span class=s>  disabled: true</span>
<span class=s>  nodeSelector: all()</span>
<span class=s>EOF</span>
</code></pre></div> <p>查询所创建的IP池。</p> <div class=highlight><pre><span></span><code>calicoctl<span class=w> </span>get<span class=w> </span>ippools<span class=w> </span>-o<span class=w> </span>wide
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME            CIDR              NAT    IPIPMODE   VXLANMODE   DISABLED   DISABLEBGPEXPORT   SELECTOR   </span>
<span class=go>ipv4-ippool-1   10.244.0.0/18     true   Never      Never       false      false              all()      </span>
<span class=go>ipv4-ippool-2   10.244.192.0/19   true   Never      Never       true       false              all()     </span>
</code></pre></div> <h2 id=cni>安装CNI插件<a class=headerlink href=#cni title="Permanent link"> ¶</a></h2> <ul> <li>为插件创建Kubernetes用户账户。</li> </ul> <p>Kubernetes使用容器网络接口（CNI）与像Calico这样的网络提供者进行交互。</p> <p>以API形式呈现的，供Kubernetes使用的Calico二进制文件，称为CNI插件，必须安装在Kubernetes集群中的每个节点上。</p> <p>CNI插件在创建Pod时与Kubernetes API服务器交互，既要获取附加信息，又要使用有关Pod的信息更新数据存储。</p> <p>在Kubernetes *master*节点上，为CNI插件创建一个密钥以进行身份验证并签名证书请求。</p> <p>切换到目录 <code>/etc/kubernetes/pki/</code>。</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>/etc/kubernetes/pki/
</code></pre></div> <p>生成证书。</p> <div class=highlight><pre><span></span><code>openssl<span class=w> </span>req<span class=w> </span>-newkey<span class=w> </span>rsa:4096<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-keyout<span class=w> </span>cni.key<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-nodes<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-out<span class=w> </span>cni.csr<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-subj<span class=w> </span><span class=s2>&quot;/CN=calico-cni&quot;</span>
</code></pre></div> <p>使用主Kubernetes CA对此证书进行签名。</p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>openssl<span class=w> </span>x509<span class=w> </span>-req<span class=w> </span>-in<span class=w> </span>cni.csr<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-CA<span class=w> </span>/etc/kubernetes/pki/ca.crt<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-CAkey<span class=w> </span>/etc/kubernetes/pki/ca.key<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-CAcreateserial<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-out<span class=w> </span>cni.crt<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-days<span class=w> </span><span class=m>3650</span>
</code></pre></div> <p>输出结果类似如下，用户是 <code>calico-cni</code>。</p> <div class=highlight><pre><span></span><code><span class=go>Signature ok</span>
<span class=go>subject=CN = calico-cni</span>
<span class=go>Getting CA Private Key</span>
</code></pre></div> <p>赋予当前操作系统用户对文件<code>cni.crt</code>的操作权限。</p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>chown<span class=w> </span><span class=k>$(</span>id<span class=w> </span>-u<span class=k>)</span>:<span class=k>$(</span>id<span class=w> </span>-g<span class=k>)</span><span class=w> </span>cni.crt
</code></pre></div> <p>保持在<code>/etc/kubernetes/pki/</code>目录中，接下来我们将为CNI插件创建一个kubeconfig文件，用于访问Kubernetes。 将此<code>cni.kubeconfig</code>文件复制到集群中的每个节点。</p> <div class=highlight><pre><span></span><code><span class=nv>APISERVER</span><span class=o>=</span><span class=k>$(</span>kubectl<span class=w> </span>config<span class=w> </span>view<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.clusters[0].cluster.server}&#39;</span><span class=k>)</span>

<span class=nb>echo</span><span class=w> </span><span class=nv>$APISERVER</span>

kubectl<span class=w> </span>config<span class=w> </span>set-cluster<span class=w> </span>kubernetes<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--certificate-authority<span class=o>=</span>/etc/kubernetes/pki/ca.crt<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--embed-certs<span class=o>=</span><span class=nb>true</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--server<span class=o>=</span><span class=nv>$APISERVER</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--kubeconfig<span class=o>=</span>cni.kubeconfig

kubectl<span class=w> </span>config<span class=w> </span>set-credentials<span class=w> </span>calico-cni<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--client-certificate<span class=o>=</span>cni.crt<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--client-key<span class=o>=</span>cni.key<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--embed-certs<span class=o>=</span><span class=nb>true</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--kubeconfig<span class=o>=</span>cni.kubeconfig

kubectl<span class=w> </span>config<span class=w> </span>set-context<span class=w> </span>cni@kubernetes<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--cluster<span class=o>=</span>kubernetes<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--user<span class=o>=</span>calico-cni<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--kubeconfig<span class=o>=</span>cni.kubeconfig

kubectl<span class=w> </span>config<span class=w> </span>use-context<span class=w> </span>cni@kubernetes<span class=w> </span>--kubeconfig<span class=o>=</span>cni.kubeconfig
</code></pre></div> <p>查询CNI上下文看起来类似下面的输出。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>config<span class=w> </span>get-contexts<span class=w> </span>--kubeconfig<span class=o>=</span>cni.kubeconfig
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code><span class=go>CURRENT   NAME             CLUSTER      AUTHINFO     NAMESPACE</span>
<span class=go>*         cni@kubernetes   kubernetes   calico-cni </span>
</code></pre></div> <ul> <li>配置RBAC（ Role-Based Access Control）</li> </ul> <p>为 CNI 插件的 Kubernetes 用户帐户配置 RBAC 角色和角色绑定。这将授予此用户帐户所需的 Kubernetes API 访问权限。</p> <p>切换到home路径，作为当前工作目录。</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>~
</code></pre></div> <p>定义一个集群角色，CNI插件将使用该角色访问Kubernetes。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>kind: ClusterRole</span>
<span class=s>apiVersion: rbac.authorization.k8s.io/v1</span>
<span class=s>metadata:</span>
<span class=s>  name: calico-cni</span>
<span class=s>rules:</span>
<span class=s>  # The CNI plugin needs to get pods, nodes, and namespaces.</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - pods</span>
<span class=s>      - nodes</span>
<span class=s>      - namespaces</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>  # The CNI plugin patches pods/status.</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - pods/status</span>
<span class=s>    verbs:</span>
<span class=s>      - patch</span>
<span class=s> # These permissions are required for Calico CNI to perform IPAM allocations.</span>
<span class=s>  - apiGroups: [&quot;crd.projectcalico.org&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - blockaffinities</span>
<span class=s>      - ipamblocks</span>
<span class=s>      - ipamhandles</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>      - list</span>
<span class=s>      - create</span>
<span class=s>      - update</span>
<span class=s>      - delete</span>
<span class=s>  - apiGroups: [&quot;crd.projectcalico.org&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - ipamconfigs</span>
<span class=s>      - clusterinformations</span>
<span class=s>      - ippools</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>      - list</span>
<span class=s>EOF</span>
</code></pre></div> <p>把上面创建的集群角色绑定到 <code>calico-cni</code> 用户账户。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>clusterrolebinding<span class=w> </span>calico-cni<span class=w> </span>--clusterrole<span class=o>=</span>calico-cni<span class=w> </span>--user<span class=o>=</span>calico-cni
</code></pre></div> <ul> <li>安装插件</li> </ul> <p>提示：需要在每个节点上执行下面的安装步骤。</p> <p>在<code>cka001</code>上安装。</p> <p>以 <strong>root</strong> 用户运行下面的命令。</p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>su
</code></pre></div> <p>安装CNI插件的二进制文件。 下载包链接：<code>https://github.com/projectcalico/cni-plugin/releases</code>和 <code>https://github.com/containernetworking/plugins/releases</code>。</p> <div class=highlight><pre><span></span><code>mkdir<span class=w> </span>-p<span class=w> </span>/opt/cni/bin

curl<span class=w> </span>-L<span class=w> </span>-o<span class=w> </span>/opt/cni/bin/calico<span class=w> </span>https://github.com/projectcalico/cni-plugin/releases/download/v3.20.5/calico-amd64
chmod<span class=w> </span><span class=m>755</span><span class=w> </span>/opt/cni/bin/calico

curl<span class=w> </span>-L<span class=w> </span>-o<span class=w> </span>/opt/cni/bin/calico-ipam<span class=w> </span>https://github.com/projectcalico/cni-plugin/releases/download/v3.20.5/calico-ipam-amd64
chmod<span class=w> </span><span class=m>755</span><span class=w> </span>/opt/cni/bin/calico-ipam

wget<span class=w> </span>https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz
tar<span class=w> </span>xvf<span class=w> </span>cni-plugins-linux-amd64-v1.1.1.tgz<span class=w> </span>-C<span class=w> </span>/opt/cni/bin
</code></pre></div> <p>创建配置文件目录。</p> <div class=highlight><pre><span></span><code>mkdir<span class=w> </span>-p<span class=w> </span>/etc/cni/net.d/
</code></pre></div> <p>复制前面生成的kubeconfig到我们创建的配置文件目录<code>/etc/cni/net.d/</code>下，改名为<code>calico-kubeconfig</code>，并修改其权限。</p> <div class=highlight><pre><span></span><code>cp<span class=w> </span>/etc/kubernetes/pki/cni.kubeconfig<span class=w> </span>/etc/cni/net.d/calico-kubeconfig

chmod<span class=w> </span><span class=m>600</span><span class=w> </span>/etc/cni/net.d/calico-kubeconfig
</code></pre></div> <p>将下面的内容写入CNI配置文件<code>/etc/cni/net.d/10-calico.conflist</code>中。</p> <div class=highlight><pre><span></span><code>cat<span class=w> </span>&gt;<span class=w> </span>/etc/cni/net.d/10-calico.conflist<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>{</span>
<span class=s>  &quot;name&quot;: &quot;k8s-pod-network&quot;,</span>
<span class=s>  &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class=s>  &quot;plugins&quot;: [</span>
<span class=s>    {</span>
<span class=s>      &quot;type&quot;: &quot;calico&quot;,</span>
<span class=s>      &quot;log_level&quot;: &quot;info&quot;,</span>
<span class=s>      &quot;datastore_type&quot;: &quot;kubernetes&quot;,</span>
<span class=s>      &quot;mtu&quot;: 1500,</span>
<span class=s>      &quot;ipam&quot;: {</span>
<span class=s>          &quot;type&quot;: &quot;calico-ipam&quot;</span>
<span class=s>      },</span>
<span class=s>      &quot;policy&quot;: {</span>
<span class=s>          &quot;type&quot;: &quot;k8s&quot;</span>
<span class=s>      },</span>
<span class=s>      &quot;kubernetes&quot;: {</span>
<span class=s>          &quot;kubeconfig&quot;: &quot;/etc/cni/net.d/calico-kubeconfig&quot;</span>
<span class=s>      }</span>
<span class=s>    },</span>
<span class=s>    {</span>
<span class=s>      &quot;type&quot;: &quot;portmap&quot;,</span>
<span class=s>      &quot;snat&quot;: true,</span>
<span class=s>      &quot;capabilities&quot;: {&quot;portMappings&quot;: true}</span>
<span class=s>    }</span>
<span class=s>  ]</span>
<span class=s>}</span>
<span class=s>EOF</span>
</code></pre></div> <p>将/etc/cni/net.d/calico-kubeconfig配置文件复制到当前操作系统用户（<code>root</code>）的home路径下。</p> <div class=highlight><pre><span></span><code>cp<span class=w> </span>/etc/cni/net.d/calico-kubeconfig<span class=w> </span>~
</code></pre></div> <p>退出 <code>su</code> 的 root用户，返回常规用户，这里是<code>vagrant</code>。</p> <div class=highlight><pre><span></span><code><span class=nb>exit</span>
</code></pre></div> <p>在节点<code>cka002</code>上安装。</p> <p>当前仍然在节点<code>cka001</code>，通过sftp命令把生成的证书从节点<code>cka001</code>上传至节点<code>cka002</code>。</p> <div class=highlight><pre><span></span><code>sftp<span class=w> </span>-i<span class=w> </span>cka-key-pair.pem<span class=w> </span>cka002

put<span class=w> </span>calico-amd64
put<span class=w> </span>calicoctl-linux-amd64
put<span class=w> </span>calico-ipam-amd64
put<span class=w> </span>calico-kubeconfig
put<span class=w> </span>cni-plugins-linux-amd64-v1.1.1.tgz
</code></pre></div> <p>通过证书从节点<code>cka001</code>登录到节点<code>cka002</code>。</p> <div class=highlight><pre><span></span><code>ssh<span class=w> </span>-i<span class=w> </span>cka-key-pair.pem<span class=w> </span>cka002
</code></pre></div> <p>创建目录<code>/opt/cni/bin</code>以存放cni二进制文件。</p> <div class=highlight><pre><span></span><code>mkdir<span class=w> </span>-p<span class=w> </span>/opt/cni/bin

cp<span class=w> </span>calico-amd64<span class=w> </span>/opt/cni/bin/calico
cp<span class=w> </span>calico-ipam-amd64<span class=w> </span>/opt/cni/bin/calico-ipam

tar<span class=w> </span>xvf<span class=w> </span>cni-plugins-linux-amd64-v1.1.1.tgz<span class=w> </span>-C<span class=w> </span>/opt/cni/bin

mkdir<span class=w> </span>-p<span class=w> </span>/etc/cni/net.d/

cp<span class=w> </span>calico-kubeconfig<span class=w> </span>/etc/cni/net.d/calico-kubeconfig

chmod<span class=w> </span><span class=m>600</span><span class=w> </span>/etc/cni/net.d/calico-kubeconfig
</code></pre></div> <p>更新CNI配置文件<code>/etc/cni/net.d/10-calico.conflist</code>。</p> <div class=highlight><pre><span></span><code>cat<span class=w> </span>&gt;<span class=w> </span>/etc/cni/net.d/10-calico.conflist<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>{</span>
<span class=s>  &quot;name&quot;: &quot;k8s-pod-network&quot;,</span>
<span class=s>  &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class=s>  &quot;plugins&quot;: [</span>
<span class=s>    {</span>
<span class=s>      &quot;type&quot;: &quot;calico&quot;,</span>
<span class=s>      &quot;log_level&quot;: &quot;info&quot;,</span>
<span class=s>      &quot;datastore_type&quot;: &quot;kubernetes&quot;,</span>
<span class=s>      &quot;mtu&quot;: 1500,</span>
<span class=s>      &quot;ipam&quot;: {</span>
<span class=s>          &quot;type&quot;: &quot;calico-ipam&quot;</span>
<span class=s>      },</span>
<span class=s>      &quot;policy&quot;: {</span>
<span class=s>          &quot;type&quot;: &quot;k8s&quot;</span>
<span class=s>      },</span>
<span class=s>      &quot;kubernetes&quot;: {</span>
<span class=s>          &quot;kubeconfig&quot;: &quot;/etc/cni/net.d/calico-kubeconfig&quot;</span>
<span class=s>      }</span>
<span class=s>    },</span>
<span class=s>    {</span>
<span class=s>      &quot;type&quot;: &quot;portmap&quot;,</span>
<span class=s>      &quot;snat&quot;: true,</span>
<span class=s>      &quot;capabilities&quot;: {&quot;portMappings&quot;: true}</span>
<span class=s>    }</span>
<span class=s>  ]</span>
<span class=s>}</span>
<span class=s>EOF</span>
</code></pre></div> <p>返回至节点 <code>cka001</code>。</p> <div class=highlight><pre><span></span><code><span class=nb>exit</span>
</code></pre></div> <p>在<code>cka003</code>上安装。</p> <p>类似<code>cka002</code>的安装过程，从节点<code>cka001</code>上传证书到节点<code>cka003</code>，并登录到节点<code>cka003</code>完成下面的命令。</p> <div class=highlight><pre><span></span><code>sftp<span class=w> </span>-i<span class=w> </span>cka-key-pair.pem<span class=w> </span>cka003
</code></pre></div> <div class=highlight><pre><span></span><code>put<span class=w> </span>calico-amd64
put<span class=w> </span>calicoctl-linux-amd64
put<span class=w> </span>calico-ipam-amd64
put<span class=w> </span>calico-kubeconfig
put<span class=w> </span>cni-plugins-linux-amd64-v1.1.1.tgz
</code></pre></div> <div class=highlight><pre><span></span><code>ssh<span class=w> </span>-i<span class=w> </span>cka-key-pair.pem<span class=w> </span>cka003
</code></pre></div> <div class=highlight><pre><span></span><code>mkdir<span class=w> </span>-p<span class=w> </span>/opt/cni/bin

cp<span class=w> </span>calico-amd64<span class=w> </span>/opt/cni/bin/calico
cp<span class=w> </span>calico-ipam-amd64<span class=w> </span>/opt/cni/bin/calico-ipam

tar<span class=w> </span>xvf<span class=w> </span>cni-plugins-linux-amd64-v1.1.1.tgz<span class=w> </span>-C<span class=w> </span>/opt/cni/bin

mkdir<span class=w> </span>-p<span class=w> </span>/etc/cni/net.d/

cp<span class=w> </span>calico-kubeconfig<span class=w> </span>/etc/cni/net.d/calico-kubeconfig

chmod<span class=w> </span><span class=m>600</span><span class=w> </span>/etc/cni/net.d/calico-kubeconfig
</code></pre></div> <div class=highlight><pre><span></span><code>cat<span class=w> </span>&gt;<span class=w> </span>/etc/cni/net.d/10-calico.conflist<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>{</span>
<span class=s>  &quot;name&quot;: &quot;k8s-pod-network&quot;,</span>
<span class=s>  &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class=s>  &quot;plugins&quot;: [</span>
<span class=s>    {</span>
<span class=s>      &quot;type&quot;: &quot;calico&quot;,</span>
<span class=s>      &quot;log_level&quot;: &quot;info&quot;,</span>
<span class=s>      &quot;datastore_type&quot;: &quot;kubernetes&quot;,</span>
<span class=s>      &quot;mtu&quot;: 1500,</span>
<span class=s>      &quot;ipam&quot;: {</span>
<span class=s>          &quot;type&quot;: &quot;calico-ipam&quot;</span>
<span class=s>      },</span>
<span class=s>      &quot;policy&quot;: {</span>
<span class=s>          &quot;type&quot;: &quot;k8s&quot;</span>
<span class=s>      },</span>
<span class=s>      &quot;kubernetes&quot;: {</span>
<span class=s>          &quot;kubeconfig&quot;: &quot;/etc/cni/net.d/calico-kubeconfig&quot;</span>
<span class=s>      }</span>
<span class=s>    },</span>
<span class=s>    {</span>
<span class=s>      &quot;type&quot;: &quot;portmap&quot;,</span>
<span class=s>      &quot;snat&quot;: true,</span>
<span class=s>      &quot;capabilities&quot;: {&quot;portMappings&quot;: true}</span>
<span class=s>    }</span>
<span class=s>  ]</span>
<span class=s>}</span>
<span class=s>EOF</span>
</code></pre></div> <p>返回至节点<code>cka001</code>。</p> <div class=highlight><pre><span></span><code><span class=nb>exit</span>
</code></pre></div> <p>当前工作目录仍然是节点<code>cka001</code>的home目录。</p> <p>至此，此时，Kubernetes 节点将变为 Ready 状态，因为 Kubernetes 已安装了网络提供程序和配置。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>get<span class=w> </span>nodes
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME     STATUS   ROLES                  AGE     VERSION</span>
<span class=go>cka001   Ready    control-plane,master   4h50m   v1.24.0</span>
<span class=go>cka002   Ready    &lt;none&gt;                 4h49m   v1.24.0</span>
<span class=go>cka003   Ready    &lt;none&gt;                 4h49m   v1.24.0</span>
</code></pre></div> <h2 id=typha>安装Typha<a class=headerlink href=#typha title="Permanent link"> ¶</a></h2> <p>Typha 处于 Kubernetes API 服务器和每个节点守护进程（如运行在 calico/node 中的 Felix 和 confd）之间。 它监视这些守护进程使用的 Kubernetes 资源和 Calico 自定义资源，每当资源更改时，它会将更新扩散到这些守护进程。 这减少了 Kubernetes API 服务器需要服务的监视数，提高了集群的可扩展性。</p> <ul> <li>准备证书</li> </ul> <p>下面，我们使用相互认证的TLS来确保calico/node和Typha之间的通信安全。 生成一个证书授权机构（CA）并使用它来为Typha签署证书。</p> <p>将当前工作目录改为 <code>/etc/kubernetes/pki/</code>。</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>/etc/kubernetes/pki/
</code></pre></div> <p>创建CA证书和密钥。</p> <div class=highlight><pre><span></span><code>openssl<span class=w> </span>req<span class=w> </span>-x509<span class=w> </span>-newkey<span class=w> </span>rsa:4096<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-keyout<span class=w> </span>typhaca.key<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-nodes<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-out<span class=w> </span>typhaca.crt<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-subj<span class=w> </span><span class=s2>&quot;/CN=Calico Typha CA&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>-days<span class=w> </span><span class=m>365</span>
</code></pre></div> <p>把CA证书存放在ConfigMap中，使Typha和calico/node能够访问。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>configmap<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>calico-typha-ca<span class=w> </span>--from-file<span class=o>=</span>typhaca.crt
</code></pre></div> <p>生成Typha密钥和证书签名请求（certificate signing request，CSR）。</p> <div class=highlight><pre><span></span><code>openssl<span class=w> </span>req<span class=w> </span>-newkey<span class=w> </span>rsa:4096<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-keyout<span class=w> </span>typha.key<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-nodes<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-out<span class=w> </span>typha.csr<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-subj<span class=w> </span><span class=s2>&quot;/CN=calico-typha&quot;</span>
</code></pre></div> <p>证书的通用名称（CN）设置为 <code>calico-typha</code>。<code>calico/node</code> 将被用来验证此名称。</p> <p>使用 CA 对 Typha 证书进行签名。</p> <div class=highlight><pre><span></span><code>openssl<span class=w> </span>x509<span class=w> </span>-req<span class=w> </span>-in<span class=w> </span>typha.csr<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-CA<span class=w> </span>typhaca.crt<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-CAkey<span class=w> </span>typhaca.key<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-CAcreateserial<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-out<span class=w> </span>typha.crt<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-days<span class=w> </span><span class=m>365</span>
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>Signature ok</span>
<span class=go>subject=CN = calico-typha</span>
<span class=go>Getting CA Private Key</span>
</code></pre></div> <p>将 Typha 密钥和证书存储在一个 secret 中，以便 Typha 可以访问。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>calico-typha-certs<span class=w> </span>--from-file<span class=o>=</span>typha.key<span class=w> </span>--from-file<span class=o>=</span>typha.crt
</code></pre></div> <ul> <li>配置RBAC</li> </ul> <p>当前工作目录为home路径。</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>~
</code></pre></div> <p>创建一个Typha使用的ServiceAccount。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>serviceaccount<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>calico-typha
</code></pre></div> <p>为 Typha 创建一个集群角色，有观察 Calico 数据存储对象的权限。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>kind: ClusterRole</span>
<span class=s>apiVersion: rbac.authorization.k8s.io/v1</span>
<span class=s>metadata:</span>
<span class=s>  name: calico-typha</span>
<span class=s>rules:</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - pods</span>
<span class=s>      - namespaces</span>
<span class=s>      - serviceaccounts</span>
<span class=s>      - endpoints</span>
<span class=s>      - services</span>
<span class=s>      - nodes</span>
<span class=s>    verbs:</span>
<span class=s>      # Used to discover service IPs for advertisement.</span>
<span class=s>      - watch</span>
<span class=s>      - list</span>
<span class=s>  - apiGroups: [&quot;networking.k8s.io&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - networkpolicies</span>
<span class=s>    verbs:</span>
<span class=s>      - watch</span>
<span class=s>      - list</span>
<span class=s>  - apiGroups: [&quot;crd.projectcalico.org&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - globalfelixconfigs</span>
<span class=s>      - felixconfigurations</span>
<span class=s>      - bgppeers</span>
<span class=s>      - globalbgpconfigs</span>
<span class=s>      - bgpconfigurations</span>
<span class=s>      - ippools</span>
<span class=s>      - ipamblocks</span>
<span class=s>      - globalnetworkpolicies</span>
<span class=s>      - globalnetworksets</span>
<span class=s>      - networkpolicies</span>
<span class=s>      - clusterinformations</span>
<span class=s>      - hostendpoints</span>
<span class=s>      - blockaffinities</span>
<span class=s>      - networksets</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>      - list</span>
<span class=s>      - watch</span>
<span class=s>  - apiGroups: [&quot;crd.projectcalico.org&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      #- ippools</span>
<span class=s>      #- felixconfigurations</span>
<span class=s>      - clusterinformations</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>      - create</span>
<span class=s>      - update</span>
<span class=s>EOF</span>
</code></pre></div> <p>将创建的集群角色绑定到<code>calico-typha</code>这个ServiceAccount。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>clusterrolebinding<span class=w> </span>calico-typha<span class=w> </span>--clusterrole<span class=o>=</span>calico-typha<span class=w> </span>--serviceaccount<span class=o>=</span>kube-system:calico-typha
</code></pre></div> <ul> <li>安装Deployment</li> </ul> <p>由于 <code>calico/node</code> 需要 Typha，而 <code>calico/node</code> 负责建立 Pod 网络，所以我们把 Typha 作为主机网络的 Pod 运行，以避免鸡生蛋或蛋生鸡的问题（chicken-and-egg problem）。</p> <p>我们运行 3 个 Typha 副本，这样即使在滚动更新期间发生单个故障，也不会使 Typha 不可用。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>apiVersion: apps/v1</span>
<span class=s>kind: Deployment</span>
<span class=s>metadata:</span>
<span class=s>  name: calico-typha</span>
<span class=s>  namespace: kube-system</span>
<span class=s>  labels:</span>
<span class=s>    k8s-app: calico-typha</span>
<span class=s>spec:</span>
<span class=s>  replicas: 3</span>
<span class=s>  revisionHistoryLimit: 2</span>
<span class=s>  selector:</span>
<span class=s>    matchLabels:</span>
<span class=s>      k8s-app: calico-typha</span>
<span class=s>  template:</span>
<span class=s>    metadata:</span>
<span class=s>      labels:</span>
<span class=s>        k8s-app: calico-typha</span>
<span class=s>      annotations:</span>
<span class=s>        cluster-autoscaler.kubernetes.io/safe-to-evict: &#39;true&#39;</span>
<span class=s>    spec:</span>
<span class=s>      hostNetwork: true</span>
<span class=s>      tolerations:</span>
<span class=s>        # Mark the pod as a critical add-on for rescheduling.</span>
<span class=s>        - key: CriticalAddonsOnly</span>
<span class=s>          operator: Exists</span>
<span class=s>      serviceAccountName: calico-typha</span>
<span class=s>      priorityClassName: system-cluster-critical</span>
<span class=s>      containers:</span>
<span class=s>      - image: calico/typha:v3.8.0</span>
<span class=s>        name: calico-typha</span>
<span class=s>        ports:</span>
<span class=s>        - containerPort: 5473</span>
<span class=s>          name: calico-typha</span>
<span class=s>          protocol: TCP</span>
<span class=s>        env:</span>
<span class=s>          # Disable logging to file and syslog since those don&#39;t make sense in Kubernetes.</span>
<span class=s>          - name: TYPHA_LOGFILEPATH</span>
<span class=s>            value: &quot;none&quot;</span>
<span class=s>          - name: TYPHA_LOGSEVERITYSYS</span>
<span class=s>            value: &quot;none&quot;</span>
<span class=s>          # Monitor the Kubernetes API to find the number of running instances and rebalance</span>
<span class=s>          # connections.</span>
<span class=s>          - name: TYPHA_CONNECTIONREBALANCINGMODE</span>
<span class=s>            value: &quot;kubernetes&quot;</span>
<span class=s>          - name: TYPHA_DATASTORETYPE</span>
<span class=s>            value: &quot;kubernetes&quot;</span>
<span class=s>          - name: TYPHA_HEALTHENABLED</span>
<span class=s>            value: &quot;true&quot;</span>
<span class=s>          # Location of the CA bundle Typha uses to authenticate calico/node; volume mount</span>
<span class=s>          - name: TYPHA_CAFILE</span>
<span class=s>            value: /calico-typha-ca/typhaca.crt</span>
<span class=s>          # Common name on the calico/node certificate</span>
<span class=s>          - name: TYPHA_CLIENTCN</span>
<span class=s>            value: calico-node</span>
<span class=s>          # Location of the server certificate for Typha; volume mount</span>
<span class=s>          - name: TYPHA_SERVERCERTFILE</span>
<span class=s>            value: /calico-typha-certs/typha.crt</span>
<span class=s>          # Location of the server certificate key for Typha; volume mount</span>
<span class=s>          - name: TYPHA_SERVERKEYFILE</span>
<span class=s>            value: /calico-typha-certs/typha.key</span>
<span class=s>        livenessProbe:</span>
<span class=s>          httpGet:</span>
<span class=s>            path: /liveness</span>
<span class=s>            port: 9098</span>
<span class=s>            host: localhost</span>
<span class=s>          periodSeconds: 30</span>
<span class=s>          initialDelaySeconds: 30</span>
<span class=s>        readinessProbe:</span>
<span class=s>          httpGet:</span>
<span class=s>            path: /readiness</span>
<span class=s>            port: 9098</span>
<span class=s>            host: localhost</span>
<span class=s>          periodSeconds: 10</span>
<span class=s>        volumeMounts:</span>
<span class=s>        - name: calico-typha-ca</span>
<span class=s>          mountPath: &quot;/calico-typha-ca&quot;</span>
<span class=s>          readOnly: true</span>
<span class=s>        - name: calico-typha-certs</span>
<span class=s>          mountPath: &quot;/calico-typha-certs&quot;</span>
<span class=s>          readOnly: true</span>
<span class=s>      volumes:</span>
<span class=s>      - name: calico-typha-ca</span>
<span class=s>        configMap:</span>
<span class=s>          name: calico-typha-ca</span>
<span class=s>      - name: calico-typha-certs</span>
<span class=s>        secret:</span>
<span class=s>          secretName: calico-typha-certs</span>
<span class=s>EOF</span>
</code></pre></div> <p>我们设置 <code>TYPHA_CLIENTCN</code> 为 <code>calico-node</code>，后续将用于 <code>calico/node</code> 证书的通用名称。</p> <p>确认 Typha 已经启动并运行了三个实例。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-l<span class=w> </span>k8s-app<span class=o>=</span>calico-typha<span class=w> </span>-n<span class=w> </span>kube-system
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME                           READY   STATUS    RESTARTS   AGE</span>
<span class=go>calico-typha-5b8669646-b2xnq   1/1     Running   0          20s</span>
<span class=go>calico-typha-5b8669646-q5glk   0/1     Pending   0          20s</span>
<span class=go>calico-typha-5b8669646-rvv86   1/1     Running   0          20s</span>
</code></pre></div> <p>遇到如下错误信息。</p> <div class=highlight><pre><span></span><code><span class=go>0/3 nodes are available: 1 node(s) had taint {node-role.kubernetes.io/master: }, that the pod didn&#39;t tolerate, 2 node(s) didn&#39;t have free ports for the requested pod ports.</span>
</code></pre></div> <ul> <li>安装Service</li> </ul> <p><code>calico/node</code>使用Kubernetes Service以获得对Typha的负载均衡访问。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>apiVersion: v1</span>
<span class=s>kind: Service</span>
<span class=s>metadata:</span>
<span class=s>  name: calico-typha</span>
<span class=s>  namespace: kube-system</span>
<span class=s>  labels:</span>
<span class=s>    k8s-app: calico-typha</span>
<span class=s>spec:</span>
<span class=s>  ports:</span>
<span class=s>    - port: 5473</span>
<span class=s>      protocol: TCP</span>
<span class=s>      targetPort: calico-typha</span>
<span class=s>      name: calico-typha</span>
<span class=s>  selector:</span>
<span class=s>    k8s-app: calico-typha</span>
<span class=s>EOF</span>
</code></pre></div> <p>验证Typha正在使用TLS。</p> <div class=highlight><pre><span></span><code><span class=nv>TYPHA_CLUSTERIP</span><span class=o>=</span><span class=k>$(</span>kubectl<span class=w> </span>get<span class=w> </span>svc<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>calico-typha<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span><span class=k>)</span>
curl<span class=w> </span>https://<span class=nv>$TYPHA_CLUSTERIP</span>:5473<span class=w> </span>-v<span class=w> </span>--cacert<span class=w> </span>/etc/kubernetes/pki/typhaca.crt
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>*   Trying 11.244.91.165:5473...</span>
<span class=go>* TCP_NODELAY set</span>
<span class=go>* Connected to 11.244.91.165 (11.244.91.165) port 5473 (#0)</span>
<span class=go>* ALPN, offering h2</span>
<span class=go>* ALPN, offering http/1.1</span>
<span class=go>* successfully set certificate verify locations:</span>
<span class=go>*   CAfile: /etc/kubernetes/pki/typhaca.crt</span>
<span class=go>  CApath: /etc/ssl/certs</span>
<span class=go>* TLSv1.3 (OUT), TLS handshake, Client hello (1):</span>
<span class=go>* TLSv1.3 (IN), TLS handshake, Server hello (2):</span>
<span class=go>* TLSv1.2 (IN), TLS handshake, Certificate (11):</span>
<span class=go>* TLSv1.2 (IN), TLS handshake, Server key exchange (12):</span>
<span class=go>* TLSv1.2 (IN), TLS handshake, Request CERT (13):</span>
<span class=go>* TLSv1.2 (IN), TLS handshake, Server finished (14):</span>
<span class=go>* TLSv1.2 (OUT), TLS handshake, Certificate (11):</span>
<span class=go>* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):</span>
<span class=go>* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):</span>
<span class=go>* TLSv1.2 (OUT), TLS handshake, Finished (20):</span>
<span class=go>* TLSv1.2 (IN), TLS alert, bad certificate (554):</span>
<span class=go>* error:14094412:SSL routines:ssl3_read_bytes:sslv3 alert bad certificate</span>
<span class=go>* Closing connection 0</span>
<span class=go>curl: (35) error:14094412:SSL routines:ssl3_read_bytes:sslv3 alert bad certificate</span>
</code></pre></div> <p>上面的错误信息说明 Typha 正在使用 TLS 证书，且因我们没有提供证书而拒绝连接。 下面我们会使用一个证书部署 calico/node，这样 Typha 就会接受连接了。</p> <h2 id=caliconode>安装calico/node<a class=headerlink href=#caliconode title="Permanent link"> ¶</a></h2> <p><code>calico/node</code> 运行三个守护进程。</p> <ul> <li>Felix，Calico的每个节点守护进程</li> <li>BIRD，一个守护进程，使用BGP协议与其他节点交换路由信息</li> <li> <p>confd，一个守护进程，监视Calico数据存储中的配置更改，并更新BIRD的配置文件</p> </li> <li> <p>准备证书</p> </li> </ul> <p>切换到目录 <code>/etc/kubernetes/pki/</code>。</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>/etc/kubernetes/pki/
</code></pre></div> <p>创建 <code>calico/node</code> 密钥，用于认证 Typha 和证书签名请求 (certificate signing request，CSR)。</p> <div class=highlight><pre><span></span><code>openssl<span class=w> </span>req<span class=w> </span>-newkey<span class=w> </span>rsa:4096<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-keyout<span class=w> </span>calico-node.key<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-nodes<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-out<span class=w> </span>calico-node.csr<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-subj<span class=w> </span><span class=s2>&quot;/CN=calico-node&quot;</span>
</code></pre></div> <p>这个证书的公共名称 (CN) 是 <code>calico-node</code>，这是我们在上一个演示中配置 Typha 接受的名称。</p> <p>使用我们前面创建的 CA 对 Felix 证书进行签名。</p> <div class=highlight><pre><span></span><code>openssl<span class=w> </span>x509<span class=w> </span>-req<span class=w> </span>-in<span class=w> </span>calico-node.csr<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-CA<span class=w> </span>typhaca.crt<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-CAkey<span class=w> </span>typhaca.key<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-CAcreateserial<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-out<span class=w> </span>calico-node.crt<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-days<span class=w> </span><span class=m>365</span>
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>Signature ok</span>
<span class=go>subject=CN = calico-node</span>
<span class=go>Getting CA Private Key</span>
</code></pre></div> <p>将密钥和证书存储在 calico/node 将要访问的 Secret 中。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>calico-node-certs<span class=w> </span>--from-file<span class=o>=</span>calico-node.key<span class=w> </span>--from-file<span class=o>=</span>calico-node.crt
</code></pre></div> <ul> <li>准备RBAC</li> </ul> <p>切换至当前用户的home目录。</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>~
</code></pre></div> <p>创建一个 <code>calico/node</code> 要使用的 ServiceAccount。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>serviceaccount<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>calico-node
</code></pre></div> <p>准备一个集群角色，该角色具有读写Calico数据库对象的权限。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>kind: ClusterRole</span>
<span class=s>apiVersion: rbac.authorization.k8s.io/v1</span>
<span class=s>metadata:</span>
<span class=s>  name: calico-node</span>
<span class=s>rules:</span>
<span class=s>  # The CNI plugin needs to get pods, nodes, and namespaces.</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - pods</span>
<span class=s>      - nodes</span>
<span class=s>      - namespaces</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>  # EndpointSlices are used for Service-based network policy rule</span>
<span class=s>  # enforcement.</span>
<span class=s>  - apiGroups: [&quot;discovery.k8s.io&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - endpointslices</span>
<span class=s>    verbs:</span>
<span class=s>      - watch</span>
<span class=s>      - list</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - endpoints</span>
<span class=s>      - services</span>
<span class=s>    verbs:</span>
<span class=s>      # Used to discover service IPs for advertisement.</span>
<span class=s>      - watch</span>
<span class=s>      - list</span>
<span class=s>      # Used to discover Typhas.</span>
<span class=s>      - get</span>
<span class=s>  # Pod CIDR auto-detection on kubeadm needs access to config maps.</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - configmaps</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - nodes/status</span>
<span class=s>    verbs:</span>
<span class=s>      # Needed for clearing NodeNetworkUnavailable flag.</span>
<span class=s>      - patch</span>
<span class=s>      # Calico stores some configuration information in node annotations.</span>
<span class=s>      - update</span>
<span class=s>  # Watch for changes to Kubernetes NetworkPolicies.</span>
<span class=s>  - apiGroups: [&quot;networking.k8s.io&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - networkpolicies</span>
<span class=s>    verbs:</span>
<span class=s>      - watch</span>
<span class=s>      - list</span>
<span class=s>  # Used by Calico for policy information.</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - pods</span>
<span class=s>      - namespaces</span>
<span class=s>      - serviceaccounts</span>
<span class=s>    verbs:</span>
<span class=s>      - list</span>
<span class=s>      - watch</span>
<span class=s>  # The CNI plugin patches pods/status.</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - pods/status</span>
<span class=s>    verbs:</span>
<span class=s>      - patch</span>
<span class=s>  # Used for creating service account tokens to be used by the CNI plugin</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - serviceaccounts/token</span>
<span class=s>    resourceNames:</span>
<span class=s>      - calico-node</span>
<span class=s>    verbs:</span>
<span class=s>      - create</span>
<span class=s>  # Calico monitors various CRDs for config.</span>
<span class=s>  - apiGroups: [&quot;crd.projectcalico.org&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - globalfelixconfigs</span>
<span class=s>      - felixconfigurations</span>
<span class=s>      - bgppeers</span>
<span class=s>      - globalbgpconfigs</span>
<span class=s>      - bgpconfigurations</span>
<span class=s>      - ippools</span>
<span class=s>      - ipamblocks</span>
<span class=s>      - globalnetworkpolicies</span>
<span class=s>      - globalnetworksets</span>
<span class=s>      - networkpolicies</span>
<span class=s>      - networksets</span>
<span class=s>      - clusterinformations</span>
<span class=s>      - hostendpoints</span>
<span class=s>      - blockaffinities</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>      - list</span>
<span class=s>      - watch</span>
<span class=s>  # Calico must create and update some CRDs on startup.</span>
<span class=s>  - apiGroups: [&quot;crd.projectcalico.org&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - ippools</span>
<span class=s>      - felixconfigurations</span>
<span class=s>      - clusterinformations</span>
<span class=s>    verbs:</span>
<span class=s>      - create</span>
<span class=s>      - update</span>
<span class=s>  # Calico stores some configuration information on the node.</span>
<span class=s>  - apiGroups: [&quot;&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - nodes</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>      - list</span>
<span class=s>      - watch</span>
<span class=s>  # These permissions are required for Calico CNI to perform IPAM allocations.</span>
<span class=s>  - apiGroups: [&quot;crd.projectcalico.org&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - blockaffinities</span>
<span class=s>      - ipamblocks</span>
<span class=s>      - ipamhandles</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>      - list</span>
<span class=s>      - create</span>
<span class=s>      - update</span>
<span class=s>      - delete</span>
<span class=s>  - apiGroups: [&quot;crd.projectcalico.org&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - ipamconfigs</span>
<span class=s>    verbs:</span>
<span class=s>      - get</span>
<span class=s>  # Block affinities must also be watchable by confd for route aggregation.</span>
<span class=s>  - apiGroups: [&quot;crd.projectcalico.org&quot;]</span>
<span class=s>    resources:</span>
<span class=s>      - blockaffinities</span>
<span class=s>    verbs:</span>
<span class=s>      - watch</span>
<span class=s>EOF</span>
</code></pre></div> <p>把创建的集群角色绑定到<code>calico-node</code>这个ServiceAccount。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>clusterrolebinding<span class=w> </span>calico-node<span class=w> </span>--clusterrole<span class=o>=</span>calico-node<span class=w> </span>--serviceaccount<span class=o>=</span>kube-system:calico-node
</code></pre></div> <ul> <li>安装daemonset</li> </ul> <p>切换至当前用户的home目录。</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>~
</code></pre></div> <p><code>calico/node</code>作为daemonset运行，安装在群集中的每个节点上。</p> <p>修改<code>image: calico/node:v3.20.0</code>为实际安装版本。</p> <p>创建daemonset。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>kind: DaemonSet</span>
<span class=s>apiVersion: apps/v1</span>
<span class=s>metadata:</span>
<span class=s>  name: calico-node</span>
<span class=s>  namespace: kube-system</span>
<span class=s>  labels:</span>
<span class=s>    k8s-app: calico-node</span>
<span class=s>spec:</span>
<span class=s>  selector:</span>
<span class=s>    matchLabels:</span>
<span class=s>      k8s-app: calico-node</span>
<span class=s>  updateStrategy:</span>
<span class=s>    type: RollingUpdate</span>
<span class=s>    rollingUpdate:</span>
<span class=s>      maxUnavailable: 1</span>
<span class=s>  template:</span>
<span class=s>    metadata:</span>
<span class=s>      labels:</span>
<span class=s>        k8s-app: calico-node</span>
<span class=s>    spec:</span>
<span class=s>      nodeSelector:</span>
<span class=s>        kubernetes.io/os: linux</span>
<span class=s>      hostNetwork: true</span>
<span class=s>      tolerations:</span>
<span class=s>        # Make sure calico-node gets scheduled on all nodes.</span>
<span class=s>        - effect: NoSchedule</span>
<span class=s>          operator: Exists</span>
<span class=s>        # Mark the pod as a critical add-on for rescheduling.</span>
<span class=s>        - key: CriticalAddonsOnly</span>
<span class=s>          operator: Exists</span>
<span class=s>        - effect: NoExecute</span>
<span class=s>          operator: Exists</span>
<span class=s>      serviceAccountName: calico-node</span>
<span class=s>      # Minimize downtime during a rolling upgrade or deletion; tell Kubernetes to do a &quot;force</span>
<span class=s>      # deletion&quot;: https://kubernetes.io/docs/concepts/workloads/pods/pod/#termination-of-pods.</span>
<span class=s>      terminationGracePeriodSeconds: 0</span>
<span class=s>      priorityClassName: system-node-critical</span>
<span class=s>      containers:</span>
<span class=s>        # Runs calico-node container on each Kubernetes node.  This</span>
<span class=s>        # container programs network policy and routes on each</span>
<span class=s>        # host.</span>
<span class=s>        - name: calico-node</span>
<span class=s>          image: calico/node:v3.20.0</span>
<span class=s>          env:</span>
<span class=s>            # Use Kubernetes API as the backing datastore.</span>
<span class=s>            - name: DATASTORE_TYPE</span>
<span class=s>              value: &quot;kubernetes&quot;</span>
<span class=s>            - name: FELIX_TYPHAK8SSERVICENAME</span>
<span class=s>              value: calico-typha</span>
<span class=s>            # Wait for the datastore.</span>
<span class=s>            - name: WAIT_FOR_DATASTORE</span>
<span class=s>              value: &quot;true&quot;</span>
<span class=s>            # Set based on the k8s node name.</span>
<span class=s>            - name: NODENAME</span>
<span class=s>              valueFrom:</span>
<span class=s>                fieldRef:</span>
<span class=s>                  fieldPath: spec.nodeName</span>
<span class=s>            # Choose the backend to use.</span>
<span class=s>            - name: CALICO_NETWORKING_BACKEND</span>
<span class=s>              value: bird</span>
<span class=s>            # Cluster type to identify the deployment type</span>
<span class=s>            - name: CLUSTER_TYPE</span>
<span class=s>              value: &quot;k8s,bgp&quot;</span>
<span class=s>            # Auto-detect the BGP IP address.</span>
<span class=s>            - name: IP</span>
<span class=s>              value: &quot;autodetect&quot;</span>
<span class=s>            # Disable file logging so kubectl logs works.</span>
<span class=s>            - name: CALICO_DISABLE_FILE_LOGGING</span>
<span class=s>              value: &quot;true&quot;</span>
<span class=s>            # Set Felix endpoint to host default action to ACCEPT.</span>
<span class=s>            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION</span>
<span class=s>              value: &quot;ACCEPT&quot;</span>
<span class=s>            # Disable IPv6 on Kubernetes.</span>
<span class=s>            - name: FELIX_IPV6SUPPORT</span>
<span class=s>              value: &quot;false&quot;</span>
<span class=s>            # Set Felix logging to &quot;info&quot;</span>
<span class=s>            - name: FELIX_LOGSEVERITYSCREEN</span>
<span class=s>              value: &quot;info&quot;</span>
<span class=s>            - name: FELIX_HEALTHENABLED</span>
<span class=s>              value: &quot;true&quot;</span>
<span class=s>            # Location of the CA bundle Felix uses to authenticate Typha; volume mount</span>
<span class=s>            - name: FELIX_TYPHACAFILE</span>
<span class=s>              value: /calico-typha-ca/typhaca.crt</span>
<span class=s>            # Common name on the Typha certificate; used to verify we are talking to an authentic typha</span>
<span class=s>            - name: FELIX_TYPHACN</span>
<span class=s>              value: calico-typha</span>
<span class=s>            # Location of the client certificate for connecting to Typha; volume mount</span>
<span class=s>            - name: FELIX_TYPHACERTFILE</span>
<span class=s>              value: /calico-node-certs/calico-node.crt</span>
<span class=s>            # Location of the client certificate key for connecting to Typha; volume mount</span>
<span class=s>            - name: FELIX_TYPHAKEYFILE</span>
<span class=s>              value: /calico-node-certs/calico-node.key</span>
<span class=s>          securityContext:</span>
<span class=s>            privileged: true</span>
<span class=s>          resources:</span>
<span class=s>            requests:</span>
<span class=s>              cpu: 250m</span>
<span class=s>          lifecycle:</span>
<span class=s>            preStop:</span>
<span class=s>              exec:</span>
<span class=s>                command:</span>
<span class=s>                - /bin/calico-node</span>
<span class=s>                - -shutdown</span>
<span class=s>          livenessProbe:</span>
<span class=s>            httpGet:</span>
<span class=s>              path: /liveness</span>
<span class=s>              port: 9099</span>
<span class=s>              host: localhost</span>
<span class=s>            periodSeconds: 10</span>
<span class=s>            initialDelaySeconds: 10</span>
<span class=s>            failureThreshold: 6</span>
<span class=s>          readinessProbe:</span>
<span class=s>            exec:</span>
<span class=s>              command:</span>
<span class=s>              - /bin/calico-node</span>
<span class=s>              - -bird-ready</span>
<span class=s>              - -felix-ready</span>
<span class=s>            periodSeconds: 10</span>
<span class=s>          volumeMounts:</span>
<span class=s>            - mountPath: /lib/modules</span>
<span class=s>              name: lib-modules</span>
<span class=s>              readOnly: true</span>
<span class=s>            - mountPath: /run/xtables.lock</span>
<span class=s>              name: xtables-lock</span>
<span class=s>              readOnly: false</span>
<span class=s>            - mountPath: /var/run/calico</span>
<span class=s>              name: var-run-calico</span>
<span class=s>              readOnly: false</span>
<span class=s>            - mountPath: /var/lib/calico</span>
<span class=s>              name: var-lib-calico</span>
<span class=s>              readOnly: false</span>
<span class=s>            - mountPath: /var/run/nodeagent</span>
<span class=s>              name: policysync</span>
<span class=s>            - mountPath: &quot;/calico-typha-ca&quot;</span>
<span class=s>              name: calico-typha-ca</span>
<span class=s>              readOnly: true</span>
<span class=s>            - mountPath: /calico-node-certs</span>
<span class=s>              name: calico-node-certs</span>
<span class=s>              readOnly: true</span>
<span class=s>      volumes:</span>
<span class=s>        # Used by calico-node.</span>
<span class=s>        - name: lib-modules</span>
<span class=s>          hostPath:</span>
<span class=s>            path: /lib/modules</span>
<span class=s>        - name: var-run-calico</span>
<span class=s>          hostPath:</span>
<span class=s>            path: /var/run/calico</span>
<span class=s>        - name: var-lib-calico</span>
<span class=s>          hostPath:</span>
<span class=s>            path: /var/lib/calico</span>
<span class=s>        - name: xtables-lock</span>
<span class=s>          hostPath:</span>
<span class=s>            path: /run/xtables.lock</span>
<span class=s>            type: FileOrCreate</span>
<span class=s>        # Used to create per-pod Unix Domain Sockets</span>
<span class=s>        - name: policysync</span>
<span class=s>          hostPath:</span>
<span class=s>            type: DirectoryOrCreate</span>
<span class=s>            path: /var/run/nodeagent</span>
<span class=s>        - name: calico-typha-ca</span>
<span class=s>          configMap:</span>
<span class=s>            name: calico-typha-ca</span>
<span class=s>        - name: calico-node-certs</span>
<span class=s>          secret:</span>
<span class=s>            secretName: calico-node-certs</span>
<span class=s>EOF</span>
</code></pre></div> <p>验证在集群中每个节点上 <code>calico/node</code> 是否在运行，安装后，一般在几分钟内会变为 Running 状态。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>-l<span class=w> </span>k8s-app<span class=o>=</span>calico-node<span class=w> </span>-n<span class=w> </span>kube-system
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME                READY   STATUS    RESTARTS   AGE</span>
<span class=go>calico-node-4c4sp   1/1     Running   0          40s</span>
<span class=go>calico-node-j2z6v   1/1     Running   0          40s</span>
<span class=go>calico-node-vgm9n   1/1     Running   0          40s</span>
</code></pre></div> <h2 id=_1>测试网络<a class=headerlink href=#_1 title="Permanent link"> ¶</a></h2> <h3 id=podping>pod之间的ping<a class=headerlink href=#podping title="Permanent link"> ¶</a></h3> <p>创建三个busybox实例。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>deployment<span class=w> </span>pingtest<span class=w> </span>--image<span class=o>=</span>busybox<span class=w> </span>--replicas<span class=o>=</span><span class=m>3</span><span class=w> </span>--<span class=w> </span>sleep<span class=w> </span>infinity
</code></pre></div> <p>查询他们的IP地址。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>--selector<span class=o>=</span><span class=nv>app</span><span class=o>=</span>pingtest<span class=w> </span>--output<span class=o>=</span>wide
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME                        READY   STATUS    RESTARTS   AGE   IP             NODE     NOMINATED NODE   READINESS GATES</span>
<span class=go>pingtest-585b76c894-chwjq   1/1     Running   0          7s    10.244.31.1    cka002   &lt;none&gt;           &lt;none&gt;</span>
<span class=go>pingtest-585b76c894-s2tbs   1/1     Running   0          7s    10.244.31.0    cka002   &lt;none&gt;           &lt;none&gt;</span>
<span class=go>pingtest-585b76c894-vm9wn   1/1     Running   0          7s    10.244.28.64   cka003   &lt;none&gt;           &lt;none&gt;</span>
</code></pre></div> <p>留意第二个和第三个 pod 的 IP 地址。 随后我们会在第一个 pod 中运行 exec 命令。 在第一个 pod 内部，对另外两个 pod 的 IP 地址进行 ping 测试。</p> <p>例如：</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-ti<span class=w> </span>pingtest-585b76c894-chwjq<span class=w> </span>--<span class=w> </span>sh
/<span class=w> </span><span class=c1># ping 10.244.31.1 -c 4</span>
<span class=m>4</span><span class=w> </span>packets<span class=w> </span>transmitted,<span class=w> </span><span class=m>4</span><span class=w> </span>packets<span class=w> </span>received,<span class=w> </span><span class=m>0</span>%<span class=w> </span>packet<span class=w> </span>loss

/<span class=w> </span><span class=c1># ping 10.244.31.0 -c 4</span>
<span class=m>4</span><span class=w> </span>packets<span class=w> </span>transmitted,<span class=w> </span><span class=m>4</span><span class=w> </span>packets<span class=w> </span>received,<span class=w> </span><span class=m>0</span>%<span class=w> </span>packet<span class=w> </span>loss

/<span class=w> </span><span class=c1># ping 10.244.28.64 -c 4</span>
<span class=m>4</span><span class=w> </span>packets<span class=w> </span>transmitted,<span class=w> </span><span class=m>0</span><span class=w> </span>packets<span class=w> </span>received,<span class=w> </span><span class=m>100</span>%<span class=w> </span>packet<span class=w> </span>loss
</code></pre></div> <h3 id=_2>路由检查<a class=headerlink href=#_2 title="Permanent link"> ¶</a></h3> <p>从其中一个节点验证是否能ping通到每个pod的IP地址。例如：</p> <div class=highlight><pre><span></span><code>ip<span class=w> </span>route<span class=w> </span>get<span class=w> </span><span class=m>10</span>.244.31.1
ip<span class=w> </span>route<span class=w> </span>get<span class=w> </span><span class=m>10</span>.244.31.0
ip<span class=w> </span>route<span class=w> </span>get<span class=w> </span><span class=m>10</span>.244.28.64
</code></pre></div> <p>在上面的结果中，示例中的 <code>via &lt;cka001_ip&gt;</code> （它是控制平面）表示此Pod IP的下一跳，这与Pod所在节点的IP地址匹配，符合预期。</p> <p>不同IP池的IPAM分配。在前面的演示中，我们创建了两个IP池，但将一个禁用了。</p> <div class=highlight><pre><span></span><code>calicoctl<span class=w> </span>get<span class=w> </span>ippools<span class=w> </span>-o<span class=w> </span>wide
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME            CIDR              NAT    IPIPMODE   VXLANMODE   DISABLED   DISABLEBGPEXPORT   SELECTOR   </span>
<span class=go>ipv4-ippool-1   10.244.0.0/18     true   Never      Never       false      false              all()      </span>
<span class=go>ipv4-ippool-2   10.244.192.0/19   true   Never      Never       true       false              all()   </span>
</code></pre></div> <p>激活第二个IP池。</p> <div class=highlight><pre><span></span><code>calicoctl<span class=w> </span>--allow-version-mismatch<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>apiVersion: projectcalico.org/v3</span>
<span class=s>kind: IPPool</span>
<span class=s>metadata:</span>
<span class=s>  name: ipv4-ippool-2</span>
<span class=s>spec:</span>
<span class=s>  cidr: 10.244.192.0/19</span>
<span class=s>  ipipMode: Never</span>
<span class=s>  natOutgoing: true</span>
<span class=s>  disabled: false</span>
<span class=s>  nodeSelector: all()</span>
<span class=s>EOF</span>
</code></pre></div> <p>查询IP池的状态。</p> <div class=highlight><pre><span></span><code>calicoctl<span class=w> </span>get<span class=w> </span>ippools<span class=w> </span>-o<span class=w> </span>wide
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME            CIDR              NAT    IPIPMODE   VXLANMODE   DISABLED   DISABLEBGPEXPORT   SELECTOR   </span>
<span class=go>ipv4-ippool-1   10.244.0.0/18     true   Never      Never       false      false              all()      </span>
<span class=go>ipv4-ippool-2   10.244.192.0/19   true   Never      Never       false      false              all()      </span>
</code></pre></div> <p>创建一个 Pod，以显式方式请求从 <code>pool2</code> 分配一个 IP 地址。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<span class=s>apiVersion: v1</span>
<span class=s>kind: Pod</span>
<span class=s>metadata:</span>
<span class=s>  name: pingtest-ippool-2</span>
<span class=s>  annotations:</span>
<span class=s>    cni.projectcalico.org/ipv4pools: &quot;[\&quot;ipv4-ippool-2\&quot;]&quot;</span>
<span class=s>spec:</span>
<span class=s>  containers:</span>
<span class=s>  - args:</span>
<span class=s>    - sleep</span>
<span class=s>    - infinity</span>
<span class=s>    image: busybox</span>
<span class=s>    imagePullPolicy: Always</span>
<span class=s>    name: pingtest</span>
<span class=s>EOF</span>
</code></pre></div> <p>验证pod已经从 <code>pool2</code> 分配一个 IP 地址。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>get<span class=w> </span>pod<span class=w> </span>pingtest-ippool-2<span class=w> </span>-o<span class=w> </span>wide
</code></pre></div> <p>运行结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME                READY   STATUS    RESTARTS   AGE   IP               NODE     NOMINATED NODE   READINESS GATES</span>
<span class=go>pingtest-ippool-2   1/1     Running   0          18s   10.244.203.192   cka003   &lt;none&gt;           &lt;none&gt;</span>
</code></pre></div> <p>连接并进入Pod <code>pingtest-585b76c894-chwjq</code>内部。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-ti<span class=w> </span>pingtest-585b76c894-chwjq<span class=w> </span>--<span class=w> </span>sh
/<span class=w> </span><span class=c1># 10.244.203.192 -c 4</span>
<span class=m>4</span><span class=w> </span>packets<span class=w> </span>transmitted,<span class=w> </span><span class=m>0</span><span class=w> </span>packets<span class=w> </span>received,<span class=w> </span><span class=m>100</span>%<span class=w> </span>packet<span class=w> </span>loss
</code></pre></div> <p>标记： 演示止于此，路由没有安装预期工作，原因查找中。</p> <p>删除演示中创建的临时资源。</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>delete<span class=w> </span>deployments.apps<span class=w> </span>pingtest
kubectl<span class=w> </span>delete<span class=w> </span>pod<span class=w> </span>pingtest-ippool-2
</code></pre></div> <p>参考：<a href=https://projectcalico.docs.tigera.io/getting-started/kubernetes/hardway/ >End-to-end Calico installation</a></p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../casestudy-health-check/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 健康检查" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> 健康检查 </div> </div> </a> <a href=../../../demo/cap_on_kyma/ class="md-footer__link md-footer__link--next" aria-label="Next: Build CAP Application on Kyma" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Build CAP Application on Kyma </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.top"], "search": "../../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": null}</script> <script src=../../../../assets/javascripts/bundle.b1047164.min.js></script> </body> </html>