<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://huyuhui001.github.io/mySite/k8s/cka_cn/foundamentals/docker/ rel=canonical><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.3"><title>Docker基础 - 知行斋</title><link rel=stylesheet href=../../../../assets/stylesheets/main.6b80c2a2.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#009485><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../extra.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=teal data-md-color-accent=green> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#cka4docker class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=知行斋 class="md-header__button md-logo" aria-label=知行斋 data-md-component=logo> <img src=../../../../assets/logo.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 知行斋 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Docker基础 </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> Site </a> </li> <li class=md-tabs__item> <a href=../../../../linux/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../ class="md-tabs__link md-tabs__link--active"> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../../python/ class=md-tabs__link> Python </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=知行斋 class="md-nav__button md-logo" aria-label=知行斋 data-md-component=logo> <img src=../../../../assets/logo.jpg alt=logo> </a> 知行斋 </label> <div class=md-nav__source> <a href=https://github.com/huyuhui001/mySite title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> huyuhui001/mySite </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Site <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Site data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Site </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../../../about/ class=md-nav__link> About </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Linux SRE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux SRE" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Linux SRE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/SRE/01-fundamentals/ class=md-nav__link> 第一章 Linux基础 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/02-filesystem/ class=md-nav__link> 第二章 文件系统 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/03-identity-security/ class=md-nav__link> 第三章 身份与安全 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/04-TextTools/ class=md-nav__link> 第四章 文本编辑 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/05-RegExpress/ class=md-nav__link> 第五章 正则表达式 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/06-FileLookup/ class=md-nav__link> 第六章 文件查找 </a> </li> <li class=md-nav__item> <a href=../../../../linux/SRE/07-FilePacking/ class=md-nav__link> 第七章 文件打包和解包 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> SUSE Linux Administration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Linux Administration" data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> SUSE Linux Administration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/Administration/01/ class=md-nav__link> Linux File System Overview </a> </li> <li class=md-nav__item> <a href=../../../../linux/Administration/02/ class=md-nav__link> Useful Commands </a> </li> <li class=md-nav__item> <a href=../../../../linux/Administration/03/ class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4> SUSE Enterprise Storage Foundation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SUSE Enterprise Storage Foundation" data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> SUSE Enterprise Storage Foundation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/SES/linux_ses_memo/ class=md-nav__link> SUSE Enterprise Storage Foundation </a> </li> <li class=md-nav__item> <a href=../../../../linux/SES/linux_ses_demo/ class=md-nav__link> SUSE Enterprise Storage Basic Operation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> CKA Learning Memo <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CKA Learning Memo" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> CKA Learning Memo </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_1 type=checkbox id=__nav_3_2_1> <label class=md-nav__link for=__nav_3_2_1> Installation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Installation data-md-level=3> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/installation/single-local/ class=md-nav__link> Single Node Installation </a> </li> <li class=md-nav__item> <a href=../../../cka_en/installation/multiple-local/ class=md-nav__link> Multiple Nodes Installation </a> </li> <li class=md-nav__item> <a href=../../../cka_en/installation/aliyun-ubuntu/ class=md-nav__link> Installation on Aliyun ECS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_2 type=checkbox id=__nav_3_2_2> <label class=md-nav__link for=__nav_3_2_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=3> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/docker/ class=md-nav__link> Fundamentals </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_3 type=checkbox id=__nav_3_2_3> <label class=md-nav__link for=__nav_3_2_3> Foundamentals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Foundamentals data-md-level=3> <label class=md-nav__title for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> Foundamentals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/memo/ class=md-nav__link> Memo </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/basics/ class=md-nav__link> kubectl basics </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_4 type=checkbox id=__nav_3_2_4> <label class=md-nav__link for=__nav_3_2_4> Core Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Core Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_4> <span class="md-nav__icon md-icon"></span> Core Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_5 type=checkbox id=__nav_3_2_5> <label class=md-nav__link for=__nav_3_2_5> Application Modeling <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Application Modeling" data-md-level=3> <label class=md-nav__title for=__nav_3_2_5> <span class="md-nav__icon md-icon"></span> Application Modeling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/secrets/ class=md-nav__link> Secrets </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/rbac/ class=md-nav__link> Role Based Access Control (RBAC) </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/ingress/ class=md-nav__link> Ingress </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_6 type=checkbox id=__nav_3_2_6> <label class=md-nav__link for=__nav_3_2_6> Advanced Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advanced Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_6> <span class="md-nav__icon md-icon"></span> Advanced Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_7 type=checkbox id=__nav_3_2_7> <label class=md-nav__link for=__nav_3_2_7> Operating Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Operating Kubernetes" data-md-level=3> <label class=md-nav__title for=__nav_3_2_7> <span class="md-nav__icon md-icon"></span> Operating Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/healthcheck/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/helming/ class=md-nav__link> Helming </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_8 type=checkbox id=__nav_3_2_8> <label class=md-nav__link for=__nav_3_2_8> Topics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Topics data-md-level=3> <label class=md-nav__title for=__nav_3_2_8> <span class="md-nav__icon md-icon"></span> Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/casestudy-operation-resources/ class=md-nav__link> Operations on Resources </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/casestudy-health-check/ class=md-nav__link> Health Check </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/casestudy-calico/ class=md-nav__link> Calico Installation </a> </li> <li class=md-nav__item> <a href=../../../cka_en/foundamentals/kyma/ class=md-nav__link> Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3> CKA学习笔记 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CKA学习笔记 data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> CKA学习笔记 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_1 type=checkbox id=__nav_3_3_1> <label class=md-nav__link for=__nav_3_3_1> 安装 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=安装 data-md-level=3> <label class=md-nav__title for=__nav_3_3_1> <span class="md-nav__icon md-icon"></span> 安装 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../installation/single-local/ class=md-nav__link> 单节点虚拟机安装Kubernetes </a> </li> <li class=md-nav__item> <a href=../../installation/multiple-local/ class=md-nav__link> 多节点虚拟机安装Kubernetes </a> </li> <li class=md-nav__item> <a href=../../installation/aliyun-ubuntu/ class=md-nav__link> 阿里云ECS安装Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_2 type=checkbox id=__nav_3_3_2 checked> <label class=md-nav__link for=__nav_3_3_2> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=3> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Docker基础 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Docker基础 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 摘要 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 练习环境 </a> </li> <li class=md-nav__item> <a href=#linux class=md-nav__link> Linux原语 </a> <nav class=md-nav aria-label=Linux原语> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chroot class=md-nav__link> chroot </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 命名空间 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 控制组 </a> </li> <li class=md-nav__item> <a href=#apparmorselinux class=md-nav__link> Apparmor和SELinux配置文件 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 内核能力 </a> </li> <li class=md-nav__item> <a href=#seccomp class=md-nav__link> seccomp策略 </a> </li> <li class=md-nav__item> <a href=#netlink class=md-nav__link> Netlink </a> </li> <li class=md-nav__item> <a href=#netfilter class=md-nav__link> Netfilter </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#docker class=md-nav__link> 安装Docker </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 容器生命周期 </a> <nav class=md-nav aria-label=容器生命周期> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 概述 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 端口和卷 </a> </li> <li class=md-nav__item> <a href=#dockerfile class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=#dockerfile_1 class=md-nav__link> 多阶段Dockerfile </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_3 type=checkbox id=__nav_3_3_3> <label class=md-nav__link for=__nav_3_3_3> 基础知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础知识 data-md-level=3> <label class=md-nav__title for=__nav_3_3_3> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../memo/ class=md-nav__link> Kubernetes随笔 </a> </li> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> Kubernetes集群概览 </a> </li> <li class=md-nav__item> <a href=../basics/ class=md-nav__link> kubectl基础 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_4 type=checkbox id=__nav_3_3_4> <label class=md-nav__link for=__nav_3_3_4> 核心概念 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=核心概念 data-md-level=3> <label class=md-nav__title for=__nav_3_3_4> <span class="md-nav__icon md-icon"></span> 核心概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../pod/ class=md-nav__link> Pod </a> </li> <li class=md-nav__item> <a href=../deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../service/ class=md-nav__link> Service </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_5 type=checkbox id=__nav_3_3_5> <label class=md-nav__link for=__nav_3_3_5> 应用体系 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=应用体系 data-md-level=3> <label class=md-nav__title for=__nav_3_3_5> <span class="md-nav__icon md-icon"></span> 应用体系 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../namespace/ class=md-nav__link> Namespace </a> </li> <li class=md-nav__item> <a href=../statefulset/ class=md-nav__link> StatefulSet </a> </li> <li class=md-nav__item> <a href=../daemonset/ class=md-nav__link> DaemonSet </a> </li> <li class=md-nav__item> <a href=../job/ class=md-nav__link> Job and Cronjob </a> </li> <li class=md-nav__item> <a href=../configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../secrets/ class=md-nav__link> secrets </a> </li> <li class=md-nav__item> <a href=../persistence/ class=md-nav__link> Persistence </a> </li> <li class=md-nav__item> <a href=../rbac/ class=md-nav__link> RBAC鉴权 </a> </li> <li class=md-nav__item> <a href=../ingress/ class=md-nav__link> Ingress-nginx </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_6 type=checkbox id=__nav_3_3_6> <label class=md-nav__link for=__nav_3_3_6> 进阶概念 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=进阶概念 data-md-level=3> <label class=md-nav__title for=__nav_3_3_6> <span class="md-nav__icon md-icon"></span> 进阶概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../scheduling/ class=md-nav__link> Scheduling </a> </li> <li class=md-nav__item> <a href=../hpa/ class=md-nav__link> Horizontal Pod Autoscaling (HPA) </a> </li> <li class=md-nav__item> <a href=../policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../networkpolicy/ class=md-nav__link> Network Policy </a> </li> <li class=md-nav__item> <a href=../clustermgt/ class=md-nav__link> Cluster Management </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_7 type=checkbox id=__nav_3_3_7> <label class=md-nav__link for=__nav_3_3_7> 日常维护 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=日常维护 data-md-level=3> <label class=md-nav__title for=__nav_3_3_7> <span class="md-nav__icon md-icon"></span> 日常维护 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../healthcheck/ class=md-nav__link> 健康检查 </a> </li> <li class=md-nav__item> <a href=../helming/ class=md-nav__link> Helm Chart </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_8 type=checkbox id=__nav_3_3_8> <label class=md-nav__link for=__nav_3_3_8> 主题讨论 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=主题讨论 data-md-level=3> <label class=md-nav__title for=__nav_3_3_8> <span class="md-nav__icon md-icon"></span> 主题讨论 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../casestudy-operation-resources/ class=md-nav__link> Kubernetes资源常见操作 </a> </li> <li class=md-nav__item> <a href=../casestudy-health-check/ class=md-nav__link> 健康检查 </a> </li> <li class=md-nav__item> <a href=../casestudy-calico/ class=md-nav__link> 安装Calico </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../demo/cap_on_kyma/ class=md-nav__link> Build CAP Application on Kyma </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/ class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Python基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python基础 data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Python基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/Foundation/ch00/ class=md-nav__link> Python安装 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch01/ class=md-nav__link> Python语言基础 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch02/ class=md-nav__link> Python打包和解包 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch03/ class=md-nav__link> Python内置函数及文件 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch04/ class=md-nav__link> Python面向对象概念 </a> </li> <li class=md-nav__item> <a href=../../../../python/Foundation/ch05/ class=md-nav__link> Python面向对象三大特性 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Python数据分析基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python数据分析基础 data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Python数据分析基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch01/ class=md-nav__link> NumPy基础 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch10/ class=md-nav__link> NumPy进阶 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch02/ class=md-nav__link> Pandas入门 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch03/ class=md-nav__link> 数据载入、存储及文件格式 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch04/ class=md-nav__link> 数据清洗与准备 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch05/ class=md-nav__link> 数据规整：连接、联合与重塑 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch06/ class=md-nav__link> 绘图与可视化 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch07/ class=md-nav__link> 数据聚合与分组操作 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch08/ class=md-nav__link> 时间序列 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch09/ class=md-nav__link> 高阶pandas </a> </li> <li class=md-nav__item> <a href=../../../../python/DataAnalysis/ch11/ class=md-nav__link> Python建模库介绍 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4> 数据结构和算法 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=数据结构和算法 data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> 数据结构和算法 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/DataStructure/01_PythonFundmantal/ class=md-nav__link> 基础知识回顾 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataStructure/02_CollectionsOverview/ class=md-nav__link> 多项集的概述 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataStructure/03_TimeComplexity/ class=md-nav__link> 搜索、排序以及复杂度分析 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataStructure/04_ArrayChain/ class=md-nav__link> 数组和链接结构 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataStructure/05_InterfacePolymorphism/ class=md-nav__link> 接口、实现和多态 </a> </li> <li class=md-nav__item> <a href=../../../../python/DataStructure/06_InheritanceAbstractClass/ class=md-nav__link> 继承与抽象类 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_5 type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5> Effective Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Effective Python" data-md-level=2> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Effective Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule01/ class=md-nav__link> 第01条 查询自己使用的Python版本 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule02/ class=md-nav__link> 第02条 遵循PEP 8风格指南 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule03/ class=md-nav__link> 第03条 了解bytes与str的区别 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule04/ class=md-nav__link> 第04条 用支持插值的f-string取代C风格的格式字符串与str.format方法 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule05/ class=md-nav__link> 第05条 用辅助函数取代复杂的表达式 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule06/ class=md-nav__link> 第06条 把数据结构直接拆分到多个变量里，不要专门通过下标访问 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule07/ class=md-nav__link> 第07条 尽量用enumerate取代range </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule08/ class=md-nav__link> 第08条 用zip函数同时遍历两个迭代器 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule09/ class=md-nav__link> 第09条 不要在for与while循环后面写else块 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule10/ class=md-nav__link> 第10条 用赋值表达式减少重复代码 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule11/ class=md-nav__link> 第11条 学会对序列做切片 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule12/ class=md-nav__link> 第12条 不要在切片里同时指定起止下标与步进 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule13/ class=md-nav__link> 第13条 通过带星号的unpacking操作来捕获多个元素,不要用切片 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule14/ class=md-nav__link> 第14条 用sort方法的key参数来表示复杂的排序逻辑 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule15/ class=md-nav__link> 第15条 不要过分依赖给字典添加条目时所用的顺序 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule16/ class=md-nav__link> 第16条 用get处理键不在字典中的情况,不要使用in与KeyError </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule17/ class=md-nav__link> 第17条 用defaultdict处理内部状态中缺失的元素,而不要用setdefault </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule18/ class=md-nav__link> 第18条 学会利用__missing__构造依赖键的默认值 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule19/ class=md-nav__link> 第19条 不要把函数返回的多个数值拆分到三个以上的变量中 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule20/ class=md-nav__link> 第20条 遇到意外状况时应该抛出异常,不要返回None </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule21/ class=md-nav__link> 第21条 了解如何在闭包里面使用外围作用域中的变量 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule22/ class=md-nav__link> 第22条 用数量可变的位置参数给函数设计清晰的参数列表 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule23/ class=md-nav__link> 第23条 用关键字参数来表示可选的行为 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule24/ class=md-nav__link> 第24条 用None和docstring来描述默认值会变的参数 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule25/ class=md-nav__link> 第25条 用只能以关键字指定和只能按位置传入的参数来设计清晰的参数列表 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule26/ class=md-nav__link> 第26条 用functools.wraps定义函数修饰器 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule27/ class=md-nav__link> 第27条 用列表推导取代map与filter </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule28/ class=md-nav__link> 第28条 控制推导逻辑的子表达式不要超过两个 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule29/ class=md-nav__link> 第29条 用赋值表达式消除推导中的重复代码 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule30/ class=md-nav__link> 第30条 不要让函数直接返回列表，应该让它逐个生成列表里的值 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule31/ class=md-nav__link> 第31条 谨慎地迭代函数所收到的参数 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule32/ class=md-nav__link> 第32条 考虑用生成器表达式改写数据量较大的列表推导 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule33/ class=md-nav__link> 第33条 通过yield from把多个生成器连起来用 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule34/ class=md-nav__link> 第34条 不要用send给生成器注入数据 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule35/ class=md-nav__link> 第35条 不要通过throw变换生成器的状态 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule36/ class=md-nav__link> 第36条 考虑用itertools拼装迭代器与生成器 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule37/ class=md-nav__link> 第37条 用组合起来的类来实现多层结构，不要用嵌套的内置类型 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule38/ class=md-nav__link> 第38条 让简单的接口接受函数，而不是类的实例 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule39/ class=md-nav__link> 第39条 通过@classmethod多态来构造同一体系中的各类对象 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule40/ class=md-nav__link> 第40条 通过super初始化超类 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule41/ class=md-nav__link> 第41条 考虑用mix-in类来表示可组合的功能 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule42/ class=md-nav__link> 第42条 优先考虑用public属性表示应受保护的数据,不要用private属性表示 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule43/ class=md-nav__link> 第43条 自定义的容器类型应该从collections.abc继承 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule44/ class=md-nav__link> 第44条 用纯属性与修饰器取代旧式的setter与getter方法 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule45/ class=md-nav__link> 第45条 考虑用@property实现新的属性访问逻辑,不要急着重构原有的代码 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule46/ class=md-nav__link> 第46条 用描述符来改写需要复用的@property方法 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule47/ class=md-nav__link> 第47条 针对惰性属性使用__getattr__、__getattribute__及__setattr__ </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule48/ class=md-nav__link> 第48条 用__init_subclass__验证子类写得是否正确 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule49/ class=md-nav__link> 第49条 用__init_subclass__记录现有的子类 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule50/ class=md-nav__link> 第50条 用__set_name__给类属性加注解 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule51/ class=md-nav__link> 第51条 优先考虑通过类修饰器来提供可组合的扩充功能，不要使用元类 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule52/ class=md-nav__link> 第52条 用subprocess管理子进程 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule53/ class=md-nav__link> 第53条 可以用线程执行阻塞式I/O,但不要用它做并行计算 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule54/ class=md-nav__link> 第54条 利用Lock防止多个线程争用同一份数据 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule55/ class=md-nav__link> 第55条 用Queue来协调各线程之间的工作进度 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule56/ class=md-nav__link> 第56条 学会判断什么场合必须做并发 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule57/ class=md-nav__link> 第57条 不要在每次fan-out时都新建一批Thread实例 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule58/ class=md-nav__link> 第58条 学会正确地重构代码,以便用Queue做并发 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule59/ class=md-nav__link> 第59条 如果必须用线程做并发,那就考虑通过ThreadPoolExecutor实现 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule60/ class=md-nav__link> 第60条 用协程实现高并发的I/O </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule61/ class=md-nav__link> 第61条 学会用asyncio改写那些通过线程实现的I/O </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule62/ class=md-nav__link> 第62条 结合线程与协程,将代码顺利迁移到asyncio </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule63/ class=md-nav__link> 第63条 让asyncio的事件循环保持畅通,以便进一步提升程序的响应能力 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule64/ class=md-nav__link> 第64条 考虑用concurrent.futures实现真正的并行计算 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule65/ class=md-nav__link> 第65条 合理利用try/except/else/finally结构中的每个代码块 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule66/ class=md-nav__link> 第66条 考虑用contextlib和with语句来改写可复用的try/finally代码 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule67/ class=md-nav__link> 第67条 用datetime模块处理本地时间,不要用time模块 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule68/ class=md-nav__link> 第68条 用copyreg实现可靠的pickle操作 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule69/ class=md-nav__link> 第69条 在需要准确计算的场合,用decimal表示相应的数值 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule70/ class=md-nav__link> 第70条 先分析性能，然后再优化 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule71/ class=md-nav__link> 第71条 优先考虑用deque实现生产者-消费者队列 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule72/ class=md-nav__link> 第72条 考虑用bisect搜索已排序的序列 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule73/ class=md-nav__link> 第73条 学会使用heapq制作优先级队列 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule74/ class=md-nav__link> 第74条 考虑用memoryview与bytearray来实现无须拷贝的bytes操作 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule75/ class=md-nav__link> 第75条 通过repr字符串输出调试信息 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule76/ class=md-nav__link> 第76条 在TestCase子类里验证相关的行为 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule77/ class=md-nav__link> 第77条 把测试前、后的准备与清理逻辑写在setUp、tearDown、setUpModule与tearDownModule中,以防用例之间互相干扰 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule78/ class=md-nav__link> 第78条 用Mock来模拟受测代码所依赖的复杂函数 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule79/ class=md-nav__link> 第79条 把受测代码所依赖的系统封装起来，以便于模拟和测试 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule80/ class=md-nav__link> 第80条 考虑用pdb做交互调试 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule81/ class=md-nav__link> 第81条 用tracemalloc来掌握内存的使用与泄漏情况 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule82/ class=md-nav__link> 第82条 学会寻找由其他Python开发者所构建的模块 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule83/ class=md-nav__link> 第83条 用虚拟环境隔离项目,并重建依赖关系 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule84/ class=md-nav__link> 第84条 每一个函数、类与模块都要写docstring </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule85/ class=md-nav__link> 第85条 用包来安排模块,以提供稳固的API </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule86/ class=md-nav__link> 第86条 考虑用模块级别的代码配置不同的部署环境 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule87/ class=md-nav__link> 第87条 为自编的模块定义根异常,让调用者能够专门处理与此API有关的异常 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule88/ class=md-nav__link> 第88条 用适当的方式打破循环依赖关系 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule89/ class=md-nav__link> 第89条 重构时考虑通过warnings提醒开发者API已经发生变化 </a> </li> <li class=md-nav__item> <a href=../../../../python/Pythonic90Rules/Rule90/ class=md-nav__link> 第90条 考虑通过typing做静态分析,以消除bug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_6 type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6> Demos <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Demos data-md-level=2> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../python/Demo/CourseSystem/ class=md-nav__link> 选课系统 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 摘要 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 练习环境 </a> </li> <li class=md-nav__item> <a href=#linux class=md-nav__link> Linux原语 </a> <nav class=md-nav aria-label=Linux原语> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chroot class=md-nav__link> chroot </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 命名空间 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 控制组 </a> </li> <li class=md-nav__item> <a href=#apparmorselinux class=md-nav__link> Apparmor和SELinux配置文件 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 内核能力 </a> </li> <li class=md-nav__item> <a href=#seccomp class=md-nav__link> seccomp策略 </a> </li> <li class=md-nav__item> <a href=#netlink class=md-nav__link> Netlink </a> </li> <li class=md-nav__item> <a href=#netfilter class=md-nav__link> Netfilter </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#docker class=md-nav__link> 安装Docker </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 容器生命周期 </a> <nav class=md-nav aria-label=容器生命周期> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 概述 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 端口和卷 </a> </li> <li class=md-nav__item> <a href=#dockerfile class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=#dockerfile_1 class=md-nav__link> 多阶段Dockerfile </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/huyuhui001/mySite/edit/main/docs/k8s/cka_cn/foundamentals/docker.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=cka4docker>CKA自学笔记4:Docker基础<a class=headerlink href=#cka4docker title="Permanent link"> ¶</a></h1> <h2 id=_1>摘要<a class=headerlink href=#_1 title="Permanent link"> ¶</a></h2> <p>了解Linux原语的概念和包含的特性。</p> <p>安装Docker，了解基本的Docker命令和Dockerfile的使用。</p> <h2 id=_2>练习环境<a class=headerlink href=#_2 title="Permanent link"> ¶</a></h2> <p>操作系统：openSUSE 15.3</p> <div class=highlight><pre><span></span><code>cat /etc/os-release
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code><span class=go>NAME=&quot;openSUSE Leap&quot;</span>
<span class=go>VERSION=&quot;15.3&quot;</span>
<span class=go>ID=&quot;opensuse-leap&quot;</span>
<span class=go>ID_LIKE=&quot;suse opensuse&quot;</span>
<span class=go>VERSION_ID=&quot;15.3&quot;</span>
<span class=go>PRETTY_NAME=&quot;openSUSE Leap 15.3&quot;</span>
<span class=go>ANSI_COLOR=&quot;0;32&quot;</span>
<span class=go>CPE_NAME=&quot;cpe:/o:opensuse:leap:15.3&quot;</span>
<span class=go>BUG_REPORT_URL=&quot;https://bugs.opensuse.org&quot;</span>
<span class=go>HOME_URL=&quot;https://www.opensuse.org/&quot;</span>
</code></pre></div> <h2 id=linux>Linux原语<a class=headerlink href=#linux title="Permanent link"> ¶</a></h2> <p>在操作系统中，原语（primitives）是用于创建更复杂功能的基本构建块或操作。在Linux中，有几种常用的原语。包括：</p> <ul> <li> <p>进程（Processes）：进程是程序或应用程序的运行实例。它们是Linux中的基本工作单元，由内核管理。</p> </li> <li> <p>文件（Files）：文件是在Linux中存储数据的主要方式。它们可以是文本文件、二进制文件、目录或特殊文件，如设备文件。</p> </li> <li> <p>信号（Signals）：信号是进程之间或进程与内核之间通信的一种方式。它们用于通知进程事件，例如任务完成或错误发生的情况。</p> </li> <li> <p>套接字（Sockets）：套接字是Linux中进程间通信的一种方式。它们允许进程在网络或本地机器上发送和接收数据。</p> </li> <li> <p>线程（Threads）：线程是轻量级的进程，与其父进程共享相同的内存空间和资源。它们通常用于通过允许同时执行多个任务来提高应用程序的性能。</p> </li> <li> <p>管道（Pipes）：管道是一种将一个进程的输出连接到另一个进程的输入的方式。它们允许进程以受控的方式进行通信和交换数据。</p> </li> <li> <p>信号量（Semaphores）：信号量是Linux中控制对共享资源访问的一种方式。它们允许进程协调它们对共享资源的访问，如文件或内存。</p> </li> </ul> <h3 id=chroot>chroot<a class=headerlink href=#chroot title="Permanent link"> ¶</a></h3> <p>chroot使用pivot_root，以实现将*进程*的根目录更改为任何给定的目录。</p> <p>a. 模拟容器</p> <p>使用<code>chroot</code>命令可以在Linux系统中创建一个容器。该容器可以看作是一个虚拟的根文件系统，其中运行的进程只能访问该根文件系统中的资源。</p> <p>例如，以下命令会将当前根文件系统更改为<code>/tmp/myroot</code>目录：</p> <div class=highlight><pre><span></span><code>chroot /tmp/myroot /bin/bash
</code></pre></div> <p>这条命令会启动一个新的Bash shell，该shell的根目录为<code>/tmp/myroot</code>。</p> <p>b. 更改根文件系统</p> <p><code>chroot</code>命令还可用于更改进程的根文件系统。例如，我们可以使用<code>chroot</code>命令启动一个具有另一个根文件系统的进程，而不是系统的默认根文件系统。</p> <p>例如，以下命令会将当前目录（即<code>./</code>）作为根目录，并在其中启动一个新的Bash shell：</p> <div class=highlight><pre><span></span><code>sudo chroot . /bin/bash
</code></pre></div> <h3 id=_3>命名空间<a class=headerlink href=#_3 title="Permanent link"> ¶</a></h3> <p>在Linux操作系统中，Namespace（命名空间）是一种机制，用于隔离不同进程的资源。通过Namespace机制，可以将一组进程及其子进程的视图隔离在一个独立的Namespace中，从而实现进程之间资源隔离的目的。</p> <p>下面是一些常见的Namespace类型及其作用：</p> <ol> <li> <p>Mount Namespace：隔离文件系统挂载点。可以使不同进程拥有自己的独立的文件系统视图。</p> </li> <li> <p>PID Namespace：隔离进程ID号。可以使不同进程拥有自己的进程ID号空间，避免进程之间的PID冲突。</p> </li> <li> <p>Network Namespace：隔离网络栈。可以使不同进程拥有自己的独立的网络栈，从而避免进程之间的网络冲突。</p> </li> <li> <p>IPC Namespace：隔离进程间通信（IPC）机制。可以使不同进程拥有自己的独立的IPC空间，从而避免IPC机制带来的资源竞争。</p> </li> <li> <p>UTS Namespace：隔离主机名和域名。可以使不同进程拥有自己的独立的主机名和域名空间，从而避免进程之间的命名冲突。</p> </li> </ol> <p>Primitives namespace和Namespace是两个不同的概念。</p> <p>Namespace是Linux操作系统提供的一种机制，用于隔离不同进程的资源，以实现进程之间的资源隔离和环境隔离。例如，PID Namespace可以使不同进程拥有自己的独立的PID号空间，避免进程之间的PID冲突；Network Namespace可以使不同进程拥有自己的独立的网络栈，从而避免进程之间的网络冲突等。</p> <p>Primitives namespace是一种新的技术概念，它是指将不同的基本操作（例如读写文件、创建进程、网络通信等）作为原语进行隔离和封装，使得应用程序可以在这些隔离的原语上构建出自己的隔离环境。例如，可以通过隔离文件系统读写操作来实现容器级别的文件系统隔离；通过隔离网络通信操作来实现容器级别的网络隔离等。</p> <p>因此，Namespace和Primitives namespace是两个不同的概念，虽然它们都可以用于实现隔离和封装的功能，但是Namespace是一种更为通用和底层的机制，Primitives namespace是一种更为高层的抽象概念，通常用于构建容器等应用级别的隔离环境。</p> <p>Namespace示例：</p> <p>在Linux系统中，可以使用PID Namespace来隔离进程ID号空间，避免进程之间的PID冲突。下面是一个简单的示例：</p> <div class=highlight><pre><span></span><code><span class=c1># 创建一个新的PID Namespace</span>
unshare -p /bin/bash

<span class=c1># 在新的PID Namespace中运行一个进程</span>
<span class=nb>echo</span> <span class=nv>$$</span> <span class=c1># 显示当前进程的PID</span>
ps aux <span class=c1># 显示当前进程及其子进程</span>
</code></pre></div> <p>在上面的示例中，<code>unshare -p</code>命令创建了一个新的PID Namespace，并在其中启动了一个新的bash进程。由于该进程运行在一个独立的PID Namespace中，因此它的PID号与主机上的其他进程不会冲突。在这个新的bash进程中，<code>$$</code>命令显示的是该进程在PID Namespace中的PID号，而<code>ps aux</code>命令只会显示当前PID Namespace中的进程，不会显示主机上的其他进程。</p> <p>Primitives Namespace示例：</p> <p>在Docker容器中，可以使用Filesystem Namespace来隔离文件系统，使得不同的容器之间拥有独立的文件系统视图。下面是一个简单的示例：</p> <div class=highlight><pre><span></span><code><span class=c1># 在容器中运行一个命令</span>
docker run --rm -it --name mycontainer ubuntu bash

<span class=c1># 在容器中创建一个文件并退出</span>
touch myfile
<span class=nb>exit</span>

<span class=c1># 在主机上查看文件</span>
ls myfile <span class=c1># myfile文件不存在</span>

<span class=c1># 再次进入容器</span>
docker start -i mycontainer

<span class=c1># 在容器中查看文件</span>
ls myfile <span class=c1># myfile文件存在</span>
</code></pre></div> <p>在上面的示例中，<code>docker run</code>命令启动了一个新的Docker容器，并在其中运行了一个bash进程。由于该容器使用了Filesystem Namespace，因此容器内的文件系统视图与主机上的文件系统视图是隔离的。在容器内创建的文件<code>myfile</code>只存在于容器内部，在主机上是看不到的。当再次进入容器时，<code>myfile</code>文件就可以被看到了。</p> <p>总结：</p> <p>Namespace是Linux内核提供的机制，而Primitives Namespace则是一种基于Namespace的高层抽象，用于实现应用级别的隔离和封装。Namespace可以用于隔离多种资源，而Primitives Namespace通常用于隔离文件系统、网络、进程等操作的原语。</p> <h3 id=_4>控制组<a class=headerlink href=#_4 title="Permanent link"> ¶</a></h3> <p>cgroup，全称为Control Group，即控制组，是Linux内核提供的一种机制，用于限制、记录、隔离和优先级控制一组进程的资源使用。它可以限制进程组的CPU、内存、磁盘、网络等资源的使用，同时也可以记录进程组的资源使用情况和行为。</p> <p>cgroup通过将一组进程组织成一个层次结构，将资源分配给不同的cgroup来实现资源限制和优先级控制。每个cgroup可以设置资源限制和控制策略，例如可以限制一个进程组最多使用50%的CPU时间，或者限制一个进程组最多使用100MB的内存等。</p> <p>cgroup最初由Google公司开发，后来被Linux内核社区采纳并加入到内核中，成为Linux系统的一部分。它在容器技术、虚拟化、云计算等领域都有广泛的应用。</p> <p>下面是cgroup 的一些常见用途：</p> <ol> <li> <p>CPU 限制：使用 cgroup 可以限制进程的 CPU 使用率，避免某个进程占用过多的 CPU 资源导致系统负载过高，从而影响系统稳定性和其他进程的正常运行。</p> </li> <li> <p>内存限制：使用 cgroup 可以限制进程的内存使用量，避免某个进程占用过多的内存资源导致系统内存不足，从而影响系统性能和其他进程的正常运行。</p> </li> <li> <p>IO 限制：使用 cgroup 可以限制进程的 IO 带宽，避免某个进程占用过多的 IO 资源导致其他进程的 IO 操作受到影响，从而影响系统性能和响应速度。</p> </li> <li> <p>网络限制：使用 cgroup 可以限制进程的网络带宽，避免某个进程占用过多的网络资源导致网络拥塞，从而影响系统性能和其他进程的正常运行。</p> </li> <li> <p>进程控制：使用 cgroup 可以限制进程的启动、停止和调度等行为，从而实现对系统进程的控制和管理。</p> </li> <li> <p>资源统计：使用 cgroup 可以实时统计系统中各个进程的资源使用情况，从而帮助管理员了解系统负载状况和各个进程的性能瓶颈，从而采取相应的措施优化系统性能。</p> </li> </ol> <p>下面是openSUSE中的示例：</p> <p>安装需要的软件包：</p> <div class=highlight><pre><span></span><code>sudo zypper install libcgroup-tools
</code></pre></div> <p>限制CPU使用上限：</p> <div class=highlight><pre><span></span><code><span class=c1># 创建新的cgroup &#39;mygroup&#39;</span>
sudo mkdir /sys/fs/cgroup/cpu/mygroup

<span class=c1># 系统会创建默认的一些文件，含初始值，比如CPU使用时间的限额的默认值是-1</span>
cat /sys/fs/cgroup/cpu/mygroup/cpu.cfs_quota_us

<span class=c1># 设定CPU使用时间上限</span>
sudo sh -c <span class=s2>&quot;echo 50000 &gt; /sys/fs/cgroup/cpu/mygroup/cpu.cfs_quota_us&quot;</span>

<span class=c1># 启动一个新的进程，并且关联到</span>
sudo cgcreate -g cpu:mygroup
sudo cgexec -g cpu:mygroup /bin/bash
</code></pre></div> <p>在上面的例子中，<code>cpu.cfs_quota_us</code> 文件设置了 cgroup 中的进程可以使用的最大 CPU 时间。该值以微秒为单位，因此将其设置为 50000 表示进程最多可以使用单个 CPU 核心的 50%。<code>cgcreate</code>和 <code>cgexec</code>命令创建并将进程<code>/bin/bash</code>移动到 <code>mygroup</code>cgroup 中。</p> <p>限制内存使用上限：</p> <div class=highlight><pre><span></span><code><span class=c1># 创建新的cgroup &#39;mygroup&#39;</span>
sudo mkdir /sys/fs/cgroup/memory/mygroup

<span class=c1># 系统会创建默认的一些文件，含初始值，比如内存使用上限的默认值是9223372036854771712</span>
cat /sys/fs/cgroup/memory/mygroup/memory.limit_in_bytes

<span class=c1># 设置内存使用上限512MB</span>
sudo sh -c <span class=s2>&quot;echo 536870912 &gt; /sys/fs/cgroup/memory/mygroup/memory.limit_in_bytes&quot;</span>

<span class=c1># 启动一个新的进程，并且关联到&#39;mygroup&#39;</span>
sudo cgcreate -g memory:mygroup
sudo cgexec -g memory:mygroup /bin/bash
</code></pre></div> <p>在上面例子中，<code>memory.limit_in_bytes</code> 文件设置了 cgroup 中进程可以使用的最大内存量。该值以字节为单位，因此将其设置为 536870912 表示进程最多可以使用 512MB 的内存。</p> <p>设置优先进程的 I/O 使用率：</p> <div class=highlight><pre><span></span><code><span class=c1># 创建新cgroup &#39;mygroup&#39;</span>
sudo mkdir /sys/fs/cgroup/blkio/mygroup

<span class=c1># 设置进程最大读和写的速率10MB/s</span>
sudo sh -c <span class=s2>&quot;echo &#39;8:0 10485760&#39; &gt; /sys/fs/cgroup/blkio/mygroup/blkio.throttle.read_bps_device&quot;</span>
sudo sh -c <span class=s2>&quot;echo &#39;8:0 10485760&#39; &gt; /sys/fs/cgroup/blkio/mygroup/blkio.throttle.write_bps_device&quot;</span>

<span class=c1># 启动一个新的进程，并且关联到&#39;mygroup&#39;</span>
sudo cgcreate -g blkio:mygroup
sudo cgexec -g blkio:mygroup /bin/bash
</code></pre></div> <p>在上面例子中，<code>blkio.throttle.read_bps_device</code>和<code>blkio.throttle.write_bps_device</code>文件设置了cgroup中进程可以使用的最大读取和写入带宽。该值以每秒字节数为单位，因此将其设置为10485760意味着进程在主设备号:次设备号为8:0的设备（通常是第一个硬盘）上读取或写入的带宽最多为10MB/s。</p> <p>将 <code>8:0 10485760</code> 这个字符串写入到 <code>/sys/fs/cgroup/blkio/mygroup/blkio.throttle.read_bps_device</code> 文件中的作用是限制 <code>mygroup</code> 控制组中关联的块设备（block device）的读取速率。</p> <p>在 Linux 中，<code>blkio</code> 控制组子系统可以用来对进程或线程的块设备访问进行限制，如限制读写速率、I/O 优先级等。而 <code>blkio.throttle.read_bps_device</code> 这个文件则用于设置某个块设备的读取速率限制。</p> <p>具体来说，<code>8:0</code> 表示设备的主次编号（major:minor），这里是指磁盘 <code>/dev/sda</code>。<code>10485760</code> 则是读取速率的限制值，单位是字节/秒。这个值表示 <code>/dev/sda</code> 最大读取速率为 10MB/s，超过这个速率的读取请求会被延迟执行，从而限制了磁盘的读取带宽。</p> <p>因此，以上命令的含义是将 <code>mygroup</code> 控制组中关联的 <code>/dev/sda</code> 磁盘的读取速率限制为 10MB/s，从而实现对该控制组中进程或线程对磁盘读取的限制。</p> <p>同理，将 <code>8:0 10485760</code> 这个字符串写入到 <code>/sys/fs/cgroup/blkio/mygroup/blkio.throttle.write_bps_device</code> 文件中，以限制 <code>mygroup</code> 控制组中关联的块设备（block device）的写入速率。</p> <p>限制一组进程的网络带宽：</p> <div class=highlight><pre><span></span><code><span class=c1># 创建新的cgroup &#39;mygroup&#39;</span>
sudo mkdir /sys/fs/cgroup/net_cls/mygroup

<span class=c1># 将此组中的进程的网络类ID设置为“myclass”</span>
sudo sh -c <span class=s2>&quot;echo 0x10001 &gt; /sys/fs/cgroup/net_cls/mygroup/net_cls.classid&quot;</span>
</code></pre></div> <p>上面的例子是将 <code>0x10001</code> 这个十六进制数值写入到<code>/sys/fs/cgroup/net_cls/mygroup/net_cls.classid</code> 文件中，以指定 <code>mygroup</code> 控制组的网络类别标识符（classid）。</p> <p>网络类别标识符是 Linux 内核中用来实现流量控制和流量分类的一个机制，它可以将数据包按照不同的类别（class）进行标记和区分，然后在网络设备上针对不同的类别进行不同的处理，如限速、优先级调整等。控制组中的 <code>net_cls</code> 子系统可以用来将进程或线程与网络类别标识符关联起来，从而实现对它们的网络流量进行控制和分类。</p> <p>因此，以上命令是将 <code>mygroup</code> 控制组的网络类别标识符设置为 <code>0x10001</code>，这样与该控制组相关联的进程或线程就会被标记为该类别，然后可以通过其他工具（如 <code>tc</code> 命令）对其进行网络流量控制和分类。</p> <p>如果遇到对应限制文件不存在，一种可能是需要检查cgroup子系有没有正确统载或者没有启用内存子系统。</p> <div class=highlight><pre><span></span><code>mount <span class=p>|</span> grep cgroup
</code></pre></div> <p>如果 cgroups 文件系统已经挂载，应该会看到输出类似于以下内容（）以memory为例）：</p> <div class=highlight><pre><span></span><code><span class=go>cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)</span>
</code></pre></div> <p>如果没有看到 <code>memory</code> 字段，则表示内存子系统没有启用。可以编辑<code>/etc/default/grub</code> 文件，添加或修改以下行：</p> <div class=highlight><pre><span></span><code><span class=go>GRUB_CMDLINE_LINUX_DEFAULT=&quot;cgroup_enable=memory&quot;</span>
</code></pre></div> <p>然后更新 GRUB 配置并重启系统：</p> <div class=highlight><pre><span></span><code>sudo update-grub
sudo reboot
</code></pre></div> <p>重启后再次检查 <code>/sys/fs/cgroup/memory/mygroup/memory.limit_in_bytes</code> 文件是否存在。如果还是不存在，可能需要手动创建它以及其他相关的 cgroups 文件。例如，运行以下命令：</p> <div class=highlight><pre><span></span><code>sudo mkdir /sys/fs/cgroup/memory/mygroup
sudo touch /sys/fs/cgroup/memory/mygroup/memory.limit_in_bytes
</code></pre></div> <p>然后就可以像之前的例子一样设置内存限制了</p> <h3 id=apparmorselinux>Apparmor和SELinux配置文件<a class=headerlink href=#apparmorselinux title="Permanent link"> ¶</a></h3> <ul> <li>安全配置文件，用于控制对资源的访问</li> </ul> <p>AppArmor 和 SELinux 都是常见的强制访问控制（MAC）机制，可以对进程或应用程序的访问权限进行精细控制。下面分别举例说明这两种机制的配置文件使用。</p> <ol> <li>AppArmor</li> </ol> <p>AppArmor 的主配置文件是 <code>/etc/apparmor/profiles.d/</code> 目录下的各个文件，每个文件对应一个应用程序或进程的配置。以 <code>sshd</code> 服务为例，该服务的配置文件是<code>/etc/apparmor.d/usr.sbin.sshd</code>。</p> <p>该配置文件的内容类似于下面这样：</p> <div class=highlight><pre><span></span><code><span class=gp># </span>Last Modified: Sun Mar <span class=m>14</span> <span class=m>18</span>:53:00 <span class=m>2023</span>
<span class=gp>#</span>include &lt;tunables/global&gt;

<span class=go>/usr/sbin/sshd {</span>
<span class=gp>  #</span>include &lt;abstractions/base&gt;
<span class=gp>  #</span>include &lt;abstractions/nameservice&gt;

<span class=gp>  # </span>allow <span class=nb>read</span> access to user home directories
<span class=go>  /home/** r,</span>

<span class=gp>  # </span>allow sshd to execute /usr/bin/which to determine full path of shell
<span class=go>  /usr/bin/which ix,</span>

<span class=gp>  # </span>allow sshd to <span class=nb>read</span> its own configuration file
<span class=go>  /etc/ssh/sshd_config r,</span>

<span class=gp>  # </span>allow sshd to <span class=nb>read</span> the SSH host keys
<span class=go>  /etc/ssh/ssh_host_* r,</span>

<span class=gp>  # </span>allow sshd to use pam <span class=k>for</span> authentication
<span class=go>  /usr/share/pam/** r,</span>

<span class=gp>  # </span>allow sshd to use nsswitch <span class=k>for</span> name resolution
<span class=go>  /etc/nsswitch.conf r,</span>
<span class=go>  /etc/hosts r,</span>
<span class=go>  /etc/hostname r,</span>
<span class=go>  /etc/resolv.conf r,</span>

<span class=gp>  # </span>allow sshd to write to its own log file
<span class=go>  /var/log/auth.log w,</span>

<span class=gp>  # </span>allow sshd to create and manage pid files
<span class=go>  /var/run/sshd.pid w,</span>
<span class=go>  /var/run/sshd.dir/ w,</span>
<span class=go>  /var/run/sshd.dir/* rw,</span>

<span class=gp>  # </span>allow sshd to access systemd-logind
<span class=go>  /run/systemd/* r,</span>
<span class=go>  /run/systemd/session/*.scope r,</span>
<span class=go>  /run/systemd/sessions/*.scope r,</span>

<span class=gp>  # </span>deny everything <span class=k>else</span>
<span class=go>  deny /,</span>
<span class=go>}</span>
</code></pre></div> <p>该配置文件定义了 <code>/usr/sbin/sshd</code> 进程的权限限制规则，包括允许访问的文件、禁止访问的文件等。其中 <code>#include &lt;abstractions/base&gt;</code> 表示包含了一组通用的权限规则，可以在不同的应用程序配置中重复使用。</p> <p>2.SELinux</p> <p>SELinux 的主配置文件是 <code>/etc/selinux/config</code>，该文件定义了系统的 SELinux 策略和模式。默认情况下，openSUSE 使用的是 <code>targeted</code> 模式。</p> <p>每个进程或应用程序还需要对应一个 SELinux 配置文件，以定义它们的访问权限。以 <code>httpd</code> 服务为例，该服务的 SELinux 配置文件是<code>/etc/selinux/targeted/contexts/httpd.te</code>。</p> <p>该配置文件的内容类似于下面这样：</p> <div class=highlight><pre><span></span><code><span class=c1># HTTPD server</span>
<span class=nb>type</span> httpd_t<span class=p>;</span>
<span class=nb>type</span> httpd_sys_script_t<span class=p>;</span>
init_daemon_domain<span class=o>(</span>httpd_t, httpd_sys_script_t<span class=o>)</span>
</code></pre></div> <p>该配置文件定义了 <code>httpd</code> 服务的 SELinux 类型为 <code>httpd_t</code>，并使用了<code>httpd_sys_script_t</code> 作为其初始化域。其中 <code>type</code> 表示 SELinux 类型，<code>init_daemon_domain</code> 则是一个 SELinux 宏，用于定义服务的初始域。</p> <p>需要注意的是，在 SELinux 中，访问权限规则不是直接在配置文件中定义的，而是通过访问控制策略和规则进行控制。这些策略和规则可以使用 SELinux 工具集（如 <code>semanage</code>、<code>setsebool</code>、<code>restorecon</code> 等）进行管理和设置。</p> <p>比如，在openSUSE中可以看到<code>/etc/selinux/semanage.conf</code>文件和其中的配置。</p> <h3 id=_5>内核能力<a class=headerlink href=#_5 title="Permanent link"> ¶</a></h3> <p>内核能力（Kernel capabilities）</p> <ul> <li>没有能力：root可以执行所有操作，其他用户可能什么也做不了</li> <li>38个细粒度的功能来控制权限</li> </ul> <p>Kernel capabilities 是 Linux 内核提供的一种机制，用于控制进程对系统资源的访问权限。与传统的 Unix 权限机制不同，Kernel capabilities 可以使管理员在精细控制系统资源访问的同时，避免将过多权限授予进程，提高了系统的安全性。</p> <p>在传统 Unix 权限机制中，每个进程都有一个有效用户 ID 和一个有效组 ID，这些 ID 决定了该进程对文件、设备、网络等资源的访问权限。但是，这种权限机制不够灵活，如果要授予进程某些特定的权限，可能需要将所有的权限都授予给它，从而降低了系统的安全性。</p> <p>Kernel capabilities 提供了一种更细粒度的权限控制方式。每个进程都有一组 capabilities，每个 capability 表示一种特定的权限。进程可以请求和释放某些 capability，这样就可以将权限授予进程，而不必授予所有权限。</p> <p>例如，可以将 <code>CAP_NET_BIND_SERVICE</code>capability 授予某个进程，这样该进程就可以绑定 1-1023 的端口，而不必具有 root 权限。类似地，可以将 <code>CAP_SYS_ADMIN</code>capability 授予某个进程，这样该进程就可以执行系统管理任务，如挂载文件系统和创建设备节点等。</p> <p>Linux 内核提供了一组默认的 capabilities，也可以通过自定义的方式创建新的 capabilities，以便更好地控制系统资源的访问权限。可以使用 <code>setcap</code>命令为二进制文件设置 capabilities。例如，下面的命令将 <code>CAP_NET_RAW</code>capability 授予 <code>/usr/bin/ping</code> 命令：</p> <div class=highlight><pre><span></span><code>sudo setcap cap_net_raw+ep /usr/bin/ping
</code></pre></div> <p>这样，用户就可以使用 <code>ping</code>命令而不必以 root 用户的身份登录。</p> <p>除了 <code>CAP_NET_BIND_SERVICE</code>和 <code>CAP_SYS_ADMIN</code>，还有一些其他的 capabilities，以下是一些例子：</p> <ul> <li><code>CAP_DAC_OVERRIDE</code>：允许进程忽略文件权限，可以访问任何文件。</li> <li><code>CAP_CHOWN</code>：允许进程修改文件的所有者。</li> <li><code>CAP_SETUID</code>和 <code>CAP_SETGID</code>：允许进程修改自己的用户 ID 和组 ID。</li> <li><code>CAP_NET_ADMIN</code>：允许进程执行网络管理任务，如配置网络接口和路由表等。</li> <li><code>CAP_SYS_RESOURCE</code>：允许进程修改系统资源限制，如 CPU 时间和内存限制等。</li> </ul> <p>可以通过命令 <code>man 7 capabilities</code> 来查看系统提供的 capabilities 列表和详细说明。在使用 Kernel capabilities 时，需要注意，只有拥有 <code>CAP_SETFCAP</code>或 <code>CAP_SYS_ADMIN</code>capability 的进程才能够修改自己或其他进程的 capabilities，这也是为了保护系统的安全性。</p> <p>如果执行 setcap 命令时出现 "command not found" 的错误，这通常意味着 setcap 命令所在的包尚未安装。在 openSUSE 中，setcap 命令包含在 libcap-progs 软件包中。</p> <p>在 openSUSE 系统中需要安装 libcap-progs 软件包：</p> <div class=highlight><pre><span></span><code>sudo zypper <span class=k>in</span> libcap-progs
</code></pre></div> <p>在 Ubuntu/Debian 系统上需要安装 libcap 库：</p> <div class=highlight><pre><span></span><code>sudo apt-get install libcap2-bin
</code></pre></div> <p>在 CentOS/RHEL 系统上需要安装 libcap 库：</p> <div class=highlight><pre><span></span><code>sudo yum install libcap-devel
</code></pre></div> <p>安装完成后，可以使用 setcap 命令为二进制文件设置 capabilities。如果还是无法找到 setcap 命令，可以尝试使用完整路径 /sbin/setcap 或者 /usr/sbin/setcap。</p> <h3 id=seccomp>seccomp策略<a class=headerlink href=#seccomp title="Permanent link"> ¶</a></h3> <p>seccomp（secure computing mode）是 Linux 内核提供的一种安全机制，它可以限制进程能够进行的系统调用。通过使用 seccomp，可以限制进程只能够使用必要的系统调用，从而减少系统被攻击的风险。</p> <p>seccomp 策略可以使用 BPF（Berkeley Packet Filter）语言编写，并使用 seccomp() 系统调用加载。以下是一个使用 seccomp 策略限制进程能够进行的系统调用的示例：</p> <div class=highlight><pre><span></span><code><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;linux/seccomp.h&gt;</span><span class=cp></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/prctl.h&gt;</span><span class=cp></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span><span class=cp></span>

<span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=c1>// 创建 seccomp 过滤器</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>sock_filter</span><span class=w> </span><span class=n>filter</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>BPF_STMT</span><span class=p>(</span><span class=n>BPF_LD</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>BPF_W</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>BPF_ABS</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w></span>
<span class=w>        </span><span class=n>BPF_JUMP</span><span class=p>(</span><span class=n>BPF_JMP</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>BPF_JEQ</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>BPF_K</span><span class=p>,</span><span class=w> </span><span class=n>__NR_write</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=w></span>
<span class=w>        </span><span class=n>BPF_STMT</span><span class=p>(</span><span class=n>BPF_RET</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>BPF_K</span><span class=p>,</span><span class=w> </span><span class=n>SECCOMP_RET_ALLOW</span><span class=p>),</span><span class=w></span>
<span class=w>        </span><span class=n>BPF_STMT</span><span class=p>(</span><span class=n>BPF_RET</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>BPF_K</span><span class=p>,</span><span class=w> </span><span class=n>SECCOMP_RET_KILL</span><span class=p>),</span><span class=w></span>
<span class=w>    </span><span class=p>};</span><span class=w></span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>sock_fprog</span><span class=w> </span><span class=n>prog</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>filter</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>filter</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=n>filter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>filter</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=p>};</span><span class=w></span>

<span class=w>    </span><span class=c1>// 加载 seccomp 过滤器</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>prctl</span><span class=p>(</span><span class=n>PR_SET_SECCOMP</span><span class=p>,</span><span class=w> </span><span class=n>SECCOMP_MODE_FILTER</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>prog</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>perror</span><span class=p>(</span><span class=s>&quot;prctl&quot;</span><span class=p>);</span><span class=w></span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>

<span class=w>    </span><span class=c1>// 调用 write 系统调用</span>
<span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>buf</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;Hello, world!&quot;</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>));</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <p>上述代码创建了一个 seccomp 过滤器，仅允许进程调用 write() 系统调用，其他系统调用均会被禁止。可以通过编译并运行上述代码来演示 seccomp 策略的作用。</p> <p>需要注意的是，seccomp 策略只能够限制进程进行的系统调用，但不能够限制系统调用的参数或返回值。因此，使用 seccomp 策略时需要特别小心，避免误用或产生漏洞。</p> <h3 id=netlink>Netlink<a class=headerlink href=#netlink title="Permanent link"> ¶</a></h3> <p>Netlink 是一种 Linux 内核提供的通信机制，用于内核和用户空间进程之间的双向通信（IPC）。Netlink 可以用于许多目的，例如：</p> <ol> <li> <p>配置网络设备和路由表：使用 Netlink 可以通过用户空间进程修改内核的网络设备和路由表配置，例如添加、删除、修改网络接口、IP 地址、路由等。</p> </li> <li> <p>监视网络事件：使用 Netlink 可以实时地从内核获取网络事件的通知，例如网络接口的状态变化、路由的变化等。</p> </li> <li> <p>程序间通信：使用 Netlink 可以在用户空间进程之间进行通信，类似于 Unix 域套接字。</p> </li> </ol> <p>Netlink 机制基于一种特殊的套接字类型（PF_NETLINK）和一个特定的协议（NETLINK）。用户空间进程可以通过创建 Netlink 套接字和内核通信。内核和用户空间进程之间的通信是基于 Netlink 消息的，每个 Netlink 消息包含一个消息头和一个负载（payload），负载可以是任何结构体或二进制数据。</p> <p>Netlink 消息的类型和格式由内核定义。用户空间进程需要了解内核的 Netlink 消息格式和类型，才能正确地构造和解析 Netlink 消息。常用的 Netlink 消息类型包括：</p> <ol> <li> <p>RTM_NEWLINK 和 RTM_DELLINK：添加和删除网络接口。</p> </li> <li> <p>RTM_NEWADDR 和 RTM_DELADDR：添加和删除 IP 地址。</p> </li> <li> <p>RTM_NEWROUTE 和 RTM_DELROUTE：添加和删除路由。</p> </li> <li> <p>RTM_NEWNEIGH 和 RTM_DELNEIGH：添加和删除 ARP 表项。</p> </li> </ol> <p>Netlink 可以使用 C 语言的 socket API 进行编程。</p> <h3 id=netfilter>Netfilter<a class=headerlink href=#netfilter title="Permanent link"> ¶</a></h3> <p>Netfilter是Linux内核中的一个子系统，用于在数据包传输过程中进行过滤和操作。它支持对网络数据包进行各种类型的处理，包括过滤、修改、重定向等。Netfilter通过在内核中注册钩子函数，在数据包通过网络栈的不同阶段时进行拦截和处理。</p> <p>Netfilter的核心是iptables命令，它可以用来配置Netfilter规则。iptables命令可以用来配置防火墙规则，NAT规则，限制连接速度等。iptables命令通过匹配不同的数据包字段（例如源IP地址、目的IP地址、源端口、目的端口等）来进行过滤。</p> <p>除了iptables命令，还有其他一些工具可以用于配置Netfilter规则，例如nftables命令和firewalld服务。这些工具提供了更灵活、更强大的配置选项，可以帮助管理员更好地管理和保护网络安全。</p> <p>也可以用于将网络数据包定向到单个容器。</p> <p>更多信息可以参考 <a href=https://linuxcontainers.org/ >LXC/LXD</a>。</p> <h2 id=docker>安装Docker<a class=headerlink href=#docker title="Permanent link"> ¶</a></h2> <p>参考<a href=https://docs.docker.com/engine/ >指导</a>安装Docker引擎。 参考<a href=https://docs.docker.com/desktop/ >指导</a>安装Docker桌面版。</p> <p>下面以openSUSE为例安装Docker引擎。</p> <div class=highlight><pre><span></span><code>sudo zypper <span class=k>in</span> docker
</code></pre></div> <p>在安装过程中，在操作系统中会自动创建组<code>docker</code>。 将vagrant用户加入docker组，则vagrant用户可以在下次登录后与本机的Docker守护进程（daemon）进行通信。Docker守护进程监听本地套接字，只能由root用户和docker组的成员访问。</p> <div class=highlight><pre><span></span><code>sudo usermod -aG docker <span class=nv>$USER</span>
</code></pre></div> <p>启用并启动 Docker 引擎。</p> <div class=highlight><pre><span></span><code>sudo systemctl <span class=nb>enable</span> docker.service 
sudo systemctl start docker.service 
sudo systemctl status docker.service
</code></pre></div> <p>下面通过一个容器<code>alpine</code>的例子来演示在目录<code>/opt/test</code>下模拟实现choot。</p> <div class=highlight><pre><span></span><code>mkdir <span class=nb>test</span>
<span class=nb>cd</span> <span class=nb>test</span>
wget https://dl-cdn.alpinelinux.org/alpine/v3.13/releases/x86_64/alpine-minirootfs-3.13.4-x86_64.tar.gz
tar zxvf alpine-minirootfs-3.13.4-x86_64.tar.gz -C alpine-minirootfs/
</code></pre></div> <p>查看当前目录结构：</p> <div class=highlight><pre><span></span><code>tree ./test -L <span class=m>1</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code><span class=go>./test</span>
<span class=go>├── alpine-minirootfs-3.13.4-x86_64.tar.gz</span>
<span class=go>├── bin</span>
<span class=go>├── dev</span>
<span class=go>├── etc</span>
<span class=go>├── home</span>
<span class=go>├── lib</span>
<span class=go>├── media</span>
<span class=go>├── mnt</span>
<span class=go>├── opt</span>
<span class=go>├── proc</span>
<span class=go>├── root</span>
<span class=go>├── run</span>
<span class=go>├── sbin</span>
<span class=go>├── srv</span>
<span class=go>├── sys</span>
<span class=go>├── tmp</span>
<span class=go>├── usr</span>
<span class=go>└── var</span>
</code></pre></div> <p>通过命令<code>unshare</code>挂载目录 <code>/opt/test/proc</code> 到某个文件来实现客户子系统。</p> <div class=highlight><pre><span></span><code>sudo mount -t tmpfs tmpfs /opt/test/proc
</code></pre></div> <div class=highlight><pre><span></span><code>sudo unshare --pid --mount-proc<span class=o>=</span><span class=nv>$PWD</span>/test/proc --fork chroot ./test/ /bin/sh
/ <span class=c1># ps -ef</span>
PID   USER     TIME  COMMAND
    <span class=m>1</span> root      <span class=m>0</span>:00 /bin/sh
    <span class=m>2</span> root      <span class=m>0</span>:00 ps -ef
/ <span class=c1># touch 123</span>
/ <span class=c1># ls 123</span>
<span class=m>123</span>
</code></pre></div> <p>文件<code>123</code>在客户子系统中已创建，对应主系统中也可以对其进行读写操作。比如，修改文件<code>123</code>的内容。</p> <div class=highlight><pre><span></span><code>su -
ls <span class=m>123</span>
<span class=nb>echo</span> hello &gt; <span class=m>123</span>
</code></pre></div> <p>文件<code>123</code>修改后的内容在客户机里面也可见。</p> <div class=highlight><pre><span></span><code>/ <span class=c1># cat 123</span>
hello
</code></pre></div> <p>在主系统中再创建两个子目录 <code>/opt/test-1</code> 和<code>/opt/test-2</code>。</p> <div class=highlight><pre><span></span><code>mkdir test-1
mkdir test-2
</code></pre></div> <p>创建2个客户子系统，并将上面的两个子目录挂在到各自的 <code>/opt/test/home/</code>目录。</p> <div class=highlight><pre><span></span><code>sudo mount --bind /opt/test-1 /opt/test/home/
sudo unshare --pid --mount-proc<span class=o>=</span><span class=nv>$PWD</span>/test/proc --fork chroot ./test/ /bin/sh
/ <span class=c1># cd /home</span>
/home <span class=c1># echo &quot;test-1&quot; &gt; 123.1</span>
/home <span class=c1># cat 123.1</span>
test-1
</code></pre></div> <div class=highlight><pre><span></span><code>sudo mount --bind /opt/test-2 /opt/test/home/
sudo unshare --pid --mount-proc<span class=o>=</span><span class=nv>$PWD</span>/test/proc --fork chroot ./test/ /bin/sh
/ <span class=c1># cd /home</span>
/home <span class=c1># echo &quot;test-2&quot; &gt; 123.2</span>
/home <span class=c1># cat 123.2</span>
test-2
</code></pre></div> <div class=highlight><pre><span></span><code>ll test/home
ll test-1/
ll test-2/
</code></pre></div> <p>通过上面的演示，可以得出结论，两个客户子系统挂在到同一个主系统目录时，子系统时共享主系统目录，并相互影响。</p> <h2 id=_6>容器生命周期<a class=headerlink href=#_6 title="Permanent link"> ¶</a></h2> <h3 id=_7>概述<a class=headerlink href=#_7 title="Permanent link"> ¶</a></h3> <p>预先下载下列镜像。</p> <div class=highlight><pre><span></span><code>docker image pull busybox
docker image pull nginx
docker image pull alpine
docker image pull jenkins/jenkins:lts
docker image pull golang:1.12-alpine
docker image pull golang
</code></pre></div> <p>创建并交互式运行一个新的busybox容器，并连接一个伪终端（pseudo terminal）。 在容器内，使用<code>top</code>命令查找<code>/bin/sh</code>正在作为PID为1的进程运行，以及<code>top</code>进程也在运行。 然后，退出容器。</p> <div class=highlight><pre><span></span><code>docker image ls
docker run -d -it --name busybox_v1 -v /opt/test:/docker busybox:latest /bin/sh
docker container ps -a
docker <span class=nb>exec</span> -it 185efe490507 /bin/sh
/ <span class=c1># top</span>
Mem: 3627396K used, 12731512K free, 10080K shrd, 2920K buff, 2999340K cached
CPU:  <span class=m>0</span>.0% usr  <span class=m>0</span>.1% sys  <span class=m>0</span>.0% nic <span class=m>99</span>.8% idle  <span class=m>0</span>.0% io  <span class=m>0</span>.0% irq  <span class=m>0</span>.0% sirq
Load average: <span class=m>0</span>.38 <span class=m>1</span>.09 <span class=m>1</span>.29 <span class=m>2</span>/277 <span class=m>14</span>
  PID  PPID USER     STAT   VSZ %VSZ CPU %CPU COMMAND
    <span class=m>1</span>     <span class=m>0</span> root     S     <span class=m>1332</span>  <span class=m>0</span>.0   <span class=m>1</span>  <span class=m>0</span>.0 /bin/sh
    <span class=m>8</span>     <span class=m>0</span> root     S     <span class=m>1332</span>  <span class=m>0</span>.0   <span class=m>2</span>  <span class=m>0</span>.0 /bin/sh
   <span class=m>14</span>     <span class=m>8</span> root     R     <span class=m>1328</span>  <span class=m>0</span>.0   <span class=m>1</span>  <span class=m>0</span>.0 top
/ <span class=c1># exitbuild </span>
</code></pre></div> <p>启动一个新的 <code>Nginx</code> 容器，并以独立模式（detached mode）运行。 使用 <code>docker exec</code> 命令在 Nginx 容器中启动另一个 shell（<code>/bin/sh</code>）。 使用 <code>ps</code> 命令查看容器中正在运行的 <code>sh</code> 和 <code>ps</code> 命令（在上一步执行的）。</p> <div class=highlight><pre><span></span><code>docker run -d -it --name nginx_v1 -v /opt/test:/docker nginx:latest /bin/sh
docker container ps -a
docker <span class=nb>exec</span> -it edb640127a0d /bin/sh
<span class=c1># ps</span>
/bin/sh: <span class=m>2</span>: ps: not found
<span class=c1># apt-get update &amp;&amp; apt-get install -y procps</span>
<span class=c1># ps</span>
   PID TTY          TIME CMD
     <span class=m>8</span> pts/1    <span class=m>00</span>:00:00 sh
   <span class=m>351</span> pts/1    <span class=m>00</span>:00:00 ps
<span class=c1># exit</span>
</code></pre></div> <p>通过下面命令可以看到2个现在运行中的容器。</p> <div class=highlight><pre><span></span><code>docker container ps -a
</code></pre></div> <p>使用 <code>docker logs</code> 命令显示我们刚刚退出的容器的日志。选项 <code>--since 35m</code> 表示显示最近 35 分钟内的日志。</p> <div class=highlight><pre><span></span><code>docker logs nginx_v1 --details --since 35m
docker logs busybox_v1 --details --since 35m
</code></pre></div> <p>使用 <code>docker stop</code> 命令来停止 nginx 容器。</p> <div class=highlight><pre><span></span><code>docker stop busybox_v1
docker stop nginx_v1 
docker container ps -a
</code></pre></div> <p>使用上述命令<code>docker container ps -a</code>，我们可以获取所有正在运行和已退出的容器列表。使用<code>docker rm</code>将其删除。使用<code>docker rm $(docker ps -aq)</code>来清理主机上的所有容器。请谨慎使用！</p> <div class=highlight><pre><span></span><code>docker rm busybox_v1
docker container ps -a
</code></pre></div> <h3 id=_8>端口和卷<a class=headerlink href=#_8 title="Permanent link"> ¶</a></h3> <p>现在启动一个新的 nginx 容器，并将 nginx web 服务器的端口导出到 Docker 随机选择的端口。</p> <p>我们可以使用命令 <code>docker ps</code> 找出 web 服务器转发到了哪个端口。在主机上使用转发的端口号访问 <code>docker http://localhost:&lt;port#&gt;</code>。</p> <div class=highlight><pre><span></span><code>docker container ps -a
docker run -d -P --name nginx_v2 nginx:latest
docker container ps -a
</code></pre></div> <p>Start another nginx container and expose port to <code>1080</code> on host as an example via <code>http://localhost:1080</code>. 启动另一个nginx容器，将其端口映射到主机的1080端口，可以通过<code>http://localhost:1080</code>访问。</p> <div class=highlight><pre><span></span><code>docker run -d -p <span class=m>1080</span>:80 --name nginx_v3 nginx:latest
docker container ps -a
</code></pre></div> <p>使用<code>docker inspect</code>命令查找镜像暴露的端口号，输出JSON格式文件，网络信息（IP、网关、端口等）是输出JSON格式的一部分。</p> <div class=highlight><pre><span></span><code>docker inspect nginx_v3 
</code></pre></div> <p>在目录 <code>/opt/test</code> 中创建一个名为 <code>index.html</code> 的文件，其内容如下：</p> <div class=highlight><pre><span></span><code><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Sample Website from my container<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>This is a custom website.<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>This website is served from my <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;http://www.docker.com&quot;</span> <span class=na>target</span><span class=o>=</span><span class=s>&quot;_blank&quot;</span><span class=p>&gt;</span>Docker<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span> container.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</code></pre></div> <p>启动一个新容器，将主机目录 <code>/opt/test</code> 与容器目录 <code>/usr/share/nginx/html</code> 绑定挂载为一个卷，以便Nginx可以通过 <code>http://localhost:49159/</code> 发布我们刚创建的html文件，而不是Nginx默认的页面。</p> <div class=highlight><pre><span></span><code>docker run -d -P --mount <span class=nv>type</span><span class=o>=</span>bind,source<span class=o>=</span>/opt/test/,target<span class=o>=</span>/usr/share/nginx/html --name nginx_v3-1 nginx:latest
docker container ps -a
</code></pre></div> <p>检查Nginx配置文件，查看容器中html主页存储的位置。</p> <div class=highlight><pre><span></span><code>docker <span class=nb>exec</span> -it nginx_v3-1 /bin/sh
<span class=c1># cd /etc/nginx/conf.d</span>
<span class=c1># ls</span>
default.conf
<span class=c1># cat default.conf</span>
server <span class=o>{</span>
    listen       <span class=m>80</span><span class=p>;</span>
    listen  <span class=o>[</span>::<span class=o>]</span>:80<span class=p>;</span>
    server_name  localhost<span class=p>;</span>

    <span class=c1>#access_log  /var/log/nginx/host.access.log  main;</span>

    location / <span class=o>{</span>
        root   /usr/share/nginx/html<span class=p>;</span>  &lt;--
        index  index.html index.htm<span class=p>;</span>
    <span class=o>}</span>

    <span class=c1>#error_page  404              /404.html;</span>

    <span class=c1># redirect server error pages to the static page /50x.html</span>
    <span class=c1>#</span>
    error_page   <span class=m>500</span> <span class=m>502</span> <span class=m>503</span> <span class=m>504</span>  /50x.html<span class=p>;</span>
    <span class=nv>location</span> <span class=o>=</span> /50x.html <span class=o>{</span>
        root   /usr/share/nginx/html<span class=p>;</span>
    <span class=o>}</span>

    <span class=c1># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>
    <span class=c1>#</span>
    <span class=c1>#location ~ \.php$ {</span>
    <span class=c1>#    proxy_pass   http://127.0.0.1;</span>
    <span class=c1>#}</span>

    <span class=c1># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>
    <span class=c1>#</span>
    <span class=c1>#location ~ \.php$ {</span>
    <span class=c1>#    root           html;</span>
    <span class=c1>#    fastcgi_pass   127.0.0.1:9000;</span>
    <span class=c1>#    fastcgi_index  index.php;</span>
    <span class=c1>#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>
    <span class=c1>#    include        fastcgi_params;</span>
    <span class=c1>#}</span>

    <span class=c1># deny access to .htaccess files, if Apache&#39;s document root</span>
    <span class=c1># concurs with nginx&#39;s one</span>
    <span class=c1>#</span>
    <span class=c1>#location ~ /\.ht {</span>
    <span class=c1>#    deny  all;</span>
    <span class=c1>#}</span>
<span class=o>}</span>
<span class=c1># cd /usr/share/nginx/html</span>
<span class=c1># cat index.html              </span>
  &lt;html&gt;
  &lt;head&gt;
      &lt;title&gt;Sample Website from my container&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
      &lt;h1&gt;This is a custom website.&lt;/h1&gt;
      &lt;p&gt;This website is served from my &lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&quot;http://www.docker.com&quot;</span> <span class=nv>target</span><span class=o>=</span><span class=s2>&quot;_blank&quot;</span>&gt;Docker&lt;/a&gt; container.&lt;/p&gt;
  &lt;/body&gt;
  &lt;/html&gt;
<span class=c1># </span>
</code></pre></div> <p>推荐使用卷 API 来实现数据持久化，而不是将数据存储在 Docker 容器中。Docker 支持两种挂载方式：</p> <ul> <li>绑定挂载（Bind mounts）：</li> <li>将本地主机目录挂载到容器中的某个路径。</li> <li>挂载后，目标目录中原有的所有内容将被隐藏。</li> <li>例如，如果我们想要注入某些配置文件，我们需要自己写对应的配置文件，将其存储在 Docker 主机上的<code>/home/container/config</code>路径下，并将此目录的内容挂载到 <code>/usr/application/config</code>（假设应用程序从此处读取配置）。</li> <li>命令：<code>docker run --mount type=bind,source=&lt;source path&gt;,target=&lt;container path&gt; …</code></li> <li>命名卷（Named volumes）：</li> <li>Docker 可以创建一个独立的存储卷，其生命周期独立于容器但仍由 Docker 管理。</li> <li>在创建时，挂载目标的内容将合并到卷中。</li> <li>命令：<code>docker run --mount source=&lt;vol name&gt;,target=&lt;container path&gt; …</code></li> </ul> <p>如何区分绑定挂载和命名卷？</p> <ul> <li>当指定绝对路径时，Docker 会认为这是一个绑定挂载。</li> <li>当我们仅提供名称（如相对路径<code>config</code>）时，它会认为这是一个命名卷，并创建一个名为<code>config</code>的卷。</li> </ul> <p>注：持久存储由主机提供，可以直接是主机文件系统的一部分，也可以是 NFS 挂载。</p> <h3 id=dockerfile>Dockerfile<a class=headerlink href=#dockerfile title="Permanent link"> ¶</a></h3> <p>让我们用 Dockerfile 构建一个镜像，对其进行打标签并上传到镜像仓库。</p> <p>获取 Docker 镜像的构建历史记录。</p> <div class=highlight><pre><span></span><code>docker image <span class=nb>history</span> nginx:latest 
</code></pre></div> <p>创建一个空的目录<code>/opt/tmp-1</code>，进入该目录并在其中创建<code>index.html</code>文件。</p> <div class=highlight><pre><span></span><code>/opt/tmp-1&gt; cat index.html 
  &lt;html&gt;
  &lt;head&gt;
      &lt;title&gt;Sample Website from my container&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
      &lt;h1&gt;This is a custom website.&lt;/h1&gt;
      &lt;p&gt;This website is served from my &lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&quot;http://www.docker.com&quot;</span> <span class=nv>target</span><span class=o>=</span><span class=s2>&quot;_blank&quot;</span>&gt;Docker&lt;/a&gt; container.&lt;/p&gt;
  &lt;/body&gt;
  &lt;/html&gt;
</code></pre></div> <p>使用<code>FROM</code>来扩展一个已有的镜像，并指定版本号。</p> <p>使用<code>COPY</code>将一个新的默认网站复制到镜像中，例如 <code>/usr/share/nginx/html</code>。</p> <p>为Nginx创建SSL配置<code>/opt/tmp-1/ssl.conf</code>。</p> <div class=highlight><pre><span></span><code>server {
    listen       443 ssl;
    server_name  localhost;

    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }
}
</code></pre></div> <p>使用OpenSSL创建一个自签名证书，以便SSL/TLS工作。</p> <p>使用以下命令创建一个加密密钥和证书。</p> <div class=highlight><pre><span></span><code>openssl req -x509 -nodes -newkey rsa:4096 -keyout nginx.key -out nginx.crt -days <span class=m>365</span> -subj <span class=s2>&quot;/CN=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> <p>为了启用加密的HTTPS，我们需要使用<code>EXPOSE</code>指令公开<code>443</code>端口。默认的nginx镜像仅公开端口<code>80</code>，用于非加密的HTTP。</p> <p>在<code>/opt/tmp-1</code>文件夹中创建以下Dockerfile。</p> <div class=highlight><pre><span></span><code>cat Dockerfile
</code></pre></div> <p>输出：</p> <div class=highlight><pre><span></span><code><span class=go>FROM nginx:latest</span>

<span class=gp># </span>copy the custom website into the image
<span class=go>COPY index.html /usr/share/nginx/html</span>

<span class=gp># </span>copy the SSL configuration file into the image
<span class=go>COPY ssl.conf /etc/nginx/conf.d/ssl.conf</span>

<span class=gp># </span>download the SSL key and certificate into the image
<span class=go>COPY nginx.key /etc/nginx/ssl/</span>
<span class=go>COPY nginx.crt /etc/nginx/ssl/</span>

<span class=gp># </span>expose the HTTPS port
<span class=go>EXPOSE 443</span>
</code></pre></div> <p>至此，我们在目录<code>/opt/tmp-1</code>下有5个文件。</p> <div class=highlight><pre><span></span><code>ls /opt/tmp-1
</code></pre></div> <p>输出：</p> <div class=highlight><pre><span></span><code><span class=go>Dockerfile  index.html  nginx.crt  nginx.key  ssl.conf</span>
</code></pre></div> <p>使用<code>docker build</code>命令来构建镜像，并将容器的80和443端口转发。</p> <div class=highlight><pre><span></span><code>docker build -t nginx:my1 /opt/tmp-1/
docker image ls

docker run -d -p <span class=m>1086</span>:80 -p <span class=m>1088</span>:443 --name nginx_v5 nginx:my1

docker container ps -a
</code></pre></div> <p>通过下面两个链接来验证上面的变化是否生效。</p> <ul> <li><a href=http://localhost:1086/ >http://localhost:1086/</a></li> <li><a href=https://localhost:1088/ >https://localhost:1088/</a></li> </ul> <p>在<a href=https://hub.docker.com/ >DockerHub</a> 注册一个个人账号，启用 Docker Hub 中的访问令牌以进行 CLI 客户端身份验证。</p> <div class=highlight><pre><span></span><code>docker login
</code></pre></div> <p>输入用户名和密码。</p> <div class=highlight><pre><span></span><code><span class=go>Username: &lt;your account id&gt;</span>
<span class=go>Password: &lt;token&gt;</span>
</code></pre></div> <p>给这个镜像加上一个标签，例如：secure_nginx_0001，版本号为 v1。</p> <div class=highlight><pre><span></span><code>docker tag nginx:my1 &lt;your account id&gt;secure_nginx_0001:v1
docker push &lt;your account id&gt;secure_nginx_0001:v1
docker image ls
</code></pre></div> <h3 id=dockerfile_1>多阶段Dockerfile<a class=headerlink href=#dockerfile_1 title="Permanent link"> ¶</a></h3> <p>下面的例子是演示一个多阶段（Multi-stage）构建的例子。在Docker的上下文中，多阶段（Multi-stage）意味着我们可以有多个带有<code>FROM</code>关键字的行。</p> <p>创建文件夹<code>/opt/tmp-2</code>和<code>/opt/tmp-2/tmpl</code>。创建文件<a href=../../../../assets/edit.html>edit.html</a>，<a href=../../../../assets/view.html>view.html</a>，<a href=../../../../assets/wiki.go>wiki.go</a>。</p> <p>文件结构如下：</p> <div class=highlight><pre><span></span><code>tree -l /opt/tmp-2
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>.
├── tmpl
│   ├── edit.html
│   └── view.html
└── wiki.go
</code></pre></div> <p>创建一个新的Dockerfile。</p> <div class=highlight><pre><span></span><code>cat Dockerfile
</code></pre></div> <p>文件内容：</p> <div class=highlight><pre><span></span><code><span class=gp># </span>app builder stage
<span class=go>FROM golang:1.12-alpine as builder</span>

<span class=gp>#</span><span class=c1># copy the go source code over and build the binary</span>
<span class=go>WORKDIR /go/src</span>
<span class=go>COPY wiki.go /go/src/wiki.go</span>
<span class=go>RUN go build wiki.go</span>

<span class=gp># </span>app <span class=nb>exec</span> stage
<span class=gp># </span>separate <span class=p>&amp;</span> new image starts here!#
<span class=go>FROM alpine:3.9</span>

<span class=gp># </span>prepare file system etc
<span class=go>RUN mkdir -p /app/data /app/tmpl &amp;&amp; adduser -S -D -H -h /app appuser</span>
<span class=go>COPY tmpl/* /app/tmpl/</span>

<span class=gp># </span>get the compiled binary from the previous stage
<span class=go>COPY --from=builder /go/src/wiki /app/wiki</span>

<span class=gp># </span>prepare runtime env
<span class=go>RUN chown -R appuser /app</span>
<span class=go>USER appuser</span>
<span class=go>WORKDIR /app</span>

<span class=gp># </span>expose app port <span class=p>&amp;</span> <span class=nb>set</span> default <span class=nb>command</span>
<span class=go>EXPOSE 8080</span>
<span class=go>CMD [&quot;/app/wiki&quot;]</span>
</code></pre></div> <p>用上一步创建的Dockerfile来创建新景象。</p> <div class=highlight><pre><span></span><code>docker build -t lizard/golang:my1 /opt/tmp-2/
</code></pre></div> <p>以独立模式（detached）运行这个镜像，并将容器端口<code>8080</code>转发到主机端口<code>1090</code>。</p> <div class=highlight><pre><span></span><code>docker run -d -p <span class=m>1090</span>:8080 --name golan_v1 lizard/golang:my1
</code></pre></div> <p>通过链接 <a href=http://localhost:1090>http://localhost:1090</a> 访问这个运行的容器。</p> <p>对我们刚刚创建的新的golang镜像进行标签，并且上传到Dockerhub。</p> <div class=highlight><pre><span></span><code>docker tag lizard/golang:my1 &lt;your acccount id&gt;/golang_0001:v1
docker push &lt;your acccount id&gt;/golang_0001:v1
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../installation/aliyun-ubuntu/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 阿里云ECS安装Kubernetes" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> 阿里云ECS安装Kubernetes </div> </div> </a> <a href=../memo/ class="md-footer__link md-footer__link--next" aria-label="Next: Kubernetes随笔" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Kubernetes随笔 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.top"], "search": "../../../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.2ab50757.min.js></script> </body> </html>