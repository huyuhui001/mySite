# 4.数组和链接结构

数据结构（data structure）或具体数据类型（concrete data type）是指一组数据的内部存储方式。

数组（array）和链接结构（linked structure）这两种数据结构是编程语言里多项集最常用的实现。

目标：

- 创建数组；
- 对数组执行各种操作；
- 确定数组相关操作的运行时和内存的使用情况；
- 基于数组在计算机内存里的不同存储方式，描述数组相关操作的成本和收益；
- 使用单向链接节点创建链接结构；
- 对由单向链接节点构成的链接结构执行各种操作；
- 基于链接结构在计算机内存里的不同存储方式，描述在链接结构上执行相关操作的成本和收益；
- 比较数组和链接结构在运行时和内存使用上的权衡；

## 4.1.数组数据结构

关于数组（array）：

- 数组是指在给定索引位置可以访问和替换的元素序列。
- Python列表的底层数据结构正是一个数组。
- Python中数组的限制要比列表更多。只能在指定位置访问和替换数组中的元素、检查数组的长度、获取它的字符串表达式；不能基于位置添加或删除元素；数组的长度也就是它的容量，在创建之后就是固定的。

Python的`array`模块包含一个叫作`array`的类，它非常类似于列表，但是只能存储数字。我们会定义一个叫作`Array`的新类，使用列表保存元素，存储任何类型的元素。

```python
class Array(object):
    """
    描述一个数组。
    数组类似列表，但数组只能使用[], len, iter, 和 str这些属性。
    实例化一个数组，使用 <variable> = Array(<capacity>, <optional fill value>) 其中fill value默认值是None。
    """

    def __init__(self, capacity, fillValue=None):
        """Capacity是数组的大小.  fillValue会填充在每个元素位置, 默认值是None"""
        self.items = list()
        for count in range(capacity):
            self.items.append(fillValue)

    def __len__(self):
        """-> 数组的大小"""
        return len(self.items)

    def __str__(self):
        """-> 将数组字符串化"""
        return str(self.items)

    def __iter__(self):
        """支持for循环对数组进行遍历."""
        return iter(self.items)

    def __getitem__(self, index):
        """用于访问索引处的下标运算符."""
        return self.items[index]

    def __setitem__(self, index, newItem):
        """下标运算符用于在索引处进行替换."""
        self.items[index] = newItem
```

```python
def main(size=10):
    my_array = Array(5)
    print("The array is", my_array)
    print("__len__() of the array:", my_array.__len__())
    print("len() of the arry:", len(my_array))


# 运行结果：
# The array is [None, None, None, None, None]
# __len__() of the array: 5
# len() of the arry: 5
```




### 4.1.1.随机访问和连续内存

### 4.1.2.静态内存和动态内存

### 4.1.3.物理尺寸和逻辑尺寸

### 4.1.4.练习题

1．请说明随机访问的工作原理，以及这个操作这么快的原因。

2．数组和Python列表之间有什么区别？

3．请说明数组的物理尺寸和逻辑尺寸之间的区别。

## 4.2.数组的操作

### 4.2.1.增大数组的尺寸

### 4.2.2.减小数组的尺寸

### 4.2.3.将元素插入增大的数组

### 4.2.4.从数组里删除元素

### 4.2.5.复杂度的权衡：时间、空间和数组

### 4.2.6.练习题

1．请说明为什么插入或删除给定元素时必须要移动数组里的某些元素。

2．在插入过程中，移动数组元素时，要先移动哪个元素？先移动插入位置的元素，还是最后一个元素？为什么？

3．如果插入位置是数组的逻辑末尾，请说明这个插入操作的运行时复杂度。

4．假设数组当前包含14个元素，它的负载因子为0.70，那么它的物理容量是多少？

## 4.3.二维数组（网格）

### 4.3.1.使用网格

### 4.3.2.创建并初始化网格

### 4.3.3.定义Grid类

### 4.3.4.参差不齐的网格和多维数组

### 4.3.5.练习题

1．什么是二维数组（网格）？

2．请描述一个可能会用到二维数组的应用程序。

3．编写一个程序，使之可以在Grid对象里搜索一个负整数。循环应该在遇到网格里的第一个负整数的地方终止，这时变量row和column应该被设置为这个负数的位置。如果在网格里找不到负数，那么变量row和column应该等于网格的行数和列数。

4．说说运行下面这段代码后网格里的内容是什么。

```python
matrix = Grid(3, 3)
for row in range(matrix.getHeight()):
     for column in range(matrix.getWidth()):
         matrix[row][column] = row * column
```

5．编写一段代码以创建一个参差不齐的网格，它的行分别用来存储3个、6个和9个元素。

6．提供一个把Grid类用作数据结构来实现三维array类的策略。

7．编写一段代码：这段代码会把三维数组里每个单元的值都初始化为它的3个索引位置。例如，如果位置是（深度、行、列），则对于位置（2、3、3）来说，它的值就是233。

8．编写一段代码：这段代码可以显示出三维数组里的所有元素。打印出的每一行数据都应该代表给定行和列里的所有元素，而深度将从第一个位置向后递归到最后一个位置。遍历应该从第1行、第1列以及第一个深度位置开始，依次遍历所有的深度、列和行。

## 4.4.链接结构

### 4.4.1.单向链接结构和双向链接结构

### 4.4.2.非连续内存和节点

### 4.4.3.定义单向链接节点类

### 4.4.4.使用单向链接节点类

### 4.4.5.练习题

1．用框和指针绘制测试程序里第一个循环所创建的节点的示意图。

2．当节点变量引用的是None时，如果程序员尝试访问节点的数据字段，则会发生什么？如何防止这种情况的发生？

3．编写一段代码：这段代码会把一个被填满的数组里的元素都转移为单向链接结构里的数据。这个操作应保留元素的顺序不变。

## 4.5.单向链接结构上的操作

### 4.5.1.遍历

### 4.5.2.搜索

### 4.5.3.替换

### 4.5.4.在开始处插入

### 4.5.5.在结尾处插入

### 4.5.6.在开始处删除

### 4.5.7.在结尾处删除

### 4.5.8.在任意位置处插入

### 4.5.9.在任意位置处删除

### 4.5.10.复杂度的权衡：时间、空间和单向链接结构

### 4.5.11.练习题

1．假设已经找到了从单向链接结构里删除元素的位置，请说明从这个时候开始完成删除操作的运行时复杂度。

2．可以对单向链接结构里按顺序排列的元素执行二分搜索吗？如果不可以，为什么？

3．请说明为什么Python列表会使用数组而不是链接结构来保存它的元素。

## 4.6.链接上的变化

### 4.6.1.包含虚拟头节点的环状链接结构

### 4.6.2.双向链接结构

### 4.6.3.练习题

1．包含虚拟头节点的环状链接结构给程序员带来了什么好处？

2．和单向链接结构相比，请描述双向链接结构的一个好处和一个额外开销。

## 4.7.小结

- 数据结构是一个表示多项集里所包含数据的对象。
- 数组是一种在常数时间内支持对位置逐项随机访问的数据结构。在创建数组时，会为它分配若干个用来存放数据的内存空间，并且数组的长度会保持不变。插入和删除操作需要移动数据元素，并且可能需要创建一个新的、更大或更小的数组。
- 二维数组里的每个数据值都位于矩形网格的行和列上。
- 链接结构是由0个或多个节点组成的数据结构。每个节点都包含一个数据元素和一个或多个指向其他节点的链接。
- 单向链接结构的节点包含数据元素和到下一个节点的链接。双向链接结构里的节点还包含到前一个节点的链接。
- 在链接结构里进行插入或删除操作不需要移动数据元素，每次最多只会创建一个节点。但是，在链接结构里执行插入、删除和访问操作需要的时间复杂度都是线性的。
- 在链接结构里使用头节点可以简化某些操作，如添加或删除元素。

## 4.8.复习题

1．数组和链接结构都是：

- 抽象数据类型（ADT）
- 数据结构

2．数组的长度：

- 在创建之后大小是固定的
- 在创建之后大小可以增加或减少

3．在数组里进行随机访问支持在：

- 常数时间里访问数据
- 线性时间里访问数据

4．单向链接结构里的数据包含在：

- 单元里
- 节点里

5．对单向链接结构执行的大多数操作都需要：

- 常数时间
- 线性时间

6．从以下哪种类型里删除第一个元素需要常数时间：

- 数组
- 单向链接结构

7．在下面哪种情况下，数组里使用的内存会少于单向链接结构的：

- 不到一半的位置放置了数据
- 一半以上的位置放置了数据

8．当数组的内存不足以保存数据时，最好创建一个新的数组，这个新数组应该：

- 大小比旧数组多1个位置
- 大小是旧数组的2倍

9．对于单向链接结构，当你在什么地方执行插入操作会得到最坏情况下的运行时：

- 在结构的开头
- 在结构的末尾

10．双向链接结构让程序员可以移动到：

- 给定节点的后一个节点或前一个节点
- 给定节点的后一个节点

## 4.9.编程练习

在前6个项目里，你将修改在本章定义的Array类，从而让它更像Python的list类。对于这些项目的答案，请包含你对Array类所做修改的代码测试。

1．为Array类添加一个实例变量`logicalSize`。这个变量的初始值为`0`，用来记录数组里当前已经包含的元素数量。然后为Array类添加`size()`方法，这个方法用来返回数组的逻辑尺寸。`__len__`方法依然会返回数组的容量，也就是它的物理尺寸。

2．为Array类的`__getitem__`和_`_setitem__`方法添加先验条件。它们的先验条件是`0<=index < size()`。如果不满足先验条件，就引发异常。

3．将`grow`和`shrink`方法添加到Array类。它们能够基于本章所讨论的策略来增加或减少数组里所包含的列表长度。在实现时，要保证数组的物理尺寸不会缩小到用户指定的容量之下，并且在增加数组尺寸时，数组的内存单元将会用默认值来填充。

4．将方法`insert`和`pop`添加到Array类中。它们基于本章已经讨论过的策略，在需要的时候对数组的长度进行调整。`insert`方法会接收一个位置和一个元素值作为参数，然后把这个元素插入指定的位置。如果位置大于或等于数组的逻辑尺寸，那么这个方法会把元素插入数组里当前可获得的最后一个元素之后。`pop`方法会接收一个位置作为参数，然后删除并返回这个位置的元素。`pop`方法的先验条件是`0<=index < size()`。`pop`方法还应该把腾出来的数组内存单元重置为填充值。

5．将方法`__eq__`添加到Array类中。当Array对象作为`==`运算符的左操作数时，Python会运行这个方法。如果这个方法的参数也是一个Array对象，并且它的逻辑尺寸和左操作数相同，且在两个数组里每个逻辑位置上的元素都相等，那么这个方法会返回`True`；否则，这个方法返回`False`。

6．为了让Array类和列表一样，应该删除`__iter__`方法的当前实现。请解释这为什么是一个好建议，并说明在这个情况下应该如何对`__str__`方法进行修改。

7．`Matrix`类可以执行线性代数里的某些运算，比如矩阵运算。开发一个使用内置运算符进行算术运算的`Matrix`类，这个`Matrix`类应扩展自`Grid`类。在接下来的4个项目里，你应定义一些用来操作链接结构的函数。在解答的过程中，你应该继续使用本章定义的`Node`和`TwoWayNode`类。创建一个测试模块以包含你的函数定义和用来测试它们的代码。

8．定义一个叫作`length`的函数（不是`len`），这个函数会接受一个单向链接结构作为参数，并能够返回结构里的元素数量。

9．定义一个叫作`insert`的函数，这个函数具有把元素插入单向链接结构中指定位置的功能。这个函数有3个参数：元素、位置以及一个链接结构（这个链接结构可能为空）。这个函数能够返回修改之后的链接结构。如果传递的位置大于或等于链接结构的长度，那么这个函数会把元素插入它的末尾。这个函数的调用示例是`head =insert(1,data,head)`，其中`head`是一个变量，这个变量要么为空链接，要么指向链接结构的第一个节点。

10．定义一个叫作`pop`的函数，这个函数能够在单向链接结构的指定位置上删除元素。这个函数的第一个参数是位置，它的先验条件是`0<=position<结构的长度`。它的第二个参数是一个链接结构，很明显它不应该为空。这个函数将会返回一个元组，包含修改后的链接结构和删除的元素。它的调用示例是`(head, item) = pop(1,head)`。

11．定义一个函数`makeTwoWay`，这个函数会接受一个单向链接结构作为参数，然后生成并返回一个包含单向链接结构里的元素的双向链接结构。（注意：这个函数不应该对作为参数的链接结构进行任何修改。）
